"use strict";var oy=Object.create;var ki=Object.defineProperty;var ay=Object.getOwnPropertyDescriptor;var cy=Object.getOwnPropertyNames;var ly=Object.getPrototypeOf,uy=Object.prototype.hasOwnProperty;var fy=(t,e)=>()=>(t&&(e=t(t=0)),e);var w=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),dy=(t,e)=>{for(var r in e)ki(t,r,{get:e[r],enumerable:!0})},Ru=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of cy(e))!uy.call(t,s)&&s!==r&&ki(t,s,{get:()=>e[s],enumerable:!(n=ay(e,s))||n.enumerable});return t};var ze=(t,e,r)=>(r=t!=null?oy(ly(t)):{},Ru(e||!t||!t.__esModule?ki(r,"default",{value:t,enumerable:!0}):r,t)),ss=t=>Ru(ki({},"__esModule",{value:!0}),t);var is=w((Oa,Ra)=>{(function(t,e){typeof Oa=="object"&&typeof Ra<"u"?Ra.exports=e():typeof define=="function"&&define.amd?define(e):(t=typeof globalThis<"u"?globalThis:t||self).dayjs=e()})(Oa,function(){"use strict";var t=1e3,e=6e4,r=36e5,n="millisecond",s="second",i="minute",o="hour",a="day",c="week",l="month",f="quarter",u="year",d="date",p="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,_={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(U){var B=["th","st","nd","rd"],E=U%100;return"["+U+(B[(E-20)%10]||B[E]||B[0])+"]"}},x=function(U,B,E){var T=String(U);return!T||T.length>=B?U:""+Array(B+1-T.length).join(E)+U},te={s:x,z:function(U){var B=-U.utcOffset(),E=Math.abs(B),T=Math.floor(E/60),C=E%60;return(B<=0?"+":"-")+x(T,2,"0")+":"+x(C,2,"0")},m:function U(B,E){if(B.date()<E.date())return-U(E,B);var T=12*(E.year()-B.year())+(E.month()-B.month()),C=B.clone().add(T,l),L=E-C<0,H=B.clone().add(T+(L?-1:1),l);return+(-(T+(E-C)/(L?C-H:H-C))||0)},a:function(U){return U<0?Math.ceil(U)||0:Math.floor(U)},p:function(U){return{M:l,y:u,w:c,d:a,D:d,h:o,m:i,s,ms:n,Q:f}[U]||String(U||"").toLowerCase().replace(/s$/,"")},u:function(U){return U===void 0}},ne="en",ce={};ce[ne]=_;var zr="$isDayjsObject",ye=function(U){return U instanceof Xr||!(!U||!U[zr])},Ae=function U(B,E,T){var C;if(!B)return ne;if(typeof B=="string"){var L=B.toLowerCase();ce[L]&&(C=L),E&&(ce[L]=E,C=L);var H=B.split("-");if(!C&&H.length>1)return U(H[0])}else{var le=B.name;ce[le]=B,C=le}return!T&&C&&(ne=C),C||!T&&ne},se=function(U,B){if(ye(U))return U.clone();var E=typeof B=="object"?B:{};return E.date=U,E.args=arguments,new Xr(E)},W=te;W.l=Ae,W.i=ye,W.w=function(U,B){return se(U,{locale:B.$L,utc:B.$u,x:B.$x,$offset:B.$offset})};var Xr=function(){function U(E){this.$L=Ae(E.locale,null,!0),this.parse(E),this.$x=this.$x||E.x||{},this[zr]=!0}var B=U.prototype;return B.parse=function(E){this.$d=function(T){var C=T.date,L=T.utc;if(C===null)return new Date(NaN);if(W.u(C))return new Date;if(C instanceof Date)return new Date(C);if(typeof C=="string"&&!/Z$/i.test(C)){var H=C.match(m);if(H){var le=H[2]-1||0,Pe=(H[7]||"0").substring(0,3);return L?new Date(Date.UTC(H[1],le,H[3]||1,H[4]||0,H[5]||0,H[6]||0,Pe)):new Date(H[1],le,H[3]||1,H[4]||0,H[5]||0,H[6]||0,Pe)}}return new Date(C)}(E),this.init()},B.init=function(){var E=this.$d;this.$y=E.getFullYear(),this.$M=E.getMonth(),this.$D=E.getDate(),this.$W=E.getDay(),this.$H=E.getHours(),this.$m=E.getMinutes(),this.$s=E.getSeconds(),this.$ms=E.getMilliseconds()},B.$utils=function(){return W},B.isValid=function(){return this.$d.toString()!==p},B.isSame=function(E,T){var C=se(E);return this.startOf(T)<=C&&C<=this.endOf(T)},B.isAfter=function(E,T){return se(E)<this.startOf(T)},B.isBefore=function(E,T){return this.endOf(T)<se(E)},B.$g=function(E,T,C){return W.u(E)?this[T]:this.set(C,E)},B.unix=function(){return Math.floor(this.valueOf()/1e3)},B.valueOf=function(){return this.$d.getTime()},B.startOf=function(E,T){var C=this,L=!!W.u(T)||T,H=W.p(E),le=function(Zr,lt){var Rr=W.w(C.$u?Date.UTC(C.$y,lt,Zr):new Date(C.$y,lt,Zr),C);return L?Rr:Rr.endOf(a)},Pe=function(Zr,lt){return W.w(C.toDate()[Zr].apply(C.toDate("s"),(L?[0,0,0,0]:[23,59,59,999]).slice(lt)),C)},De=this.$W,We=this.$M,xt=this.$D,An="set"+(this.$u?"UTC":"");switch(H){case u:return L?le(1,0):le(31,11);case l:return L?le(1,We):le(0,We+1);case c:var Yr=this.$locale().weekStart||0,rs=(De<Yr?De+7:De)-Yr;return le(L?xt-rs:xt+(6-rs),We);case a:case d:return Pe(An+"Hours",0);case o:return Pe(An+"Minutes",1);case i:return Pe(An+"Seconds",2);case s:return Pe(An+"Milliseconds",3);default:return this.clone()}},B.endOf=function(E){return this.startOf(E,!1)},B.$set=function(E,T){var C,L=W.p(E),H="set"+(this.$u?"UTC":""),le=(C={},C[a]=H+"Date",C[d]=H+"Date",C[l]=H+"Month",C[u]=H+"FullYear",C[o]=H+"Hours",C[i]=H+"Minutes",C[s]=H+"Seconds",C[n]=H+"Milliseconds",C)[L],Pe=L===a?this.$D+(T-this.$W):T;if(L===l||L===u){var De=this.clone().set(d,1);De.$d[le](Pe),De.init(),this.$d=De.set(d,Math.min(this.$D,De.daysInMonth())).$d}else le&&this.$d[le](Pe);return this.init(),this},B.set=function(E,T){return this.clone().$set(E,T)},B.get=function(E){return this[W.p(E)]()},B.add=function(E,T){var C,L=this;E=Number(E);var H=W.p(T),le=function(We){var xt=se(L);return W.w(xt.date(xt.date()+Math.round(We*E)),L)};if(H===l)return this.set(l,this.$M+E);if(H===u)return this.set(u,this.$y+E);if(H===a)return le(1);if(H===c)return le(7);var Pe=(C={},C[i]=e,C[o]=r,C[s]=t,C)[H]||1,De=this.$d.getTime()+E*Pe;return W.w(De,this)},B.subtract=function(E,T){return this.add(-1*E,T)},B.format=function(E){var T=this,C=this.$locale();if(!this.isValid())return C.invalidDate||p;var L=E||"YYYY-MM-DDTHH:mm:ssZ",H=W.z(this),le=this.$H,Pe=this.$m,De=this.$M,We=C.weekdays,xt=C.months,An=C.meridiem,Yr=function(lt,Rr,ns,xi){return lt&&(lt[Rr]||lt(T,L))||ns[Rr].slice(0,xi)},rs=function(lt){return W.s(le%12||12,lt,"0")},Zr=An||function(lt,Rr,ns){var xi=lt<12?"AM":"PM";return ns?xi.toLowerCase():xi};return L.replace(g,function(lt,Rr){return Rr||function(ns){switch(ns){case"YY":return String(T.$y).slice(-2);case"YYYY":return W.s(T.$y,4,"0");case"M":return De+1;case"MM":return W.s(De+1,2,"0");case"MMM":return Yr(C.monthsShort,De,xt,3);case"MMMM":return Yr(xt,De);case"D":return T.$D;case"DD":return W.s(T.$D,2,"0");case"d":return String(T.$W);case"dd":return Yr(C.weekdaysMin,T.$W,We,2);case"ddd":return Yr(C.weekdaysShort,T.$W,We,3);case"dddd":return We[T.$W];case"H":return String(le);case"HH":return W.s(le,2,"0");case"h":return rs(1);case"hh":return rs(2);case"a":return Zr(le,Pe,!0);case"A":return Zr(le,Pe,!1);case"m":return String(Pe);case"mm":return W.s(Pe,2,"0");case"s":return String(T.$s);case"ss":return W.s(T.$s,2,"0");case"SSS":return W.s(T.$ms,3,"0");case"Z":return H}return null}(lt)||H.replace(":","")})},B.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},B.diff=function(E,T,C){var L,H=this,le=W.p(T),Pe=se(E),De=(Pe.utcOffset()-this.utcOffset())*e,We=this-Pe,xt=function(){return W.m(H,Pe)};switch(le){case u:L=xt()/12;break;case l:L=xt();break;case f:L=xt()/3;break;case c:L=(We-De)/6048e5;break;case a:L=(We-De)/864e5;break;case o:L=We/r;break;case i:L=We/e;break;case s:L=We/t;break;default:L=We}return C?L:W.a(L)},B.daysInMonth=function(){return this.endOf(l).$D},B.$locale=function(){return ce[this.$L]},B.locale=function(E,T){if(!E)return this.$L;var C=this.clone(),L=Ae(E,T,!0);return L&&(C.$L=L),C},B.clone=function(){return W.w(this.$d,this)},B.toDate=function(){return new Date(this.valueOf())},B.toJSON=function(){return this.isValid()?this.toISOString():null},B.toISOString=function(){return this.$d.toISOString()},B.toString=function(){return this.$d.toUTCString()},U}(),ts=Xr.prototype;return se.prototype=ts,[["$ms",n],["$s",s],["$m",i],["$H",o],["$W",a],["$M",l],["$y",u],["$D",d]].forEach(function(U){ts[U[1]]=function(B){return this.$g(B,U[0],U[1])}}),se.extend=function(U,B){return U.$i||(U(B,Xr,se),U.$i=!0),se},se.locale=Ae,se.isDayjs=ye,se.unix=function(U){return se(1e3*U)},se.en=ce[ne],se.Ls=ce,se.p={},se})});var Nu=w((Na,Ia)=>{(function(t,e){typeof Na=="object"&&typeof Ia<"u"?Ia.exports=e(is()):typeof define=="function"&&define.amd?define(["dayjs"],e):(t=typeof globalThis<"u"?globalThis:t||self).dayjs_locale_zh_cn=e(t.dayjs)})(Na,function(t){"use strict";function e(s){return s&&typeof s=="object"&&"default"in s?s:{default:s}}var r=e(t),n={name:"zh-cn",weekdays:"\u661F\u671F\u65E5_\u661F\u671F\u4E00_\u661F\u671F\u4E8C_\u661F\u671F\u4E09_\u661F\u671F\u56DB_\u661F\u671F\u4E94_\u661F\u671F\u516D".split("_"),weekdaysShort:"\u5468\u65E5_\u5468\u4E00_\u5468\u4E8C_\u5468\u4E09_\u5468\u56DB_\u5468\u4E94_\u5468\u516D".split("_"),weekdaysMin:"\u65E5_\u4E00_\u4E8C_\u4E09_\u56DB_\u4E94_\u516D".split("_"),months:"\u4E00\u6708_\u4E8C\u6708_\u4E09\u6708_\u56DB\u6708_\u4E94\u6708_\u516D\u6708_\u4E03\u6708_\u516B\u6708_\u4E5D\u6708_\u5341\u6708_\u5341\u4E00\u6708_\u5341\u4E8C\u6708".split("_"),monthsShort:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),ordinal:function(s,i){return i==="W"?s+"\u5468":s+"\u65E5"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY\u5E74M\u6708D\u65E5",LLL:"YYYY\u5E74M\u6708D\u65E5Ah\u70B9mm\u5206",LLLL:"YYYY\u5E74M\u6708D\u65E5ddddAh\u70B9mm\u5206",l:"YYYY/M/D",ll:"YYYY\u5E74M\u6708D\u65E5",lll:"YYYY\u5E74M\u6708D\u65E5 HH:mm",llll:"YYYY\u5E74M\u6708D\u65E5dddd HH:mm"},relativeTime:{future:"%s\u5185",past:"%s\u524D",s:"\u51E0\u79D2",m:"1 \u5206\u949F",mm:"%d \u5206\u949F",h:"1 \u5C0F\u65F6",hh:"%d \u5C0F\u65F6",d:"1 \u5929",dd:"%d \u5929",M:"1 \u4E2A\u6708",MM:"%d \u4E2A\u6708",y:"1 \u5E74",yy:"%d \u5E74"},meridiem:function(s,i){var o=100*s+i;return o<600?"\u51CC\u6668":o<900?"\u65E9\u4E0A":o<1100?"\u4E0A\u5348":o<1300?"\u4E2D\u5348":o<1800?"\u4E0B\u5348":"\u665A\u4E0A"}};return r.default.locale(n,null,!0),n})});var Lu=w((CA,Mu)=>{"use strict";Mu.exports=function(...t){try{return JSON.stringify(...t)}catch(e){return"[Cannot display object: "+e.message+"]"}}});var Ua=w((Hu,ju)=>{"use strict";var xy=Lu();ju.exports=class extends Error{constructor(t){let e=t.filter(r=>r!=="").map(r=>typeof r=="string"?r:r instanceof Error?r.message:xy(r));super(e.join(" ")||"Unknown error"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Hu.assert)}}});var Q=w((kA,Vu)=>{"use strict";var ky=Ua();Vu.exports=function(t,...e){if(!t)throw e.length===1&&e[0]instanceof Error?e[0]:new ky(e)}});var en=w((PA,qu)=>{"use strict";var Da=Q(),Fu={};qu.exports=function(t,e,r){if(e===!1||e===null||e===void 0)return t;r=r||{},typeof r=="string"&&(r={separator:r});let n=Array.isArray(e);Da(!n||!r.separator,"Separator option is not valid for array-based chain");let s=n?e:e.split(r.separator||"."),i=t;for(let o=0;o<s.length;++o){let a=s[o],c=r.iterables&&Fu.iterables(i);if(Array.isArray(i)||c==="set"){let l=Number(a);Number.isInteger(l)&&(a=l<0?i.length+l:l)}if(!i||typeof i=="function"&&r.functions===!1||!c&&i[a]===void 0){Da(!r.strict||o+1===s.length,"Missing segment",a,"in reach path ",e),Da(typeof i=="object"||r.functions===!0||typeof i!="function","Invalid segment",a,"in reach path ",e),i=r.default;break}c?c==="set"?i=[...i][a]:i=i.get(a):i=i[a]}return i};Fu.iterables=function(t){if(t instanceof Set)return"set";if(t instanceof Map)return"map"}});var Ma=w((et,Ju)=>{"use strict";var Gu={};et=Ju.exports={array:Array.prototype,buffer:Buffer&&Buffer.prototype,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype};Gu.typeMap=new Map([["[object Error]",et.error],["[object Map]",et.map],["[object Promise]",et.promise],["[object Set]",et.set],["[object WeakMap]",et.weakMap],["[object WeakSet]",et.weakSet]]);et.getInternalProto=function(t){if(Array.isArray(t))return et.array;if(Buffer&&t instanceof Buffer)return et.buffer;if(t instanceof Date)return et.date;if(t instanceof RegExp)return et.regex;if(t instanceof Error)return et.error;let e=Object.prototype.toString.call(t);return Gu.typeMap.get(e)||et.generic}});var La=w(Wu=>{"use strict";Wu.keys=function(t,e={}){return e.symbols!==!1?Reflect.ownKeys(t):Object.getOwnPropertyNames(t)}});var tt=w((OA,zu)=>{"use strict";var Py=en(),ht=Ma(),By=La(),dr={needsProtoHack:new Set([ht.set,ht.map,ht.weakSet,ht.weakMap])};zu.exports=dr.clone=function(t,e={},r=null){if(typeof t!="object"||t===null)return t;let n=dr.clone,s=r;if(e.shallow){if(e.shallow!==!0)return dr.cloneWithShallow(t,e);n=c=>c}else if(s){let c=s.get(t);if(c)return c}else s=new Map;let i=ht.getInternalProto(t);if(i===ht.buffer)return Buffer&&Buffer.from(t);if(i===ht.date)return new Date(t.getTime());if(i===ht.regex)return new RegExp(t);let o=dr.base(t,i,e);if(o===t)return t;if(s&&s.set(t,o),i===ht.set)for(let c of t)o.add(n(c,e,s));else if(i===ht.map)for(let[c,l]of t)o.set(c,n(l,e,s));let a=By.keys(t,e);for(let c of a){if(c==="__proto__")continue;if(i===ht.array&&c==="length"){o.length=t.length;continue}let l=Object.getOwnPropertyDescriptor(t,c);l?l.get||l.set?Object.defineProperty(o,c,l):l.enumerable?o[c]=n(t[c],e,s):Object.defineProperty(o,c,{enumerable:!1,writable:!0,configurable:!0,value:n(t[c],e,s)}):Object.defineProperty(o,c,{enumerable:!0,writable:!0,configurable:!0,value:n(t[c],e,s)})}return o};dr.cloneWithShallow=function(t,e){let r=e.shallow;e=Object.assign({},e),e.shallow=!1;let n=new Map;for(let s of r){let i=Py(t,s);(typeof i=="object"||typeof i=="function")&&n.set(i,i)}return dr.clone(t,e,n)};dr.base=function(t,e,r){if(r.prototype===!1)return dr.needsProtoHack.has(e)?new e.constructor:e===ht.array?[]:{};let n=Object.getPrototypeOf(t);if(n&&n.isImmutable)return t;if(e===ht.array){let s=[];return n!==e&&Object.setPrototypeOf(s,n),s}if(dr.needsProtoHack.has(e)){let s=new n.constructor;return n!==e&&Object.setPrototypeOf(s,n),s}return Object.create(n)}});var Xu=w((RA,Oy)=>{Oy.exports={name:"joi",description:"Object schema validation",version:"17.13.3",repository:"git://github.com/hapijs/joi",main:"lib/index.js",types:"lib/index.d.ts",browser:"dist/joi-browser.min.js",files:["lib/**/*","dist/*"],keywords:["schema","validation"],dependencies:{"@hapi/hoek":"^9.3.0","@hapi/topo":"^5.1.0","@sideway/address":"^4.1.5","@sideway/formula":"^3.0.1","@sideway/pinpoint":"^2.0.0"},devDependencies:{"@hapi/bourne":"2.x.x","@hapi/code":"8.x.x","@hapi/joi-legacy-test":"npm:@hapi/joi@15.x.x","@hapi/lab":"^25.1.3","@types/node":"^14.18.63",typescript:"4.3.x"},scripts:{prepublishOnly:"cd browser && npm install && npm run build",test:"lab -t 100 -a @hapi/code -L -Y","test-cov-html":"lab -r html -o coverage.html -a @hapi/code"},license:"BSD-3-Clause"}});var Ri=w(os=>{"use strict";var h=Ha(),j={};j.wrap=h.string().min(1).max(2).allow(!1);os.preferences=h.object({allowUnknown:h.boolean(),abortEarly:h.boolean(),artifacts:h.boolean(),cache:h.boolean(),context:h.object(),convert:h.boolean(),dateFormat:h.valid("date","iso","string","time","utc"),debug:h.boolean(),errors:{escapeHtml:h.boolean(),label:h.valid("path","key",!1),language:[h.string(),h.object().ref()],render:h.boolean(),stack:h.boolean(),wrap:{label:j.wrap,array:j.wrap,string:j.wrap}},externals:h.boolean(),messages:h.object(),noDefaults:h.boolean(),nonEnumerables:h.boolean(),presence:h.valid("required","optional","forbidden"),skipFunctions:h.boolean(),stripUnknown:h.object({arrays:h.boolean(),objects:h.boolean()}).or("arrays","objects").allow(!0,!1),warnings:h.boolean()}).strict();j.nameRx=/^[a-zA-Z0-9]\w*$/;j.rule=h.object({alias:h.array().items(h.string().pattern(j.nameRx)).single(),args:h.array().items(h.string(),h.object({name:h.string().pattern(j.nameRx).required(),ref:h.boolean(),assert:h.alternatives([h.function(),h.object().schema()]).conditional("ref",{is:!0,then:h.required()}),normalize:h.function(),message:h.string().when("assert",{is:h.function(),then:h.required()})})),convert:h.boolean(),manifest:h.boolean(),method:h.function().allow(!1),multi:h.boolean(),validate:h.function()});os.extension=h.object({type:h.alternatives([h.string(),h.object().regex()]).required(),args:h.function(),cast:h.object().pattern(j.nameRx,h.object({from:h.function().maxArity(1).required(),to:h.function().minArity(1).maxArity(2).required()})),base:h.object().schema().when("type",{is:h.object().regex(),then:h.forbidden()}),coerce:[h.function().maxArity(3),h.object({method:h.function().maxArity(3).required(),from:h.array().items(h.string()).single()})],flags:h.object().pattern(j.nameRx,h.object({setter:h.string(),default:h.any()})),manifest:{build:h.function().arity(2)},messages:[h.object(),h.string()],modifiers:h.object().pattern(j.nameRx,h.function().minArity(1).maxArity(2)),overrides:h.object().pattern(j.nameRx,h.function()),prepare:h.function().maxArity(3),rebuild:h.function().arity(1),rules:h.object().pattern(j.nameRx,j.rule),terms:h.object().pattern(j.nameRx,h.object({init:h.array().allow(null).required(),manifest:h.object().pattern(/.+/,[h.valid("schema","single"),h.object({mapped:h.object({from:h.string().required(),to:h.string().required()}).required()})])})),validate:h.function().maxArity(3)}).strict();os.extensions=h.array().items(h.object(),h.function().arity(1)).strict();j.desc={buffer:h.object({buffer:h.string()}),func:h.object({function:h.function().required(),options:{literal:!0}}),override:h.object({override:!0}),ref:h.object({ref:h.object({type:h.valid("value","global","local"),path:h.array().required(),separator:h.string().length(1).allow(!1),ancestor:h.number().min(0).integer().allow("root"),map:h.array().items(h.array().length(2)).min(1),adjust:h.function(),iterables:h.boolean(),in:h.boolean(),render:h.boolean()}).required()}),regex:h.object({regex:h.string().min(3)}),special:h.object({special:h.valid("deep").required()}),template:h.object({template:h.string().required(),options:h.object()}),value:h.object({value:h.alternatives([h.object(),h.array()]).required()})};j.desc.entity=h.alternatives([h.array().items(h.link("...")),h.boolean(),h.function(),h.number(),h.string(),j.desc.buffer,j.desc.func,j.desc.ref,j.desc.regex,j.desc.special,j.desc.template,j.desc.value,h.link("/")]);j.desc.values=h.array().items(null,h.boolean(),h.function(),h.number().allow(1/0,-1/0),h.string().allow(""),h.symbol(),j.desc.buffer,j.desc.func,j.desc.override,j.desc.ref,j.desc.regex,j.desc.template,j.desc.value);j.desc.messages=h.object().pattern(/.+/,[h.string(),j.desc.template,h.object().pattern(/.+/,[h.string(),j.desc.template])]);os.description=h.object({type:h.string().required(),flags:h.object({cast:h.string(),default:h.any(),description:h.string(),empty:h.link("/"),failover:j.desc.entity,id:h.string(),label:h.string(),only:!0,presence:["optional","required","forbidden"],result:["raw","strip"],strip:h.boolean(),unit:h.string()}).unknown(),preferences:{allowUnknown:h.boolean(),abortEarly:h.boolean(),artifacts:h.boolean(),cache:h.boolean(),convert:h.boolean(),dateFormat:["date","iso","string","time","utc"],errors:{escapeHtml:h.boolean(),label:["path","key"],language:[h.string(),j.desc.ref],wrap:{label:j.wrap,array:j.wrap}},externals:h.boolean(),messages:j.desc.messages,noDefaults:h.boolean(),nonEnumerables:h.boolean(),presence:["required","optional","forbidden"],skipFunctions:h.boolean(),stripUnknown:h.object({arrays:h.boolean(),objects:h.boolean()}).or("arrays","objects").allow(!0,!1),warnings:h.boolean()},allow:j.desc.values,invalid:j.desc.values,rules:h.array().min(1).items({name:h.string().required(),args:h.object().min(1),keep:h.boolean(),message:[h.string(),j.desc.messages],warn:h.boolean()}),keys:h.object().pattern(/.*/,h.link("/")),link:j.desc.ref}).pattern(/^[a-z]\w*$/,h.any())});var Zu=w((NA,Yu)=>{"use strict";var Tr={};Yu.exports=function(t){if(!t)return"";let e="";for(let r=0;r<t.length;++r){let n=t.charCodeAt(r);Tr.isSafe(n)?e+=t[r]:e+=Tr.escapeHtmlChar(n)}return e};Tr.escapeHtmlChar=function(t){let e=Tr.namedHtml.get(t);return e||(t>=256?"&#"+t+";":`&#x${t.toString(16).padStart(2,"0")};`)};Tr.isSafe=function(t){return Tr.safeCharCodes.has(t)};Tr.namedHtml=new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[34,"&quot;"],[160,"&nbsp;"],[162,"&cent;"],[163,"&pound;"],[164,"&curren;"],[169,"&copy;"],[174,"&reg;"]]);Tr.safeCharCodes=function(){let t=new Set;for(let e=32;e<123;++e)(e>=97||e>=65&&e<=90||e>=48&&e<=57||e===32||e===46||e===44||e===45||e===58||e===95)&&t.add(e);return t}()});var Qu=w(as=>{"use strict";var Y={operators:["!","^","*","/","%","+","-","<","<=",">",">=","==","!=","&&","||","??"],operatorCharacters:["!","^","*","/","%","+","-","<","=",">","&","|","?"],operatorsOrder:[["^"],["*","/","%"],["+","-"],["<","<=",">",">="],["==","!="],["&&"],["||","??"]],operatorsPrefix:["!","n"],literals:{'"':'"',"`":"`","'":"'","[":"]"},numberRx:/^(?:[0-9]*(\.[0-9]*)?){1}$/,tokenRx:/^[\w\$\#\.\@\:\{\}]+$/,symbol:Symbol("formula"),settings:Symbol("settings")};as.Parser=class{constructor(t,e={}){if(!e[Y.settings]&&e.constants)for(let r in e.constants){let n=e.constants[r];if(n!==null&&!["boolean","number","string"].includes(typeof n))throw new Error(`Formula constant ${r} contains invalid ${typeof n} value type`)}this.settings=e[Y.settings]?e:Object.assign({[Y.settings]:!0,constants:{},functions:{}},e),this.single=null,this._parts=null,this._parse(t)}_parse(t){let e=[],r="",n=0,s=!1,i=a=>{if(n)throw new Error("Formula missing closing parenthesis");let c=e.length?e[e.length-1]:null;if(!(!s&&!r&&!a)){if(c&&c.type==="reference"&&a===")"){c.type="function",c.value=this._subFormula(r,c.value),r="";return}if(a===")"){let l=new as.Parser(r,this.settings);e.push({type:"segment",value:l})}else if(s){if(s==="]"){e.push({type:"reference",value:r}),r="";return}e.push({type:"literal",value:r})}else if(Y.operatorCharacters.includes(r))c&&c.type==="operator"&&Y.operators.includes(c.value+r)?c.value+=r:e.push({type:"operator",value:r});else if(r.match(Y.numberRx))e.push({type:"constant",value:parseFloat(r)});else if(this.settings.constants[r]!==void 0)e.push({type:"constant",value:this.settings.constants[r]});else{if(!r.match(Y.tokenRx))throw new Error(`Formula contains invalid token: ${r}`);e.push({type:"reference",value:r})}r=""}};for(let a of t)s?a===s?(i(),s=!1):r+=a:n?a==="("?(r+=a,++n):a===")"?(--n,n?r+=a:i(a)):r+=a:a in Y.literals?s=Y.literals[a]:a==="("?(i(),++n):Y.operatorCharacters.includes(a)?(i(),r=a,i()):a!==" "?r+=a:i();i(),e=e.map((a,c)=>a.type!=="operator"||a.value!=="-"||c&&e[c-1].type!=="operator"?a:{type:"operator",value:"n"});let o=!1;for(let a of e){if(a.type==="operator"){if(Y.operatorsPrefix.includes(a.value))continue;if(!o)throw new Error("Formula contains an operator in invalid position");if(!Y.operators.includes(a.value))throw new Error(`Formula contains an unknown operator ${a.value}`)}else if(o)throw new Error("Formula missing expected operator");o=!o}if(!o)throw new Error("Formula contains invalid trailing operator");e.length===1&&["reference","literal","constant"].includes(e[0].type)&&(this.single={type:e[0].type==="reference"?"reference":"value",value:e[0].value}),this._parts=e.map(a=>{if(a.type==="operator")return Y.operatorsPrefix.includes(a.value)?a:a.value;if(a.type!=="reference")return a.value;if(this.settings.tokenRx&&!this.settings.tokenRx.test(a.value))throw new Error(`Formula contains invalid reference ${a.value}`);return this.settings.reference?this.settings.reference(a.value):Y.reference(a.value)})}_subFormula(t,e){let r=this.settings.functions[e];if(typeof r!="function")throw new Error(`Formula contains unknown function ${e}`);let n=[];if(t){let s="",i=0,o=!1,a=()=>{if(!s)throw new Error(`Formula contains function ${e} with invalid arguments ${t}`);n.push(s),s=""};for(let c=0;c<t.length;++c){let l=t[c];o?(s+=l,l===o&&(o=!1)):l in Y.literals&&!i?(s+=l,o=Y.literals[l]):l===","&&!i?a():(s+=l,l==="("?++i:l===")"&&--i)}a()}return n=n.map(s=>new as.Parser(s,this.settings)),function(s){let i=[];for(let o of n)i.push(o.evaluate(s));return r.call(s,...i)}}evaluate(t){let e=this._parts.slice();for(let r=e.length-2;r>=0;--r){let n=e[r];if(n&&n.type==="operator"){let s=e[r+1];e.splice(r+1,1);let i=Y.evaluate(s,t);e[r]=Y.single(n.value,i)}}return Y.operatorsOrder.forEach(r=>{for(let n=1;n<e.length-1;)if(r.includes(e[n])){let s=e[n],i=Y.evaluate(e[n-1],t),o=Y.evaluate(e[n+1],t);e.splice(n,2);let a=Y.calculate(s,i,o);e[n-1]=a===0?0:a}else n+=2}),Y.evaluate(e[0],t)}};as.Parser.prototype[Y.symbol]=!0;Y.reference=function(t){return function(e){return e&&e[t]!==void 0?e[t]:null}};Y.evaluate=function(t,e){return t===null?null:typeof t=="function"?t(e):t[Y.symbol]?t.evaluate(e):t};Y.single=function(t,e){if(t==="!")return!e;let r=-e;return r===0?0:r};Y.calculate=function(t,e,r){if(t==="??")return Y.exists(e)?e:r;if(typeof e=="string"||typeof r=="string"){if(t==="+")return e=Y.exists(e)?e:"",r=Y.exists(r)?r:"",e+r}else switch(t){case"^":return Math.pow(e,r);case"*":return e*r;case"/":return e/r;case"%":return e%r;case"+":return e+r;case"-":return e-r}switch(t){case"<":return e<r;case"<=":return e<=r;case">":return e>r;case">=":return e>=r;case"==":return e===r;case"!=":return e!==r;case"&&":return e&&r;case"||":return e||r}return null};Y.exists=function(t){return t!=null}});var tf=w(ef=>{"use strict";var Ry=tt(),Ty=ge(),tn={annotations:Symbol("annotations")};ef.error=function(t){if(!this._original||typeof this._original!="object")return this.details[0].message;let e=t?"":"\x1B[31m",r=t?"":"\x1B[41m",n=t?"":"\x1B[0m",s=Ry(this._original);for(let a=this.details.length-1;a>=0;--a){let c=a+1,l=this.details[a],f=l.path,u=s;for(let d=0;;++d){let p=f[d];if(Ty.isSchema(u)&&(u=u.clone()),d+1<f.length&&typeof u[p]!="string")u=u[p];else{let m=u[tn.annotations]||{errors:{},missing:{}};u[tn.annotations]=m;let g=p||l.context.key;u[p]!==void 0?(m.errors[g]=m.errors[g]||[],m.errors[g].push(c)):m.missing[g]=c;break}}}let i={key:/_\$key\$_([, \d]+)_\$end\$_"/g,missing:/"_\$miss\$_([^|]+)\|(\d+)_\$end\$_": "__missing__"/g,arrayIndex:/\s*"_\$idx\$_([, \d]+)_\$end\$_",?\n(.*)/g,specials:/"\[(NaN|Symbol.*|-?Infinity|function.*|\(.*)]"/g},o=tn.safeStringify(s,2).replace(i.key,(a,c)=>`" ${e}[${c}]${n}`).replace(i.missing,(a,c,l)=>`${r}"${c}"${n}${e} [${l}]: -- missing --${n}`).replace(i.arrayIndex,(a,c,l)=>`
${l} ${e}[${c}]${n}`).replace(i.specials,(a,c)=>c);o=`${o}
${e}`;for(let a=0;a<this.details.length;++a){let c=a+1;o=`${o}
[${c}] ${this.details[a].message}`}return o=o+n,o};tn.safeStringify=function(t,e){return JSON.stringify(t,tn.serializer(),e)};tn.serializer=function(){let t=[],e=[],r=(n,s)=>e[0]===s?"[Circular ~]":"[Circular ~."+t.slice(0,e.indexOf(s)).join(".")+"]";return function(n,s){if(e.length>0){let i=e.indexOf(this);~i?(e.length=i+1,t.length=i+1,t[i]=n):(e.push(this),t.push(n)),~e.indexOf(s)&&(s=r.call(this,n,s))}else e.push(s);if(s){let i=s[tn.annotations];if(i){if(Array.isArray(s)){let o=[];for(let a=0;a<s.length;++a)i.errors[a]&&o.push(`_$idx$_${i.errors[a].sort().join(", ")}_$end$_`),o.push(s[a]);s=o}else{for(let o in i.errors)s[`${o}_$key$_${i.errors[o].sort().join(", ")}_$end$_`]=s[o],s[o]=void 0;for(let o in i.missing)s[`_$miss$_${o}|${i.missing[o]}_$end$_`]="__missing__"}return s}}return s===1/0||s===-1/0||Number.isNaN(s)||typeof s=="function"||typeof s=="symbol"?"["+s.toString()+"]":s}}});var pr=w(Re=>{"use strict";var Ny=tf(),Iy=ge(),Ky=Nr();Re.Report=class{constructor(t,e,r,n,s,i,o){if(this.code=t,this.flags=n,this.messages=s,this.path=i.path,this.prefs=o,this.state=i,this.value=e,this.message=null,this.template=null,this.local=r||{},this.local.label=Re.label(this.flags,this.state,this.prefs,this.messages),this.value!==void 0&&!this.local.hasOwnProperty("value")&&(this.local.value=this.value),this.path.length){let a=this.path[this.path.length-1];typeof a!="object"&&(this.local.key=a)}}_setTemplate(t){if(this.template=t,!this.flags.label&&this.path.length===0){let e=this._template(this.template,"root");e&&(this.local.label=e)}}toString(){if(this.message)return this.message;let t=this.code;if(!this.prefs.errors.render)return this.code;let e=this._template(this.template)||this._template(this.prefs.messages)||this._template(this.messages);return e===void 0?`Error code "${t}" is not defined, your custom type is missing the correct messages definition`:(this.message=e.render(this.value,this.state,this.prefs,this.local,{errors:this.prefs.errors,messages:[this.prefs.messages,this.messages]}),this.prefs.errors.label||(this.message=this.message.replace(/^"" /,"").trim()),this.message)}_template(t,e){return Re.template(this.value,t,e||this.code,this.state,this.prefs)}};Re.path=function(t){let e="";for(let r of t)typeof r!="object"&&(typeof r=="string"?(e&&(e+="."),e+=r):e+=`[${r}]`);return e};Re.template=function(t,e,r,n,s){if(!e)return;if(Ky.isTemplate(e))return r!=="root"?e:null;let i=s.errors.language;if(Iy.isResolvable(i)&&(i=i.resolve(t,n,s)),i&&e[i]){if(e[i][r]!==void 0)return e[i][r];if(e[i]["*"]!==void 0)return e[i]["*"]}return e[r]?e[r]:e["*"]};Re.label=function(t,e,r,n){if(!r.errors.label)return"";if(t.label)return t.label;let s=e.path;r.errors.label==="key"&&e.path.length>1&&(s=e.path.slice(-1));let i=Re.path(s);return i||Re.template(null,r.messages,"root",e,r)||n&&Re.template(null,n,"root",e,r)||"value"};Re.process=function(t,e,r){if(!t)return null;let{override:n,message:s,details:i}=Re.details(t);if(n)return n;if(r.errors.stack)return new Re.ValidationError(s,i,e);let o=Error.stackTraceLimit;Error.stackTraceLimit=0;let a=new Re.ValidationError(s,i,e);return Error.stackTraceLimit=o,a};Re.details=function(t,e={}){let r=[],n=[];for(let s of t){if(s instanceof Error){if(e.override!==!1)return{override:s};let o=s.toString();r.push(o),n.push({message:o,type:"override",context:{error:s}});continue}let i=s.toString();r.push(i),n.push({message:i,path:s.path.filter(o=>typeof o!="object"),type:s.code,context:s.local})}return r.length>1&&(r=[...new Set(r)]),{message:r.join(". "),details:n}};Re.ValidationError=class extends Error{constructor(t,e,r){super(t),this._original=r,this.details=e}static isError(t){return t instanceof Re.ValidationError}};Re.ValidationError.prototype.isJoi=!0;Re.ValidationError.prototype.name="ValidationError";Re.ValidationError.prototype.annotate=Ny.error});var hr=w(Bt=>{"use strict";var kt=Q(),$y=tt(),Uy=en(),cs=ge(),ja,Pt={symbol:Symbol("ref"),defaults:{adjust:null,in:!1,iterables:null,map:null,separator:".",type:"value"}};Bt.create=function(t,e={}){kt(typeof t=="string","Invalid reference key:",t),cs.assertOptions(e,["adjust","ancestor","in","iterables","map","prefix","render","separator"]),kt(!e.prefix||typeof e.prefix=="object","options.prefix must be of type object");let r=Object.assign({},Pt.defaults,e);delete r.prefix;let n=r.separator,s=Pt.context(t,n,e.prefix);if(r.type=s.type,t=s.key,r.type==="value")if(s.root&&(kt(!n||t[0]!==n,"Cannot specify relative path with root prefix"),r.ancestor="root",t||(t=null)),n&&n===t)t=null,r.ancestor=0;else if(r.ancestor!==void 0)kt(!n||!t||t[0]!==n,"Cannot combine prefix with ancestor option");else{let[i,o]=Pt.ancestor(t,n);o&&(t=t.slice(o),t===""&&(t=null)),r.ancestor=i}return r.path=n?t===null?[]:t.split(n):[t],new Pt.Ref(r)};Bt.in=function(t,e={}){return Bt.create(t,{...e,in:!0})};Bt.isRef=function(t){return t?!!t[cs.symbols.ref]:!1};Pt.Ref=class{constructor(t){kt(typeof t=="object","Invalid reference construction"),cs.assertOptions(t,["adjust","ancestor","in","iterables","map","path","render","separator","type","depth","key","root","display"]),kt([!1,void 0].includes(t.separator)||typeof t.separator=="string"&&t.separator.length===1,"Invalid separator"),kt(!t.adjust||typeof t.adjust=="function","options.adjust must be a function"),kt(!t.map||Array.isArray(t.map),"options.map must be an array"),kt(!t.map||!t.adjust,"Cannot set both map and adjust options"),Object.assign(this,Pt.defaults,t),kt(this.type==="value"||this.ancestor===void 0,"Non-value references cannot reference ancestors"),Array.isArray(this.map)&&(this.map=new Map(this.map)),this.depth=this.path.length,this.key=this.path.length?this.path.join(this.separator):null,this.root=this.path[0],this.updateDisplay()}resolve(t,e,r,n,s={}){return kt(!this.in||s.in,"Invalid in() reference usage"),this.type==="global"?this._resolve(r.context,e,s):this.type==="local"?this._resolve(n,e,s):this.ancestor?this.ancestor==="root"?this._resolve(e.ancestors[e.ancestors.length-1],e,s):(kt(this.ancestor<=e.ancestors.length,"Invalid reference exceeds the schema root:",this.display),this._resolve(e.ancestors[this.ancestor-1],e,s)):this._resolve(t,e,s)}_resolve(t,e,r){let n;if(this.type==="value"&&e.mainstay.shadow&&r.shadow!==!1&&(n=e.mainstay.shadow.get(this.absolute(e))),n===void 0&&(n=Uy(t,this.path,{iterables:this.iterables,functions:!0})),this.adjust&&(n=this.adjust(n)),this.map){let s=this.map.get(n);s!==void 0&&(n=s)}return e.mainstay&&e.mainstay.tracer.resolve(e,this,n),n}toString(){return this.display}absolute(t){return[...t.path.slice(0,-this.ancestor),...this.path]}clone(){return new Pt.Ref(this)}describe(){let t={path:this.path};this.type!=="value"&&(t.type=this.type),this.separator!=="."&&(t.separator=this.separator),this.type==="value"&&this.ancestor!==1&&(t.ancestor=this.ancestor),this.map&&(t.map=[...this.map]);for(let e of["adjust","iterables","render"])this[e]!==null&&this[e]!==void 0&&(t[e]=this[e]);return this.in!==!1&&(t.in=!0),{ref:t}}updateDisplay(){let t=this.key!==null?this.key:"";if(this.type!=="value"){this.display=`ref:${this.type}:${t}`;return}if(!this.separator){this.display=`ref:${t}`;return}if(!this.ancestor){this.display=`ref:${this.separator}${t}`;return}if(this.ancestor==="root"){this.display=`ref:root:${t}`;return}if(this.ancestor===1){this.display=`ref:${t||".."}`;return}let e=new Array(this.ancestor+1).fill(this.separator).join("");this.display=`ref:${e}${t||""}`}};Pt.Ref.prototype[cs.symbols.ref]=!0;Bt.build=function(t){return t=Object.assign({},Pt.defaults,t),t.type==="value"&&t.ancestor===void 0&&(t.ancestor=1),new Pt.Ref(t)};Pt.context=function(t,e,r={}){if(t=t.trim(),r){let n=r.global===void 0?"$":r.global;if(n!==e&&t.startsWith(n))return{key:t.slice(n.length),type:"global"};let s=r.local===void 0?"#":r.local;if(s!==e&&t.startsWith(s))return{key:t.slice(s.length),type:"local"};let i=r.root===void 0?"/":r.root;if(i!==e&&t.startsWith(i))return{key:t.slice(i.length),type:"value",root:!0}}return{key:t,type:"value"}};Pt.ancestor=function(t,e){if(!e)return[1,0];if(t[0]!==e)return[1,0];if(t[1]!==e)return[0,1];let r=2;for(;t[r]===e;)++r;return[r-1,r]};Bt.toSibling=0;Bt.toParent=1;Bt.Manager=class{constructor(){this.refs=[]}register(t,e){if(t){if(e=e===void 0?Bt.toParent:e,Array.isArray(t)){for(let r of t)this.register(r,e);return}if(cs.isSchema(t)){for(let r of t._refs.refs)r.ancestor-e>=0&&this.refs.push({ancestor:r.ancestor-e,root:r.root});return}Bt.isRef(t)&&t.type==="value"&&t.ancestor-e>=0&&this.refs.push({ancestor:t.ancestor-e,root:t.root}),ja=ja||Nr(),ja.isTemplate(t)&&this.register(t.refs(),e)}}get length(){return this.refs.length}clone(){let t=new Bt.Manager;return t.refs=$y(this.refs),t}reset(){this.refs=[]}roots(){return this.refs.filter(t=>!t.ancestor).map(t=>t.root)}}});var Nr=w((of,af)=>{"use strict";var Ti=Q(),Dy=tt(),My=Zu(),Ly=Qu(),nf=ge(),rf=pr(),sf=hr(),ie={symbol:Symbol("template"),opens:new Array(1e3).join("\0"),closes:new Array(1e3).join(""),dateFormat:{date:Date.prototype.toDateString,iso:Date.prototype.toISOString,string:Date.prototype.toString,time:Date.prototype.toTimeString,utc:Date.prototype.toUTCString}};af.exports=of=ie.Template=class{constructor(t,e){if(Ti(typeof t=="string","Template source must be a string"),Ti(!t.includes("\0")&&!t.includes(""),"Template source cannot contain reserved control characters"),this.source=t,this.rendered=t,this._template=null,e){let{functions:r,...n}=e;this._settings=Object.keys(n).length?Dy(n):void 0,this._functions=r,this._functions&&(Ti(Object.keys(this._functions).every(s=>typeof s=="string"),"Functions keys must be strings"),Ti(Object.values(this._functions).every(s=>typeof s=="function"),"Functions values must be functions"))}else this._settings=void 0,this._functions=void 0;this._parse()}_parse(){if(!this.source.includes("{"))return;let t=ie.encode(this.source),e=ie.split(t),r=!1,n=[],s=e.shift();s&&n.push(s);for(let i of e){let o=i[0]!=="{",a=o?"}":"}}",c=i.indexOf(a);if(c===-1||i[1]==="{"){n.push(`{${ie.decode(i)}`);continue}let l=i.slice(o?0:1,c),f=l[0]===":";f&&(l=l.slice(1));let u=this._ref(ie.decode(l),{raw:o,wrapped:f});n.push(u),typeof u!="string"&&(r=!0);let d=i.slice(c+a.length);d&&n.push(ie.decode(d))}if(!r){this.rendered=n.join("");return}this._template=n}static date(t,e){return ie.dateFormat[e.dateFormat].call(t)}describe(t={}){if(!this._settings&&t.compact)return this.source;let e={template:this.source};return this._settings&&(e.options=this._settings),this._functions&&(e.functions=this._functions),e}static build(t){return new ie.Template(t.template,t.options||t.functions?{...t.options,functions:t.functions}:void 0)}isDynamic(){return!!this._template}static isTemplate(t){return t?!!t[nf.symbols.template]:!1}refs(){if(!this._template)return;let t=[];for(let e of this._template)typeof e!="string"&&t.push(...e.refs);return t}resolve(t,e,r,n){return this._template&&this._template.length===1?this._part(this._template[0],t,e,r,n,{}):this.render(t,e,r,n)}_part(t,...e){return t.ref?t.ref.resolve(...e):t.formula.evaluate(e)}render(t,e,r,n,s={}){if(!this.isDynamic())return this.rendered;let i=[];for(let o of this._template)if(typeof o=="string")i.push(o);else{let a=this._part(o,t,e,r,n,s),c=ie.stringify(a,t,e,r,n,s);if(c!==void 0){let l=o.raw||(s.errors&&s.errors.escapeHtml)===!1?c:My(c);i.push(ie.wrap(l,o.wrapped&&r.errors.wrap.label))}}return i.join("")}_ref(t,{raw:e,wrapped:r}){let n=[],s=o=>{let a=sf.create(o,this._settings);return n.push(a),c=>{let l=a.resolve(...c);return l!==void 0?l:null}};try{let o=this._functions?{...ie.functions,...this._functions}:ie.functions;var i=new Ly.Parser(t,{reference:s,functions:o,constants:ie.constants})}catch(o){throw o.message=`Invalid template variable "${t}" fails due to: ${o.message}`,o}if(i.single){if(i.single.type==="reference"){let o=n[0];return{ref:o,raw:e,refs:n,wrapped:r||o.type==="local"&&o.key==="label"}}return ie.stringify(i.single.value)}return{formula:i,raw:e,refs:n}}toString(){return this.source}};ie.Template.prototype[nf.symbols.template]=!0;ie.Template.prototype.isImmutable=!0;ie.encode=function(t){return t.replace(/\\(\{+)/g,(e,r)=>ie.opens.slice(0,r.length)).replace(/\\(\}+)/g,(e,r)=>ie.closes.slice(0,r.length))};ie.decode=function(t){return t.replace(/\u0000/g,"{").replace(/\u0001/g,"}")};ie.split=function(t){let e=[],r="";for(let n=0;n<t.length;++n){let s=t[n];if(s==="{"){let i="";for(;n+1<t.length&&t[n+1]==="{";)i+="{",++n;e.push(r),r=i}else r+=s}return e.push(r),e};ie.wrap=function(t,e){return e?e.length===1?`${e}${t}${e}`:`${e[0]}${t}${e[1]}`:t};ie.stringify=function(t,e,r,n,s,i={}){let o=typeof t,a=n&&n.errors&&n.errors.wrap||{},c=!1;if(sf.isRef(t)&&t.render&&(c=t.in,t=t.resolve(e,r,n,s,{in:t.in,...i})),t===null)return"null";if(o==="string")return ie.wrap(t,i.arrayItems&&a.string);if(o==="number"||o==="function"||o==="symbol")return t.toString();if(o!=="object")return JSON.stringify(t);if(t instanceof Date)return ie.Template.date(t,n);if(t instanceof Map){let f=[];for(let[u,d]of t.entries())f.push(`${u.toString()} -> ${d.toString()}`);t=f}if(!Array.isArray(t))return t.toString();let l=[];for(let f of t)l.push(ie.stringify(f,e,r,n,s,{arrayItems:!0,...i}));return ie.wrap(l.join(", "),!c&&a.array)};ie.constants={true:!0,false:!1,null:null,second:1e3,minute:60*1e3,hour:60*60*1e3,day:24*60*60*1e3};ie.functions={if(t,e,r){return t?e:r},length(t){return typeof t=="string"?t.length:!t||typeof t!="object"?null:Array.isArray(t)?t.length:Object.keys(t).length},msg(t){let[e,r,n,s,i]=this,o=i.messages;if(!o)return"";let a=rf.template(e,o[0],t,r,n)||rf.template(e,o[1],t,r,n);return a?a.render(e,r,n,s,i):""},number(t){return typeof t=="number"?t:typeof t=="string"?parseFloat(t):typeof t=="boolean"?t?1:0:t instanceof Date?t.getTime():null}}});var En=w(ls=>{"use strict";var rn=Q(),cf=tt(),mt=Nr();ls.compile=function(t,e){if(typeof t=="string")return rn(!e,"Cannot set single message string"),new mt(t);if(mt.isTemplate(t))return rn(!e,"Cannot set single message template"),t;rn(typeof t=="object"&&!Array.isArray(t),"Invalid message options"),e=e?cf(e):{};for(let r in t){let n=t[r];if(r==="root"||mt.isTemplate(n)){e[r]=n;continue}if(typeof n=="string"){e[r]=new mt(n);continue}rn(typeof n=="object"&&!Array.isArray(n),"Invalid message for",r);let s=r;e[s]=e[s]||{};for(r in n){let i=n[r];if(r==="root"||mt.isTemplate(i)){e[s][r]=i;continue}rn(typeof i=="string","Invalid message for",r,"in",s),e[s][r]=new mt(i)}}return e};ls.decompile=function(t){let e={};for(let r in t){let n=t[r];if(r==="root"){e.root=n;continue}if(mt.isTemplate(n)){e[r]=n.describe({compact:!0});continue}let s=r;e[s]={};for(r in n){let i=n[r];if(r==="root"){e[s].root=i;continue}e[s][r]=i.describe({compact:!0})}}return e};ls.merge=function(t,e){if(!t)return ls.compile(e);if(!e)return t;if(typeof e=="string")return new mt(e);if(mt.isTemplate(e))return e;let r=cf(t);for(let n in e){let s=e[n];if(n==="root"||mt.isTemplate(s)){r[n]=s;continue}if(typeof s=="string"){r[n]=new mt(s);continue}rn(typeof s=="object"&&!Array.isArray(s),"Invalid message for",n);let i=n;r[i]=r[i]||{};for(n in s){let o=s[n];if(n==="root"||mt.isTemplate(o)){r[i][n]=o;continue}rn(typeof o=="string","Invalid message for",n,"in",i),r[i][n]=new mt(o)}}return r}});var ge=w(_e=>{"use strict";var Ni=Q(),Hy=Ua(),jy=Xu(),Va,Fa,Vy={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};_e.version=jy.version;_e.defaults={abortEarly:!0,allowUnknown:!1,artifacts:!1,cache:!0,context:null,convert:!0,dateFormat:"iso",errors:{escapeHtml:!1,label:"path",language:null,render:!0,stack:!1,wrap:{label:'"',array:"[]"}},externals:!0,messages:{},nonEnumerables:!1,noDefaults:!1,presence:"optional",skipFunctions:!1,stripUnknown:!1,warnings:!1};_e.symbols={any:Symbol.for("@hapi/joi/schema"),arraySingle:Symbol("arraySingle"),deepDefault:Symbol("deepDefault"),errors:Symbol("errors"),literal:Symbol("literal"),override:Symbol("override"),parent:Symbol("parent"),prefs:Symbol("prefs"),ref:Symbol("ref"),template:Symbol("template"),values:Symbol("values")};_e.assertOptions=function(t,e,r="Options"){Ni(t&&typeof t=="object"&&!Array.isArray(t),"Options must be of type object");let n=Object.keys(t).filter(s=>!e.includes(s));Ni(n.length===0,`${r} contain unknown keys: ${n}`)};_e.checkPreferences=function(t){Fa=Fa||Ri();let e=Fa.preferences.validate(t);if(e.error)throw new Hy([e.error.details[0].message])};_e.compare=function(t,e,r){switch(r){case"=":return t===e;case">":return t>e;case"<":return t<e;case">=":return t>=e;case"<=":return t<=e}};_e.default=function(t,e){return t===void 0?e:t};_e.isIsoDate=function(t){return Vy.isoDate.test(t)};_e.isNumber=function(t){return typeof t=="number"&&!isNaN(t)};_e.isResolvable=function(t){return t?t[_e.symbols.ref]||t[_e.symbols.template]:!1};_e.isSchema=function(t,e={}){let r=t&&t[_e.symbols.any];return r?(Ni(e.legacy||r.version===_e.version,"Cannot mix different versions of joi schemas"),!0):!1};_e.isValues=function(t){return t[_e.symbols.values]};_e.limit=function(t){return Number.isSafeInteger(t)&&t>=0};_e.preferences=function(t,e){Va=Va||En(),t=t||{},e=e||{};let r=Object.assign({},t,e);return e.errors&&t.errors&&(r.errors=Object.assign({},t.errors,e.errors),r.errors.wrap=Object.assign({},t.errors.wrap,e.errors.wrap)),e.messages&&(r.messages=Va.compile(e.messages,t.messages)),delete r[_e.symbols.prefs],r};_e.tryWithPath=function(t,e,r={}){try{return t()}catch(n){throw n.path!==void 0?n.path=e+"."+n.path:n.path=e,r.append&&(n.message=`${n.message} (${n.path})`),n}};_e.validateArg=function(t,e,{assert:r,message:n}){if(_e.isSchema(r)){let s=r.validate(t);return s.error?s.error.message:void 0}else if(!r(t))return e?`${e} ${n}`:n};_e.verifyFlat=function(t,e){for(let r of t)Ni(!Array.isArray(r),"Method no longer accepts array arguments:",e)}});var qa=w(lf=>{"use strict";var Fy=Q(),qy=tt(),Gy=ge(),Cn={max:1e3,supported:new Set(["undefined","boolean","number","string"])};lf.provider={provision(t){return new Cn.Cache(t)}};Cn.Cache=class{constructor(t={}){Gy.assertOptions(t,["max"]),Fy(t.max===void 0||t.max&&t.max>0&&isFinite(t.max),"Invalid max cache size"),this._max=t.max||Cn.max,this._map=new Map,this._list=new Cn.List}get length(){return this._map.size}set(t,e){if(t!==null&&!Cn.supported.has(typeof t))return;let r=this._map.get(t);if(r){r.value=e,this._list.first(r);return}r=this._list.unshift({key:t,value:e}),this._map.set(t,r),this._compact()}get(t){let e=this._map.get(t);if(e)return this._list.first(e),qy(e.value)}_compact(){if(this._map.size>this._max){let t=this._list.pop();this._map.delete(t.key)}}};Cn.List=class{constructor(){this.tail=null,this.head=null}unshift(t){return t.next=null,t.prev=this.head,this.head&&(this.head.next=t),this.head=t,this.tail||(this.tail=t),t}first(t){t!==this.head&&(this._remove(t),this.unshift(t))}pop(){return this._remove(this.tail)}_remove(t){let{next:e,prev:r}=t;return e.prev=r,r&&(r.next=e),t===this.tail&&(this.tail=e),t.prev=null,t.next=null,t}}});var nn=w(mr=>{"use strict";var xe=Q(),yt=ge(),xn=hr(),Ot={};mr.schema=function(t,e,r={}){yt.assertOptions(r,["appendPath","override"]);try{return Ot.schema(t,e,r)}catch(n){throw r.appendPath&&n.path!==void 0&&(n.message=`${n.message} (${n.path})`),n}};Ot.schema=function(t,e,r){xe(e!==void 0,"Invalid undefined schema"),Array.isArray(e)&&(xe(e.length,"Invalid empty array schema"),e.length===1&&(e=e[0]));let n=(s,...i)=>r.override!==!1?s.valid(t.override,...i):s.valid(...i);if(Ot.simple(e))return n(t,e);if(typeof e=="function")return t.custom(e);if(xe(typeof e=="object","Invalid schema content:",typeof e),yt.isResolvable(e))return n(t,e);if(yt.isSchema(e))return e;if(Array.isArray(e)){for(let s of e)if(!Ot.simple(s))return t.alternatives().try(...e);return n(t,...e)}return e instanceof RegExp?t.string().regex(e):e instanceof Date?n(t.date(),e):(xe(Object.getPrototypeOf(e)===Object.getPrototypeOf({}),"Schema can only contain plain objects"),t.object().keys(e))};mr.ref=function(t,e){return xn.isRef(t)?t:xn.create(t,e)};mr.compile=function(t,e,r={}){yt.assertOptions(r,["legacy"]);let n=e&&e[yt.symbols.any];if(n)return xe(r.legacy||n.version===yt.version,"Cannot mix different versions of joi schemas:",n.version,yt.version),e;if(typeof e!="object"||!r.legacy)return mr.schema(t,e,{appendPath:!0});let s=Ot.walk(e);return s?s.compile(s.root,e):mr.schema(t,e,{appendPath:!0})};Ot.walk=function(t){if(typeof t!="object")return null;if(Array.isArray(t)){for(let r of t){let n=Ot.walk(r);if(n)return n}return null}let e=t[yt.symbols.any];if(e)return{root:t[e.root],compile:e.compile};xe(Object.getPrototypeOf(t)===Object.getPrototypeOf({}),"Schema can only contain plain objects");for(let r in t){let n=Ot.walk(t[r]);if(n)return n}return null};Ot.simple=function(t){return t===null||["boolean","string","number"].includes(typeof t)};mr.when=function(t,e,r){if(r===void 0&&(xe(e&&typeof e=="object","Missing options"),r=e,e=xn.create(".")),Array.isArray(r)&&(r={switch:r}),yt.assertOptions(r,["is","not","then","otherwise","switch","break"]),yt.isSchema(e))return xe(r.is===void 0,'"is" can not be used with a schema condition'),xe(r.not===void 0,'"not" can not be used with a schema condition'),xe(r.switch===void 0,'"switch" can not be used with a schema condition'),Ot.condition(t,{is:e,then:r.then,otherwise:r.otherwise,break:r.break});if(xe(xn.isRef(e)||typeof e=="string","Invalid condition:",e),xe(r.not===void 0||r.is===void 0,'Cannot combine "is" with "not"'),r.switch===void 0){let s=r;r.not!==void 0&&(s={is:r.not,then:r.otherwise,otherwise:r.then,break:r.break});let i=s.is!==void 0?t.$_compile(s.is):t.$_root.invalid(null,!1,0,"").required();return xe(s.then!==void 0||s.otherwise!==void 0,'options must have at least one of "then", "otherwise", or "switch"'),xe(s.break===void 0||s.then===void 0||s.otherwise===void 0,"Cannot specify then, otherwise, and break all together"),r.is!==void 0&&!xn.isRef(r.is)&&!yt.isSchema(r.is)&&(i=i.required()),Ot.condition(t,{ref:mr.ref(e),is:i,then:s.then,otherwise:s.otherwise,break:s.break})}xe(Array.isArray(r.switch),'"switch" must be an array'),xe(r.is===void 0,'Cannot combine "switch" with "is"'),xe(r.not===void 0,'Cannot combine "switch" with "not"'),xe(r.then===void 0,'Cannot combine "switch" with "then"');let n={ref:mr.ref(e),switch:[],break:r.break};for(let s=0;s<r.switch.length;++s){let i=r.switch[s],o=s===r.switch.length-1;yt.assertOptions(i,o?["is","then","otherwise"]:["is","then"]),xe(i.is!==void 0,'Switch statement missing "is"'),xe(i.then!==void 0,'Switch statement missing "then"');let a={is:t.$_compile(i.is),then:t.$_compile(i.then)};if(!xn.isRef(i.is)&&!yt.isSchema(i.is)&&(a.is=a.is.required()),o){xe(r.otherwise===void 0||i.otherwise===void 0,'Cannot specify "otherwise" inside and outside a "switch"');let c=r.otherwise!==void 0?r.otherwise:i.otherwise;c!==void 0&&(xe(n.break===void 0,"Cannot specify both otherwise and break"),a.otherwise=t.$_compile(c))}n.switch.push(a)}return n};Ot.condition=function(t,e){for(let r of["then","otherwise"])e[r]===void 0?delete e[r]:e[r]=t.$_compile(e[r]);return e}});var Ga=w(ff=>{"use strict";var Ir=Q(),Jy=tt(),uf=ge(),Wy=En(),Qt={};ff.type=function(t,e){let r=Object.getPrototypeOf(t),n=Jy(r),s=t._assign(Object.create(n)),i=Object.assign({},e);delete i.base,n._definition=i;let o=r._definition||{};i.messages=Wy.merge(o.messages,i.messages),i.properties=Object.assign({},o.properties,i.properties),s.type=i.type,i.flags=Object.assign({},o.flags,i.flags);let a=Object.assign({},o.terms);if(i.terms)for(let u in i.terms){let d=i.terms[u];Ir(s.$_terms[u]===void 0,"Invalid term override for",i.type,u),s.$_terms[u]=d.init,a[u]=d}i.terms=a,i.args||(i.args=o.args),i.prepare=Qt.prepare(i.prepare,o.prepare),i.coerce&&(typeof i.coerce=="function"&&(i.coerce={method:i.coerce}),i.coerce.from&&!Array.isArray(i.coerce.from)&&(i.coerce={method:i.coerce.method,from:[].concat(i.coerce.from)})),i.coerce=Qt.coerce(i.coerce,o.coerce),i.validate=Qt.validate(i.validate,o.validate);let c=Object.assign({},o.rules);if(i.rules)for(let u in i.rules){let d=i.rules[u];Ir(typeof d=="object","Invalid rule definition for",i.type,u);let p=d.method;if(p===void 0&&(p=function(){return this.$_addRule(u)}),p&&(Ir(!n[u],"Rule conflict in",i.type,u),n[u]=p),Ir(!c[u],"Rule conflict in",i.type,u),c[u]=d,d.alias){let m=[].concat(d.alias);for(let g of m)n[g]=d.method}d.args&&(d.argsByName=new Map,d.args=d.args.map(m=>(typeof m=="string"&&(m={name:m}),Ir(!d.argsByName.has(m.name),"Duplicated argument name",m.name),uf.isSchema(m.assert)&&(m.assert=m.assert.strict().label(m.name)),d.argsByName.set(m.name,m),m)))}i.rules=c;let l=Object.assign({},o.modifiers);if(i.modifiers)for(let u in i.modifiers){Ir(!n[u],"Rule conflict in",i.type,u);let d=i.modifiers[u];Ir(typeof d=="function","Invalid modifier definition for",i.type,u);let p=function(m){return this.rule({[u]:m})};n[u]=p,l[u]=d}if(i.modifiers=l,i.overrides){n._super=r,s.$_super={};for(let u in i.overrides)Ir(r[u],"Cannot override missing",u),i.overrides[u][uf.symbols.parent]=r[u],s.$_super[u]=r[u].bind(s);Object.assign(n,i.overrides)}i.cast=Object.assign({},o.cast,i.cast);let f=Object.assign({},o.manifest,i.manifest);return f.build=Qt.build(i.manifest&&i.manifest.build,o.manifest&&o.manifest.build),i.manifest=f,i.rebuild=Qt.rebuild(i.rebuild,o.rebuild),s};Qt.build=function(t,e){return!t||!e?t||e:function(r,n){return e(t(r,n),n)}};Qt.coerce=function(t,e){return!t||!e?t||e:{from:t.from&&e.from?[...new Set([...t.from,...e.from])]:null,method(r,n){let s;if((!e.from||e.from.includes(typeof r))&&(s=e.method(r,n),s)){if(s.errors||s.value===void 0)return s;r=s.value}if(!t.from||t.from.includes(typeof r)){let i=t.method(r,n);if(i)return i}return s}}};Qt.prepare=function(t,e){return!t||!e?t||e:function(r,n){let s=t(r,n);if(s){if(s.errors||s.value===void 0)return s;r=s.value}return e(r,n)||s}};Qt.rebuild=function(t,e){return!t||!e?t||e:function(r){e(r),t(r)}};Qt.validate=function(t,e){return!t||!e?t||e:function(r,n){let s=e(r,n);if(s){if(s.errors&&(!Array.isArray(s.errors)||s.errors.length))return s;r=s.value}return t(r,n)||s}}});var za=w(Wa=>{"use strict";var er=Q(),Ii=tt(),sn=ge(),zy=En(),df=hr(),Xy=Nr(),Ja,rt={};Wa.describe=function(t){let e=t._definition,r={type:t.type,flags:{},rules:[]};for(let n in t._flags)n[0]!=="_"&&(r.flags[n]=rt.describe(t._flags[n]));Object.keys(r.flags).length||delete r.flags,t._preferences&&(r.preferences=Ii(t._preferences,{shallow:["messages"]}),delete r.preferences[sn.symbols.prefs],r.preferences.messages&&(r.preferences.messages=zy.decompile(r.preferences.messages))),t._valids&&(r.allow=t._valids.describe()),t._invalids&&(r.invalid=t._invalids.describe());for(let n of t._rules){if(e.rules[n.name].manifest===!1)continue;let i={name:n.name};for(let o in e.modifiers)n[o]!==void 0&&(i[o]=rt.describe(n[o]));if(n.args){i.args={};for(let o in n.args){let a=n.args[o];o==="options"&&!Object.keys(a).length||(i.args[o]=rt.describe(a,{assign:o}))}Object.keys(i.args).length||delete i.args}r.rules.push(i)}r.rules.length||delete r.rules;for(let n in t.$_terms){if(n[0]==="_")continue;er(!r[n],"Cannot describe schema due to internal name conflict with",n);let s=t.$_terms[n];if(!s)continue;if(s instanceof Map){s.size&&(r[n]=[...s.entries()]);continue}if(sn.isValues(s)){r[n]=s.describe();continue}er(e.terms[n],"Term",n,"missing configuration");let i=e.terms[n].manifest,o=typeof i=="object";if(!s.length&&!o)continue;let a=[];for(let c of s)a.push(rt.describe(c));if(o){let{from:c,to:l}=i.mapped;r[n]={};for(let f of a)r[n][f[l]]=f[c];continue}if(i==="single"){er(a.length===1,"Term",n,"contains more than one item"),r[n]=a[0];continue}r[n]=a}return rt.validate(t.$_root,r),r};rt.describe=function(t,e={}){if(Array.isArray(t))return t.map(rt.describe);if(t===sn.symbols.deepDefault)return{special:"deep"};if(typeof t!="object"||t===null)return t;if(e.assign==="options")return Ii(t);if(Buffer&&Buffer.isBuffer(t))return{buffer:t.toString("binary")};if(t instanceof Date)return t.toISOString();if(t instanceof Error)return t;if(t instanceof RegExp)return e.assign==="regex"?t.toString():{regex:t.toString()};if(t[sn.symbols.literal])return{function:t.literal};if(typeof t.describe=="function")return e.assign==="ref"?t.describe().ref:t.describe();let r={};for(let n in t){let s=t[n];s!==void 0&&(r[n]=rt.describe(s,{assign:n}))}return r};Wa.build=function(t,e){return new rt.Builder(t).parse(e)};rt.Builder=class{constructor(t){this.joi=t}parse(t){rt.validate(this.joi,t);let e=this.joi[t.type]()._bare(),r=e._definition;if(t.flags)for(let s in t.flags){let i=r.flags[s]&&r.flags[s].setter||s;er(typeof e[i]=="function","Invalid flag",s,"for type",t.type),e=e[i](this.build(t.flags[s]))}if(t.preferences&&(e=e.preferences(this.build(t.preferences))),t.allow&&(e=e.allow(...this.build(t.allow))),t.invalid&&(e=e.invalid(...this.build(t.invalid))),t.rules)for(let s of t.rules){er(typeof e[s.name]=="function","Invalid rule",s.name,"for type",t.type);let i=[];if(s.args){let a={};for(let f in s.args)a[f]=this.build(s.args[f],{assign:f});let c=Object.keys(a),l=r.rules[s.name].args;if(l){er(c.length<=l.length,"Invalid number of arguments for",t.type,s.name,"(expected up to",l.length,", found",c.length,")");for(let{name:f}of l)i.push(a[f])}else er(c.length===1,"Invalid number of arguments for",t.type,s.name,"(expected up to 1, found",c.length,")"),i.push(a[c[0]])}e=e[s.name](...i);let o={};for(let a in r.modifiers)s[a]!==void 0&&(o[a]=this.build(s[a]));Object.keys(o).length&&(e=e.rule(o))}let n={};for(let s in t){if(["allow","flags","invalid","whens","preferences","rules","type"].includes(s))continue;er(r.terms[s],"Term",s,"missing configuration");let i=r.terms[s].manifest;if(i==="schema"){n[s]=t[s].map(o=>this.parse(o));continue}if(i==="values"){n[s]=t[s].map(o=>this.build(o));continue}if(i==="single"){n[s]=this.build(t[s]);continue}if(typeof i=="object"){n[s]={};for(let o in t[s]){let a=t[s][o];n[s][o]=this.parse(a)}continue}n[s]=this.build(t[s])}return t.whens&&(n.whens=t.whens.map(s=>this.build(s))),e=r.manifest.build(e,n),e.$_temp.ruleset=!1,e}build(t,e={}){if(t===null)return null;if(Array.isArray(t))return t.map(n=>this.build(n));if(t instanceof Error)return t;if(e.assign==="options")return Ii(t);if(e.assign==="regex")return rt.regex(t);if(e.assign==="ref")return df.build(t);if(typeof t!="object")return t;if(Object.keys(t).length===1){if(t.buffer)return er(Buffer,"Buffers are not supported"),Buffer&&Buffer.from(t.buffer,"binary");if(t.function)return{[sn.symbols.literal]:!0,literal:t.function};if(t.override)return sn.symbols.override;if(t.ref)return df.build(t.ref);if(t.regex)return rt.regex(t.regex);if(t.special)return er(["deep"].includes(t.special),"Unknown special value",t.special),sn.symbols.deepDefault;if(t.value)return Ii(t.value)}if(t.type)return this.parse(t);if(t.template)return Xy.build(t);let r={};for(let n in t)r[n]=this.build(t[n],{assign:n});return r}};rt.regex=function(t){let e=t.lastIndexOf("/"),r=t.slice(1,e),n=t.slice(e+1);return new RegExp(r,n)};rt.validate=function(t,e){Ja=Ja||Ri(),t.assert(e,Ja.description)}});var us=w((QA,pf)=>{"use strict";var tr=Ma(),Xe={mismatched:null};pf.exports=function(t,e,r){return r=Object.assign({prototype:!0},r),!!Xe.isDeepEqual(t,e,r,[])};Xe.isDeepEqual=function(t,e,r,n){if(t===e)return t!==0||1/t===1/e;let s=typeof t;if(s!==typeof e||t===null||e===null)return!1;if(s==="function"){if(!r.deepFunction||t.toString()!==e.toString())return!1}else if(s!=="object")return t!==t&&e!==e;let i=Xe.getSharedType(t,e,!!r.prototype);switch(i){case tr.buffer:return Buffer&&Buffer.prototype.equals.call(t,e);case tr.promise:return t===e;case tr.regex:return t.toString()===e.toString();case Xe.mismatched:return!1}for(let o=n.length-1;o>=0;--o)if(n[o].isSame(t,e))return!0;n.push(new Xe.SeenEntry(t,e));try{return!!Xe.isDeepEqualObj(i,t,e,r,n)}finally{n.pop()}};Xe.getSharedType=function(t,e,r){if(r)return Object.getPrototypeOf(t)!==Object.getPrototypeOf(e)?Xe.mismatched:tr.getInternalProto(t);let n=tr.getInternalProto(t);return n!==tr.getInternalProto(e)?Xe.mismatched:n};Xe.valueOf=function(t){let e=t.valueOf;if(e===void 0)return t;try{return e.call(t)}catch(r){return r}};Xe.hasOwnEnumerableProperty=function(t,e){return Object.prototype.propertyIsEnumerable.call(t,e)};Xe.isSetSimpleEqual=function(t,e){for(let r of Set.prototype.values.call(t))if(!Set.prototype.has.call(e,r))return!1;return!0};Xe.isDeepEqualObj=function(t,e,r,n,s){let{isDeepEqual:i,valueOf:o,hasOwnEnumerableProperty:a}=Xe,{keys:c,getOwnPropertySymbols:l}=Object;if(t===tr.array)if(n.part){for(let m of e)for(let g of r)if(i(m,g,n,s))return!0}else{if(e.length!==r.length)return!1;for(let m=0;m<e.length;++m)if(!i(e[m],r[m],n,s))return!1;return!0}else if(t===tr.set){if(e.size!==r.size)return!1;if(!Xe.isSetSimpleEqual(e,r)){let m=new Set(Set.prototype.values.call(r));for(let g of Set.prototype.values.call(e)){if(m.delete(g))continue;let _=!1;for(let x of m)if(i(g,x,n,s)){m.delete(x),_=!0;break}if(!_)return!1}}}else if(t===tr.map){if(e.size!==r.size)return!1;for(let[m,g]of Map.prototype.entries.call(e))if(g===void 0&&!Map.prototype.has.call(r,m)||!i(g,Map.prototype.get.call(r,m),n,s))return!1}else if(t===tr.error&&(e.name!==r.name||e.message!==r.message))return!1;let f=o(e),u=o(r);if((e!==f||r!==u)&&!i(f,u,n,s))return!1;let d=c(e);if(!n.part&&d.length!==c(r).length&&!n.skip)return!1;let p=0;for(let m of d){if(n.skip&&n.skip.includes(m)){r[m]===void 0&&++p;continue}if(!a(r,m)||!i(e[m],r[m],n,s))return!1}if(!n.part&&d.length-p!==c(r).length)return!1;if(n.symbols!==!1){let m=l(e),g=new Set(l(r));for(let _ of m){if(!n.skip||!n.skip.includes(_)){if(a(e,_)){if(!a(r,_)||!i(e[_],r[_],n,s))return!1}else if(a(r,_))return!1}g.delete(_)}for(let _ of g)if(a(r,_))return!1}return!0};Xe.SeenEntry=class{constructor(t,e){this.obj=t,this.ref=e}isSame(t,e){return this.obj===t&&this.ref===e}}});var mf=w(hf=>{"use strict";hf.location=function(t=0){let e=Error.prepareStackTrace;Error.prepareStackTrace=(s,i)=>i;let r={};Error.captureStackTrace(r,this);let n=r.stack[t+1];return Error.prepareStackTrace=e,{filename:n.getFileName(),line:n.getLineNumber()}}});var Ya=w(Xa=>{"use strict";var yf=us(),gf=mf(),Yy=pr(),Ye={codes:{error:1,pass:2,full:3},labels:{0:"never used",1:"always error",2:"always pass"}};Xa.setup=function(t){let e=function(){return t._tracer=t._tracer||new Ye.Tracer,t._tracer};t.trace=e,t[Symbol.for("@hapi/lab/coverage/initialize")]=e,t.untrace=()=>{t._tracer=null}};Xa.location=function(t){return t.$_setFlag("_tracerLocation",gf.location(2))};Ye.Tracer=class{constructor(){this.name="Joi",this._schemas=new Map}_register(t){let e=this._schemas.get(t);if(e)return e.store;let r=new Ye.Store(t),{filename:n,line:s}=t._flags._tracerLocation||gf.location(5);return this._schemas.set(t,{filename:n,line:s,store:r}),r}_combine(t,e){for(let{store:r}of this._schemas.values())r._combine(t,e)}report(t){let e=[];for(let{filename:r,line:n,store:s}of this._schemas.values()){if(t&&t!==r)continue;let i=[],o=[];for(let[a,c]of s._sources.entries()){if(Ye.sub(c.paths,o))continue;if(!c.entry){i.push({status:"never reached",paths:[...c.paths]}),o.push(...c.paths);continue}for(let f of["valid","invalid"]){let u=a[`_${f}s`];if(!u)continue;let d=new Set(u._values),p=new Set(u._refs);for(let{value:m,ref:g}of c[f])d.delete(m),p.delete(g);(d.size||p.size)&&i.push({status:[...d,...[...p].map(m=>m.display)],rule:`${f}s`})}let l=a._rules.map(f=>f.name);for(let f of["default","failover"])a._flags[f]!==void 0&&l.push(f);for(let f of l){let u=Ye.labels[c.rule[f]||0];if(u){let d={rule:f,status:u};c.paths.size&&(d.paths=[...c.paths]),i.push(d)}}}i.length&&e.push({filename:r,line:n,missing:i,severity:"error",message:`Schema missing tests for ${i.map(Ye.message).join(", ")}`})}return e.length?e:null}};Ye.Store=class{constructor(t){this.active=!0,this._sources=new Map,this._combos=new Map,this._scan(t)}debug(t,e,r,n){t.mainstay.debug&&t.mainstay.debug.push({type:e,name:r,result:n,path:t.path})}entry(t,e){Ye.debug(e,{type:"entry"}),this._record(t,r=>{r.entry=!0})}filter(t,e,r,n){Ye.debug(e,{type:r,...n}),this._record(t,s=>{s[r].add(n)})}log(t,e,r,n,s){Ye.debug(e,{type:r,name:n,result:s==="full"?"pass":s}),this._record(t,i=>{i[r][n]=i[r][n]||0,i[r][n]|=Ye.codes[s]})}resolve(t,e,r){if(!t.mainstay.debug)return;let n={type:"resolve",ref:e.display,to:r,path:t.path};t.mainstay.debug.push(n)}value(t,e,r,n,s){if(!t.mainstay.debug||yf(r,n))return;let i={type:"value",by:e,from:r,to:n,path:t.path};s&&(i.name=s),t.mainstay.debug.push(i)}_record(t,e){let r=this._sources.get(t);if(r){e(r);return}let n=this._combos.get(t);for(let s of n)this._record(s,e)}_scan(t,e){let r=e||[],n=this._sources.get(t);n||(n={paths:new Set,entry:!1,rule:{},valid:new Set,invalid:new Set},this._sources.set(t,n)),r.length&&n.paths.add(r);let s=(i,o)=>{let a=Ye.id(i,o);this._scan(i,r.concat(a))};t.$_modify({each:s,ref:!1})}_combine(t,e){this._combos.set(t,e)}};Ye.message=function(t){return`${t.paths?Yy.path(t.paths[0])+(t.rule?":":""):""}${t.rule||""} (${t.status})`};Ye.id=function(t,{source:e,name:r,path:n,key:s}){return t._flags.id?t._flags.id:s||(r=`@${r}`,e==="terms"?[r,n[Math.min(n.length-1,1)]]:r)};Ye.sub=function(t,e){for(let r of t)for(let n of e)if(yf(r.slice(0,n.length),n))return!0;return!1};Ye.debug=function(t,e){t.mainstay.debug&&(e.path=t.debug?[...t.path,t.debug]:t.path,t.mainstay.debug.push(e))}});var Ki=w((iv,wf)=>{"use strict";var Za=Q(),_f=tt(),Zy=La(),bf={};wf.exports=bf.merge=function(t,e,r){if(Za(t&&typeof t=="object","Invalid target value: must be an object"),Za(e==null||typeof e=="object","Invalid source value: must be null, undefined, or an object"),!e)return t;if(r=Object.assign({nullOverride:!0,mergeArrays:!0},r),Array.isArray(e)){Za(Array.isArray(t),"Cannot merge array onto an object"),r.mergeArrays||(t.length=0);for(let s=0;s<e.length;++s)t.push(_f(e[s],{symbols:r.symbols}));return t}let n=Zy.keys(e,r);for(let s=0;s<n.length;++s){let i=n[s];if(i==="__proto__"||!Object.prototype.propertyIsEnumerable.call(e,i))continue;let o=e[i];if(o&&typeof o=="object"){if(t[i]===o)continue;!t[i]||typeof t[i]!="object"||Array.isArray(t[i])!==Array.isArray(o)||o instanceof Date||Buffer&&Buffer.isBuffer(o)||o instanceof RegExp?t[i]=_f(o,{symbols:r.symbols}):bf.merge(t[i],o,r)}else(o!=null||r.nullOverride)&&(t[i]=o)}return t}});var Af=w($i=>{"use strict";var yr=Q(),Qa=ge(),Qy=hr(),rr={};$i.Ids=rr.Ids=class{constructor(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}clone(){let t=new rr.Ids;return t._byId=new Map(this._byId),t._byKey=new Map(this._byKey),t._schemaChain=this._schemaChain,t}concat(t){t._schemaChain&&(this._schemaChain=!0);for(let[e,r]of t._byId.entries())yr(!this._byKey.has(e),"Schema id conflicts with existing key:",e),this._byId.set(e,r);for(let[e,r]of t._byKey.entries())yr(!this._byId.has(e),"Schema key conflicts with existing id:",e),this._byKey.set(e,r)}fork(t,e,r){let n=this._collect(t);n.push({schema:r});let s=n.shift(),i={id:s.id,schema:e(s.schema)};yr(Qa.isSchema(i.schema),"adjuster function failed to return a joi schema type");for(let o of n)i={id:o.id,schema:rr.fork(o.schema,i.id,i.schema)};return i.schema}labels(t,e=[]){let r=t[0],n=this._get(r);if(!n)return[...e,...t].join(".");let s=t.slice(1);return e=[...e,n.schema._flags.label||r],s.length?n.schema._ids.labels(s,e):e.join(".")}reach(t,e=[]){let r=t[0],n=this._get(r);yr(n,"Schema does not contain path",[...e,...t].join("."));let s=t.slice(1);return s.length?n.schema._ids.reach(s,[...e,r]):n.schema}register(t,{key:e}={}){if(!t||!Qa.isSchema(t))return;(t.$_property("schemaChain")||t._ids._schemaChain)&&(this._schemaChain=!0);let r=t._flags.id;if(r){let n=this._byId.get(r);yr(!n||n.schema===t,"Cannot add different schemas with the same id:",r),yr(!this._byKey.has(r),"Schema id conflicts with existing key:",r),this._byId.set(r,{schema:t,id:r})}e&&(yr(!this._byKey.has(e),"Schema already contains key:",e),yr(!this._byId.has(e),"Schema key conflicts with existing id:",e),this._byKey.set(e,{schema:t,id:e}))}reset(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}_collect(t,e=[],r=[]){let n=t[0],s=this._get(n);yr(s,"Schema does not contain path",[...e,...t].join(".")),r=[s,...r];let i=t.slice(1);return i.length?s.schema._ids._collect(i,[...e,n],r):r}_get(t){return this._byId.get(t)||this._byKey.get(t)}};rr.fork=function(t,e,r){let n=(i,{key:o})=>{if(e===(i._flags.id||o))return r},s=$i.schema(t,{each:n,ref:!1});return s?s.$_mutateRebuild():t};$i.schema=function(t,e){let r;for(let n in t._flags){if(n[0]==="_")continue;let s=rr.scan(t._flags[n],{source:"flags",name:n},e);s!==void 0&&(r=r||t.clone(),r._flags[n]=s)}for(let n=0;n<t._rules.length;++n){let s=t._rules[n],i=rr.scan(s.args,{source:"rules",name:s.name},e);if(i!==void 0){r=r||t.clone();let o=Object.assign({},s);o.args=i,r._rules[n]=o,r._singleRules.get(s.name)===s&&r._singleRules.set(s.name,o)}}for(let n in t.$_terms){if(n[0]==="_")continue;let s=rr.scan(t.$_terms[n],{source:"terms",name:n},e);s!==void 0&&(r=r||t.clone(),r.$_terms[n]=s)}return r};rr.scan=function(t,e,r,n,s){let i=n||[];if(t===null||typeof t!="object")return;let o;if(Array.isArray(t)){for(let a=0;a<t.length;++a){let c=e.source==="terms"&&e.name==="keys"&&t[a].key,l=rr.scan(t[a],e,r,[a,...i],c);l!==void 0&&(o=o||t.slice(),o[a]=l)}return o}if(r.schema!==!1&&Qa.isSchema(t)||r.ref!==!1&&Qy.isRef(t)){let a=r.each(t,{...e,path:i,key:s});return a===t?void 0:a}for(let a in t){if(a[0]==="_")continue;let c=rr.scan(t[a],e,r,[a,...i],s);c!==void 0&&(o=o||Object.assign({},t),o[a]=c)}return o}});var Sf=w((cv,vf)=>{"use strict";vf.exports=function(){}});var xf=w((lv,Cf)=>{"use strict";var eg=tt(),Ef=en(),tg=ge(),nr={value:Symbol("value")};Cf.exports=nr.State=class{constructor(t,e,r){this.path=t,this.ancestors=e,this.mainstay=r.mainstay,this.schemas=r.schemas,this.debug=null}localize(t,e=null,r=null){let n=new nr.State(t,e,this);return r&&n.schemas&&(n.schemas=[nr.schemas(r),...n.schemas]),n}nest(t,e){let r=new nr.State(this.path,this.ancestors,this);return r.schemas=r.schemas&&[nr.schemas(t),...r.schemas],r.debug=e,r}shadow(t,e){this.mainstay.shadow=this.mainstay.shadow||new nr.Shadow,this.mainstay.shadow.set(this.path,t,e)}snapshot(){this.mainstay.shadow&&(this._snapshot=eg(this.mainstay.shadow.node(this.path))),this.mainstay.snapshot()}restore(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.restore()}commit(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.commit()}};nr.schemas=function(t){return tg.isSchema(t)?{schema:t}:t};nr.Shadow=class{constructor(){this._values=null}set(t,e,r){if(!t.length||r==="strip"&&typeof t[t.length-1]=="number")return;this._values=this._values||new Map;let n=this._values;for(let s=0;s<t.length;++s){let i=t[s],o=n.get(i);o||(o=new Map,n.set(i,o)),n=o}n[nr.value]=e}get(t){let e=this.node(t);if(e)return e[nr.value]}node(t){if(this._values)return Ef(this._values,t,{iterables:!0})}override(t,e){if(!this._values)return;let r=t.slice(0,-1),n=t[t.length-1],s=Ef(this._values,r,{iterables:!0});if(e){s.set(n,e);return}s&&s.delete(n)}}});var Pf=w(ds=>{"use strict";var fs=Q(),kf=tt(),kn=Sf(),rg=en(),Ke=ge(),Kr=pr(),ng=xf(),q={result:Symbol("result")};ds.entry=function(t,e,r){let n=Ke.defaults;r&&(fs(r.warnings===void 0,"Cannot override warnings preference in synchronous validation"),fs(r.artifacts===void 0,"Cannot override artifacts preference in synchronous validation"),n=Ke.preferences(Ke.defaults,r));let s=q.entry(t,e,n);fs(!s.mainstay.externals.length,"Schema with external rules must use validateAsync()");let i={value:s.value};return s.error&&(i.error=s.error),s.mainstay.warnings.length&&(i.warning=Kr.details(s.mainstay.warnings)),s.mainstay.debug&&(i.debug=s.mainstay.debug),s.mainstay.artifacts&&(i.artifacts=s.mainstay.artifacts),i};ds.entryAsync=async function(t,e,r){let n=Ke.defaults;r&&(n=Ke.preferences(Ke.defaults,r));let s=q.entry(t,e,n),i=s.mainstay;if(s.error)throw i.debug&&(s.error.debug=i.debug),s.error;if(i.externals.length){let a=s.value,c=[];for(let l of i.externals){let f=l.state.path,u=l.schema.type==="link"?i.links.get(l.schema):null,d=a,p,m,g=f.length?[a]:[],_=f.length?rg(t,f):t;if(f.length){p=f[f.length-1];let x=a;for(let te of f.slice(0,-1))x=x[te],g.unshift(x);m=g[0],d=m[p]}try{let x=(ne,ce)=>(u||l.schema).$_createError(ne,d,ce,l.state,n),te=await l.method(d,{schema:l.schema,linked:u,state:l.state,prefs:r,original:_,error:x,errorsArray:q.errorsArray,warn:(ne,ce)=>i.warnings.push((u||l.schema).$_createError(ne,d,ce,l.state,n)),message:(ne,ce)=>(u||l.schema).$_createError("external",d,ce,l.state,n,{messages:ne})});if(te===void 0||te===d)continue;if(te instanceof Kr.Report){if(i.tracer.log(l.schema,l.state,"rule","external","error"),c.push(te),n.abortEarly)break;continue}if(Array.isArray(te)&&te[Ke.symbols.errors]){if(i.tracer.log(l.schema,l.state,"rule","external","error"),c.push(...te),n.abortEarly)break;continue}m?(i.tracer.value(l.state,"rule",d,te,"external"),m[p]=te):(i.tracer.value(l.state,"rule",a,te,"external"),a=te)}catch(x){throw n.errors.label&&(x.message+=` (${l.label})`),x}}if(s.value=a,c.length)throw s.error=Kr.process(c,t,n),i.debug&&(s.error.debug=i.debug),s.error}if(!n.warnings&&!n.debug&&!n.artifacts)return s.value;let o={value:s.value};return i.warnings.length&&(o.warning=Kr.details(i.warnings)),i.debug&&(o.debug=i.debug),i.artifacts&&(o.artifacts=i.artifacts),o};q.Mainstay=class{constructor(t,e,r){this.externals=[],this.warnings=[],this.tracer=t,this.debug=e,this.links=r,this.shadow=null,this.artifacts=null,this._snapshots=[]}snapshot(){this._snapshots.push({externals:this.externals.slice(),warnings:this.warnings.slice()})}restore(){let t=this._snapshots.pop();this.externals=t.externals,this.warnings=t.warnings}commit(){this._snapshots.pop()}};q.entry=function(t,e,r){let{tracer:n,cleanup:s}=q.tracer(e,r),i=r.debug?[]:null,o=e._ids._schemaChain?new Map:null,a=new q.Mainstay(n,i,o),c=e._ids._schemaChain?[{schema:e}]:null,l=new ng([],[],{mainstay:a,schemas:c}),f=ds.validate(t,e,l,r);s&&e.$_root.untrace();let u=Kr.process(f.errors,t,r);return{value:f.value,error:u,mainstay:a}};q.tracer=function(t,e){return t.$_root._tracer?{tracer:t.$_root._tracer._register(t)}:e.debug?(fs(t.$_root.trace,"Debug mode not supported"),{tracer:t.$_root.trace()._register(t),cleanup:!0}):{tracer:q.ignore}};ds.validate=function(t,e,r,n,s={}){if(e.$_terms.whens&&(e=e._generate(t,r,n).schema),e._preferences&&(n=q.prefs(e,n)),e._cache&&n.cache){let u=e._cache.get(t);if(r.mainstay.tracer.debug(r,"validate","cached",!!u),u)return u}let i=(u,d,p)=>e.$_createError(u,t,d,p||r,n),o={original:t,prefs:n,schema:e,state:r,error:i,errorsArray:q.errorsArray,warn:(u,d,p)=>r.mainstay.warnings.push(i(u,d,p)),message:(u,d)=>e.$_createError("custom",t,d,r,n,{messages:u})};r.mainstay.tracer.entry(e,r);let a=e._definition;if(a.prepare&&t!==void 0&&n.convert){let u=a.prepare(t,o);if(u){if(r.mainstay.tracer.value(r,"prepare",t,u.value),u.errors)return q.finalize(u.value,[].concat(u.errors),o);t=u.value}}if(a.coerce&&t!==void 0&&n.convert&&(!a.coerce.from||a.coerce.from.includes(typeof t))){let u=a.coerce.method(t,o);if(u){if(r.mainstay.tracer.value(r,"coerced",t,u.value),u.errors)return q.finalize(u.value,[].concat(u.errors),o);t=u.value}}let c=e._flags.empty;c&&c.$_match(q.trim(t,e),r.nest(c),Ke.defaults)&&(r.mainstay.tracer.value(r,"empty",t,void 0),t=void 0);let l=s.presence||e._flags.presence||(e._flags._endedSwitch?null:n.presence);if(t===void 0){if(l==="forbidden")return q.finalize(t,null,o);if(l==="required")return q.finalize(t,[e.$_createError("any.required",t,null,r,n)],o);if(l==="optional"){if(e._flags.default!==Ke.symbols.deepDefault)return q.finalize(t,null,o);r.mainstay.tracer.value(r,"default",t,{}),t={}}}else if(l==="forbidden")return q.finalize(t,[e.$_createError("any.unknown",t,null,r,n)],o);let f=[];if(e._valids){let u=e._valids.get(t,r,n,e._flags.insensitive);if(u)return n.convert&&(r.mainstay.tracer.value(r,"valids",t,u.value),t=u.value),r.mainstay.tracer.filter(e,r,"valid",u),q.finalize(t,null,o);if(e._flags.only){let d=e.$_createError("any.only",t,{valids:e._valids.values({display:!0})},r,n);if(n.abortEarly)return q.finalize(t,[d],o);f.push(d)}}if(e._invalids){let u=e._invalids.get(t,r,n,e._flags.insensitive);if(u){r.mainstay.tracer.filter(e,r,"invalid",u);let d=e.$_createError("any.invalid",t,{invalids:e._invalids.values({display:!0})},r,n);if(n.abortEarly)return q.finalize(t,[d],o);f.push(d)}}if(a.validate){let u=a.validate(t,o);if(u&&(r.mainstay.tracer.value(r,"base",t,u.value),t=u.value,u.errors)){if(!Array.isArray(u.errors))return f.push(u.errors),q.finalize(t,f,o);if(u.errors.length)return f.push(...u.errors),q.finalize(t,f,o)}}return e._rules.length?q.rules(t,f,o):q.finalize(t,f,o)};q.rules=function(t,e,r){let{schema:n,state:s,prefs:i}=r;for(let o of n._rules){let a=n._definition.rules[o.method];if(a.convert&&i.convert){s.mainstay.tracer.log(n,s,"rule",o.name,"full");continue}let c,l=o.args;if(o._resolve.length){l=Object.assign({},l);for(let u of o._resolve){let d=a.argsByName.get(u),p=l[u].resolve(t,s,i),m=d.normalize?d.normalize(p):p,g=Ke.validateArg(m,null,d);if(g){c=n.$_createError("any.ref",p,{arg:u,ref:l[u],reason:g},s,i);break}l[u]=m}}c=c||a.validate(t,r,l,o);let f=q.rule(c,o);if(f.errors){if(s.mainstay.tracer.log(n,s,"rule",o.name,"error"),o.warn){s.mainstay.warnings.push(...f.errors);continue}if(i.abortEarly)return q.finalize(t,f.errors,r);e.push(...f.errors)}else s.mainstay.tracer.log(n,s,"rule",o.name,"pass"),s.mainstay.tracer.value(s,"rule",t,f.value,o.name),t=f.value}return q.finalize(t,e,r)};q.rule=function(t,e){return t instanceof Kr.Report?(q.error(t,e),{errors:[t],value:null}):Array.isArray(t)&&t[Ke.symbols.errors]?(t.forEach(r=>q.error(r,e)),{errors:t,value:null}):{errors:null,value:t}};q.error=function(t,e){return e.message&&t._setTemplate(e.message),t};q.finalize=function(t,e,r){e=e||[];let{schema:n,state:s,prefs:i}=r;if(e.length){let a=q.default("failover",void 0,e,r);a!==void 0&&(s.mainstay.tracer.value(s,"failover",t,a),t=a,e=[])}if(e.length&&n._flags.error)if(typeof n._flags.error=="function"){e=n._flags.error(e),Array.isArray(e)||(e=[e]);for(let a of e)fs(a instanceof Error||a instanceof Kr.Report,"error() must return an Error object")}else e=[n._flags.error];if(t===void 0){let a=q.default("default",t,e,r);s.mainstay.tracer.value(s,"default",t,a),t=a}if(n._flags.cast&&t!==void 0){let a=n._definition.cast[n._flags.cast];if(a.from(t)){let c=a.to(t,r);s.mainstay.tracer.value(s,"cast",t,c,n._flags.cast),t=c}}if(n.$_terms.externals&&i.externals&&i._externals!==!1)for(let{method:a}of n.$_terms.externals)s.mainstay.externals.push({method:a,schema:n,state:s,label:Kr.label(n._flags,s,i)});let o={value:t,errors:e.length?e:null};return n._flags.result&&(o.value=n._flags.result==="strip"?void 0:r.original,s.mainstay.tracer.value(s,n._flags.result,t,o.value),s.shadow(t,n._flags.result)),n._cache&&i.cache!==!1&&!n._refs.length&&n._cache.set(r.original,o),t!==void 0&&!o.errors&&n._flags.artifact!==void 0&&(s.mainstay.artifacts=s.mainstay.artifacts||new Map,s.mainstay.artifacts.has(n._flags.artifact)||s.mainstay.artifacts.set(n._flags.artifact,[]),s.mainstay.artifacts.get(n._flags.artifact).push(s.path)),o};q.prefs=function(t,e){let r=e===Ke.defaults;return r&&t._preferences[Ke.symbols.prefs]?t._preferences[Ke.symbols.prefs]:(e=Ke.preferences(e,t._preferences),r&&(t._preferences[Ke.symbols.prefs]=e),e)};q.default=function(t,e,r,n){let{schema:s,state:i,prefs:o}=n,a=s._flags[t];if(o.noDefaults||a===void 0)return e;if(i.mainstay.tracer.log(s,i,"rule",t,"full"),!a)return a;if(typeof a=="function"){let c=a.length?[kf(i.ancestors[0]),n]:[];try{return a(...c)}catch(l){r.push(s.$_createError(`any.${t}`,null,{error:l},i,o));return}}return typeof a!="object"?a:a[Ke.symbols.literal]?a.literal:Ke.isResolvable(a)?a.resolve(e,i,o):kf(a)};q.trim=function(t,e){if(typeof t!="string")return t;let r=e.$_getRule("trim");return!r||!r.args.enabled?t:t.trim()};q.ignore={active:!1,debug:kn,entry:kn,filter:kn,log:kn,resolve:kn,value:kn};q.errorsArray=function(){let t=[];return t[Ke.symbols.errors]=!0,t}});var tc=w((hv,Of)=>{"use strict";var sg=Q(),Bf=us(),ec=ge(),gr={};Of.exports=gr.Values=class{constructor(t,e){this._values=new Set(t),this._refs=new Set(e),this._lowercase=gr.lowercases(t),this._override=!1}get length(){return this._values.size+this._refs.size}add(t,e){if(ec.isResolvable(t)){this._refs.has(t)||(this._refs.add(t),e&&e.register(t));return}this.has(t,null,null,!1)||(this._values.add(t),typeof t=="string"&&this._lowercase.set(t.toLowerCase(),t))}static merge(t,e,r){if(t=t||new gr.Values,e){if(e._override)return e.clone();for(let n of[...e._values,...e._refs])t.add(n)}if(r)for(let n of[...r._values,...r._refs])t.remove(n);return t.length?t:null}remove(t){if(ec.isResolvable(t)){this._refs.delete(t);return}this._values.delete(t),typeof t=="string"&&this._lowercase.delete(t.toLowerCase())}has(t,e,r,n){return!!this.get(t,e,r,n)}get(t,e,r,n){if(!this.length)return!1;if(this._values.has(t))return{value:t};if(typeof t=="string"&&t&&n){let s=this._lowercase.get(t.toLowerCase());if(s)return{value:s}}if(!this._refs.size&&typeof t!="object")return!1;if(typeof t=="object"){for(let s of this._values)if(Bf(s,t))return{value:s}}if(e)for(let s of this._refs){let i=s.resolve(t,e,r,null,{in:!0});if(i===void 0)continue;let o=!s.in||typeof i!="object"?[i]:Array.isArray(i)?i:Object.keys(i);for(let a of o)if(typeof a==typeof t){if(n&&t&&typeof t=="string"){if(a.toLowerCase()===t.toLowerCase())return{value:a,ref:s}}else if(Bf(a,t))return{value:a,ref:s}}}return!1}override(){this._override=!0}values(t){if(t&&t.display){let e=[];for(let r of[...this._values,...this._refs])r!==void 0&&e.push(r);return e}return Array.from([...this._values,...this._refs])}clone(){let t=new gr.Values(this._values,this._refs);return t._override=this._override,t}concat(t){sg(!t._override,"Cannot concat override set of values");let e=new gr.Values([...this._values,...t._values],[...this._refs,...t._refs]);return e._override=this._override,e}describe(){let t=[];this._override&&t.push({override:!0});for(let e of this._values.values())t.push(e&&typeof e=="object"?{value:e}:e);for(let e of this._refs.values())t.push(e.describe());return t}};gr.Values.prototype[ec.symbols.values]=!0;gr.Values.prototype.slice=gr.Values.prototype.clone;gr.lowercases=function(t){let e=new Map;if(t)for(let r of t)typeof r=="string"&&e.set(r.toLowerCase(),r);return e}});var Df=w((yv,Uf)=>{"use strict";var O=Q(),Rf=tt(),Tf=us(),rc=Ki(),ig=qa(),Be=ge(),nc=nn(),og=pr(),ag=Ga(),Nf=za(),cg=En(),If=Af(),Kf=hr(),$f=Ya(),Ui=Pf(),Di=tc(),Me={};Me.Base=class{constructor(t){this.type=t,this.$_root=null,this._definition={},this._reset()}_reset(){this._ids=new If.Ids,this._preferences=null,this._refs=new Kf.Manager,this._cache=null,this._valids=null,this._invalids=null,this._flags={},this._rules=[],this._singleRules=new Map,this.$_terms={},this.$_temp={ruleset:null,whens:{}}}describe(){return O(typeof Nf.describe=="function","Manifest functionality disabled"),Nf.describe(this)}allow(...t){return Be.verifyFlat(t,"allow"),this._values(t,"_valids")}alter(t){O(t&&typeof t=="object"&&!Array.isArray(t),"Invalid targets argument"),O(!this._inRuleset(),"Cannot set alterations inside a ruleset");let e=this.clone();e.$_terms.alterations=e.$_terms.alterations||[];for(let r in t){let n=t[r];O(typeof n=="function","Alteration adjuster for",r,"must be a function"),e.$_terms.alterations.push({target:r,adjuster:n})}return e.$_temp.ruleset=!1,e}artifact(t){return O(t!==void 0,"Artifact cannot be undefined"),O(!this._cache,"Cannot set an artifact with a rule cache"),this.$_setFlag("artifact",t)}cast(t){return O(t===!1||typeof t=="string","Invalid to value"),O(t===!1||this._definition.cast[t],"Type",this.type,"does not support casting to",t),this.$_setFlag("cast",t===!1?void 0:t)}default(t,e){return this._default("default",t,e)}description(t){return O(t&&typeof t=="string","Description must be a non-empty string"),this.$_setFlag("description",t)}empty(t){let e=this.clone();return t!==void 0&&(t=e.$_compile(t,{override:!1})),e.$_setFlag("empty",t,{clone:!1})}error(t){return O(t,"Missing error"),O(t instanceof Error||typeof t=="function","Must provide a valid Error object or a function"),this.$_setFlag("error",t)}example(t,e={}){return O(t!==void 0,"Missing example"),Be.assertOptions(e,["override"]),this._inner("examples",t,{single:!0,override:e.override})}external(t,e){return typeof t=="object"&&(O(!e,"Cannot combine options with description"),e=t.description,t=t.method),O(typeof t=="function","Method must be a function"),O(e===void 0||e&&typeof e=="string","Description must be a non-empty string"),this._inner("externals",{method:t,description:e},{single:!0})}failover(t,e){return this._default("failover",t,e)}forbidden(){return this.presence("forbidden")}id(t){return t?(O(typeof t=="string","id must be a non-empty string"),O(/^[^\.]+$/.test(t),"id cannot contain period character"),this.$_setFlag("id",t)):this.$_setFlag("id",void 0)}invalid(...t){return this._values(t,"_invalids")}label(t){return O(t&&typeof t=="string","Label name must be a non-empty string"),this.$_setFlag("label",t)}meta(t){return O(t!==void 0,"Meta cannot be undefined"),this._inner("metas",t,{single:!0})}note(...t){O(t.length,"Missing notes");for(let e of t)O(e&&typeof e=="string","Notes must be non-empty strings");return this._inner("notes",t)}only(t=!0){return O(typeof t=="boolean","Invalid mode:",t),this.$_setFlag("only",t)}optional(){return this.presence("optional")}prefs(t){O(t,"Missing preferences"),O(t.context===void 0,"Cannot override context"),O(t.externals===void 0,"Cannot override externals"),O(t.warnings===void 0,"Cannot override warnings"),O(t.debug===void 0,"Cannot override debug"),Be.checkPreferences(t);let e=this.clone();return e._preferences=Be.preferences(e._preferences,t),e}presence(t){return O(["optional","required","forbidden"].includes(t),"Unknown presence mode",t),this.$_setFlag("presence",t)}raw(t=!0){return this.$_setFlag("result",t?"raw":void 0)}result(t){return O(["raw","strip"].includes(t),"Unknown result mode",t),this.$_setFlag("result",t)}required(){return this.presence("required")}strict(t){let e=this.clone(),r=t===void 0?!1:!t;return e._preferences=Be.preferences(e._preferences,{convert:r}),e}strip(t=!0){return this.$_setFlag("result",t?"strip":void 0)}tag(...t){O(t.length,"Missing tags");for(let e of t)O(e&&typeof e=="string","Tags must be non-empty strings");return this._inner("tags",t)}unit(t){return O(t&&typeof t=="string","Unit name must be a non-empty string"),this.$_setFlag("unit",t)}valid(...t){Be.verifyFlat(t,"valid");let e=this.allow(...t);return e.$_setFlag("only",!!e._valids,{clone:!1}),e}when(t,e){let r=this.clone();r.$_terms.whens||(r.$_terms.whens=[]);let n=nc.when(r,t,e);if(!["any","link"].includes(r.type)){let s=n.is?[n]:n.switch;for(let i of s)O(!i.then||i.then.type==="any"||i.then.type===r.type,"Cannot combine",r.type,"with",i.then&&i.then.type),O(!i.otherwise||i.otherwise.type==="any"||i.otherwise.type===r.type,"Cannot combine",r.type,"with",i.otherwise&&i.otherwise.type)}return r.$_terms.whens.push(n),r.$_mutateRebuild()}cache(t){O(!this._inRuleset(),"Cannot set caching inside a ruleset"),O(!this._cache,"Cannot override schema cache"),O(this._flags.artifact===void 0,"Cannot cache a rule with an artifact");let e=this.clone();return e._cache=t||ig.provider.provision(),e.$_temp.ruleset=!1,e}clone(){let t=Object.create(Object.getPrototypeOf(this));return this._assign(t)}concat(t){O(Be.isSchema(t),"Invalid schema object"),O(this.type==="any"||t.type==="any"||t.type===this.type,"Cannot merge type",this.type,"with another type:",t.type),O(!this._inRuleset(),"Cannot concatenate onto a schema with open ruleset"),O(!t._inRuleset(),"Cannot concatenate a schema with open ruleset");let e=this.clone();if(this.type==="any"&&t.type!=="any"){let r=t.clone();for(let n of Object.keys(e))n!=="type"&&(r[n]=e[n]);e=r}e._ids.concat(t._ids),e._refs.register(t,Kf.toSibling),e._preferences=e._preferences?Be.preferences(e._preferences,t._preferences):t._preferences,e._valids=Di.merge(e._valids,t._valids,t._invalids),e._invalids=Di.merge(e._invalids,t._invalids,t._valids);for(let r of t._singleRules.keys())e._singleRules.has(r)&&(e._rules=e._rules.filter(n=>n.keep||n.name!==r),e._singleRules.delete(r));for(let r of t._rules)t._definition.rules[r.method].multi||e._singleRules.set(r.name,r),e._rules.push(r);if(e._flags.empty&&t._flags.empty){e._flags.empty=e._flags.empty.concat(t._flags.empty);let r=Object.assign({},t._flags);delete r.empty,rc(e._flags,r)}else if(t._flags.empty){e._flags.empty=t._flags.empty;let r=Object.assign({},t._flags);delete r.empty,rc(e._flags,r)}else rc(e._flags,t._flags);for(let r in t.$_terms){let n=t.$_terms[r];if(!n){e.$_terms[r]||(e.$_terms[r]=n);continue}if(!e.$_terms[r]){e.$_terms[r]=n.slice();continue}e.$_terms[r]=e.$_terms[r].concat(n)}return this.$_root._tracer&&this.$_root._tracer._combine(e,[this,t]),e.$_mutateRebuild()}extend(t){return O(!t.base,"Cannot extend type with another base"),ag.type(this,t)}extract(t){return t=Array.isArray(t)?t:t.split("."),this._ids.reach(t)}fork(t,e){O(!this._inRuleset(),"Cannot fork inside a ruleset");let r=this;for(let n of[].concat(t))n=Array.isArray(n)?n:n.split("."),r=r._ids.fork(n,e,r);return r.$_temp.ruleset=!1,r}rule(t){let e=this._definition;Be.assertOptions(t,Object.keys(e.modifiers)),O(this.$_temp.ruleset!==!1,"Cannot apply rules to empty ruleset or the last rule added does not support rule properties");let r=this.$_temp.ruleset===null?this._rules.length-1:this.$_temp.ruleset;O(r>=0&&r<this._rules.length,"Cannot apply rules to empty ruleset");let n=this.clone();for(let s=r;s<n._rules.length;++s){let i=n._rules[s],o=Rf(i);for(let a in t)e.modifiers[a](o,t[a]),O(o.name===i.name,"Cannot change rule name");n._rules[s]=o,n._singleRules.get(o.name)===i&&n._singleRules.set(o.name,o)}return n.$_temp.ruleset=!1,n.$_mutateRebuild()}get ruleset(){O(!this._inRuleset(),"Cannot start a new ruleset without closing the previous one");let t=this.clone();return t.$_temp.ruleset=t._rules.length,t}get $(){return this.ruleset}tailor(t){t=[].concat(t),O(!this._inRuleset(),"Cannot tailor inside a ruleset");let e=this;if(this.$_terms.alterations)for(let{target:r,adjuster:n}of this.$_terms.alterations)t.includes(r)&&(e=n(e),O(Be.isSchema(e),"Alteration adjuster for",r,"failed to return a schema object"));return e=e.$_modify({each:r=>r.tailor(t),ref:!1}),e.$_temp.ruleset=!1,e.$_mutateRebuild()}tracer(){return $f.location?$f.location(this):this}validate(t,e){return Ui.entry(t,this,e)}validateAsync(t,e){return Ui.entryAsync(t,this,e)}$_addRule(t){typeof t=="string"&&(t={name:t}),O(t&&typeof t=="object","Invalid options"),O(t.name&&typeof t.name=="string","Invalid rule name");for(let i in t)O(i[0]!=="_","Cannot set private rule properties");let e=Object.assign({},t);e._resolve=[],e.method=e.method||e.name;let r=this._definition.rules[e.method],n=e.args;O(r,"Unknown rule",e.method);let s=this.clone();if(n){O(Object.keys(n).length===1||Object.keys(n).length===this._definition.rules[e.name].args.length,"Invalid rule definition for",this.type,e.name);for(let i in n){let o=n[i];if(r.argsByName){let a=r.argsByName.get(i);if(a.ref&&Be.isResolvable(o))e._resolve.push(i),s.$_mutateRegister(o);else if(a.normalize&&(o=a.normalize(o),n[i]=o),a.assert){let c=Be.validateArg(o,i,a);O(!c,c,"or reference")}}if(o===void 0){delete n[i];continue}n[i]=o}}return r.multi||(s._ruleRemove(e.name,{clone:!1}),s._singleRules.set(e.name,e)),s.$_temp.ruleset===!1&&(s.$_temp.ruleset=null),r.priority?s._rules.unshift(e):s._rules.push(e),s}$_compile(t,e){return nc.schema(this.$_root,t,e)}$_createError(t,e,r,n,s,i={}){let o=i.flags!==!1?this._flags:{},a=i.messages?cg.merge(this._definition.messages,i.messages):this._definition.messages;return new og.Report(t,e,r,o,a,n,s)}$_getFlag(t){return this._flags[t]}$_getRule(t){return this._singleRules.get(t)}$_mapLabels(t){return t=Array.isArray(t)?t:t.split("."),this._ids.labels(t)}$_match(t,e,r,n){r=Object.assign({},r),r.abortEarly=!0,r._externals=!1,e.snapshot();let s=!Ui.validate(t,this,e,r,n).errors;return e.restore(),s}$_modify(t){return Be.assertOptions(t,["each","once","ref","schema"]),If.schema(this,t)||this}$_mutateRebuild(){O(!this._inRuleset(),"Cannot add this rule inside a ruleset"),this._refs.reset(),this._ids.reset();let t=(e,{source:r,name:n,path:s,key:i})=>{let o=this._definition[r][n]&&this._definition[r][n].register;o!==!1&&this.$_mutateRegister(e,{family:o,key:i})};return this.$_modify({each:t}),this._definition.rebuild&&this._definition.rebuild(this),this.$_temp.ruleset=!1,this}$_mutateRegister(t,{family:e,key:r}={}){this._refs.register(t,e),this._ids.register(t,{key:r})}$_property(t){return this._definition.properties[t]}$_reach(t){return this._ids.reach(t)}$_rootReferences(){return this._refs.roots()}$_setFlag(t,e,r={}){O(t[0]==="_"||!this._inRuleset(),"Cannot set flag inside a ruleset");let n=this._definition.flags[t]||{};if(Tf(e,n.default)&&(e=void 0),Tf(e,this._flags[t]))return this;let s=r.clone!==!1?this.clone():this;return e!==void 0?(s._flags[t]=e,s.$_mutateRegister(e)):delete s._flags[t],t[0]!=="_"&&(s.$_temp.ruleset=!1),s}$_parent(t,...e){return this[t][Be.symbols.parent].call(this,...e)}$_validate(t,e,r){return Ui.validate(t,this,e,r)}_assign(t){t.type=this.type,t.$_root=this.$_root,t.$_temp=Object.assign({},this.$_temp),t.$_temp.whens={},t._ids=this._ids.clone(),t._preferences=this._preferences,t._valids=this._valids&&this._valids.clone(),t._invalids=this._invalids&&this._invalids.clone(),t._rules=this._rules.slice(),t._singleRules=Rf(this._singleRules,{shallow:!0}),t._refs=this._refs.clone(),t._flags=Object.assign({},this._flags),t._cache=null,t.$_terms={};for(let e in this.$_terms)t.$_terms[e]=this.$_terms[e]?this.$_terms[e].slice():null;t.$_super={};for(let e in this.$_super)t.$_super[e]=this._super[e].bind(t);return t}_bare(){let t=this.clone();t._reset();let e=t._definition.terms;for(let r in e){let n=e[r];t.$_terms[r]=n.init}return t.$_mutateRebuild()}_default(t,e,r={}){return Be.assertOptions(r,"literal"),O(e!==void 0,"Missing",t,"value"),O(typeof e=="function"||!r.literal,"Only function value supports literal option"),typeof e=="function"&&r.literal&&(e={[Be.symbols.literal]:!0,literal:e}),this.$_setFlag(t,e)}_generate(t,e,r){if(!this.$_terms.whens)return{schema:this};let n=[],s=[];for(let a=0;a<this.$_terms.whens.length;++a){let c=this.$_terms.whens[a];if(c.concat){n.push(c.concat),s.push(`${a}.concat`);continue}let l=c.ref?c.ref.resolve(t,e,r):t,f=c.is?[c]:c.switch,u=s.length;for(let d=0;d<f.length;++d){let{is:p,then:m,otherwise:g}=f[d],_=`${a}${c.switch?"."+d:""}`;if(p.$_match(l,e.nest(p,`${_}.is`),r)){if(m){let x=e.localize([...e.path,`${_}.then`],e.ancestors,e.schemas),{schema:te,id:ne}=m._generate(t,x,r);n.push(te),s.push(`${_}.then${ne?`(${ne})`:""}`);break}}else if(g){let x=e.localize([...e.path,`${_}.otherwise`],e.ancestors,e.schemas),{schema:te,id:ne}=g._generate(t,x,r);n.push(te),s.push(`${_}.otherwise${ne?`(${ne})`:""}`);break}}if(c.break&&s.length>u)break}let i=s.join(", ");if(e.mainstay.tracer.debug(e,"rule","when",i),!i)return{schema:this};if(!e.mainstay.tracer.active&&this.$_temp.whens[i])return{schema:this.$_temp.whens[i],id:i};let o=this;this._definition.generate&&(o=this._definition.generate(this,t,e,r));for(let a of n)o=o.concat(a);return this.$_root._tracer&&this.$_root._tracer._combine(o,[this,...n]),this.$_temp.whens[i]=o,{schema:o,id:i}}_inner(t,e,r={}){O(!this._inRuleset(),`Cannot set ${t} inside a ruleset`);let n=this.clone();return(!n.$_terms[t]||r.override)&&(n.$_terms[t]=[]),r.single?n.$_terms[t].push(e):n.$_terms[t].push(...e),n.$_temp.ruleset=!1,n}_inRuleset(){return this.$_temp.ruleset!==null&&this.$_temp.ruleset!==!1}_ruleRemove(t,e={}){if(!this._singleRules.has(t))return this;let r=e.clone!==!1?this.clone():this;r._singleRules.delete(t);let n=[];for(let s=0;s<r._rules.length;++s){let i=r._rules[s];if(i.name===t&&!i.keep){r._inRuleset()&&s<r.$_temp.ruleset&&--r.$_temp.ruleset;continue}n.push(i)}return r._rules=n,r}_values(t,e){Be.verifyFlat(t,e.slice(1,-1));let r=this.clone(),n=t[0]===Be.symbols.override;if(n&&(t=t.slice(1)),!r[e]&&t.length?r[e]=new Di:n&&(r[e]=t.length?new Di:null,r.$_mutateRebuild()),!r[e])return r;n&&r[e].override();for(let s of t){O(s!==void 0,"Cannot call allow/valid/invalid with undefined"),O(s!==Be.symbols.override,"Override must be the first value");let i=e==="_invalids"?"_valids":"_invalids";r[i]&&(r[i].remove(s),r[i].length||(O(e==="_valids"||!r._flags.only,"Setting invalid value",s,"leaves schema rejecting all values due to previous valid rule"),r[i]=null)),r[e].add(s,r._refs)}return r}};Me.Base.prototype[Be.symbols.any]={version:Be.version,compile:nc.compile,root:"$_root"};Me.Base.prototype.isImmutable=!0;Me.Base.prototype.deny=Me.Base.prototype.invalid;Me.Base.prototype.disallow=Me.Base.prototype.invalid;Me.Base.prototype.equal=Me.Base.prototype.valid;Me.Base.prototype.exist=Me.Base.prototype.required;Me.Base.prototype.not=Me.Base.prototype.invalid;Me.Base.prototype.options=Me.Base.prototype.prefs;Me.Base.prototype.preferences=Me.Base.prototype.prefs;Uf.exports=new Me.Base});var Rt=w((_v,Mf)=>{"use strict";var Mi=Q(),lg=Df(),ug=ge(),fg=En();Mf.exports=lg.extend({type:"any",flags:{only:{default:!1}},terms:{alterations:{init:null},examples:{init:null},externals:{init:null},metas:{init:[]},notes:{init:[]},shared:{init:null},tags:{init:[]},whens:{init:null}},rules:{custom:{method(t,e){return Mi(typeof t=="function","Method must be a function"),Mi(e===void 0||e&&typeof e=="string","Description must be a non-empty string"),this.$_addRule({name:"custom",args:{method:t,description:e}})},validate(t,e,{method:r}){try{return r(t,e)}catch(n){return e.error("any.custom",{error:n})}},args:["method","description"],multi:!0},messages:{method(t){return this.prefs({messages:t})}},shared:{method(t){Mi(ug.isSchema(t)&&t._flags.id,"Schema must be a schema with an id");let e=this.clone();return e.$_terms.shared=e.$_terms.shared||[],e.$_terms.shared.push(t),e.$_mutateRegister(t),e}},warning:{method(t,e){return Mi(t&&typeof t=="string","Invalid warning code"),this.$_addRule({name:"warning",args:{code:t,local:e},warn:!0})},validate(t,e,{code:r,local:n}){return e.error(r,n)},args:["code","local"],multi:!0}},modifiers:{keep(t,e=!0){t.keep=e},message(t,e){t.message=fg.compile(e)},warn(t,e=!0){t.warn=e}},manifest:{build(t,e){for(let r in e){let n=e[r];if(["examples","externals","metas","notes","tags"].includes(r)){for(let s of n)t=t[r.slice(0,-1)](s);continue}if(r==="alterations"){let s={};for(let{target:i,adjuster:o}of n)s[i]=o;t=t.alter(s);continue}if(r==="whens"){for(let s of n){let{ref:i,is:o,not:a,then:c,otherwise:l,concat:f}=s;f?t=t.concat(f):i?t=t.when(i,{is:o,not:a,then:c,otherwise:l,switch:s.switch,break:s.break}):t=t.when(o,{then:c,otherwise:l,break:s.break})}continue}if(r==="shared")for(let s of n)t=t.shared(s)}return t}},messages:{"any.custom":"{{#label}} failed custom validation because {{#error.message}}","any.default":"{{#label}} threw an error when running default method","any.failover":"{{#label}} threw an error when running failover method","any.invalid":"{{#label}} contains an invalid value","any.only":'{{#label}} must be {if(#valids.length == 1, "", "one of ")}{{#valids}}',"any.ref":"{{#label}} {{#arg}} references {{:#ref}} which {{#reason}}","any.required":"{{#label}} is required","any.unknown":"{{#label}} is not allowed"}})});var jf=w((bv,Hf)=>{"use strict";var on=Q(),dg=Ki(),pg=Rt(),Lf=ge(),hg=nn(),Li=pr(),mg=hr(),Pn={};Hf.exports=pg.extend({type:"alternatives",flags:{match:{default:"any"}},terms:{matches:{init:[],register:mg.toSibling}},args(t,...e){return e.length===1&&Array.isArray(e[0])?t.try(...e[0]):t.try(...e)},validate(t,e){let{schema:r,error:n,state:s,prefs:i}=e;if(r._flags.match){let a=[],c=[];for(let f=0;f<r.$_terms.matches.length;++f){let u=r.$_terms.matches[f],d=s.nest(u.schema,`match.${f}`);d.snapshot();let p=u.schema.$_validate(t,d,i);p.errors?(c.push(p.errors),d.restore()):(a.push(p.value),d.commit())}if(a.length===0){let f={details:c.map(u=>Li.details(u,{override:!1}))};return{errors:n("alternatives.any",f)}}if(r._flags.match==="one")return a.length===1?{value:a[0]}:{errors:n("alternatives.one")};if(a.length!==r.$_terms.matches.length){let f={details:c.map(u=>Li.details(u,{override:!1}))};return{errors:n("alternatives.all",f)}}let l=f=>f.$_terms.matches.some(u=>u.schema.type==="object"||u.schema.type==="alternatives"&&l(u.schema));return l(r)?{value:a.reduce((f,u)=>dg(f,u,{mergeArrays:!1}))}:{value:a[a.length-1]}}let o=[];for(let a=0;a<r.$_terms.matches.length;++a){let c=r.$_terms.matches[a];if(c.schema){let u=s.nest(c.schema,`match.${a}`);u.snapshot();let d=c.schema.$_validate(t,u,i);if(!d.errors)return u.commit(),d;u.restore(),o.push({schema:c.schema,reports:d.errors});continue}let l=c.ref?c.ref.resolve(t,s,i):t,f=c.is?[c]:c.switch;for(let u=0;u<f.length;++u){let d=f[u],{is:p,then:m,otherwise:g}=d,_=`match.${a}${c.switch?"."+u:""}`;if(p.$_match(l,s.nest(p,`${_}.is`),i)){if(m)return m.$_validate(t,s.nest(m,`${_}.then`),i)}else if(g)return g.$_validate(t,s.nest(g,`${_}.otherwise`),i)}}return Pn.errors(o,e)},rules:{conditional:{method(t,e){on(!this._flags._endedSwitch,"Unreachable condition"),on(!this._flags.match,"Cannot combine match mode",this._flags.match,"with conditional rule"),on(e.break===void 0,"Cannot use break option with alternatives conditional");let r=this.clone(),n=hg.when(r,t,e),s=n.is?[n]:n.switch;for(let i of s)if(i.then&&i.otherwise){r.$_setFlag("_endedSwitch",!0,{clone:!1});break}return r.$_terms.matches.push(n),r.$_mutateRebuild()}},match:{method(t){if(on(["any","one","all"].includes(t),"Invalid alternatives match mode",t),t!=="any")for(let e of this.$_terms.matches)on(e.schema,"Cannot combine match mode",t,"with conditional rules");return this.$_setFlag("match",t)}},try:{method(...t){on(t.length,"Missing alternative schemas"),Lf.verifyFlat(t,"try"),on(!this._flags._endedSwitch,"Unreachable condition");let e=this.clone();for(let r of t)e.$_terms.matches.push({schema:e.$_compile(r)});return e.$_mutateRebuild()}}},overrides:{label(t){let e=this.$_parent("label",t),r=(n,s)=>s.path[0]!=="is"&&typeof n._flags.label!="string"?n.label(t):void 0;return e.$_modify({each:r,ref:!1})}},rebuild(t){let e=r=>{Lf.isSchema(r)&&r.type==="array"&&t.$_setFlag("_arrayItems",!0,{clone:!1})};t.$_modify({each:e})},manifest:{build(t,e){if(e.matches)for(let r of e.matches){let{schema:n,ref:s,is:i,not:o,then:a,otherwise:c}=r;n?t=t.try(n):s?t=t.conditional(s,{is:i,then:a,not:o,otherwise:c,switch:r.switch}):t=t.conditional(i,{then:a,otherwise:c})}return t}},messages:{"alternatives.all":"{{#label}} does not match all of the required types","alternatives.any":"{{#label}} does not match any of the allowed types","alternatives.match":"{{#label}} does not match any of the allowed types","alternatives.one":"{{#label}} matches more than one allowed type","alternatives.types":"{{#label}} must be one of {{#types}}"}});Pn.errors=function(t,{error:e,state:r}){if(!t.length)return{errors:e("alternatives.any")};if(t.length===1)return{errors:t[0].reports};let n=new Set,s=[];for(let{reports:i,schema:o}of t){if(i.length>1)return Pn.unmatched(t,e);let a=i[0];if(!(a instanceof Li.Report))return Pn.unmatched(t,e);if(a.state.path.length!==r.path.length){s.push({type:o.type,report:a});continue}if(a.code==="any.only"){for(let f of a.local.valids)n.add(f);continue}let[c,l]=a.code.split(".");l!=="base"?s.push({type:o.type,report:a}):a.code==="object.base"?n.add(a.local.type):n.add(c)}return s.length?s.length===1?{errors:s[0].report}:Pn.unmatched(t,e):{errors:e("alternatives.types",{types:[...n]})}};Pn.unmatched=function(t,e){let r=[];for(let n of t)r.push(...n.reports);return{errors:e("alternatives.match",Li.details(r,{override:!1}))}}});var Ff=w((wv,Vf)=>{"use strict";var ps=Q(),yg=us(),gg=en(),_g=Rt(),Tt=ge(),bg=nn(),Ee={};Vf.exports=_g.extend({type:"array",flags:{single:{default:!1},sparse:{default:!1}},terms:{items:{init:[],manifest:"schema"},ordered:{init:[],manifest:"schema"},_exclusions:{init:[]},_inclusions:{init:[]},_requireds:{init:[]}},coerce:{from:"object",method(t,{schema:e,state:r,prefs:n}){if(!Array.isArray(t))return;let s=e.$_getRule("sort");if(s)return Ee.sort(e,t,s.args.options,r,n)}},validate(t,{schema:e,error:r}){if(!Array.isArray(t)){if(e._flags.single){let n=[t];return n[Tt.symbols.arraySingle]=!0,{value:n}}return{errors:r("array.base")}}if(!(!e.$_getRule("items")&&!e.$_terms.externals))return{value:t.slice()}},rules:{has:{method(t){t=this.$_compile(t,{appendPath:!0});let e=this.$_addRule({name:"has",args:{schema:t}});return e.$_mutateRegister(t),e},validate(t,{state:e,prefs:r,error:n},{schema:s}){let i=[t,...e.ancestors];for(let a=0;a<t.length;++a){let c=e.localize([...e.path,a],i,s);if(s.$_match(t[a],c,r))return t}let o=s._flags.label;return o?n("array.hasKnown",{patternLabel:o}):n("array.hasUnknown",null)},multi:!0},items:{method(...t){Tt.verifyFlat(t,"items");let e=this.$_addRule("items");for(let r=0;r<t.length;++r){let n=Tt.tryWithPath(()=>this.$_compile(t[r]),r,{append:!0});e.$_terms.items.push(n)}return e.$_mutateRebuild()},validate(t,{schema:e,error:r,state:n,prefs:s,errorsArray:i}){let o=e.$_terms._requireds.slice(),a=e.$_terms.ordered.slice(),c=[...e.$_terms._inclusions,...o],l=!t[Tt.symbols.arraySingle];delete t[Tt.symbols.arraySingle];let f=i(),u=t.length;for(let d=0;d<u;++d){let p=t[d],m=!1,g=!1,_=l?d:new Number(d),x=[...n.path,_];if(!e._flags.sparse&&p===void 0){if(f.push(r("array.sparse",{key:_,path:x,pos:d,value:void 0},n.localize(x))),s.abortEarly)return f;a.shift();continue}let te=[t,...n.ancestors];for(let ye of e.$_terms._exclusions)if(ye.$_match(p,n.localize(x,te,ye),s,{presence:"ignore"})){if(f.push(r("array.excludes",{pos:d,value:p},n.localize(x))),s.abortEarly)return f;m=!0,a.shift();break}if(m)continue;if(e.$_terms.ordered.length){if(a.length){let ye=a.shift(),Ae=ye.$_validate(p,n.localize(x,te,ye),s);if(Ae.errors){if(f.push(...Ae.errors),s.abortEarly)return f}else if(ye._flags.result==="strip")Ee.fastSplice(t,d),--d,--u;else if(!e._flags.sparse&&Ae.value===void 0){if(f.push(r("array.sparse",{key:_,path:x,pos:d,value:void 0},n.localize(x))),s.abortEarly)return f;continue}else t[d]=Ae.value;continue}else if(!e.$_terms.items.length){if(f.push(r("array.orderedLength",{pos:d,limit:e.$_terms.ordered.length})),s.abortEarly)return f;break}}let ne=[],ce=o.length;for(let ye=0;ye<ce;++ye){let Ae=n.localize(x,te,o[ye]);Ae.snapshot();let se=o[ye].$_validate(p,Ae,s);if(ne[ye]=se,!se.errors){if(Ae.commit(),t[d]=se.value,g=!0,Ee.fastSplice(o,ye),--ye,--ce,!e._flags.sparse&&se.value===void 0&&(f.push(r("array.sparse",{key:_,path:x,pos:d,value:void 0},n.localize(x))),s.abortEarly))return f;break}Ae.restore()}if(g)continue;let zr=s.stripUnknown&&!!s.stripUnknown.arrays||!1;ce=c.length;for(let ye of c){let Ae,se=o.indexOf(ye);if(se!==-1)Ae=ne[se];else{let W=n.localize(x,te,ye);if(W.snapshot(),Ae=ye.$_validate(p,W,s),!Ae.errors){W.commit(),ye._flags.result==="strip"?(Ee.fastSplice(t,d),--d,--u):!e._flags.sparse&&Ae.value===void 0?(f.push(r("array.sparse",{key:_,path:x,pos:d,value:void 0},n.localize(x))),m=!0):t[d]=Ae.value,g=!0;break}W.restore()}if(ce===1){if(zr){Ee.fastSplice(t,d),--d,--u,g=!0;break}if(f.push(...Ae.errors),s.abortEarly)return f;m=!0;break}}if(!m&&(e.$_terms._inclusions.length||e.$_terms._requireds.length)&&!g){if(zr){Ee.fastSplice(t,d),--d,--u;continue}if(f.push(r("array.includes",{pos:d,value:p},n.localize(x))),s.abortEarly)return f}}return o.length&&Ee.fillMissedErrors(e,f,o,t,n,s),a.length&&(Ee.fillOrderedErrors(e,f,a,t,n,s),f.length||Ee.fillDefault(a,t,n,s)),f.length?f:t},priority:!0,manifest:!1},length:{method(t){return this.$_addRule({name:"length",args:{limit:t},operator:"="})},validate(t,e,{limit:r},{name:n,operator:s,args:i}){return Tt.compare(t.length,r,s)?t:e.error("array."+n,{limit:i.limit,value:t})},args:[{name:"limit",ref:!0,assert:Tt.limit,message:"must be a positive integer"}]},max:{method(t){return this.$_addRule({name:"max",method:"length",args:{limit:t},operator:"<="})}},min:{method(t){return this.$_addRule({name:"min",method:"length",args:{limit:t},operator:">="})}},ordered:{method(...t){Tt.verifyFlat(t,"ordered");let e=this.$_addRule("items");for(let r=0;r<t.length;++r){let n=Tt.tryWithPath(()=>this.$_compile(t[r]),r,{append:!0});Ee.validateSingle(n,e),e.$_mutateRegister(n),e.$_terms.ordered.push(n)}return e.$_mutateRebuild()}},single:{method(t){let e=t===void 0?!0:!!t;return ps(!e||!this._flags._arrayItems,"Cannot specify single rule when array has array items"),this.$_setFlag("single",e)}},sort:{method(t={}){Tt.assertOptions(t,["by","order"]);let e={order:t.order||"ascending"};return t.by&&(e.by=bg.ref(t.by,{ancestor:0}),ps(!e.by.ancestor,"Cannot sort by ancestor")),this.$_addRule({name:"sort",args:{options:e}})},validate(t,{error:e,state:r,prefs:n,schema:s},{options:i}){let{value:o,errors:a}=Ee.sort(s,t,i,r,n);if(a)return a;for(let c=0;c<t.length;++c)if(t[c]!==o[c])return e("array.sort",{order:i.order,by:i.by?i.by.key:"value"});return t},convert:!0},sparse:{method(t){let e=t===void 0?!0:!!t;return this._flags.sparse===e?this:(e?this.clone():this.$_addRule("items")).$_setFlag("sparse",e,{clone:!1})}},unique:{method(t,e={}){ps(!t||typeof t=="function"||typeof t=="string","comparator must be a function or a string"),Tt.assertOptions(e,["ignoreUndefined","separator"]);let r={name:"unique",args:{options:e,comparator:t}};if(t)if(typeof t=="string"){let n=Tt.default(e.separator,".");r.path=n?t.split(n):[t]}else r.comparator=t;return this.$_addRule(r)},validate(t,{state:e,error:r,schema:n},{comparator:s,options:i},{comparator:o,path:a}){let c={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),bigint:Object.create(null),object:new Map,function:new Map,custom:new Map},l=o||yg,f=i.ignoreUndefined;for(let u=0;u<t.length;++u){let d=a?gg(t[u],a):t[u],p=o?c.custom:c[typeof d];if(ps(p,"Failed to find unique map container for type",typeof d),p instanceof Map){let m=p.entries(),g;for(;!(g=m.next()).done;)if(l(g.value[0],d)){let _=e.localize([...e.path,u],[t,...e.ancestors]),x={pos:u,value:t[u],dupePos:g.value[1],dupeValue:t[g.value[1]]};return a&&(x.path=s),r("array.unique",x,_)}p.set(d,u)}else{if((!f||d!==void 0)&&p[d]!==void 0){let m={pos:u,value:t[u],dupePos:p[d],dupeValue:t[p[d]]};a&&(m.path=s);let g=e.localize([...e.path,u],[t,...e.ancestors]);return r("array.unique",m,g)}p[d]=u}}return t},args:["comparator","options"],multi:!0}},cast:{set:{from:Array.isArray,to(t,e){return new Set(t)}}},rebuild(t){t.$_terms._inclusions=[],t.$_terms._exclusions=[],t.$_terms._requireds=[];for(let e of t.$_terms.items)Ee.validateSingle(e,t),e._flags.presence==="required"?t.$_terms._requireds.push(e):e._flags.presence==="forbidden"?t.$_terms._exclusions.push(e):t.$_terms._inclusions.push(e);for(let e of t.$_terms.ordered)Ee.validateSingle(e,t)},manifest:{build(t,e){return e.items&&(t=t.items(...e.items)),e.ordered&&(t=t.ordered(...e.ordered)),t}},messages:{"array.base":"{{#label}} must be an array","array.excludes":"{{#label}} contains an excluded value","array.hasKnown":"{{#label}} does not contain at least one required match for type {:#patternLabel}","array.hasUnknown":"{{#label}} does not contain at least one required match","array.includes":"{{#label}} does not match any of the allowed types","array.includesRequiredBoth":"{{#label}} does not contain {{#knownMisses}} and {{#unknownMisses}} other required value(s)","array.includesRequiredKnowns":"{{#label}} does not contain {{#knownMisses}}","array.includesRequiredUnknowns":"{{#label}} does not contain {{#unknownMisses}} required value(s)","array.length":"{{#label}} must contain {{#limit}} items","array.max":"{{#label}} must contain less than or equal to {{#limit}} items","array.min":"{{#label}} must contain at least {{#limit}} items","array.orderedLength":"{{#label}} must contain at most {{#limit}} items","array.sort":"{{#label}} must be sorted in {#order} order by {{#by}}","array.sort.mismatching":"{{#label}} cannot be sorted due to mismatching types","array.sort.unsupported":"{{#label}} cannot be sorted due to unsupported type {#type}","array.sparse":"{{#label}} must not be a sparse array item","array.unique":"{{#label}} contains a duplicate value"}});Ee.fillMissedErrors=function(t,e,r,n,s,i){let o=[],a=0;for(let c of r){let l=c._flags.label;l?o.push(l):++a}o.length?a?e.push(t.$_createError("array.includesRequiredBoth",n,{knownMisses:o,unknownMisses:a},s,i)):e.push(t.$_createError("array.includesRequiredKnowns",n,{knownMisses:o},s,i)):e.push(t.$_createError("array.includesRequiredUnknowns",n,{unknownMisses:a},s,i))};Ee.fillOrderedErrors=function(t,e,r,n,s,i){let o=[];for(let a of r)a._flags.presence==="required"&&o.push(a);o.length&&Ee.fillMissedErrors(t,e,o,n,s,i)};Ee.fillDefault=function(t,e,r,n){let s=[],i=!0;for(let o=t.length-1;o>=0;--o){let a=t[o],c=[e,...r.ancestors],l=a.$_validate(void 0,r.localize(r.path,c,a),n).value;if(i){if(l===void 0)continue;i=!1}s.unshift(l)}s.length&&e.push(...s)};Ee.fastSplice=function(t,e){let r=e;for(;r<t.length;)t[r++]=t[r];--t.length};Ee.validateSingle=function(t,e){(t.type==="array"||t._flags._arrayItems)&&(ps(!e._flags.single,"Cannot specify array item with single rule enabled"),e.$_setFlag("_arrayItems",!0,{clone:!1}))};Ee.sort=function(t,e,r,n,s){let i=r.order==="ascending"?1:-1,o=-1*i,a=i,c=(l,f)=>{let u=Ee.compare(l,f,o,a);if(u!==null||(r.by&&(l=r.by.resolve(l,n,s),f=r.by.resolve(f,n,s)),u=Ee.compare(l,f,o,a),u!==null))return u;let d=typeof l;if(d!==typeof f)throw t.$_createError("array.sort.mismatching",e,null,n,s);if(d!=="number"&&d!=="string")throw t.$_createError("array.sort.unsupported",e,{type:d},n,s);return d==="number"?(l-f)*i:l<f?o:a};try{return{value:e.slice().sort(c)}}catch(l){return{errors:l}}};Ee.compare=function(t,e,r,n){return t===e?0:t===void 0?1:e===void 0?-1:t===null?n:e===null?r:null}});var zf=w((Av,Wf)=>{"use strict";var qf=Q(),wg=Rt(),Gf=ge(),Jf=tc(),sc={};sc.isBool=function(t){return typeof t=="boolean"};Wf.exports=wg.extend({type:"boolean",flags:{sensitive:{default:!1}},terms:{falsy:{init:null,manifest:"values"},truthy:{init:null,manifest:"values"}},coerce(t,{schema:e}){if(typeof t!="boolean"){if(typeof t=="string"){let r=e._flags.sensitive?t:t.toLowerCase();t=r==="true"?!0:r==="false"?!1:t}return typeof t!="boolean"&&(t=e.$_terms.truthy&&e.$_terms.truthy.has(t,null,null,!e._flags.sensitive)||(e.$_terms.falsy&&e.$_terms.falsy.has(t,null,null,!e._flags.sensitive)?!1:t)),{value:t}}},validate(t,{error:e}){if(typeof t!="boolean")return{value:t,errors:e("boolean.base")}},rules:{truthy:{method(...t){Gf.verifyFlat(t,"truthy");let e=this.clone();e.$_terms.truthy=e.$_terms.truthy||new Jf;for(let r=0;r<t.length;++r){let n=t[r];qf(n!==void 0,"Cannot call truthy with undefined"),e.$_terms.truthy.add(n)}return e}},falsy:{method(...t){Gf.verifyFlat(t,"falsy");let e=this.clone();e.$_terms.falsy=e.$_terms.falsy||new Jf;for(let r=0;r<t.length;++r){let n=t[r];qf(n!==void 0,"Cannot call falsy with undefined"),e.$_terms.falsy.add(n)}return e}},sensitive:{method(t=!0){return this.$_setFlag("sensitive",t)}}},cast:{number:{from:sc.isBool,to(t,e){return t?1:0}},string:{from:sc.isBool,to(t,e){return t?"true":"false"}}},manifest:{build(t,e){return e.truthy&&(t=t.truthy(...e.truthy)),e.falsy&&(t=t.falsy(...e.falsy)),t}},messages:{"boolean.base":"{{#label}} must be a boolean"}})});var Qf=w((vv,Zf)=>{"use strict";var Xf=Q(),Ag=Rt(),Yf=ge(),vg=Nr(),Ft={};Ft.isDate=function(t){return t instanceof Date};Zf.exports=Ag.extend({type:"date",coerce:{from:["number","string"],method(t,{schema:e}){return{value:Ft.parse(t,e._flags.format)||t}}},validate(t,{schema:e,error:r,prefs:n}){if(t instanceof Date&&!isNaN(t.getTime()))return;let s=e._flags.format;return!n.convert||!s||typeof t!="string"?{value:t,errors:r("date.base")}:{value:t,errors:r("date.format",{format:s})}},rules:{compare:{method:!1,validate(t,e,{date:r},{name:n,operator:s,args:i}){let o=r==="now"?Date.now():r.getTime();return Yf.compare(t.getTime(),o,s)?t:e.error("date."+n,{limit:i.date,value:t})},args:[{name:"date",ref:!0,normalize:t=>t==="now"?t:Ft.parse(t),assert:t=>t!==null,message:"must have a valid date format"}]},format:{method(t){return Xf(["iso","javascript","unix"].includes(t),"Unknown date format",t),this.$_setFlag("format",t)}},greater:{method(t){return this.$_addRule({name:"greater",method:"compare",args:{date:t},operator:">"})}},iso:{method(){return this.format("iso")}},less:{method(t){return this.$_addRule({name:"less",method:"compare",args:{date:t},operator:"<"})}},max:{method(t){return this.$_addRule({name:"max",method:"compare",args:{date:t},operator:"<="})}},min:{method(t){return this.$_addRule({name:"min",method:"compare",args:{date:t},operator:">="})}},timestamp:{method(t="javascript"){return Xf(["javascript","unix"].includes(t),'"type" must be one of "javascript, unix"'),this.format(t)}}},cast:{number:{from:Ft.isDate,to(t,e){return t.getTime()}},string:{from:Ft.isDate,to(t,{prefs:e}){return vg.date(t,e)}}},messages:{"date.base":"{{#label}} must be a valid date","date.format":'{{#label}} must be in {msg("date.format." + #format) || #format} format',"date.greater":"{{#label}} must be greater than {{:#limit}}","date.less":"{{#label}} must be less than {{:#limit}}","date.max":"{{#label}} must be less than or equal to {{:#limit}}","date.min":"{{#label}} must be greater than or equal to {{:#limit}}","date.format.iso":"ISO 8601 date","date.format.javascript":"timestamp or number of milliseconds","date.format.unix":"timestamp or number of seconds"}});Ft.parse=function(t,e){if(t instanceof Date)return t;if(typeof t!="string"&&(isNaN(t)||!isFinite(t))||/^\s*$/.test(t))return null;if(e==="iso")return Yf.isIsoDate(t)?Ft.date(t.toString()):null;let r=t;if(typeof t=="string"&&/^[+-]?\d+(\.\d+)?$/.test(t)&&(t=parseFloat(t)),e){if(e==="javascript")return Ft.date(1*t);if(e==="unix")return Ft.date(1e3*t);if(typeof r=="string")return null}return Ft.date(t)};Ft.date=function(t){let e=new Date(t);return isNaN(e.getTime())?null:e}});var sd=w((Sv,nd)=>{"use strict";var Hi=Q(),td=tt(),rd=Ki(),ed=en(),ji={};nd.exports=function(t,e,r={}){if(Hi(t&&typeof t=="object","Invalid defaults value: must be an object"),Hi(!e||e===!0||typeof e=="object","Invalid source value: must be true, falsy or an object"),Hi(typeof r=="object","Invalid options: must be an object"),!e)return null;if(r.shallow)return ji.applyToDefaultsWithShallow(t,e,r);let n=td(t);if(e===!0)return n;let s=r.nullOverride!==void 0?r.nullOverride:!1;return rd(n,e,{nullOverride:s,mergeArrays:!1})};ji.applyToDefaultsWithShallow=function(t,e,r){let n=r.shallow;Hi(Array.isArray(n),"Invalid keys");let s=new Map,i=e===!0?null:new Set;for(let c of n){c=Array.isArray(c)?c:c.split(".");let l=ed(t,c);l&&typeof l=="object"?s.set(l,i&&ed(e,c)||l):i&&i.add(c)}let o=td(t,{},s);if(!i)return o;for(let c of i)ji.reachCopy(o,e,c);let a=r.nullOverride!==void 0?r.nullOverride:!1;return rd(o,e,{nullOverride:a,mergeArrays:!1})};ji.reachCopy=function(t,e,r){for(let i of r){if(!(i in e))return;let o=e[i];if(typeof o!="object"||o===null)return;e=o}let n=e,s=t;for(let i=0;i<r.length-1;++i){let o=r[i];typeof s[o]!="object"&&(s[o]={}),s=s[o]}s[r[r.length-1]]=n}});var ad=w(od=>{"use strict";var an=Q(),id={};od.Sorter=class{constructor(){this._items=[],this.nodes=[]}add(t,e){e=e||{};let r=[].concat(e.before||[]),n=[].concat(e.after||[]),s=e.group||"?",i=e.sort||0;an(!r.includes(s),`Item cannot come before itself: ${s}`),an(!r.includes("?"),"Item cannot come before unassociated items"),an(!n.includes(s),`Item cannot come after itself: ${s}`),an(!n.includes("?"),"Item cannot come after unassociated items"),Array.isArray(t)||(t=[t]);for(let o of t){let a={seq:this._items.length,sort:i,before:r,after:n,group:s,node:o};this._items.push(a)}if(!e.manual){let o=this._sort();an(o,"item",s!=="?"?`added into group ${s}`:"","created a dependencies error")}return this.nodes}merge(t){Array.isArray(t)||(t=[t]);for(let r of t)if(r)for(let n of r._items)this._items.push(Object.assign({},n));this._items.sort(id.mergeSort);for(let r=0;r<this._items.length;++r)this._items[r].seq=r;let e=this._sort();return an(e,"merge created a dependencies error"),this.nodes}sort(){let t=this._sort();return an(t,"sort created a dependencies error"),this.nodes}_sort(){let t={},e=Object.create(null),r=Object.create(null);for(let a of this._items){let c=a.seq,l=a.group;r[l]=r[l]||[],r[l].push(c),t[c]=a.before;for(let f of a.after)e[f]=e[f]||[],e[f].push(c)}for(let a in t){let c=[];for(let l in t[a]){let f=t[a][l];r[f]=r[f]||[],c.push(...r[f])}t[a]=c}for(let a in e)if(r[a])for(let c of r[a])t[c].push(...e[a]);let n={};for(let a in t){let c=t[a];for(let l of c)n[l]=n[l]||[],n[l].push(a)}let s={},i=[];for(let a=0;a<this._items.length;++a){let c=a;if(n[a]){c=null;for(let l=0;l<this._items.length;++l){if(s[l]===!0)continue;n[l]||(n[l]=[]);let f=n[l].length,u=0;for(let d=0;d<f;++d)s[n[l][d]]&&++u;if(u===f){c=l;break}}}c!==null&&(s[c]=!0,i.push(c))}if(i.length!==this._items.length)return!1;let o={};for(let a of this._items)o[a.seq]=a;this._items=[],this.nodes=[];for(let a of i){let c=o[a];this.nodes.push(c.node),this._items.push(c)}return!0}};id.mergeSort=(t,e)=>t.sort===e.sort?0:t.sort<e.sort?-1:1});var oc=w((xv,ud)=>{"use strict";var Sg=sd(),Nt=Q(),cd=tt(),Eg=ad(),Cg=Rt(),Ze=ge(),ic=nn(),xg=pr(),ld=hr(),Vi=Nr(),D={renameDefaults:{alias:!1,multiple:!1,override:!1}};ud.exports=Cg.extend({type:"_keys",properties:{typeof:"object"},flags:{unknown:{default:void 0}},terms:{dependencies:{init:null},keys:{init:null,manifest:{mapped:{from:"schema",to:"key"}}},patterns:{init:null},renames:{init:null}},args(t,e){return t.keys(e)},validate(t,{schema:e,error:r,state:n,prefs:s}){if(!t||typeof t!==e.$_property("typeof")||Array.isArray(t))return{value:t,errors:r("object.base",{type:e.$_property("typeof")})};if(!e.$_terms.renames&&!e.$_terms.dependencies&&!e.$_terms.keys&&!e.$_terms.patterns&&!e.$_terms.externals)return;t=D.clone(t,s);let i=[];if(e.$_terms.renames&&!D.rename(e,t,n,s,i))return{value:t,errors:i};if(!e.$_terms.keys&&!e.$_terms.patterns&&!e.$_terms.dependencies)return{value:t,errors:i};let o=new Set(Object.keys(t));if(e.$_terms.keys){let a=[t,...n.ancestors];for(let c of e.$_terms.keys){let l=c.key,f=t[l];o.delete(l);let u=n.localize([...n.path,l],a,c),d=c.schema.$_validate(f,u,s);if(d.errors){if(s.abortEarly)return{value:t,errors:d.errors};d.value!==void 0&&(t[l]=d.value),i.push(...d.errors)}else c.schema._flags.result==="strip"||d.value===void 0&&f!==void 0?delete t[l]:d.value!==void 0&&(t[l]=d.value)}}if(o.size||e._flags._hasPatternMatch){let a=D.unknown(e,t,o,i,n,s);if(a)return a}if(e.$_terms.dependencies)for(let a of e.$_terms.dependencies){if(a.key!==null&&D.isPresent(a.options)(a.key.resolve(t,n,s,null,{shadow:!1}))===!1)continue;let c=D.dependencies[a.rel](e,a,t,n,s);if(c){let l=e.$_createError(c.code,t,c.context,n,s);if(s.abortEarly)return{value:t,errors:l};i.push(l)}}return{value:t,errors:i}},rules:{and:{method(...t){return Ze.verifyFlat(t,"and"),D.dependency(this,"and",null,t)}},append:{method(t){return t==null||Object.keys(t).length===0?this:this.keys(t)}},assert:{method(t,e,r){Vi.isTemplate(t)||(t=ic.ref(t)),Nt(r===void 0||typeof r=="string","Message must be a string"),e=this.$_compile(e,{appendPath:!0});let n=this.$_addRule({name:"assert",args:{subject:t,schema:e,message:r}});return n.$_mutateRegister(t),n.$_mutateRegister(e),n},validate(t,{error:e,prefs:r,state:n},{subject:s,schema:i,message:o}){let a=s.resolve(t,n,r),c=ld.isRef(s)?s.absolute(n):[];return i.$_match(a,n.localize(c,[t,...n.ancestors],i),r)?t:e("object.assert",{subject:s,message:o})},args:["subject","schema","message"],multi:!0},instance:{method(t,e){return Nt(typeof t=="function","constructor must be a function"),e=e||t.name,this.$_addRule({name:"instance",args:{constructor:t,name:e}})},validate(t,e,{constructor:r,name:n}){return t instanceof r?t:e.error("object.instance",{type:n,value:t})},args:["constructor","name"]},keys:{method(t){Nt(t===void 0||typeof t=="object","Object schema must be a valid object"),Nt(!Ze.isSchema(t),"Object schema cannot be a joi schema");let e=this.clone();if(!t)e.$_terms.keys=null;else if(!Object.keys(t).length)e.$_terms.keys=new D.Keys;else{e.$_terms.keys=e.$_terms.keys?e.$_terms.keys.filter(r=>!t.hasOwnProperty(r.key)):new D.Keys;for(let r in t)Ze.tryWithPath(()=>e.$_terms.keys.push({key:r,schema:this.$_compile(t[r])}),r)}return e.$_mutateRebuild()}},length:{method(t){return this.$_addRule({name:"length",args:{limit:t},operator:"="})},validate(t,e,{limit:r},{name:n,operator:s,args:i}){return Ze.compare(Object.keys(t).length,r,s)?t:e.error("object."+n,{limit:i.limit,value:t})},args:[{name:"limit",ref:!0,assert:Ze.limit,message:"must be a positive integer"}]},max:{method(t){return this.$_addRule({name:"max",method:"length",args:{limit:t},operator:"<="})}},min:{method(t){return this.$_addRule({name:"min",method:"length",args:{limit:t},operator:">="})}},nand:{method(...t){return Ze.verifyFlat(t,"nand"),D.dependency(this,"nand",null,t)}},or:{method(...t){return Ze.verifyFlat(t,"or"),D.dependency(this,"or",null,t)}},oxor:{method(...t){return D.dependency(this,"oxor",null,t)}},pattern:{method(t,e,r={}){let n=t instanceof RegExp;n||(t=this.$_compile(t,{appendPath:!0})),Nt(e!==void 0,"Invalid rule"),Ze.assertOptions(r,["fallthrough","matches"]),n&&Nt(!t.flags.includes("g")&&!t.flags.includes("y"),"pattern should not use global or sticky mode"),e=this.$_compile(e,{appendPath:!0});let s=this.clone();s.$_terms.patterns=s.$_terms.patterns||[];let i={[n?"regex":"schema"]:t,rule:e};return r.matches&&(i.matches=this.$_compile(r.matches),i.matches.type!=="array"&&(i.matches=i.matches.$_root.array().items(i.matches)),s.$_mutateRegister(i.matches),s.$_setFlag("_hasPatternMatch",!0,{clone:!1})),r.fallthrough&&(i.fallthrough=!0),s.$_terms.patterns.push(i),s.$_mutateRegister(e),s}},ref:{method(){return this.$_addRule("ref")},validate(t,e){return ld.isRef(t)?t:e.error("object.refType",{value:t})}},regex:{method(){return this.$_addRule("regex")},validate(t,e){return t instanceof RegExp?t:e.error("object.regex",{value:t})}},rename:{method(t,e,r={}){Nt(typeof t=="string"||t instanceof RegExp,"Rename missing the from argument"),Nt(typeof e=="string"||e instanceof Vi,"Invalid rename to argument"),Nt(e!==t,"Cannot rename key to same name:",t),Ze.assertOptions(r,["alias","ignoreUndefined","override","multiple"]);let n=this.clone();n.$_terms.renames=n.$_terms.renames||[];for(let s of n.$_terms.renames)Nt(s.from!==t,"Cannot rename the same key multiple times");return e instanceof Vi&&n.$_mutateRegister(e),n.$_terms.renames.push({from:t,to:e,options:Sg(D.renameDefaults,r)}),n}},schema:{method(t="any"){return this.$_addRule({name:"schema",args:{type:t}})},validate(t,e,{type:r}){return Ze.isSchema(t)&&(r==="any"||t.type===r)?t:e.error("object.schema",{type:r})}},unknown:{method(t){return this.$_setFlag("unknown",t!==!1)}},with:{method(t,e,r={}){return D.dependency(this,"with",t,e,r)}},without:{method(t,e,r={}){return D.dependency(this,"without",t,e,r)}},xor:{method(...t){return Ze.verifyFlat(t,"xor"),D.dependency(this,"xor",null,t)}}},overrides:{default(t,e){return t===void 0&&(t=Ze.symbols.deepDefault),this.$_parent("default",t,e)}},rebuild(t){if(t.$_terms.keys){let e=new Eg.Sorter;for(let r of t.$_terms.keys)Ze.tryWithPath(()=>e.add(r,{after:r.schema.$_rootReferences(),group:r.key}),r.key);t.$_terms.keys=new D.Keys(...e.nodes)}},manifest:{build(t,e){if(e.keys&&(t=t.keys(e.keys)),e.dependencies)for(let{rel:r,key:n=null,peers:s,options:i}of e.dependencies)t=D.dependency(t,r,n,s,i);if(e.patterns)for(let{regex:r,schema:n,rule:s,fallthrough:i,matches:o}of e.patterns)t=t.pattern(r||n,s,{fallthrough:i,matches:o});if(e.renames)for(let{from:r,to:n,options:s}of e.renames)t=t.rename(r,n,s);return t}},messages:{"object.and":"{{#label}} contains {{#presentWithLabels}} without its required peers {{#missingWithLabels}}","object.assert":'{{#label}} is invalid because {if(#subject.key, `"` + #subject.key + `" failed to ` + (#message || "pass the assertion test"), #message || "the assertion failed")}',"object.base":"{{#label}} must be of type {{#type}}","object.instance":"{{#label}} must be an instance of {{:#type}}","object.length":'{{#label}} must have {{#limit}} key{if(#limit == 1, "", "s")}',"object.max":'{{#label}} must have less than or equal to {{#limit}} key{if(#limit == 1, "", "s")}',"object.min":'{{#label}} must have at least {{#limit}} key{if(#limit == 1, "", "s")}',"object.missing":"{{#label}} must contain at least one of {{#peersWithLabels}}","object.nand":"{{:#mainWithLabel}} must not exist simultaneously with {{#peersWithLabels}}","object.oxor":"{{#label}} contains a conflict between optional exclusive peers {{#peersWithLabels}}","object.pattern.match":"{{#label}} keys failed to match pattern requirements","object.refType":"{{#label}} must be a Joi reference","object.regex":"{{#label}} must be a RegExp object","object.rename.multiple":"{{#label}} cannot rename {{:#from}} because multiple renames are disabled and another key was already renamed to {{:#to}}","object.rename.override":"{{#label}} cannot rename {{:#from}} because override is disabled and target {{:#to}} exists","object.schema":"{{#label}} must be a Joi schema of {{#type}} type","object.unknown":"{{#label}} is not allowed","object.with":"{{:#mainWithLabel}} missing required peer {{:#peerWithLabel}}","object.without":"{{:#mainWithLabel}} conflict with forbidden peer {{:#peerWithLabel}}","object.xor":"{{#label}} contains a conflict between exclusive peers {{#peersWithLabels}}"}});D.clone=function(t,e){if(typeof t=="object"){if(e.nonEnumerables)return cd(t,{shallow:!0});let n=Object.create(Object.getPrototypeOf(t));return Object.assign(n,t),n}let r=function(...n){return t.apply(this,n)};return r.prototype=cd(t.prototype),Object.defineProperty(r,"name",{value:t.name,writable:!1}),Object.defineProperty(r,"length",{value:t.length,writable:!1}),Object.assign(r,t),r};D.dependency=function(t,e,r,n,s){Nt(r===null||typeof r=="string",e,"key must be a strings"),s||(s=n.length>1&&typeof n[n.length-1]=="object"?n.pop():{}),Ze.assertOptions(s,["separator","isPresent"]),n=[].concat(n);let i=Ze.default(s.separator,"."),o=[];for(let c of n)Nt(typeof c=="string",e,"peers must be strings"),o.push(ic.ref(c,{separator:i,ancestor:0,prefix:!1}));r!==null&&(r=ic.ref(r,{separator:i,ancestor:0,prefix:!1}));let a=t.clone();return a.$_terms.dependencies=a.$_terms.dependencies||[],a.$_terms.dependencies.push(new D.Dependency(e,r,o,n,s)),a};D.dependencies={and(t,e,r,n,s){let i=[],o=[],a=e.peers.length,c=D.isPresent(e.options);for(let l of e.peers)c(l.resolve(r,n,s,null,{shadow:!1}))===!1?i.push(l.key):o.push(l.key);if(i.length!==a&&o.length!==a)return{code:"object.and",context:{present:o,presentWithLabels:D.keysToLabels(t,o),missing:i,missingWithLabels:D.keysToLabels(t,i)}}},nand(t,e,r,n,s){let i=[],o=D.isPresent(e.options);for(let l of e.peers)o(l.resolve(r,n,s,null,{shadow:!1}))&&i.push(l.key);if(i.length!==e.peers.length)return;let a=e.paths[0],c=e.paths.slice(1);return{code:"object.nand",context:{main:a,mainWithLabel:D.keysToLabels(t,a),peers:c,peersWithLabels:D.keysToLabels(t,c)}}},or(t,e,r,n,s){let i=D.isPresent(e.options);for(let o of e.peers)if(i(o.resolve(r,n,s,null,{shadow:!1})))return;return{code:"object.missing",context:{peers:e.paths,peersWithLabels:D.keysToLabels(t,e.paths)}}},oxor(t,e,r,n,s){let i=[],o=D.isPresent(e.options);for(let c of e.peers)o(c.resolve(r,n,s,null,{shadow:!1}))&&i.push(c.key);if(!i.length||i.length===1)return;let a={peers:e.paths,peersWithLabels:D.keysToLabels(t,e.paths)};return a.present=i,a.presentWithLabels=D.keysToLabels(t,i),{code:"object.oxor",context:a}},with(t,e,r,n,s){let i=D.isPresent(e.options);for(let o of e.peers)if(i(o.resolve(r,n,s,null,{shadow:!1}))===!1)return{code:"object.with",context:{main:e.key.key,mainWithLabel:D.keysToLabels(t,e.key.key),peer:o.key,peerWithLabel:D.keysToLabels(t,o.key)}}},without(t,e,r,n,s){let i=D.isPresent(e.options);for(let o of e.peers)if(i(o.resolve(r,n,s,null,{shadow:!1})))return{code:"object.without",context:{main:e.key.key,mainWithLabel:D.keysToLabels(t,e.key.key),peer:o.key,peerWithLabel:D.keysToLabels(t,o.key)}}},xor(t,e,r,n,s){let i=[],o=D.isPresent(e.options);for(let c of e.peers)o(c.resolve(r,n,s,null,{shadow:!1}))&&i.push(c.key);if(i.length===1)return;let a={peers:e.paths,peersWithLabels:D.keysToLabels(t,e.paths)};return i.length===0?{code:"object.missing",context:a}:(a.present=i,a.presentWithLabels=D.keysToLabels(t,i),{code:"object.xor",context:a})}};D.keysToLabels=function(t,e){return Array.isArray(e)?e.map(r=>t.$_mapLabels(r)):t.$_mapLabels(e)};D.isPresent=function(t){return typeof t.isPresent=="function"?t.isPresent:e=>e!==void 0};D.rename=function(t,e,r,n,s){let i={};for(let o of t.$_terms.renames){let a=[],c=typeof o.from!="string";if(!c)Object.prototype.hasOwnProperty.call(e,o.from)&&(e[o.from]!==void 0||!o.options.ignoreUndefined)&&a.push(o);else for(let l in e){if(e[l]===void 0&&o.options.ignoreUndefined||l===o.to)continue;let f=o.from.exec(l);f&&a.push({from:l,to:o.to,match:f})}for(let l of a){let f=l.from,u=l.to;if(u instanceof Vi&&(u=u.render(e,r,n,l.match)),f!==u){if(!o.options.multiple&&i[u]&&(s.push(t.$_createError("object.rename.multiple",e,{from:f,to:u,pattern:c},r,n)),n.abortEarly)||Object.prototype.hasOwnProperty.call(e,u)&&!o.options.override&&!i[u]&&(s.push(t.$_createError("object.rename.override",e,{from:f,to:u,pattern:c},r,n)),n.abortEarly))return!1;e[f]===void 0?delete e[u]:e[u]=e[f],i[u]=!0,o.options.alias||delete e[f]}}}return!0};D.unknown=function(t,e,r,n,s,i){if(t.$_terms.patterns){let a=!1,c=t.$_terms.patterns.map(f=>{if(f.matches)return a=!0,[]}),l=[e,...s.ancestors];for(let f of r){let u=e[f],d=[...s.path,f];for(let p=0;p<t.$_terms.patterns.length;++p){let m=t.$_terms.patterns[p];if(m.regex){let x=m.regex.test(f);if(s.mainstay.tracer.debug(s,"rule",`pattern.${p}`,x?"pass":"error"),!x)continue}else if(!m.schema.$_match(f,s.nest(m.schema,`pattern.${p}`),i))continue;r.delete(f);let g=s.localize(d,l,{schema:m.rule,key:f}),_=m.rule.$_validate(u,g,i);if(_.errors){if(i.abortEarly)return{value:e,errors:_.errors};n.push(..._.errors)}if(m.matches&&c[p].push(f),e[f]=_.value,!m.fallthrough)break}}if(a)for(let f=0;f<c.length;++f){let u=c[f];if(!u)continue;let d=t.$_terms.patterns[f].matches,p=s.localize(s.path,l,d),m=d.$_validate(u,p,i);if(m.errors){let g=xg.details(m.errors,{override:!1});g.matches=u;let _=t.$_createError("object.pattern.match",e,g,s,i);if(i.abortEarly)return{value:e,errors:_};n.push(_)}}}if(!r.size||!t.$_terms.keys&&!t.$_terms.patterns)return;if(i.stripUnknown&&typeof t._flags.unknown>"u"||i.skipFunctions){let a=i.stripUnknown?i.stripUnknown===!0?!0:!!i.stripUnknown.objects:!1;for(let c of r)a?(delete e[c],r.delete(c)):typeof e[c]=="function"&&r.delete(c)}if(!Ze.default(t._flags.unknown,i.allowUnknown))for(let a of r){let c=s.localize([...s.path,a],[]),l=t.$_createError("object.unknown",e[a],{child:a},c,i,{flags:!1});if(i.abortEarly)return{value:e,errors:l};n.push(l)}};D.Dependency=class{constructor(t,e,r,n,s){this.rel=t,this.key=e,this.peers=r,this.paths=n,this.options=s}describe(){let t={rel:this.rel,peers:this.paths};return this.key!==null&&(t.key=this.key.key),this.peers[0].separator!=="."&&(t.options={...t.options,separator:this.peers[0].separator}),this.options.isPresent&&(t.options={...t.options,isPresent:this.options.isPresent}),t}};D.Keys=class extends Array{concat(t){let e=this.slice(),r=new Map;for(let n=0;n<e.length;++n)r.set(e[n].key,n);for(let n of t){let s=n.key,i=r.get(s);i!==void 0?e[i]={key:s,schema:e[i].schema.concat(n.schema)}:e.push(n)}return e}}});var dd=w((Bv,fd)=>{"use strict";var ac=Q(),kg=oc();fd.exports=kg.extend({type:"function",properties:{typeof:"function"},rules:{arity:{method(t){return ac(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"arity",args:{n:t}})},validate(t,e,{n:r}){return t.length===r?t:e.error("function.arity",{n:r})}},class:{method(){return this.$_addRule("class")},validate(t,e){return/^\s*class\s/.test(t.toString())?t:e.error("function.class",{value:t})}},minArity:{method(t){return ac(Number.isSafeInteger(t)&&t>0,"n must be a strict positive integer"),this.$_addRule({name:"minArity",args:{n:t}})},validate(t,e,{n:r}){return t.length>=r?t:e.error("function.minArity",{n:r})}},maxArity:{method(t){return ac(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"maxArity",args:{n:t}})},validate(t,e,{n:r}){return t.length<=r?t:e.error("function.maxArity",{n:r})}}},messages:{"function.arity":"{{#label}} must have an arity of {{#n}}","function.class":"{{#label}} must be a class","function.maxArity":"{{#label}} must have an arity lesser or equal to {{#n}}","function.minArity":"{{#label}} must have an arity greater or equal to {{#n}}"}})});var hd=w((Ov,pd)=>{"use strict";var _r=Q(),Pg=Rt(),Bg=ge(),Og=nn(),Rg=pr(),br={};pd.exports=Pg.extend({type:"link",properties:{schemaChain:!0},terms:{link:{init:null,manifest:"single",register:!1}},args(t,e){return t.ref(e)},validate(t,{schema:e,state:r,prefs:n}){_r(e.$_terms.link,"Uninitialized link schema");let s=br.generate(e,t,r,n),i=e.$_terms.link[0].ref;return s.$_validate(t,r.nest(s,`link:${i.display}:${s.type}`),n)},generate(t,e,r,n){return br.generate(t,e,r,n)},rules:{ref:{method(t){_r(!this.$_terms.link,"Cannot reinitialize schema"),t=Og.ref(t),_r(t.type==="value"||t.type==="local","Invalid reference type:",t.type),_r(t.type==="local"||t.ancestor==="root"||t.ancestor>0,"Link cannot reference itself");let e=this.clone();return e.$_terms.link=[{ref:t}],e}},relative:{method(t=!0){return this.$_setFlag("relative",t)}}},overrides:{concat(t){_r(this.$_terms.link,"Uninitialized link schema"),_r(Bg.isSchema(t),"Invalid schema object"),_r(t.type!=="link","Cannot merge type link with another link");let e=this.clone();return e.$_terms.whens||(e.$_terms.whens=[]),e.$_terms.whens.push({concat:t}),e.$_mutateRebuild()}},manifest:{build(t,e){return _r(e.link,"Invalid link description missing link"),t.ref(e.link)}}});br.generate=function(t,e,r,n){let s=r.mainstay.links.get(t);if(s)return s._generate(e,r,n).schema;let i=t.$_terms.link[0].ref,{perspective:o,path:a}=br.perspective(i,r);br.assert(o,"which is outside of schema boundaries",i,t,r,n);try{s=a.length?o.$_reach(a):o}catch{br.assert(!1,"to non-existing schema",i,t,r,n)}return br.assert(s.type!=="link","which is another link",i,t,r,n),t._flags.relative||r.mainstay.links.set(t,s),s._generate(e,r,n).schema};br.perspective=function(t,e){if(t.type==="local"){for(let{schema:r,key:n}of e.schemas){if((r._flags.id||n)===t.path[0])return{perspective:r,path:t.path.slice(1)};if(r.$_terms.shared){for(let i of r.$_terms.shared)if(i._flags.id===t.path[0])return{perspective:i,path:t.path.slice(1)}}}return{perspective:null,path:null}}return t.ancestor==="root"?{perspective:e.schemas[e.schemas.length-1].schema,path:t.path}:{perspective:e.schemas[t.ancestor]&&e.schemas[t.ancestor].schema,path:t.path}};br.assert=function(t,e,r,n,s,i){t||_r(!1,`"${Rg.label(n._flags,s,i)}" contains link reference "${r.display}" ${e}`)}});var yd=w((Rv,md)=>{"use strict";var cc=Q(),Tg=Rt(),lc=ge(),gt={numberRx:/^\s*[+-]?(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:e([+-]?\d+))?\s*$/i,precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/,exponentialPartRegex:/[eE][+-]?\d+$/,leadingSignAndZerosRegex:/^[+-]?(0*)?/,dotRegex:/\./,trailingZerosRegex:/0+$/,decimalPlaces(t){let e=t.toString(),r=e.indexOf("."),n=e.indexOf("e");return(r<0?0:(n<0?e.length:n)-r-1)+(n<0?0:Math.max(0,-parseInt(e.slice(n+1))))}};md.exports=Tg.extend({type:"number",flags:{unsafe:{default:!1}},coerce:{from:"string",method(t,{schema:e,error:r}){if(!t.match(gt.numberRx))return;t=t.trim();let s={value:parseFloat(t)};if(s.value===0&&(s.value=0),!e._flags.unsafe)if(t.match(/e/i)){if(gt.extractSignificantDigits(t)!==gt.extractSignificantDigits(String(s.value)))return s.errors=r("number.unsafe"),s}else{let i=s.value.toString();if(i.match(/e/i))return s;if(i!==gt.normalizeDecimal(t))return s.errors=r("number.unsafe"),s}return s}},validate(t,{schema:e,error:r,prefs:n}){if(t===1/0||t===-1/0)return{value:t,errors:r("number.infinity")};if(!lc.isNumber(t))return{value:t,errors:r("number.base")};let s={value:t};if(n.convert){let i=e.$_getRule("precision");if(i){let o=Math.pow(10,i.args.limit);s.value=Math.round(s.value*o)/o}}return s.value===0&&(s.value=0),!e._flags.unsafe&&(t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER)&&(s.errors=r("number.unsafe")),s},rules:{compare:{method:!1,validate(t,e,{limit:r},{name:n,operator:s,args:i}){return lc.compare(t,r,s)?t:e.error("number."+n,{limit:i.limit,value:t})},args:[{name:"limit",ref:!0,assert:lc.isNumber,message:"must be a number"}]},greater:{method(t){return this.$_addRule({name:"greater",method:"compare",args:{limit:t},operator:">"})}},integer:{method(){return this.$_addRule("integer")},validate(t,e){return Math.trunc(t)-t===0?t:e.error("number.integer")}},less:{method(t){return this.$_addRule({name:"less",method:"compare",args:{limit:t},operator:"<"})}},max:{method(t){return this.$_addRule({name:"max",method:"compare",args:{limit:t},operator:"<="})}},min:{method(t){return this.$_addRule({name:"min",method:"compare",args:{limit:t},operator:">="})}},multiple:{method(t){let e=typeof t=="number"?gt.decimalPlaces(t):null,r=Math.pow(10,e);return this.$_addRule({name:"multiple",args:{base:t,baseDecimalPlace:e,pfactor:r}})},validate(t,e,{base:r,baseDecimalPlace:n,pfactor:s},i){return gt.decimalPlaces(t)>n?e.error("number.multiple",{multiple:i.args.base,value:t}):Math.round(s*t)%Math.round(s*r)===0?t:e.error("number.multiple",{multiple:i.args.base,value:t})},args:[{name:"base",ref:!0,assert:t=>typeof t=="number"&&isFinite(t)&&t>0,message:"must be a positive number"},"baseDecimalPlace","pfactor"],multi:!0},negative:{method(){return this.sign("negative")}},port:{method(){return this.$_addRule("port")},validate(t,e){return Number.isSafeInteger(t)&&t>=0&&t<=65535?t:e.error("number.port")}},positive:{method(){return this.sign("positive")}},precision:{method(t){return cc(Number.isSafeInteger(t),"limit must be an integer"),this.$_addRule({name:"precision",args:{limit:t}})},validate(t,e,{limit:r}){let n=t.toString().match(gt.precisionRx);return Math.max((n[1]?n[1].length:0)-(n[2]?parseInt(n[2],10):0),0)<=r?t:e.error("number.precision",{limit:r,value:t})},convert:!0},sign:{method(t){return cc(["negative","positive"].includes(t),"Invalid sign",t),this.$_addRule({name:"sign",args:{sign:t}})},validate(t,e,{sign:r}){return r==="negative"&&t<0||r==="positive"&&t>0?t:e.error(`number.${r}`)}},unsafe:{method(t=!0){return cc(typeof t=="boolean","enabled must be a boolean"),this.$_setFlag("unsafe",t)}}},cast:{string:{from:t=>typeof t=="number",to(t,e){return t.toString()}}},messages:{"number.base":"{{#label}} must be a number","number.greater":"{{#label}} must be greater than {{#limit}}","number.infinity":"{{#label}} cannot be infinity","number.integer":"{{#label}} must be an integer","number.less":"{{#label}} must be less than {{#limit}}","number.max":"{{#label}} must be less than or equal to {{#limit}}","number.min":"{{#label}} must be greater than or equal to {{#limit}}","number.multiple":"{{#label}} must be a multiple of {{#multiple}}","number.negative":"{{#label}} must be a negative number","number.port":"{{#label}} must be a valid port","number.positive":"{{#label}} must be a positive number","number.precision":"{{#label}} must have no more than {{#limit}} decimal places","number.unsafe":"{{#label}} must be a safe number"}});gt.extractSignificantDigits=function(t){return t.replace(gt.exponentialPartRegex,"").replace(gt.dotRegex,"").replace(gt.trailingZerosRegex,"").replace(gt.leadingSignAndZerosRegex,"")};gt.normalizeDecimal=function(t){return t=t.replace(/^\+/,"").replace(/\.0*$/,"").replace(/^(-?)\.([^\.]*)$/,"$10.$2").replace(/^(-?)0+([0-9])/,"$1$2"),t.includes(".")&&t.endsWith("0")&&(t=t.replace(/0+$/,"")),t==="-0"?"0":t}});var _d=w((Tv,gd)=>{"use strict";var Ng=oc();gd.exports=Ng.extend({type:"object",cast:{map:{from:t=>t&&typeof t=="object",to(t,e){return new Map(Object.entries(t))}}}})});var uc=w(Fi=>{"use strict";Fi.codes={EMPTY_STRING:"Address must be a non-empty string",FORBIDDEN_UNICODE:"Address contains forbidden Unicode characters",MULTIPLE_AT_CHAR:"Address cannot contain more than one @ character",MISSING_AT_CHAR:"Address must contain one @ character",EMPTY_LOCAL:"Address local part cannot be empty",ADDRESS_TOO_LONG:"Address too long",LOCAL_TOO_LONG:"Address local part too long",EMPTY_LOCAL_SEGMENT:"Address local part contains empty dot-separated segment",INVALID_LOCAL_CHARS:"Address local part contains invalid character",DOMAIN_NON_EMPTY_STRING:"Domain must be a non-empty string",DOMAIN_TOO_LONG:"Domain too long",DOMAIN_INVALID_UNICODE_CHARS:"Domain contains forbidden Unicode characters",DOMAIN_INVALID_CHARS:"Domain contains invalid character",DOMAIN_INVALID_TLDS_CHARS:"Domain contains invalid tld character",DOMAIN_SEGMENTS_COUNT:"Domain lacks the minimum required number of segments",DOMAIN_SEGMENTS_COUNT_MAX:"Domain contains too many segments",DOMAIN_FORBIDDEN_TLDS:"Domain uses forbidden TLD",DOMAIN_EMPTY_SEGMENT:"Domain contains empty dot-separated segment",DOMAIN_LONG_SEGMENT:"Domain contains dot-separated segment that is too long"};Fi.code=function(t){return{code:t,error:Fi.codes[t]}}});var fc=w(qi=>{"use strict";var Ig=require("url"),qt=uc(),$r={minDomainSegments:2,nonAsciiRx:/[^\x00-\x7f]/,domainControlRx:/[\x00-\x20@\:\/\\#!\$&\'\(\)\*\+,;=\?]/,tldSegmentRx:/^[a-zA-Z](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,domainSegmentRx:/^[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,URL:Ig.URL||URL};qi.analyze=function(t,e={}){if(!t)return qt.code("DOMAIN_NON_EMPTY_STRING");if(typeof t!="string")throw new Error("Invalid input: domain must be a string");if(t.length>256)return qt.code("DOMAIN_TOO_LONG");if(!!$r.nonAsciiRx.test(t)){if(e.allowUnicode===!1)return qt.code("DOMAIN_INVALID_UNICODE_CHARS");t=t.normalize("NFC")}if($r.domainControlRx.test(t))return qt.code("DOMAIN_INVALID_CHARS");t=$r.punycode(t),e.allowFullyQualified&&t[t.length-1]==="."&&(t=t.slice(0,-1));let n=e.minDomainSegments||$r.minDomainSegments,s=t.split(".");if(s.length<n)return qt.code("DOMAIN_SEGMENTS_COUNT");if(e.maxDomainSegments&&s.length>e.maxDomainSegments)return qt.code("DOMAIN_SEGMENTS_COUNT_MAX");let i=e.tlds;if(i){let o=s[s.length-1].toLowerCase();if(i.deny&&i.deny.has(o)||i.allow&&!i.allow.has(o))return qt.code("DOMAIN_FORBIDDEN_TLDS")}for(let o=0;o<s.length;++o){let a=s[o];if(!a.length)return qt.code("DOMAIN_EMPTY_SEGMENT");if(a.length>63)return qt.code("DOMAIN_LONG_SEGMENT");if(o<s.length-1){if(!$r.domainSegmentRx.test(a))return qt.code("DOMAIN_INVALID_CHARS")}else if(!$r.tldSegmentRx.test(a))return qt.code("DOMAIN_INVALID_TLDS_CHARS")}return null};qi.isValid=function(t,e){return!qi.analyze(t,e)};$r.punycode=function(t){t.includes("%")&&(t=t.replace(/%/g,"%25"));try{return new $r.URL(`http://${t}`).host}catch{return t}}});var bd=w(dc=>{"use strict";var Kg=require("util"),$g=fc(),sr=uc(),nt={nonAsciiRx:/[^\x00-\x7f]/,encoder:new(Kg.TextEncoder||TextEncoder)};dc.analyze=function(t,e){return nt.email(t,e)};dc.isValid=function(t,e){return!nt.email(t,e)};nt.email=function(t,e={}){if(typeof t!="string")throw new Error("Invalid input: email must be a string");if(!t)return sr.code("EMPTY_STRING");let r=!nt.nonAsciiRx.test(t);if(!r){if(e.allowUnicode===!1)return sr.code("FORBIDDEN_UNICODE");t=t.normalize("NFC")}let n=t.split("@");if(n.length!==2)return n.length>2?sr.code("MULTIPLE_AT_CHAR"):sr.code("MISSING_AT_CHAR");let[s,i]=n;if(!s)return sr.code("EMPTY_LOCAL");if(!e.ignoreLength){if(t.length>254)return sr.code("ADDRESS_TOO_LONG");if(nt.encoder.encode(s).length>64)return sr.code("LOCAL_TOO_LONG")}return nt.local(s,r)||$g.analyze(i,e)};nt.local=function(t,e){let r=t.split(".");for(let n of r){if(!n.length)return sr.code("EMPTY_LOCAL_SEGMENT");if(e){if(!nt.atextRx.test(n))return sr.code("INVALID_LOCAL_CHARS");continue}for(let s of n){if(nt.atextRx.test(s))continue;let i=nt.binary(s);if(!nt.atomRx.test(i))return sr.code("INVALID_LOCAL_CHARS")}}};nt.binary=function(t){return Array.from(nt.encoder.encode(t)).map(e=>String.fromCharCode(e)).join("")};nt.atextRx=/^[\w!#\$%&'\*\+\-/=\?\^`\{\|\}~]+$/;nt.atomRx=new RegExp(["(?:[\\xc2-\\xdf][\\x80-\\xbf])","(?:\\xe0[\\xa0-\\xbf][\\x80-\\xbf])|(?:[\\xe1-\\xec][\\x80-\\xbf]{2})|(?:\\xed[\\x80-\\x9f][\\x80-\\xbf])|(?:[\\xee-\\xef][\\x80-\\xbf]{2})","(?:\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2})|(?:[\\xf1-\\xf3][\\x80-\\xbf]{3})|(?:\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})"].join("|"))});var pc=w(($v,wd)=>{"use strict";wd.exports=function(t){return t.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")}});var mc=w(hc=>{"use strict";var Gi=Q(),Ug=pc(),je={};je.generate=function(){let t={},e="\\dA-Fa-f",r="["+e+"]",n="\\w-\\.~",s="!\\$&'\\(\\)\\*\\+,;=",i="%"+e,o=n+i+s+":@",a="["+o+"]",c="(?:0{0,2}\\d|0?[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";t.ipv4address="(?:"+c+"\\.){3}"+c;let l=r+"{1,4}",f="(?:"+l+":"+l+"|"+t.ipv4address+")",u="(?:"+l+":){6}"+f,d="::(?:"+l+":){5}"+f,p="(?:"+l+")?::(?:"+l+":){4}"+f,m="(?:(?:"+l+":){0,1}"+l+")?::(?:"+l+":){3}"+f,g="(?:(?:"+l+":){0,2}"+l+")?::(?:"+l+":){2}"+f,_="(?:(?:"+l+":){0,3}"+l+")?::"+l+":"+f,x="(?:(?:"+l+":){0,4}"+l+")?::"+f,te="(?:(?:"+l+":){0,5}"+l+")?::"+l,ne="(?:(?:"+l+":){0,6}"+l+")?::";t.ipv4Cidr="(?:\\d|[1-2]\\d|3[0-2])",t.ipv6Cidr="(?:0{0,2}\\d|0?[1-9]\\d|1[01]\\d|12[0-8])",t.ipv6address="(?:"+u+"|"+d+"|"+p+"|"+m+"|"+g+"|"+_+"|"+x+"|"+te+"|"+ne+")",t.ipvFuture="v"+r+"+\\.["+n+s+":]+",t.scheme="[a-zA-Z][a-zA-Z\\d+-\\.]*",t.schemeRegex=new RegExp(t.scheme);let ce="["+n+i+s+":]*",zr="\\[(?:"+t.ipv6address+"|"+t.ipvFuture+")\\]",ye="["+n+i+s+"]{1,255}",Ae="(?:"+zr+"|"+t.ipv4address+"|"+ye+")",se="\\d*",W="(?:"+ce+"@)?"+Ae+"(?::"+se+")?",Xr="(?:"+ce+"@)?("+Ae+")(?::"+se+")?",ts=a+"*",U=a+"+",B="["+n+i+s+"@]+",E="",T="(?:\\/"+ts+")*",C="\\/(?:"+U+T+")?",L=U+T,H=B+T,le="(?:\\/\\/\\/"+ts+T+")";return t.hierPart="(?:(?:\\/\\/"+W+T+")|"+C+"|"+L+"|"+le+")",t.hierPartCapture="(?:(?:\\/\\/"+Xr+T+")|"+C+"|"+L+")",t.relativeRef="(?:(?:\\/\\/"+W+T+")|"+C+"|"+H+"|"+E+")",t.relativeRefCapture="(?:(?:\\/\\/"+Xr+T+")|"+C+"|"+H+"|"+E+")",t.query="["+o+"\\/\\?]*(?=#|$)",t.queryWithSquareBrackets="["+o+"\\[\\]\\/\\?]*(?=#|$)",t.fragment="["+o+"\\/\\?]*",t};je.rfc3986=je.generate();hc.ip={v4Cidr:je.rfc3986.ipv4Cidr,v6Cidr:je.rfc3986.ipv6Cidr,ipv4:je.rfc3986.ipv4address,ipv6:je.rfc3986.ipv6address,ipvfuture:je.rfc3986.ipvFuture};je.createRegex=function(t){let e=je.rfc3986,n="(?:\\?"+(t.allowQuerySquareBrackets?e.queryWithSquareBrackets:e.query)+")?(?:#"+e.fragment+")?",s=t.domain?e.relativeRefCapture:e.relativeRef;if(t.relativeOnly)return je.wrap(s+n);let i="";if(t.scheme){Gi(t.scheme instanceof RegExp||typeof t.scheme=="string"||Array.isArray(t.scheme),"scheme must be a RegExp, String, or Array");let l=[].concat(t.scheme);Gi(l.length>=1,"scheme must have at least 1 scheme specified");let f=[];for(let u=0;u<l.length;++u){let d=l[u];Gi(d instanceof RegExp||typeof d=="string","scheme at position "+u+" must be a RegExp or String"),d instanceof RegExp?f.push(d.source.toString()):(Gi(e.schemeRegex.test(d),"scheme at position "+u+" must be a valid scheme"),f.push(Ug(d)))}i=f.join("|")}let a="(?:"+(i?"(?:"+i+")":e.scheme)+":"+(t.domain?e.hierPartCapture:e.hierPart)+")",c=t.allowRelative?"(?:"+a+"|"+s+")":a;return je.wrap(c+n,i)};je.wrap=function(t,e){return t=`(?=.)(?!https?:/(?:$|[^/]))(?!https?:///)(?!https?:[^/])${t}`,{raw:t,regex:new RegExp(`^${t}$`),scheme:e}};je.uriRegex=je.createRegex({});hc.regex=function(t={}){return t.scheme||t.allowRelative||t.relativeOnly||t.allowQuerySquareBrackets||t.domain?je.createRegex(t):je.uriRegex}});var vd=w(Ad=>{"use strict";var Bn=Q(),hs=mc();Ad.regex=function(t={}){Bn(t.cidr===void 0||typeof t.cidr=="string","options.cidr must be a string");let e=t.cidr?t.cidr.toLowerCase():"optional";Bn(["required","optional","forbidden"].includes(e),"options.cidr must be one of required, optional, forbidden"),Bn(t.version===void 0||typeof t.version=="string"||Array.isArray(t.version),"options.version must be a string or an array of string");let r=t.version||["ipv4","ipv6","ipvfuture"];Array.isArray(r)||(r=[r]),Bn(r.length>=1,"options.version must have at least 1 version specified");for(let o=0;o<r.length;++o)Bn(typeof r[o]=="string","options.version must only contain strings"),r[o]=r[o].toLowerCase(),Bn(["ipv4","ipv6","ipvfuture"].includes(r[o]),"options.version contains unknown version "+r[o]+" - must be one of ipv4, ipv6, ipvfuture");r=Array.from(new Set(r));let s=`(?:${r.map(o=>{if(e==="forbidden")return hs.ip[o];let a=`\\/${o==="ipv4"?hs.ip.v4Cidr:hs.ip.v6Cidr}`;return e==="required"?`${hs.ip[o]}${a}`:`${hs.ip[o]}(?:${a})?`}).join("|")})`,i=new RegExp(`^${s}$`);return{cidr:e,versions:r,regex:i,raw:s}}});var Cd=w((Mv,Ed)=>{"use strict";var Sd={};Sd.tlds=["AAA","AARP","ABB","ABBOTT","ABBVIE","ABC","ABLE","ABOGADO","ABUDHABI","AC","ACADEMY","ACCENTURE","ACCOUNTANT","ACCOUNTANTS","ACO","ACTOR","AD","ADS","ADULT","AE","AEG","AERO","AETNA","AF","AFL","AFRICA","AG","AGAKHAN","AGENCY","AI","AIG","AIRBUS","AIRFORCE","AIRTEL","AKDN","AL","ALIBABA","ALIPAY","ALLFINANZ","ALLSTATE","ALLY","ALSACE","ALSTOM","AM","AMAZON","AMERICANEXPRESS","AMERICANFAMILY","AMEX","AMFAM","AMICA","AMSTERDAM","ANALYTICS","ANDROID","ANQUAN","ANZ","AO","AOL","APARTMENTS","APP","APPLE","AQ","AQUARELLE","AR","ARAB","ARAMCO","ARCHI","ARMY","ARPA","ART","ARTE","AS","ASDA","ASIA","ASSOCIATES","AT","ATHLETA","ATTORNEY","AU","AUCTION","AUDI","AUDIBLE","AUDIO","AUSPOST","AUTHOR","AUTO","AUTOS","AVIANCA","AW","AWS","AX","AXA","AZ","AZURE","BA","BABY","BAIDU","BANAMEX","BAND","BANK","BAR","BARCELONA","BARCLAYCARD","BARCLAYS","BAREFOOT","BARGAINS","BASEBALL","BASKETBALL","BAUHAUS","BAYERN","BB","BBC","BBT","BBVA","BCG","BCN","BD","BE","BEATS","BEAUTY","BEER","BENTLEY","BERLIN","BEST","BESTBUY","BET","BF","BG","BH","BHARTI","BI","BIBLE","BID","BIKE","BING","BINGO","BIO","BIZ","BJ","BLACK","BLACKFRIDAY","BLOCKBUSTER","BLOG","BLOOMBERG","BLUE","BM","BMS","BMW","BN","BNPPARIBAS","BO","BOATS","BOEHRINGER","BOFA","BOM","BOND","BOO","BOOK","BOOKING","BOSCH","BOSTIK","BOSTON","BOT","BOUTIQUE","BOX","BR","BRADESCO","BRIDGESTONE","BROADWAY","BROKER","BROTHER","BRUSSELS","BS","BT","BUILD","BUILDERS","BUSINESS","BUY","BUZZ","BV","BW","BY","BZ","BZH","CA","CAB","CAFE","CAL","CALL","CALVINKLEIN","CAM","CAMERA","CAMP","CANON","CAPETOWN","CAPITAL","CAPITALONE","CAR","CARAVAN","CARDS","CARE","CAREER","CAREERS","CARS","CASA","CASE","CASH","CASINO","CAT","CATERING","CATHOLIC","CBA","CBN","CBRE","CC","CD","CENTER","CEO","CERN","CF","CFA","CFD","CG","CH","CHANEL","CHANNEL","CHARITY","CHASE","CHAT","CHEAP","CHINTAI","CHRISTMAS","CHROME","CHURCH","CI","CIPRIANI","CIRCLE","CISCO","CITADEL","CITI","CITIC","CITY","CK","CL","CLAIMS","CLEANING","CLICK","CLINIC","CLINIQUE","CLOTHING","CLOUD","CLUB","CLUBMED","CM","CN","CO","COACH","CODES","COFFEE","COLLEGE","COLOGNE","COM","COMCAST","COMMBANK","COMMUNITY","COMPANY","COMPARE","COMPUTER","COMSEC","CONDOS","CONSTRUCTION","CONSULTING","CONTACT","CONTRACTORS","COOKING","COOL","COOP","CORSICA","COUNTRY","COUPON","COUPONS","COURSES","CPA","CR","CREDIT","CREDITCARD","CREDITUNION","CRICKET","CROWN","CRS","CRUISE","CRUISES","CU","CUISINELLA","CV","CW","CX","CY","CYMRU","CYOU","CZ","DABUR","DAD","DANCE","DATA","DATE","DATING","DATSUN","DAY","DCLK","DDS","DE","DEAL","DEALER","DEALS","DEGREE","DELIVERY","DELL","DELOITTE","DELTA","DEMOCRAT","DENTAL","DENTIST","DESI","DESIGN","DEV","DHL","DIAMONDS","DIET","DIGITAL","DIRECT","DIRECTORY","DISCOUNT","DISCOVER","DISH","DIY","DJ","DK","DM","DNP","DO","DOCS","DOCTOR","DOG","DOMAINS","DOT","DOWNLOAD","DRIVE","DTV","DUBAI","DUNLOP","DUPONT","DURBAN","DVAG","DVR","DZ","EARTH","EAT","EC","ECO","EDEKA","EDU","EDUCATION","EE","EG","EMAIL","EMERCK","ENERGY","ENGINEER","ENGINEERING","ENTERPRISES","EPSON","EQUIPMENT","ER","ERICSSON","ERNI","ES","ESQ","ESTATE","ET","EU","EUROVISION","EUS","EVENTS","EXCHANGE","EXPERT","EXPOSED","EXPRESS","EXTRASPACE","FAGE","FAIL","FAIRWINDS","FAITH","FAMILY","FAN","FANS","FARM","FARMERS","FASHION","FAST","FEDEX","FEEDBACK","FERRARI","FERRERO","FI","FIDELITY","FIDO","FILM","FINAL","FINANCE","FINANCIAL","FIRE","FIRESTONE","FIRMDALE","FISH","FISHING","FIT","FITNESS","FJ","FK","FLICKR","FLIGHTS","FLIR","FLORIST","FLOWERS","FLY","FM","FO","FOO","FOOD","FOOTBALL","FORD","FOREX","FORSALE","FORUM","FOUNDATION","FOX","FR","FREE","FRESENIUS","FRL","FROGANS","FRONTIER","FTR","FUJITSU","FUN","FUND","FURNITURE","FUTBOL","FYI","GA","GAL","GALLERY","GALLO","GALLUP","GAME","GAMES","GAP","GARDEN","GAY","GB","GBIZ","GD","GDN","GE","GEA","GENT","GENTING","GEORGE","GF","GG","GGEE","GH","GI","GIFT","GIFTS","GIVES","GIVING","GL","GLASS","GLE","GLOBAL","GLOBO","GM","GMAIL","GMBH","GMO","GMX","GN","GODADDY","GOLD","GOLDPOINT","GOLF","GOO","GOODYEAR","GOOG","GOOGLE","GOP","GOT","GOV","GP","GQ","GR","GRAINGER","GRAPHICS","GRATIS","GREEN","GRIPE","GROCERY","GROUP","GS","GT","GU","GUARDIAN","GUCCI","GUGE","GUIDE","GUITARS","GURU","GW","GY","HAIR","HAMBURG","HANGOUT","HAUS","HBO","HDFC","HDFCBANK","HEALTH","HEALTHCARE","HELP","HELSINKI","HERE","HERMES","HIPHOP","HISAMITSU","HITACHI","HIV","HK","HKT","HM","HN","HOCKEY","HOLDINGS","HOLIDAY","HOMEDEPOT","HOMEGOODS","HOMES","HOMESENSE","HONDA","HORSE","HOSPITAL","HOST","HOSTING","HOT","HOTELS","HOTMAIL","HOUSE","HOW","HR","HSBC","HT","HU","HUGHES","HYATT","HYUNDAI","IBM","ICBC","ICE","ICU","ID","IE","IEEE","IFM","IKANO","IL","IM","IMAMAT","IMDB","IMMO","IMMOBILIEN","IN","INC","INDUSTRIES","INFINITI","INFO","ING","INK","INSTITUTE","INSURANCE","INSURE","INT","INTERNATIONAL","INTUIT","INVESTMENTS","IO","IPIRANGA","IQ","IR","IRISH","IS","ISMAILI","IST","ISTANBUL","IT","ITAU","ITV","JAGUAR","JAVA","JCB","JE","JEEP","JETZT","JEWELRY","JIO","JLL","JM","JMP","JNJ","JO","JOBS","JOBURG","JOT","JOY","JP","JPMORGAN","JPRS","JUEGOS","JUNIPER","KAUFEN","KDDI","KE","KERRYHOTELS","KERRYLOGISTICS","KERRYPROPERTIES","KFH","KG","KH","KI","KIA","KIDS","KIM","KINDLE","KITCHEN","KIWI","KM","KN","KOELN","KOMATSU","KOSHER","KP","KPMG","KPN","KR","KRD","KRED","KUOKGROUP","KW","KY","KYOTO","KZ","LA","LACAIXA","LAMBORGHINI","LAMER","LANCASTER","LAND","LANDROVER","LANXESS","LASALLE","LAT","LATINO","LATROBE","LAW","LAWYER","LB","LC","LDS","LEASE","LECLERC","LEFRAK","LEGAL","LEGO","LEXUS","LGBT","LI","LIDL","LIFE","LIFEINSURANCE","LIFESTYLE","LIGHTING","LIKE","LILLY","LIMITED","LIMO","LINCOLN","LINK","LIPSY","LIVE","LIVING","LK","LLC","LLP","LOAN","LOANS","LOCKER","LOCUS","LOL","LONDON","LOTTE","LOTTO","LOVE","LPL","LPLFINANCIAL","LR","LS","LT","LTD","LTDA","LU","LUNDBECK","LUXE","LUXURY","LV","LY","MA","MADRID","MAIF","MAISON","MAKEUP","MAN","MANAGEMENT","MANGO","MAP","MARKET","MARKETING","MARKETS","MARRIOTT","MARSHALLS","MATTEL","MBA","MC","MCKINSEY","MD","ME","MED","MEDIA","MEET","MELBOURNE","MEME","MEMORIAL","MEN","MENU","MERCKMSD","MG","MH","MIAMI","MICROSOFT","MIL","MINI","MINT","MIT","MITSUBISHI","MK","ML","MLB","MLS","MM","MMA","MN","MO","MOBI","MOBILE","MODA","MOE","MOI","MOM","MONASH","MONEY","MONSTER","MORMON","MORTGAGE","MOSCOW","MOTO","MOTORCYCLES","MOV","MOVIE","MP","MQ","MR","MS","MSD","MT","MTN","MTR","MU","MUSEUM","MUSIC","MV","MW","MX","MY","MZ","NA","NAB","NAGOYA","NAME","NATURA","NAVY","NBA","NC","NE","NEC","NET","NETBANK","NETFLIX","NETWORK","NEUSTAR","NEW","NEWS","NEXT","NEXTDIRECT","NEXUS","NF","NFL","NG","NGO","NHK","NI","NICO","NIKE","NIKON","NINJA","NISSAN","NISSAY","NL","NO","NOKIA","NORTON","NOW","NOWRUZ","NOWTV","NP","NR","NRA","NRW","NTT","NU","NYC","NZ","OBI","OBSERVER","OFFICE","OKINAWA","OLAYAN","OLAYANGROUP","OLLO","OM","OMEGA","ONE","ONG","ONL","ONLINE","OOO","OPEN","ORACLE","ORANGE","ORG","ORGANIC","ORIGINS","OSAKA","OTSUKA","OTT","OVH","PA","PAGE","PANASONIC","PARIS","PARS","PARTNERS","PARTS","PARTY","PAY","PCCW","PE","PET","PF","PFIZER","PG","PH","PHARMACY","PHD","PHILIPS","PHONE","PHOTO","PHOTOGRAPHY","PHOTOS","PHYSIO","PICS","PICTET","PICTURES","PID","PIN","PING","PINK","PIONEER","PIZZA","PK","PL","PLACE","PLAY","PLAYSTATION","PLUMBING","PLUS","PM","PN","PNC","POHL","POKER","POLITIE","PORN","POST","PR","PRAMERICA","PRAXI","PRESS","PRIME","PRO","PROD","PRODUCTIONS","PROF","PROGRESSIVE","PROMO","PROPERTIES","PROPERTY","PROTECTION","PRU","PRUDENTIAL","PS","PT","PUB","PW","PWC","PY","QA","QPON","QUEBEC","QUEST","RACING","RADIO","RE","READ","REALESTATE","REALTOR","REALTY","RECIPES","RED","REDSTONE","REDUMBRELLA","REHAB","REISE","REISEN","REIT","RELIANCE","REN","RENT","RENTALS","REPAIR","REPORT","REPUBLICAN","REST","RESTAURANT","REVIEW","REVIEWS","REXROTH","RICH","RICHARDLI","RICOH","RIL","RIO","RIP","RO","ROCKS","RODEO","ROGERS","ROOM","RS","RSVP","RU","RUGBY","RUHR","RUN","RW","RWE","RYUKYU","SA","SAARLAND","SAFE","SAFETY","SAKURA","SALE","SALON","SAMSCLUB","SAMSUNG","SANDVIK","SANDVIKCOROMANT","SANOFI","SAP","SARL","SAS","SAVE","SAXO","SB","SBI","SBS","SC","SCB","SCHAEFFLER","SCHMIDT","SCHOLARSHIPS","SCHOOL","SCHULE","SCHWARZ","SCIENCE","SCOT","SD","SE","SEARCH","SEAT","SECURE","SECURITY","SEEK","SELECT","SENER","SERVICES","SEVEN","SEW","SEX","SEXY","SFR","SG","SH","SHANGRILA","SHARP","SHAW","SHELL","SHIA","SHIKSHA","SHOES","SHOP","SHOPPING","SHOUJI","SHOW","SI","SILK","SINA","SINGLES","SITE","SJ","SK","SKI","SKIN","SKY","SKYPE","SL","SLING","SM","SMART","SMILE","SN","SNCF","SO","SOCCER","SOCIAL","SOFTBANK","SOFTWARE","SOHU","SOLAR","SOLUTIONS","SONG","SONY","SOY","SPA","SPACE","SPORT","SPOT","SR","SRL","SS","ST","STADA","STAPLES","STAR","STATEBANK","STATEFARM","STC","STCGROUP","STOCKHOLM","STORAGE","STORE","STREAM","STUDIO","STUDY","STYLE","SU","SUCKS","SUPPLIES","SUPPLY","SUPPORT","SURF","SURGERY","SUZUKI","SV","SWATCH","SWISS","SX","SY","SYDNEY","SYSTEMS","SZ","TAB","TAIPEI","TALK","TAOBAO","TARGET","TATAMOTORS","TATAR","TATTOO","TAX","TAXI","TC","TCI","TD","TDK","TEAM","TECH","TECHNOLOGY","TEL","TEMASEK","TENNIS","TEVA","TF","TG","TH","THD","THEATER","THEATRE","TIAA","TICKETS","TIENDA","TIPS","TIRES","TIROL","TJ","TJMAXX","TJX","TK","TKMAXX","TL","TM","TMALL","TN","TO","TODAY","TOKYO","TOOLS","TOP","TORAY","TOSHIBA","TOTAL","TOURS","TOWN","TOYOTA","TOYS","TR","TRADE","TRADING","TRAINING","TRAVEL","TRAVELERS","TRAVELERSINSURANCE","TRUST","TRV","TT","TUBE","TUI","TUNES","TUSHU","TV","TVS","TW","TZ","UA","UBANK","UBS","UG","UK","UNICOM","UNIVERSITY","UNO","UOL","UPS","US","UY","UZ","VA","VACATIONS","VANA","VANGUARD","VC","VE","VEGAS","VENTURES","VERISIGN","VERSICHERUNG","VET","VG","VI","VIAJES","VIDEO","VIG","VIKING","VILLAS","VIN","VIP","VIRGIN","VISA","VISION","VIVA","VIVO","VLAANDEREN","VN","VODKA","VOLVO","VOTE","VOTING","VOTO","VOYAGE","VU","WALES","WALMART","WALTER","WANG","WANGGOU","WATCH","WATCHES","WEATHER","WEATHERCHANNEL","WEBCAM","WEBER","WEBSITE","WED","WEDDING","WEIBO","WEIR","WF","WHOSWHO","WIEN","WIKI","WILLIAMHILL","WIN","WINDOWS","WINE","WINNERS","WME","WOLTERSKLUWER","WOODSIDE","WORK","WORKS","WORLD","WOW","WS","WTC","WTF","XBOX","XEROX","XFINITY","XIHUAN","XIN","XN--11B4C3D","XN--1CK2E1B","XN--1QQW23A","XN--2SCRJ9C","XN--30RR7Y","XN--3BST00M","XN--3DS443G","XN--3E0B707E","XN--3HCRJ9C","XN--3PXU8K","XN--42C2D9A","XN--45BR5CYL","XN--45BRJ9C","XN--45Q11C","XN--4DBRK0CE","XN--4GBRIM","XN--54B7FTA0CC","XN--55QW42G","XN--55QX5D","XN--5SU34J936BGSG","XN--5TZM5G","XN--6FRZ82G","XN--6QQ986B3XL","XN--80ADXHKS","XN--80AO21A","XN--80AQECDR1A","XN--80ASEHDB","XN--80ASWG","XN--8Y0A063A","XN--90A3AC","XN--90AE","XN--90AIS","XN--9DBQ2A","XN--9ET52U","XN--9KRT00A","XN--B4W605FERD","XN--BCK1B9A5DRE4C","XN--C1AVG","XN--C2BR7G","XN--CCK2B3B","XN--CCKWCXETD","XN--CG4BKI","XN--CLCHC0EA0B2G2A9GCD","XN--CZR694B","XN--CZRS0T","XN--CZRU2D","XN--D1ACJ3B","XN--D1ALF","XN--E1A4C","XN--ECKVDTC9D","XN--EFVY88H","XN--FCT429K","XN--FHBEI","XN--FIQ228C5HS","XN--FIQ64B","XN--FIQS8S","XN--FIQZ9S","XN--FJQ720A","XN--FLW351E","XN--FPCRJ9C3D","XN--FZC2C9E2C","XN--FZYS8D69UVGM","XN--G2XX48C","XN--GCKR3F0F","XN--GECRJ9C","XN--GK3AT1E","XN--H2BREG3EVE","XN--H2BRJ9C","XN--H2BRJ9C8C","XN--HXT814E","XN--I1B6B1A6A2E","XN--IMR513N","XN--IO0A7I","XN--J1AEF","XN--J1AMH","XN--J6W193G","XN--JLQ480N2RG","XN--JVR189M","XN--KCRX77D1X4A","XN--KPRW13D","XN--KPRY57D","XN--KPUT3I","XN--L1ACC","XN--LGBBAT1AD8J","XN--MGB9AWBF","XN--MGBA3A3EJT","XN--MGBA3A4F16A","XN--MGBA7C0BBN0A","XN--MGBAAM7A8H","XN--MGBAB2BD","XN--MGBAH1A3HJKRD","XN--MGBAI9AZGQP6J","XN--MGBAYH7GPA","XN--MGBBH1A","XN--MGBBH1A71E","XN--MGBC0A9AZCG","XN--MGBCA7DZDO","XN--MGBCPQ6GPA1A","XN--MGBERP4A5D4AR","XN--MGBGU82A","XN--MGBI4ECEXP","XN--MGBPL2FH","XN--MGBT3DHD","XN--MGBTX2B","XN--MGBX4CD0AB","XN--MIX891F","XN--MK1BU44C","XN--MXTQ1M","XN--NGBC5AZD","XN--NGBE9E0A","XN--NGBRX","XN--NODE","XN--NQV7F","XN--NQV7FS00EMA","XN--NYQY26A","XN--O3CW4H","XN--OGBPF8FL","XN--OTU796D","XN--P1ACF","XN--P1AI","XN--PGBS0DH","XN--PSSY2U","XN--Q7CE6A","XN--Q9JYB4C","XN--QCKA1PMC","XN--QXA6A","XN--QXAM","XN--RHQV96G","XN--ROVU88B","XN--RVC1E0AM3E","XN--S9BRJ9C","XN--SES554G","XN--T60B56A","XN--TCKWE","XN--TIQ49XQYJ","XN--UNUP4Y","XN--VERMGENSBERATER-CTB","XN--VERMGENSBERATUNG-PWB","XN--VHQUV","XN--VUQ861B","XN--W4R85EL8FHU5DNRA","XN--W4RS40L","XN--WGBH1C","XN--WGBL6A","XN--XHQ521B","XN--XKC2AL3HYE2A","XN--XKC2DL3A5EE0H","XN--Y9A3AQ","XN--YFRO4I67O","XN--YGBI2AMMX","XN--ZFR164B","XXX","XYZ","YACHTS","YAHOO","YAMAXUN","YANDEX","YE","YODOBASHI","YOGA","YOKOHAMA","YOU","YOUTUBE","YT","YUN","ZA","ZAPPOS","ZARA","ZERO","ZIP","ZM","ZONE","ZUERICH","ZW"];Ed.exports=new Set(Sd.tlds.map(t=>t.toLowerCase()))});var Od=w((Lv,Bd)=>{"use strict";var oe=Q(),Ji=fc(),Dg=bd(),Pd=vd(),xd=pc(),kd=Cd(),Mg=mc(),Lg=Rt(),st=ge(),Z={tlds:kd instanceof Set?{tlds:{allow:kd,deny:null}}:!1,base64Regex:{true:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}==|[\w\-]{3}=)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/},false:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}(==)?|[\w\-]{3}=?)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/}},dataUriRegex:/^data:[\w+.-]+\/[\w+.-]+;((charset=[\w-]+|base64),)?(.*)$/,hexRegex:{withPrefix:/^0x[0-9a-f]+$/i,withOptionalPrefix:/^(?:0x)?[0-9a-f]+$/i,withoutPrefix:/^[0-9a-f]+$/i},ipRegex:Pd.regex({cidr:"forbidden"}).regex,isoDurationRegex:/^P(?!$)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5",uuidv6:"6",uuidv7:"7",uuidv8:"8"},guidSeparators:new Set([void 0,!0,!1,"-",":"]),normalizationForms:["NFC","NFD","NFKC","NFKD"]};Bd.exports=Lg.extend({type:"string",flags:{insensitive:{default:!1},truncate:{default:!1}},terms:{replacements:{init:null}},coerce:{from:"string",method(t,{schema:e,state:r,prefs:n}){let s=e.$_getRule("normalize");s&&(t=t.normalize(s.args.form));let i=e.$_getRule("case");i&&(t=i.args.direction==="upper"?t.toLocaleUpperCase():t.toLocaleLowerCase());let o=e.$_getRule("trim");if(o&&o.args.enabled&&(t=t.trim()),e.$_terms.replacements)for(let c of e.$_terms.replacements)t=t.replace(c.pattern,c.replacement);let a=e.$_getRule("hex");if(a&&a.args.options.byteAligned&&t.length%2!==0&&(t=`0${t}`),e.$_getRule("isoDate")){let c=Z.isoDate(t);c&&(t=c)}if(e._flags.truncate){let c=e.$_getRule("max");if(c){let l=c.args.limit;if(st.isResolvable(l)&&(l=l.resolve(t,r,n),!st.limit(l)))return{value:t,errors:e.$_createError("any.ref",l,{ref:c.args.limit,arg:"limit",reason:"must be a positive integer"},r,n)};t=t.slice(0,l)}}return{value:t}}},validate(t,{schema:e,error:r}){if(typeof t!="string")return{value:t,errors:r("string.base")};if(t===""){let n=e.$_getRule("min");return n&&n.args.limit===0?void 0:{value:t,errors:r("string.empty")}}},rules:{alphanum:{method(){return this.$_addRule("alphanum")},validate(t,e){return/^[a-zA-Z0-9]+$/.test(t)?t:e.error("string.alphanum")}},base64:{method(t={}){return st.assertOptions(t,["paddingRequired","urlSafe"]),t={urlSafe:!1,paddingRequired:!0,...t},oe(typeof t.paddingRequired=="boolean","paddingRequired must be boolean"),oe(typeof t.urlSafe=="boolean","urlSafe must be boolean"),this.$_addRule({name:"base64",args:{options:t}})},validate(t,e,{options:r}){return Z.base64Regex[r.paddingRequired][r.urlSafe].test(t)?t:e.error("string.base64")}},case:{method(t){return oe(["lower","upper"].includes(t),"Invalid case:",t),this.$_addRule({name:"case",args:{direction:t}})},validate(t,e,{direction:r}){return r==="lower"&&t===t.toLocaleLowerCase()||r==="upper"&&t===t.toLocaleUpperCase()?t:e.error(`string.${r}case`)},convert:!0},creditCard:{method(){return this.$_addRule("creditCard")},validate(t,e){let r=t.length,n=0,s=1;for(;r--;){let i=t.charAt(r)*s;n=n+(i-(i>9)*9),s=s^3}return n>0&&n%10===0?t:e.error("string.creditCard")}},dataUri:{method(t={}){return st.assertOptions(t,["paddingRequired"]),t={paddingRequired:!0,...t},oe(typeof t.paddingRequired=="boolean","paddingRequired must be boolean"),this.$_addRule({name:"dataUri",args:{options:t}})},validate(t,e,{options:r}){let n=t.match(Z.dataUriRegex);return n&&(!n[2]||n[2]!=="base64"||Z.base64Regex[r.paddingRequired].false.test(n[3]))?t:e.error("string.dataUri")}},domain:{method(t){t&&st.assertOptions(t,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);let e=Z.addressOptions(t);return this.$_addRule({name:"domain",args:{options:t},address:e})},validate(t,e,r,{address:n}){return Ji.isValid(t,n)?t:e.error("string.domain")}},email:{method(t={}){st.assertOptions(t,["allowFullyQualified","allowUnicode","ignoreLength","maxDomainSegments","minDomainSegments","multiple","separator","tlds"]),oe(t.multiple===void 0||typeof t.multiple=="boolean","multiple option must be an boolean");let e=Z.addressOptions(t),r=new RegExp(`\\s*[${t.separator?xd(t.separator):","}]\\s*`);return this.$_addRule({name:"email",args:{options:t},regex:r,address:e})},validate(t,e,{options:r},{regex:n,address:s}){let i=r.multiple?t.split(n):[t],o=[];for(let a of i)Dg.isValid(a,s)||o.push(a);return o.length?e.error("string.email",{value:t,invalids:o}):t}},guid:{alias:"uuid",method(t={}){st.assertOptions(t,["version","separator"]);let e="";if(t.version){let s=[].concat(t.version);oe(s.length>=1,"version must have at least 1 valid version specified");let i=new Set;for(let o=0;o<s.length;++o){let a=s[o];oe(typeof a=="string","version at position "+o+" must be a string");let c=Z.guidVersions[a.toLowerCase()];oe(c,"version at position "+o+" must be one of "+Object.keys(Z.guidVersions).join(", ")),oe(!i.has(c),"version at position "+o+" must not be a duplicate"),e+=c,i.add(c)}}oe(Z.guidSeparators.has(t.separator),'separator must be one of true, false, "-", or ":"');let r=t.separator===void 0?"[:-]?":t.separator===!0?"[:-]":t.separator===!1?"[]?":`\\${t.separator}`,n=new RegExp(`^([\\[{\\(]?)[0-9A-F]{8}(${r})[0-9A-F]{4}\\2?[${e||"0-9A-F"}][0-9A-F]{3}\\2?[${e?"89AB":"0-9A-F"}][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$`,"i");return this.$_addRule({name:"guid",args:{options:t},regex:n})},validate(t,e,r,{regex:n}){let s=n.exec(t);return!s||Z.guidBrackets[s[1]]!==s[s.length-1]?e.error("string.guid"):t}},hex:{method(t={}){return st.assertOptions(t,["byteAligned","prefix"]),t={byteAligned:!1,prefix:!1,...t},oe(typeof t.byteAligned=="boolean","byteAligned must be boolean"),oe(typeof t.prefix=="boolean"||t.prefix==="optional",'prefix must be boolean or "optional"'),this.$_addRule({name:"hex",args:{options:t}})},validate(t,e,{options:r}){return(r.prefix==="optional"?Z.hexRegex.withOptionalPrefix:r.prefix===!0?Z.hexRegex.withPrefix:Z.hexRegex.withoutPrefix).test(t)?r.byteAligned&&t.length%2!==0?e.error("string.hexAlign"):t:e.error("string.hex")}},hostname:{method(){return this.$_addRule("hostname")},validate(t,e){return Ji.isValid(t,{minDomainSegments:1})||Z.ipRegex.test(t)?t:e.error("string.hostname")}},insensitive:{method(){return this.$_setFlag("insensitive",!0)}},ip:{method(t={}){st.assertOptions(t,["cidr","version"]);let{cidr:e,versions:r,regex:n}=Pd.regex(t),s=t.version?r:void 0;return this.$_addRule({name:"ip",args:{options:{cidr:e,version:s}},regex:n})},validate(t,e,{options:r},{regex:n}){return n.test(t)?t:r.version?e.error("string.ipVersion",{value:t,cidr:r.cidr,version:r.version}):e.error("string.ip",{value:t,cidr:r.cidr})}},isoDate:{method(){return this.$_addRule("isoDate")},validate(t,{error:e}){return Z.isoDate(t)?t:e("string.isoDate")}},isoDuration:{method(){return this.$_addRule("isoDuration")},validate(t,e){return Z.isoDurationRegex.test(t)?t:e.error("string.isoDuration")}},length:{method(t,e){return Z.length(this,"length",t,"=",e)},validate(t,e,{limit:r,encoding:n},{name:s,operator:i,args:o}){let a=n?Buffer&&Buffer.byteLength(t,n):t.length;return st.compare(a,r,i)?t:e.error("string."+s,{limit:o.limit,value:t,encoding:n})},args:[{name:"limit",ref:!0,assert:st.limit,message:"must be a positive integer"},"encoding"]},lowercase:{method(){return this.case("lower")}},max:{method(t,e){return Z.length(this,"max",t,"<=",e)},args:["limit","encoding"]},min:{method(t,e){return Z.length(this,"min",t,">=",e)},args:["limit","encoding"]},normalize:{method(t="NFC"){return oe(Z.normalizationForms.includes(t),"normalization form must be one of "+Z.normalizationForms.join(", ")),this.$_addRule({name:"normalize",args:{form:t}})},validate(t,{error:e},{form:r}){return t===t.normalize(r)?t:e("string.normalize",{value:t,form:r})},convert:!0},pattern:{alias:"regex",method(t,e={}){oe(t instanceof RegExp,"regex must be a RegExp"),oe(!t.flags.includes("g")&&!t.flags.includes("y"),"regex should not use global or sticky mode"),typeof e=="string"&&(e={name:e}),st.assertOptions(e,["invert","name"]);let r=["string.pattern",e.invert?".invert":"",e.name?".name":".base"].join("");return this.$_addRule({name:"pattern",args:{regex:t,options:e},errorCode:r})},validate(t,e,{regex:r,options:n},{errorCode:s}){return r.test(t)^n.invert?t:e.error(s,{name:n.name,regex:r,value:t})},args:["regex","options"],multi:!0},replace:{method(t,e){typeof t=="string"&&(t=new RegExp(xd(t),"g")),oe(t instanceof RegExp,"pattern must be a RegExp"),oe(typeof e=="string","replacement must be a String");let r=this.clone();return r.$_terms.replacements||(r.$_terms.replacements=[]),r.$_terms.replacements.push({pattern:t,replacement:e}),r}},token:{method(){return this.$_addRule("token")},validate(t,e){return/^\w+$/.test(t)?t:e.error("string.token")}},trim:{method(t=!0){return oe(typeof t=="boolean","enabled must be a boolean"),this.$_addRule({name:"trim",args:{enabled:t}})},validate(t,e,{enabled:r}){return!r||t===t.trim()?t:e.error("string.trim")},convert:!0},truncate:{method(t=!0){return oe(typeof t=="boolean","enabled must be a boolean"),this.$_setFlag("truncate",t)}},uppercase:{method(){return this.case("upper")}},uri:{method(t={}){st.assertOptions(t,["allowRelative","allowQuerySquareBrackets","domain","relativeOnly","scheme","encodeUri"]),t.domain&&st.assertOptions(t.domain,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);let{regex:e,scheme:r}=Mg.regex(t),n=t.domain?Z.addressOptions(t.domain):null;return this.$_addRule({name:"uri",args:{options:t},regex:e,domain:n,scheme:r})},validate(t,e,{options:r},{regex:n,domain:s,scheme:i}){if(["http:/","https:/"].includes(t))return e.error("string.uri");let o=n.exec(t);if(!o&&e.prefs.convert&&r.encodeUri){let a=encodeURI(t);o=n.exec(a),o&&(t=a)}if(o){let a=o[1]||o[2];return s&&(!r.allowRelative||a)&&!Ji.isValid(a,s)?e.error("string.domain",{value:a}):t}return r.relativeOnly?e.error("string.uriRelativeOnly"):r.scheme?e.error("string.uriCustomScheme",{scheme:i,value:t}):e.error("string.uri")}}},manifest:{build(t,e){if(e.replacements)for(let{pattern:r,replacement:n}of e.replacements)t=t.replace(r,n);return t}},messages:{"string.alphanum":"{{#label}} must only contain alpha-numeric characters","string.base":"{{#label}} must be a string","string.base64":"{{#label}} must be a valid base64 string","string.creditCard":"{{#label}} must be a credit card","string.dataUri":"{{#label}} must be a valid dataUri string","string.domain":"{{#label}} must contain a valid domain name","string.email":"{{#label}} must be a valid email","string.empty":"{{#label}} is not allowed to be empty","string.guid":"{{#label}} must be a valid GUID","string.hex":"{{#label}} must only contain hexadecimal characters","string.hexAlign":"{{#label}} hex decoded representation must be byte aligned","string.hostname":"{{#label}} must be a valid hostname","string.ip":"{{#label}} must be a valid ip address with a {{#cidr}} CIDR","string.ipVersion":"{{#label}} must be a valid ip address of one of the following versions {{#version}} with a {{#cidr}} CIDR","string.isoDate":"{{#label}} must be in iso format","string.isoDuration":"{{#label}} must be a valid ISO 8601 duration","string.length":"{{#label}} length must be {{#limit}} characters long","string.lowercase":"{{#label}} must only contain lowercase characters","string.max":"{{#label}} length must be less than or equal to {{#limit}} characters long","string.min":"{{#label}} length must be at least {{#limit}} characters long","string.normalize":"{{#label}} must be unicode normalized in the {{#form}} form","string.token":"{{#label}} must only contain alpha-numeric and underscore characters","string.pattern.base":"{{#label}} with value {:[.]} fails to match the required pattern: {{#regex}}","string.pattern.name":"{{#label}} with value {:[.]} fails to match the {{#name}} pattern","string.pattern.invert.base":"{{#label}} with value {:[.]} matches the inverted pattern: {{#regex}}","string.pattern.invert.name":"{{#label}} with value {:[.]} matches the inverted {{#name}} pattern","string.trim":"{{#label}} must not have leading or trailing whitespace","string.uri":"{{#label}} must be a valid uri","string.uriCustomScheme":"{{#label}} must be a valid uri with a scheme matching the {{#scheme}} pattern","string.uriRelativeOnly":"{{#label}} must be a valid relative uri","string.uppercase":"{{#label}} must only contain uppercase characters"}});Z.addressOptions=function(t){if(!t)return Z.tlds||t;if(oe(t.minDomainSegments===void 0||Number.isSafeInteger(t.minDomainSegments)&&t.minDomainSegments>0,"minDomainSegments must be a positive integer"),oe(t.maxDomainSegments===void 0||Number.isSafeInteger(t.maxDomainSegments)&&t.maxDomainSegments>0,"maxDomainSegments must be a positive integer"),t.tlds===!1)return t;if(t.tlds===!0||t.tlds===void 0)return oe(Z.tlds,"Built-in TLD list disabled"),Object.assign({},t,Z.tlds);oe(typeof t.tlds=="object","tlds must be true, false, or an object");let e=t.tlds.deny;if(e)return Array.isArray(e)&&(t=Object.assign({},t,{tlds:{deny:new Set(e)}})),oe(t.tlds.deny instanceof Set,"tlds.deny must be an array, Set, or boolean"),oe(!t.tlds.allow,"Cannot specify both tlds.allow and tlds.deny lists"),Z.validateTlds(t.tlds.deny,"tlds.deny"),t;let r=t.tlds.allow;return r?r===!0?(oe(Z.tlds,"Built-in TLD list disabled"),Object.assign({},t,Z.tlds)):(Array.isArray(r)&&(t=Object.assign({},t,{tlds:{allow:new Set(r)}})),oe(t.tlds.allow instanceof Set,"tlds.allow must be an array, Set, or boolean"),Z.validateTlds(t.tlds.allow,"tlds.allow"),t):t};Z.validateTlds=function(t,e){for(let r of t)oe(Ji.isValid(r,{minDomainSegments:1,maxDomainSegments:1}),`${e} must contain valid top level domain names`)};Z.isoDate=function(t){if(!st.isIsoDate(t))return null;/.*T.*[+-]\d\d$/.test(t)&&(t+="00");let e=new Date(t);return isNaN(e.getTime())?null:e.toISOString()};Z.length=function(t,e,r,n,s){return oe(!s||Buffer&&Buffer.isEncoding(s),"Invalid encoding:",s),t.$_addRule({name:e,method:"length",args:{limit:r,encoding:s},operator:n})}});var Td=w((Hv,Rd)=>{"use strict";var Wi=Q(),Hg=Rt(),yc={};yc.Map=class extends Map{slice(){return new yc.Map(this)}};Rd.exports=Hg.extend({type:"symbol",terms:{map:{init:new yc.Map}},coerce:{method(t,{schema:e,error:r}){let n=e.$_terms.map.get(t);return n&&(t=n),!e._flags.only||typeof t=="symbol"?{value:t}:{value:t,errors:r("symbol.map",{map:e.$_terms.map})}}},validate(t,{error:e}){if(typeof t!="symbol")return{value:t,errors:e("symbol.base")}},rules:{map:{method(t){t&&!t[Symbol.iterator]&&typeof t=="object"&&(t=Object.entries(t)),Wi(t&&t[Symbol.iterator],"Iterable must be an iterable or object");let e=this.clone(),r=[];for(let n of t){Wi(n&&n[Symbol.iterator],"Entry must be an iterable");let[s,i]=n;Wi(typeof s!="object"&&typeof s!="function"&&typeof s!="symbol","Key must not be of type object, function, or Symbol"),Wi(typeof i=="symbol","Value must be a Symbol"),e.$_terms.map.set(s,i),r.push(i)}return e.valid(...r)}}},manifest:{build(t,e){return e.map&&(t=t.map(e.map)),t}},messages:{"symbol.base":"{{#label}} must be a symbol","symbol.map":"{{#label}} must be one of {{#map}}"}})});var Kd=w((Vv,Id)=>{"use strict";var jg=Q(),Vg=Rt(),Nd=ge();Id.exports=Vg.extend({type:"binary",coerce:{from:["string","object"],method(t,{schema:e}){if(typeof t=="string"||t!==null&&t.type==="Buffer")try{return{value:Buffer.from(t,e._flags.encoding)}}catch{}}},validate(t,{error:e}){if(!Buffer.isBuffer(t))return{value:t,errors:e("binary.base")}},rules:{encoding:{method(t){return jg(Buffer.isEncoding(t),"Invalid encoding:",t),this.$_setFlag("encoding",t)}},length:{method(t){return this.$_addRule({name:"length",method:"length",args:{limit:t},operator:"="})},validate(t,e,{limit:r},{name:n,operator:s,args:i}){return Nd.compare(t.length,r,s)?t:e.error("binary."+n,{limit:i.limit,value:t})},args:[{name:"limit",ref:!0,assert:Nd.limit,message:"must be a positive integer"}]},max:{method(t){return this.$_addRule({name:"max",method:"length",args:{limit:t},operator:"<="})}},min:{method(t){return this.$_addRule({name:"min",method:"length",args:{limit:t},operator:">="})}}},cast:{string:{from:t=>Buffer.isBuffer(t),to(t,e){return t.toString()}}},messages:{"binary.base":"{{#label}} must be a buffer or a string","binary.length":"{{#label}} must be {{#limit}} bytes","binary.max":"{{#label}} must be less than or equal to {{#limit}} bytes","binary.min":"{{#label}} must be at least {{#limit}} bytes"}})});var Ha=w((Fv,Md)=>{"use strict";var ln=Q(),Fg=tt(),qg=qa(),cn=ge(),Gg=nn(),_c=pr(),Jg=Ga(),$d=za(),gc=hr(),Ud=Nr(),Dd=Ya(),zi,$e={types:{alternatives:jf(),any:Rt(),array:Ff(),boolean:zf(),date:Qf(),function:dd(),link:hd(),number:yd(),object:_d(),string:Od(),symbol:Td()},aliases:{alt:"alternatives",bool:"boolean",func:"function"}};Buffer&&($e.types.binary=Kd());$e.root=function(){let t={_types:new Set(Object.keys($e.types))};for(let e of t._types)t[e]=function(...r){return ln(!r.length||["alternatives","link","object"].includes(e),"The",e,"type does not allow arguments"),$e.generate(this,$e.types[e],r)};for(let e of["allow","custom","disallow","equal","exist","forbidden","invalid","not","only","optional","options","prefs","preferences","required","strip","valid","when"])t[e]=function(...r){return this.any()[e](...r)};Object.assign(t,$e.methods);for(let e in $e.aliases){let r=$e.aliases[e];t[e]=t[r]}return t.x=t.expression,Dd.setup&&Dd.setup(t),t};$e.methods={ValidationError:_c.ValidationError,version:cn.version,cache:qg.provider,assert(t,e,...r){$e.assert(t,e,!0,r)},attempt(t,e,...r){return $e.assert(t,e,!1,r)},build(t){return ln(typeof $d.build=="function","Manifest functionality disabled"),$d.build(this,t)},checkPreferences(t){cn.checkPreferences(t)},compile(t,e){return Gg.compile(this,t,e)},defaults(t){ln(typeof t=="function","modifier must be a function");let e=Object.assign({},this);for(let r of e._types){let n=t(e[r]());ln(cn.isSchema(n),"modifier must return a valid schema object"),e[r]=function(...s){return $e.generate(this,n,s)}}return e},expression(...t){return new Ud(...t)},extend(...t){cn.verifyFlat(t,"extend"),zi=zi||Ri(),ln(t.length,"You need to provide at least one extension"),this.assert(t,zi.extensions);let e=Object.assign({},this);e._types=new Set(e._types);for(let r of t){typeof r=="function"&&(r=r(e)),this.assert(r,zi.extension);let n=$e.expandExtension(r,e);for(let s of n){ln(e[s.type]===void 0||e._types.has(s.type),"Cannot override name",s.type);let i=s.base||this.any(),o=Jg.type(i,s);e._types.add(s.type),e[s.type]=function(...a){return $e.generate(this,o,a)}}}return e},isError:_c.ValidationError.isError,isExpression:Ud.isTemplate,isRef:gc.isRef,isSchema:cn.isSchema,in(...t){return gc.in(...t)},override:cn.symbols.override,ref(...t){return gc.create(...t)},types(){let t={};for(let e of this._types)t[e]=this[e]();for(let e in $e.aliases)t[e]=this[e]();return t}};$e.assert=function(t,e,r,n){let s=n[0]instanceof Error||typeof n[0]=="string"?n[0]:null,i=s!==null?n[1]:n[0],o=e.validate(t,cn.preferences({errors:{stack:!0}},i||{})),a=o.error;if(!a)return o.value;if(s instanceof Error)throw s;let c=r&&typeof a.annotate=="function"?a.annotate():a.message;throw a instanceof _c.ValidationError||(a=Fg(a)),a.message=s?`${s} ${c}`:c,a};$e.generate=function(t,e,r){return ln(t,"Must be invoked on a Joi instance."),e.$_root=t,!e._definition.args||!r.length?e:e._definition.args(e,...r)};$e.expandExtension=function(t,e){if(typeof t.type=="string")return[t];let r=[];for(let n of e._types)if(t.type.test(n)){let s=Object.assign({},t);s.type=n,s.base=e[n](),r.push(s)}return r};Md.exports=$e.root()});var un=w(On=>{"use strict";var Wg="[object ArrayBuffer]",wr=class t{static isArrayBuffer(e){return Object.prototype.toString.call(e)===Wg}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,r){if(e.constructor===r)return e;if(this.isArrayBuffer(e))return new r(e);if(this.isArrayBufferView(e))return new r(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,r){let n=t.toUint8Array(e),s=t.toUint8Array(r);if(n.length!==s.byteLength)return!1;for(let i=0;i<n.length;i++)if(n[i]!==s[i])return!1;return!0}static concat(...e){let r;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?r=e[0]:e[e.length-1]instanceof Function?r=e.slice(0,e.length-1):r=e;let n=0;for(let o of r)n+=o.byteLength;let s=new Uint8Array(n),i=0;for(let o of r){let a=this.toUint8Array(o);s.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(s,e[e.length-1]):s.buffer}},bc="string",zg=/^[0-9a-f\s]+$/i,Xg=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,Yg=/^[a-zA-Z0-9-_]+$/,Xi=class{static fromString(e){let r=unescape(encodeURIComponent(e)),n=new Uint8Array(r.length);for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s);return n.buffer}static toString(e){let r=wr.toUint8Array(e),n="";for(let i=0;i<r.length;i++)n+=String.fromCharCode(r[i]);return decodeURIComponent(escape(n))}},It=class{static toString(e,r=!1){let n=wr.toArrayBuffer(e),s=new DataView(n),i="";for(let o=0;o<n.byteLength;o+=2){let a=s.getUint16(o,r);i+=String.fromCharCode(a)}return i}static fromString(e,r=!1){let n=new ArrayBuffer(e.length*2),s=new DataView(n);for(let i=0;i<e.length;i++)s.setUint16(i*2,e.charCodeAt(i),r);return n}},Yi=class t{static isHex(e){return typeof e===bc&&zg.test(e)}static isBase64(e){return typeof e===bc&&Xg.test(e)}static isBase64Url(e){return typeof e===bc&&Yg.test(e)}static ToString(e,r="utf8"){let n=wr.toUint8Array(e);switch(r.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return It.toString(n,!0);case"utf16":case"utf16be":return It.toString(n);default:throw new Error(`Unknown type of encoding '${r}'`)}}static FromString(e,r="utf8"){if(!e)return new ArrayBuffer(0);switch(r.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return It.fromString(e,!0);case"utf16":case"utf16be":return It.fromString(e);default:throw new Error(`Unknown type of encoding '${r}'`)}}static ToBase64(e){let r=wr.toUint8Array(e);if(typeof btoa<"u"){let n=this.ToString(r,"binary");return btoa(n)}else return Buffer.from(r).toString("base64")}static FromBase64(e){let r=this.formatString(e);if(!r)return new ArrayBuffer(0);if(!t.isBase64(r))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(r)):new Uint8Array(Buffer.from(r,"base64")).buffer}static FromBase64Url(e){let r=this.formatString(e);if(!r)return new ArrayBuffer(0);if(!t.isBase64Url(r))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(r.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,r=t.DEFAULT_UTF8_ENCODING){switch(r){case"ascii":return this.FromBinary(e);case"utf8":return Xi.fromString(e);case"utf16":case"utf16be":return It.fromString(e);case"utf16le":case"usc2":return It.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${r}'`)}}static ToUtf8String(e,r=t.DEFAULT_UTF8_ENCODING){switch(r){case"ascii":return this.ToBinary(e);case"utf8":return Xi.toString(e);case"utf16":case"utf16be":return It.toString(e);case"utf16le":case"usc2":return It.toString(e,!0);default:throw new Error(`Unknown type of encoding '${r}'`)}}static FromBinary(e){let r=e.length,n=new Uint8Array(r);for(let s=0;s<r;s++)n[s]=e.charCodeAt(s);return n.buffer}static ToBinary(e){let r=wr.toUint8Array(e),n="";for(let s=0;s<r.length;s++)n+=String.fromCharCode(r[s]);return n}static ToHex(e){let r=wr.toUint8Array(e),n="",s=r.length;for(let i=0;i<s;i++){let o=r[i];o<16&&(n+="0"),n+=o.toString(16)}return n}static FromHex(e){let r=this.formatString(e);if(!r)return new ArrayBuffer(0);if(!t.isHex(r))throw new TypeError("Argument 'hexString' is not HEX encoded");r.length%2&&(r=`0${r}`);let n=new Uint8Array(r.length/2);for(let s=0;s<r.length;s=s+2){let i=r.slice(s,s+2);n[s/2]=parseInt(i,16)}return n.buffer}static ToUtf16String(e,r=!1){return It.toString(e,r)}static FromUtf16String(e,r=!1){return It.fromString(e,r)}static Base64Padding(e){let r=4-e.length%4;if(r<4)for(let n=0;n<r;n++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}};Yi.DEFAULT_UTF8_ENCODING="utf8";function Zg(t,...e){let r=arguments[0];for(let n=1;n<arguments.length;n++){let s=arguments[n];for(let i in s)r[i]=s[i]}return r}function Qg(...t){let e=t.map(s=>s.byteLength).reduce((s,i)=>s+i),r=new Uint8Array(e),n=0;return t.map(s=>new Uint8Array(s)).forEach(s=>{for(let i of s)r[n++]=i}),r.buffer}function e_(t,e){if(!(t&&e)||t.byteLength!==e.byteLength)return!1;let r=new Uint8Array(t),n=new Uint8Array(e);for(let s=0;s<t.byteLength;s++)if(r[s]!==n[s])return!1;return!0}On.BufferSourceConverter=wr;On.Convert=Yi;On.assign=Zg;On.combine=Qg;On.isEqual=e_});var Tn={};dy(Tn,{__addDisposableResource:()=>up,__assign:()=>Zi,__asyncDelegator:()=>rp,__asyncGenerator:()=>tp,__asyncValues:()=>np,__await:()=>Rn,__awaiter:()=>zd,__classPrivateFieldGet:()=>ap,__classPrivateFieldIn:()=>lp,__classPrivateFieldSet:()=>cp,__createBinding:()=>eo,__decorate:()=>jd,__disposeResources:()=>fp,__esDecorate:()=>Fd,__exportStar:()=>Yd,__extends:()=>Ld,__generator:()=>Xd,__importDefault:()=>op,__importStar:()=>ip,__makeTemplateObject:()=>sp,__metadata:()=>Wd,__param:()=>Vd,__propKey:()=>Gd,__read:()=>vc,__rest:()=>Hd,__rewriteRelativeImportExtension:()=>dp,__runInitializers:()=>qd,__setFunctionName:()=>Jd,__spread:()=>Zd,__spreadArray:()=>ep,__spreadArrays:()=>Qd,__values:()=>Qi,default:()=>n_});function Ld(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");wc(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function Hd(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r}function jd(t,e,r,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(i=(s<3?o(i):s>3?o(e,r,i):o(e,r))||i);return s>3&&i&&Object.defineProperty(e,r,i),i}function Vd(t,e){return function(r,n){e(r,n,t)}}function Fd(t,e,r,n,s,i){function o(x){if(x!==void 0&&typeof x!="function")throw new TypeError("Function expected");return x}for(var a=n.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&t?n.static?t:t.prototype:null,f=e||(l?Object.getOwnPropertyDescriptor(l,n.name):{}),u,d=!1,p=r.length-1;p>=0;p--){var m={};for(var g in n)m[g]=g==="access"?{}:n[g];for(var g in n.access)m.access[g]=n.access[g];m.addInitializer=function(x){if(d)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(x||null))};var _=(0,r[p])(a==="accessor"?{get:f.get,set:f.set}:f[c],m);if(a==="accessor"){if(_===void 0)continue;if(_===null||typeof _!="object")throw new TypeError("Object expected");(u=o(_.get))&&(f.get=u),(u=o(_.set))&&(f.set=u),(u=o(_.init))&&s.unshift(u)}else(u=o(_))&&(a==="field"?s.unshift(u):f[c]=u)}l&&Object.defineProperty(l,n.name,f),d=!0}function qd(t,e,r){for(var n=arguments.length>2,s=0;s<e.length;s++)r=n?e[s].call(t,r):e[s].call(t);return n?r:void 0}function Gd(t){return typeof t=="symbol"?t:"".concat(t)}function Jd(t,e,r){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:r?"".concat(r," ",e):e})}function Wd(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function zd(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(f){try{l(n.next(f))}catch(u){o(u)}}function c(f){try{l(n.throw(f))}catch(u){o(u)}}function l(f){f.done?i(f.value):s(f.value).then(a,c)}l((n=n.apply(t,e||[])).next())})}function Xd(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(f){return c([l,f])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(r=0)),r;)try{if(n=1,s&&(i=l[0]&2?s.return:l[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,l[1])).done)return i;switch(s=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,s=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(f){l=[6,f],s=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Yd(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&eo(e,t,r)}function Qi(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function vc(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function Zd(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(vc(arguments[e]));return t}function Qd(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),s=0,e=0;e<r;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)n[s]=i[o];return n}function ep(t,e,r){if(r||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))}function Rn(t){return this instanceof Rn?(this.v=t,this):new Rn(t)}function tp(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(p){return function(m){return Promise.resolve(m).then(p,u)}}function a(p,m){n[p]&&(s[p]=function(g){return new Promise(function(_,x){i.push([p,g,_,x])>1||c(p,g)})},m&&(s[p]=m(s[p])))}function c(p,m){try{l(n[p](m))}catch(g){d(i[0][3],g)}}function l(p){p.value instanceof Rn?Promise.resolve(p.value.v).then(f,u):d(i[0][2],p)}function f(p){c("next",p)}function u(p){c("throw",p)}function d(p,m){p(m),i.shift(),i.length&&c(i[0][0],i[0][1])}}function rp(t){var e,r;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,i){e[s]=t[s]?function(o){return(r=!r)?{value:Rn(t[s](o)),done:!1}:i?i(o):o}:i}}function np(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Qi=="function"?Qi(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(o){return new Promise(function(a,c){o=t[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},o)}}function sp(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function ip(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r=Ac(t),n=0;n<r.length;n++)r[n]!=="default"&&eo(e,t,r[n]);return t_(e,t),e}function op(t){return t&&t.__esModule?t:{default:t}}function ap(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function cp(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r}function lp(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function up(t,e,r){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var n,s;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=e[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=e[Symbol.dispose],r&&(s=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");s&&(n=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),t.stack.push({value:e,dispose:n,async:r})}else r&&t.stack.push({async:!0});return e}function fp(t){function e(i){t.error=t.hasError?new r_(i,t.error,"An error was suppressed during disposal."):i,t.hasError=!0}var r,n=0;function s(){for(;r=t.stack.pop();)try{if(!r.async&&n===1)return n=0,t.stack.push(r),Promise.resolve().then(s);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(i).then(s,function(o){return e(o),s()})}else n|=1}catch(o){e(o)}if(n===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return s()}function dp(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,s,i,o){return n?e?".jsx":".js":s&&(!i||!o)?r:s+i+"."+o.toLowerCase()+"js"}):t}var wc,Zi,eo,t_,Ac,r_,n_,Nn=fy(()=>{wc=function(t,e){return wc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},wc(t,e)};Zi=function(){return Zi=Object.assign||function(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Zi.apply(this,arguments)};eo=Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]};t_=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},Ac=function(t){return Ac=Object.getOwnPropertyNames||function(e){var r=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[r.length]=n);return r},Ac(t)};r_=typeof SuppressedError=="function"?SuppressedError:function(t,e,r){var n=new Error(r);return n.name="SuppressedError",n.error=t,n.suppressed=e,n};n_={__extends:Ld,__assign:Zi,__rest:Hd,__decorate:jd,__param:Vd,__esDecorate:Fd,__runInitializers:qd,__propKey:Gd,__setFunctionName:Jd,__metadata:Wd,__awaiter:zd,__generator:Xd,__createBinding:eo,__exportStar:Yd,__values:Qi,__read:vc,__spread:Zd,__spreadArrays:Qd,__spreadArray:ep,__await:Rn,__asyncGenerator:tp,__asyncDelegator:rp,__asyncValues:np,__makeTemplateObject:sp,__importStar:ip,__importDefault:op,__classPrivateFieldGet:ap,__classPrivateFieldSet:cp,__classPrivateFieldIn:lp,__addDisposableResource:up,__disposeResources:fp,__rewriteRelativeImportExtension:dp}});var mp=w(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});function s_(t){return new Date(t.getTime()+t.getTimezoneOffset()*6e4)}function i_(t,e,r){var n;return t instanceof Object&&(n=t[e])!==null&&n!==void 0?n:r}function o_(t,e=0,r=t.byteLength-e,n=!1){let s="";for(let i of new Uint8Array(t,e,r)){let o=i.toString(16).toUpperCase();o.length===1&&(s+="0"),s+=o,n&&(s+=" ")}return s.trim()}function a_(t,e,r,n){return e instanceof ArrayBuffer?e.byteLength?r<0?(t.error="Wrong parameter: inputOffset less than zero",!1):n<0?(t.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-r-n<0?(t.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(t.error="Wrong parameter: inputBuffer has zero length",!1):(t.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1)}function Sc(t,e){let r=0;if(t.length===1)return t[0];for(let n=t.length-1;n>=0;n--)r+=t[t.length-1-n]*Math.pow(2,e*n);return r}function Ec(t,e,r=-1){let n=r,s=t,i=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(t<o){let c;if(n<0)c=new ArrayBuffer(a),i=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}let l=new Uint8Array(c);for(let f=a-1;f>=0;f--){let u=Math.pow(2,f*e);l[i-f-1]=Math.floor(s/u),s-=l[i-f-1]*u}return c}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function c_(...t){let e=0,r=0;for(let i of t)e+=i.byteLength;let n=new ArrayBuffer(e),s=new Uint8Array(n);for(let i of t)s.set(new Uint8Array(i),r),r+=i.byteLength;return n}function l_(...t){let e=0,r=0;for(let i of t)e+=i.length;let n=new ArrayBuffer(e),s=new Uint8Array(n);for(let i of t)s.set(i,r),r+=i.length;return s}function u_(){let t=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let a=t[0]===255&&t[1]&128,c=t[0]===0&&(t[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}let e=new ArrayBuffer(this.valueHex.byteLength),r=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)r[a]=0;r[0]=t[0]&128;let n=Sc(r,8),s=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(s);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=t[a];return i[0]&=127,Sc(i,8)-n}function f_(t){let e=t<0?t*-1:t,r=128;for(let n=1;n<8;n++){if(e<=r){if(t<0){let o=r-e,a=Ec(o,8,n),c=new Uint8Array(a);return c[0]|=128,a}let s=Ec(e,8,n),i=new Uint8Array(s);if(i[0]&128){let o=s.slice(0),a=new Uint8Array(o);s=new ArrayBuffer(s.byteLength+1),i=new Uint8Array(s);for(let c=0;c<o.byteLength;c++)i[c+1]=a[c];i[0]=0}return s}r*=Math.pow(2,8)}return new ArrayBuffer(0)}function d_(t,e){if(t.byteLength!==e.byteLength)return!1;let r=new Uint8Array(t),n=new Uint8Array(e);for(let s=0;s<r.length;s++)if(r[s]!==n[s])return!1;return!0}function p_(t,e){let r=t.toString(10);if(e<r.length)return"";let n=e-r.length,s=new Array(n);for(let o=0;o<n;o++)s[o]="0";return s.join("").concat(r)}var pp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",hp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function h_(t,e=!1,r=!1,n=!1){let s=0,i=0,o=0,a="",c=e?hp:pp;if(n){let l=0;for(let f=0;f<t.length;f++)if(t.charCodeAt(f)!==0){l=f;break}t=t.slice(l)}for(;s<t.length;){let l=t.charCodeAt(s++);s>=t.length&&(i=1);let f=t.charCodeAt(s++);s>=t.length&&(o=1);let u=t.charCodeAt(s++),d=l>>2,p=(l&3)<<4|f>>4,m=(f&15)<<2|u>>6,g=u&63;i===1?m=g=64:o===1&&(g=64),r?m===64?a+=`${c.charAt(d)}${c.charAt(p)}`:g===64?a+=`${c.charAt(d)}${c.charAt(p)}${c.charAt(m)}`:a+=`${c.charAt(d)}${c.charAt(p)}${c.charAt(m)}${c.charAt(g)}`:a+=`${c.charAt(d)}${c.charAt(p)}${c.charAt(m)}${c.charAt(g)}`}return a}function m_(t,e=!1,r=!1){let n=e?hp:pp;function s(c){for(let l=0;l<64;l++)if(n.charAt(l)===c)return l;return 64}function i(c){return c===64?0:c}let o=0,a="";for(;o<t.length;){let c=s(t.charAt(o++)),l=o>=t.length?0:s(t.charAt(o++)),f=o>=t.length?0:s(t.charAt(o++)),u=o>=t.length?0:s(t.charAt(o++)),d=i(c)<<2|i(l)>>4,p=(i(l)&15)<<4|i(f)>>2,m=(i(f)&3)<<6|i(u);a+=String.fromCharCode(d),f!==64&&(a+=String.fromCharCode(p)),u!==64&&(a+=String.fromCharCode(m))}if(r){let c=a.length,l=-1;for(let f=c-1;f>=0;f--)if(a.charCodeAt(f)!==0){l=f;break}l!==-1?a=a.slice(0,l+1):a=""}return a}function y_(t){let e="",r=new Uint8Array(t);for(let n of r)e+=String.fromCharCode(n);return e}function g_(t){let e=t.length,r=new ArrayBuffer(e),n=new Uint8Array(r);for(let s=0;s<e;s++)n[s]=t.charCodeAt(s);return r}var __=Math.log(2);function b_(t){let e=Math.log(t)/__,r=Math.floor(e),n=Math.round(e);return r===n?r:n}function w_(t,e){for(let r of e)delete t[r]}Te.arrayBufferToString=y_;Te.bufferToHexCodes=o_;Te.checkBufferParams=a_;Te.clearProps=w_;Te.fromBase64=m_;Te.getParametersValue=i_;Te.getUTCDate=s_;Te.isEqualBuffer=d_;Te.nearestPowerOf2=b_;Te.padNumber=p_;Te.stringToArrayBuffer=g_;Te.toBase64=h_;Te.utilConcatBuf=c_;Te.utilConcatView=l_;Te.utilDecodeTC=u_;Te.utilEncodeTC=f_;Te.utilFromBase=Sc;Te.utilToBase=Ec});var Er=w(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});var A_=un(),v_=mp();function bp(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach(function(r){if(r!=="default"){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}),e.default=t,Object.freeze(e)}var G=bp(A_),ae=bp(v_);function to(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function kc(t){let e=0,r=0;for(let s=0;s<t.length;s++){let i=t[s];e+=i.byteLength}let n=new Uint8Array(e);for(let s=0;s<t.length;s++){let i=t[s];n.set(new Uint8Array(i),r),r+=i.byteLength}return n.buffer}function Sr(t,e,r,n){return e instanceof Uint8Array?e.byteLength?r<0?(t.error="Wrong parameter: inputOffset less than zero",!1):n<0?(t.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-r-n<0?(t.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(t.error="Wrong parameter: inputBuffer has zero length",!1):(t.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var Kn=class{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return kc(this.items)}},ms=[new Uint8Array([1])],yp="0123456789",Cc="name",gp="valueHexView",S_="isHexOnly",E_="idBlock",C_="tagClass",x_="tagNumber",k_="isConstructed",P_="fromBER",B_="toBER",O_="local",ut="",Gt=new ArrayBuffer(0),_o=new Uint8Array(0),ys="EndOfContent",wp="OCTET STRING",Ap="BIT STRING";function ar(t){var e;return e=class extends t{constructor(...n){var s;super(...n);let i=n[0]||{};this.isHexOnly=(s=i.isHexOnly)!==null&&s!==void 0?s:!1,this.valueHexView=i.valueHex?G.BufferSourceConverter.toUint8Array(i.valueHex):_o}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}fromBER(n,s,i){let o=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!Sr(this,o,s,i))return-1;let a=s+i;return this.valueHexView=o.subarray(s,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),s)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Gt)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:G.Convert.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}var Ar=class{constructor({blockLength:e=0,error:r=ut,warnings:n=[],valueBeforeDecode:s=_o}={}){this.blockLength=e,this.error=r,this.warnings=n,this.valueBeforeDecodeView=G.BufferSourceConverter.toUint8Array(s)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:G.Convert.ToHex(this.valueBeforeDecodeView)}}};Ar.NAME="baseBlock";var Ve=class extends Ar{fromBER(e,r,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}};Ve.NAME="valueBlock";var ro=class extends ar(Ar){constructor({idBlock:e={}}={}){var r,n,s,i;super(),e?(this.isHexOnly=(r=e.isHexOnly)!==null&&r!==void 0?r:!1,this.valueHexView=e.valueHex?G.BufferSourceConverter.toUint8Array(e.valueHex):_o,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(s=e.tagNumber)!==null&&s!==void 0?s:-1,this.isConstructed=(i=e.isConstructed)!==null&&i!==void 0?i:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let r=0;switch(this.tagClass){case 1:r|=0;break;case 2:r|=64;break;case 3:r|=128;break;case 4:r|=192;break;default:return this.error="Unknown tag class",Gt}if(this.isConstructed&&(r|=32),this.tagNumber<31&&!this.isHexOnly){let s=new Uint8Array(1);if(!e){let i=this.tagNumber;i&=31,r|=i,s[0]=r}return s.buffer}if(!this.isHexOnly){let s=ae.utilToBase(this.tagNumber,7),i=new Uint8Array(s),o=s.byteLength,a=new Uint8Array(o+1);if(a[0]=r|31,!e){for(let c=0;c<o-1;c++)a[c+1]=i[c]|128;a[o]=i[o-1]}return a.buffer}let n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=r|31,!e){let s=this.valueHexView;for(let i=0;i<s.length-1;i++)n[i+1]=s[i]|128;n[this.valueHexView.byteLength]=s[s.length-1]}return n.buffer}fromBER(e,r,n){let s=G.BufferSourceConverter.toUint8Array(e);if(!Sr(this,s,r,n))return-1;let i=s.subarray(r,r+n);if(i.length===0)return this.error="Zero buffer length",-1;switch(i[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(i[0]&32)===32,this.isHexOnly=!1;let a=i[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),f=255;for(;i[c]&128;){if(l[c-1]=i[c]&127,c++,c>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(c===f){f+=255;let d=new Uint8Array(f);for(let p=0;p<l.length;p++)d[p]=l[p];l=this.valueHexView=new Uint8Array(f)}}this.blockLength=c+1,l[c-1]=i[c]&127;let u=new Uint8Array(c);for(let d=0;d<c;d++)u[d]=l[d];l=this.valueHexView=new Uint8Array(c),l.set(u),this.blockLength<=9?this.tagNumber=ae.utilFromBase(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return r+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}};ro.NAME="identificationBlock";var no=class extends Ar{constructor({lenBlock:e={}}={}){var r,n,s;super(),this.isIndefiniteForm=(r=e.isIndefiniteForm)!==null&&r!==void 0?r:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(s=e.length)!==null&&s!==void 0?s:0}fromBER(e,r,n){let s=G.BufferSourceConverter.toUint8Array(e);if(!Sr(this,s,r,n))return-1;let i=s.subarray(r,r+n);if(i.length===0)return this.error="Zero buffer length",-1;if(i[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=i[0]===128,this.isIndefiniteForm)return this.blockLength=1,r+this.blockLength;if(this.longFormUsed=!!(i[0]&128),this.longFormUsed===!1)return this.length=i[0],this.blockLength=1,r+this.blockLength;let o=i[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>i.length)return this.error="End of input reached before message was fully decoded",-1;let a=r+1,c=s.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=ae.utilFromBase(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,r+this.blockLength}toBER(e=!1){let r,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return r=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(r),n[0]=128),r;if(this.longFormUsed){let s=ae.utilToBase(this.length,8);if(s.byteLength>127)return this.error="Too big length",Gt;if(r=new ArrayBuffer(s.byteLength+1),e)return r;let i=new Uint8Array(s);n=new Uint8Array(r),n[0]=s.byteLength|128;for(let o=0;o<s.byteLength;o++)n[o+1]=i[o];return r}return r=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(r),n[0]=this.length),r}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}};no.NAME="lengthBlock";var P={},Le=class extends Ar{constructor({name:e=ut,optional:r=!1,primitiveSchema:n,...s}={},i){super(s),this.name=e,this.optional=r,n&&(this.primitiveSchema=n),this.idBlock=new ro(s),this.lenBlock=new no(s),this.valueBlock=i?new i(s):new Ve(s)}fromBER(e,r,n){let s=this.valueBlock.fromBER(e,r,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}toBER(e,r){let n=r||new Kn;r||vp(this);let s=this.idBlock.toBER(e);if(n.write(s),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{let i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;let o=this.lenBlock.toBER(e);n.write(o),n.write(i)}return r?Gt:n.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():G.Convert.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${G.Convert.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;let r=this.toBER(),n=e.toBER();return ae.isEqualBuffer(r,n)}};Le.NAME="BaseBlock";function vp(t){if(t instanceof P.Constructed)for(let e of t.valueBlock.value)vp(e)&&(t.lenBlock.isIndefiniteForm=!0);return!!t.lenBlock.isIndefiniteForm}var gs=class extends Le{constructor({value:e=ut,...r}={},n){super(r,n),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,r,n){let s=this.valueBlock.fromBER(e,r,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}};gs.NAME="BaseStringBlock";var so=class extends ar(Ve){constructor({isHexOnly:e=!0,...r}={}){super(r),this.isHexOnly=e}};so.NAME="PrimitiveValueBlock";var Sp,_s=class extends Le{constructor(e={}){super(e,so),this.idBlock.isConstructed=!1}};Sp=_s;P.Primitive=Sp;_s.NAME="PRIMITIVE";function R_(t,e){if(t instanceof e)return t;let r=new e;return r.idBlock=t.idBlock,r.lenBlock=t.lenBlock,r.warnings=t.warnings,r.valueBeforeDecodeView=t.valueBeforeDecodeView,r}function Mn(t,e=0,r=t.length){let n=e,s=new Le({},Ve),i=new Ar;if(!Sr(i,t,e,r))return s.error=i.error,{offset:-1,result:s};if(!t.subarray(e,e+r).length)return s.error="Zero buffer length",{offset:-1,result:s};let a=s.idBlock.fromBER(t,e,r);if(s.idBlock.warnings.length&&s.warnings.concat(s.idBlock.warnings),a===-1)return s.error=s.idBlock.error,{offset:-1,result:s};if(e=a,r-=s.idBlock.blockLength,a=s.lenBlock.fromBER(t,e,r),s.lenBlock.warnings.length&&s.warnings.concat(s.lenBlock.warnings),a===-1)return s.error=s.lenBlock.error,{offset:-1,result:s};if(e=a,r-=s.lenBlock.blockLength,!s.idBlock.isConstructed&&s.lenBlock.isIndefiniteForm)return s.error="Indefinite length form used for primitive encoding form",{offset:-1,result:s};let c=Le;switch(s.idBlock.tagClass){case 1:if(s.idBlock.tagNumber>=37&&s.idBlock.isHexOnly===!1)return s.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:s};switch(s.idBlock.tagNumber){case 0:if(s.idBlock.isConstructed&&s.lenBlock.length>0)return s.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:s};c=P.EndOfContent;break;case 1:c=P.Boolean;break;case 2:c=P.Integer;break;case 3:c=P.BitString;break;case 4:c=P.OctetString;break;case 5:c=P.Null;break;case 6:c=P.ObjectIdentifier;break;case 10:c=P.Enumerated;break;case 12:c=P.Utf8String;break;case 13:c=P.RelativeObjectIdentifier;break;case 14:c=P.TIME;break;case 15:return s.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:s};case 16:c=P.Sequence;break;case 17:c=P.Set;break;case 18:c=P.NumericString;break;case 19:c=P.PrintableString;break;case 20:c=P.TeletexString;break;case 21:c=P.VideotexString;break;case 22:c=P.IA5String;break;case 23:c=P.UTCTime;break;case 24:c=P.GeneralizedTime;break;case 25:c=P.GraphicString;break;case 26:c=P.VisibleString;break;case 27:c=P.GeneralString;break;case 28:c=P.UniversalString;break;case 29:c=P.CharacterString;break;case 30:c=P.BmpString;break;case 31:c=P.DATE;break;case 32:c=P.TimeOfDay;break;case 33:c=P.DateTime;break;case 34:c=P.Duration;break;default:{let l=s.idBlock.isConstructed?new P.Constructed:new P.Primitive;l.idBlock=s.idBlock,l.lenBlock=s.lenBlock,l.warnings=s.warnings,s=l}}break;case 2:case 3:case 4:default:c=s.idBlock.isConstructed?P.Constructed:P.Primitive}return s=R_(s,c),a=s.fromBER(t,e,s.lenBlock.isIndefiniteForm?r:s.lenBlock.length),s.valueBeforeDecodeView=t.subarray(n,n+s.blockLength),{offset:a,result:s}}function T_(t){if(!t.byteLength){let e=new Le({},Ve);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Mn(G.BufferSourceConverter.toUint8Array(t).slice(),0,t.byteLength)}function N_(t,e){return t?1:e}var ir=class extends Ve{constructor({value:e=[],isIndefiniteForm:r=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=r}fromBER(e,r,n){let s=G.BufferSourceConverter.toUint8Array(e);if(!Sr(this,s,r,n))return-1;if(this.valueBeforeDecodeView=s.subarray(r,r+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),r;let i=r;for(;N_(this.isIndefiniteForm,n)>0;){let o=Mn(s,i,n);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(i=o.offset,this.blockLength+=o.result.blockLength,n-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===ys)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===ys?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,r){let n=r||new Kn;for(let s=0;s<this.value.length;s++)this.value[s].toBER(e,n);return r?Gt:n.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let r of this.value)e.value.push(r.toJSON());return e}};ir.NAME="ConstructedValueBlock";var Ep,vr=class extends Le{constructor(e={}){super(e,ir),this.idBlock.isConstructed=!0}fromBER(e,r,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let s=this.valueBlock.fromBER(e,r,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){let e=[];for(let n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(s=>`  ${s}`).join(`
`));let r=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${r} :
${e.join(`
`)}`:`${r} :`}};Ep=vr;P.Constructed=Ep;vr.NAME="CONSTRUCTED";var io=class extends Ve{fromBER(e,r,n){return r}toBER(e){return Gt}};io.override="EndOfContentValueBlock";var Cp,bs=class extends Le{constructor(e={}){super(e,io),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}};Cp=bs;P.EndOfContent=Cp;bs.NAME=ys;var xp,ws=class extends Le{constructor(e={}){super(e,Ve),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,r,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,r+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):r+n}toBER(e,r){let n=new ArrayBuffer(2);if(!e){let s=new Uint8Array(n);s[0]=5,s[1]=0}return r&&r.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}};xp=ws;P.Null=xp;ws.NAME="NULL";var oo=class extends ar(Ve){constructor({value:e,...r}={}){super(r),r.valueHex?this.valueHexView=G.BufferSourceConverter.toUint8Array(r.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,r,n){let s=G.BufferSourceConverter.toUint8Array(e);return Sr(this,s,r,n)?(this.valueHexView=s.subarray(r,r+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,ae.utilDecodeTC.call(this),this.blockLength=n,r+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}};oo.NAME="BooleanValueBlock";var kp,As=class extends Le{constructor(e={}){super(e,oo),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};kp=As;P.Boolean=kp;As.NAME="BOOLEAN";var ao=class extends ar(ir){constructor({isConstructed:e=!1,...r}={}){super(r),this.isConstructed=e}fromBER(e,r,n){let s=0;if(this.isConstructed){if(this.isHexOnly=!1,s=ir.prototype.fromBER.call(this,e,r,n),s===-1)return s;for(let i=0;i<this.value.length;i++){let o=this.value[i].constructor.NAME;if(o===ys){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==wp)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,s=super.fromBER(e,r,n),this.blockLength=n;return s}toBER(e,r){return this.isConstructed?ir.prototype.toBER.call(this,e,r):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}};ao.NAME="OctetStringValueBlock";var Pp,vs=class t extends Le{constructor({idBlock:e={},lenBlock:r={},...n}={}){var s,i;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...r,isIndefiniteForm:!!n.isIndefiniteForm},...n},ao),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,r,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),r;if(!this.valueBlock.isConstructed){let i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(r,r+n);try{if(i.byteLength){let o=Mn(i,0,i.byteLength);o.offset!==-1&&o.offset===n&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,r,n)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?vr.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${G.Convert.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let r of this.valueBlock.value)r instanceof t&&e.push(r.valueBlock.valueHexView);return G.BufferSourceConverter.concat(e)}};Pp=vs;P.OctetString=Pp;vs.NAME=wp;var co=class extends ar(ir){constructor({unusedBits:e=0,isConstructed:r=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=r,this.blockLength=this.valueHexView.byteLength}fromBER(e,r,n){if(!n)return r;let s=-1;if(this.isConstructed){if(s=ir.prototype.fromBER.call(this,e,r,n),s===-1)return s;for(let a of this.value){let c=a.constructor.NAME;if(c===ys){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==Ap)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return s}let i=G.BufferSourceConverter.toUint8Array(e);if(!Sr(this,i,r,n))return-1;let o=i.subarray(r,r+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let a=o.subarray(1);try{if(a.byteLength){let c=Mn(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,r+n}toBER(e,r){if(this.isConstructed)return ir.prototype.toBER.call(this,e,r);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Gt;let n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}};co.NAME="BitStringValueBlock";var Bp,Ss=class extends Le{constructor({idBlock:e={},lenBlock:r={},...n}={}){var s,i;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...r,isIndefiniteForm:!!n.isIndefiniteForm},...n},co),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,r,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,r,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return vr.prototype.onAsciiEncoding.call(this);{let e=[],r=this.valueBlock.valueHexView;for(let s of r)e.push(s.toString(2).padStart(8,"0"));let n=e.join("");return`${this.constructor.NAME} : ${n.substring(0,n.length-this.valueBlock.unusedBits)}`}}};Bp=Ss;P.BitString=Bp;Ss.NAME=Ap;var Op;function I_(t,e){let r=new Uint8Array([0]),n=new Uint8Array(t),s=new Uint8Array(e),i=n.slice(0),o=i.length-1,a=s.slice(0),c=a.length-1,l=0,f=c<o?o:c,u=0;for(let d=f;d>=0;d--,u++){switch(!0){case u<a.length:l=i[o-u]+a[c-u]+r[0];break;default:l=i[o-u]+r[0]}switch(r[0]=l/10,!0){case u>=i.length:i=ae.utilConcatView(new Uint8Array([l%10]),i);break;default:i[o-u]=l%10}}return r[0]>0&&(i=ae.utilConcatView(r,i)),i}function _p(t){if(t>=ms.length)for(let e=ms.length;e<=t;e++){let r=new Uint8Array([0]),n=ms[e-1].slice(0);for(let s=n.length-1;s>=0;s--){let i=new Uint8Array([(n[s]<<1)+r[0]]);r[0]=i[0]/10,n[s]=i[0]%10}r[0]>0&&(n=ae.utilConcatView(r,n)),ms.push(n)}return ms[t]}function K_(t,e){let r=0,n=new Uint8Array(t),s=new Uint8Array(e),i=n.slice(0),o=i.length-1,a=s.slice(0),c=a.length-1,l,f=0;for(let u=c;u>=0;u--,f++)switch(l=i[o-f]-a[c-f]-r,!0){case l<0:r=1,i[o-f]=l+10;break;default:r=0,i[o-f]=l}if(r>0)for(let u=o-c+1;u>=0;u--,f++)if(l=i[o-f]-r,l<0)r=1,i[o-f]=l+10;else{r=0,i[o-f]=l;break}return i.slice()}var Es=class extends ar(Ve){constructor({value:e,...r}={}){super(r),this._valueDec=0,r.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=ae.utilDecodeTC.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(ae.utilEncodeTC(e))}get valueDec(){return this._valueDec}fromDER(e,r,n,s=0){let i=this.fromBER(e,r,n);if(i===-1)return i;let o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):s!==0&&o.length<s&&(s-o.length>1&&(s=o.length+1),this.valueHexView=o.subarray(s-o.length)),i}toDER(e=!1){let r=this.valueHexView;switch(!0){case(r[0]&128)!==0:{let n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(r,1),this.valueHexView=n}break;case(r[0]===0&&(r[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,r,n){let s=super.fromBER(e,r,n);return s===-1||this.setValueHex(),s}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e=this.valueHexView.length*8-1,r=new Uint8Array(this.valueHexView.length*8/3),n=0,s,i=this.valueHexView,o="",a=!1;for(let c=i.byteLength-1;c>=0;c--){s=i[c];for(let l=0;l<8;l++){if((s&1)===1)switch(n){case e:r=K_(_p(n),r),o="-";break;default:r=I_(r,_p(n))}n++,s>>=1}}for(let c=0;c<r.length;c++)r[c]&&(a=!0),a&&(o+=yp.charAt(r[c]));return a===!1&&(o+=yp.charAt(0)),o}};Op=Es;Es.NAME="IntegerValueBlock";Object.defineProperty(Op.prototype,"valueHex",{set:function(t){this.valueHexView=new Uint8Array(t),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Rp,$n=class t extends Le{constructor(e={}){super(e,Es),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return to(),BigInt(this.valueBlock.toString())}static fromBigInt(e){to();let r=BigInt(e),n=new Kn,s=r.toString(16).replace(/^-/,""),i=new Uint8Array(G.Convert.FromHex(s));if(r<0){let a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;let l=BigInt(`0x${G.Convert.ToHex(a)}`)+r,f=G.BufferSourceConverter.toUint8Array(G.Convert.FromHex(l.toString(16)));f[0]|=128,n.write(f)}else i[0]&128&&n.write(new Uint8Array([0])),n.write(i);return new t({valueHex:n.final()})}convertToDER(){let e=new t({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new t({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}};Rp=$n;P.Integer=Rp;$n.NAME="INTEGER";var Tp,Cs=class extends $n{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}};Tp=Cs;P.Enumerated=Tp;Cs.NAME="ENUMERATED";var xs=class extends ar(Ve){constructor({valueDec:e=-1,isFirstSid:r=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=r}fromBER(e,r,n){if(!n)return r;let s=G.BufferSourceConverter.toUint8Array(e);if(!Sr(this,s,r,n))return-1;let i=s.subarray(r,r+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,!!(i[a]&128));a++);let o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,i[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ae.utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),r+this.blockLength)}set valueBigInt(e){to();let r=BigInt(e).toString(2);for(;r.length%7;)r="0"+r;let n=new Uint8Array(r.length/7);for(let s=0;s<n.length;s++)n[s]=parseInt(r.slice(s*7,s*7+7),2)+(s+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}let r=ae.utilToBase(this.valueDec,7);if(r.byteLength===0)return this.error="Error during encoding SID value",Gt;let n=new Uint8Array(r.byteLength);if(!e){let s=new Uint8Array(r),i=r.byteLength-1;for(let o=0;o<i;o++)n[o]=s[o]|128;n[i]=s[i]}return n}toString(){let e="";if(this.isHexOnly)e=G.Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let r=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",r-=40):(e="2.",r-=80),e+=r.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}};xs.NAME="sidBlock";var lo=class extends Ve{constructor({value:e=ut,...r}={}){super(r),this.value=[],e&&this.fromString(e)}fromBER(e,r,n){let s=r;for(;n>0;){let i=new xs;if(s=i.fromBER(e,s,n),s===-1)return this.blockLength=0,this.error=i.error,s;this.value.length===0&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return s}toBER(e){let r=[];for(let n=0;n<this.value.length;n++){let s=this.value[n].toBER(e);if(s.byteLength===0)return this.error=this.value[n].error,Gt;r.push(s)}return kc(r)}fromString(e){this.value=[];let r=0,n=0,s="",i=!1;do if(n=e.indexOf(".",r),n===-1?s=e.substring(r):s=e.substring(r,n),r=n+1,i){let o=this.value[0],a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}let c=parseInt(s,10);if(isNaN(c))return;o.valueDec=c+a,i=!1}else{let o=new xs;if(s>Number.MAX_SAFE_INTEGER){to();let a=BigInt(s);o.valueBigInt=a}else if(o.valueDec=parseInt(s,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,i=!0),this.value.push(o)}while(n!==-1)}toString(){let e="",r=!1;for(let n=0;n<this.value.length;n++){r=this.value[n].isHexOnly;let s=this.value[n].toString();n!==0&&(e=`${e}.`),r?(s=`{${s}}`,this.value[n].isFirstSid?e=`2.{${s} - 80}`:e+=s):e+=s}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let r=0;r<this.value.length;r++)e.sidArray.push(this.value[r].toJSON());return e}};lo.NAME="ObjectIdentifierValueBlock";var Np,ks=class extends Le{constructor(e={}){super(e,lo),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};Np=ks;P.ObjectIdentifier=Np;ks.NAME="OBJECT IDENTIFIER";var Ps=class extends ar(Ar){constructor({valueDec:e=0,...r}={}){super(r),this.valueDec=e}fromBER(e,r,n){if(n===0)return r;let s=G.BufferSourceConverter.toUint8Array(e);if(!Sr(this,s,r,n))return-1;let i=s.subarray(r,r+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,!!(i[a]&128));a++);let o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,i[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ae.utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),r+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}let r=ae.utilToBase(this.valueDec,7);if(r.byteLength===0)return this.error="Error during encoding SID value",Gt;let n=new Uint8Array(r.byteLength);if(!e){let s=new Uint8Array(r),i=r.byteLength-1;for(let o=0;o<i;o++)n[o]=s[o]|128;n[i]=s[i]}return n.buffer}toString(){let e="";return this.isHexOnly?e=G.Convert.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}};Ps.NAME="relativeSidBlock";var uo=class extends Ve{constructor({value:e=ut,...r}={}){super(r),this.value=[],e&&this.fromString(e)}fromBER(e,r,n){let s=r;for(;n>0;){let i=new Ps;if(s=i.fromBER(e,s,n),s===-1)return this.blockLength=0,this.error=i.error,s;this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return s}toBER(e,r){let n=[];for(let s=0;s<this.value.length;s++){let i=this.value[s].toBER(e);if(i.byteLength===0)return this.error=this.value[s].error,Gt;n.push(i)}return kc(n)}fromString(e){this.value=[];let r=0,n=0,s="";do{n=e.indexOf(".",r),n===-1?s=e.substring(r):s=e.substring(r,n),r=n+1;let i=new Ps;if(i.valueDec=parseInt(s,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(n!==-1);return!0}toString(){let e="",r=!1;for(let n=0;n<this.value.length;n++){r=this.value[n].isHexOnly;let s=this.value[n].toString();n!==0&&(e=`${e}.`),r&&(s=`{${s}}`),e+=s}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let r=0;r<this.value.length;r++)e.sidArray.push(this.value[r].toJSON());return e}};uo.NAME="RelativeObjectIdentifierValueBlock";var Ip,Bs=class extends Le{constructor(e={}){super(e,uo),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};Ip=Bs;P.RelativeObjectIdentifier=Ip;Bs.NAME="RelativeObjectIdentifier";var Kp,Os=class extends vr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}};Kp=Os;P.Sequence=Kp;Os.NAME="SEQUENCE";var $p,Rs=class extends vr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};$p=Rs;P.Set=$p;Rs.NAME="SET";var fo=class extends ar(Ve){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=ut}toJSON(){return{...super.toJSON(),value:this.value}}};fo.NAME="StringValueBlock";var po=class extends fo{};po.NAME="SimpleStringValueBlock";var it=class extends gs{constructor({...e}={}){super(e,po)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,G.BufferSourceConverter.toUint8Array(e))}fromString(e){let r=e.length,n=this.valueBlock.valueHexView=new Uint8Array(r);for(let s=0;s<r;s++)n[s]=e.charCodeAt(s);this.valueBlock.value=e}};it.NAME="SIMPLE STRING";var ho=class extends it{fromBuffer(e){this.valueBlock.valueHexView=G.BufferSourceConverter.toUint8Array(e);try{this.valueBlock.value=G.Convert.ToUtf8String(e)}catch(r){this.warnings.push(`Error during "decodeURIComponent": ${r}, using raw string`),this.valueBlock.value=G.Convert.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(G.Convert.FromUtf8String(e)),this.valueBlock.value=e}};ho.NAME="Utf8StringValueBlock";var Up,or=class extends ho{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}};Up=or;P.Utf8String=Up;or.NAME="UTF8String";var mo=class extends it{fromBuffer(e){this.valueBlock.value=G.Convert.ToUtf16String(e),this.valueBlock.valueHexView=G.BufferSourceConverter.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(G.Convert.FromUtf16String(e))}};mo.NAME="BmpStringValueBlock";var Dp,Ts=class extends mo{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}};Dp=Ts;P.BmpString=Dp;Ts.NAME="BMPString";var yo=class extends it{fromBuffer(e){let r=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(r);for(let s=0;s<n.length;s+=4)n[s]=n[s+3],n[s+1]=n[s+2],n[s+2]=0,n[s+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(r))}fromString(e){let r=e.length,n=this.valueBlock.valueHexView=new Uint8Array(r*4);for(let s=0;s<r;s++){let i=ae.utilToBase(e.charCodeAt(s),8),o=new Uint8Array(i);if(o.length>4)continue;let a=4-o.length;for(let c=o.length-1;c>=0;c--)n[s*4+c+a]=o[c]}this.valueBlock.value=e}};yo.NAME="UniversalStringValueBlock";var Mp,Ns=class extends yo{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}};Mp=Ns;P.UniversalString=Mp;Ns.NAME="UniversalString";var Lp,Is=class extends it{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}};Lp=Is;P.NumericString=Lp;Is.NAME="NumericString";var Hp,Ks=class extends it{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}};Hp=Ks;P.PrintableString=Hp;Ks.NAME="PrintableString";var jp,$s=class extends it{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}};jp=$s;P.TeletexString=jp;$s.NAME="TeletexString";var Vp,Us=class extends it{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}};Vp=Us;P.VideotexString=Vp;Us.NAME="VideotexString";var Fp,Ds=class extends it{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}};Fp=Ds;P.IA5String=Fp;Ds.NAME="IA5String";var qp,Ms=class extends it{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}};qp=Ms;P.GraphicString=qp;Ms.NAME="GraphicString";var Gp,Un=class extends it{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}};Gp=Un;P.VisibleString=Gp;Un.NAME="VisibleString";var Jp,Ls=class extends it{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}};Jp=Ls;P.GeneralString=Jp;Ls.NAME="GeneralString";var Wp,Hs=class extends it{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}};Wp=Hs;P.CharacterString=Wp;Hs.NAME="CharacterString";var zp,Dn=class extends Un{constructor({value:e,valueDate:r,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let s=0;s<e.length;s++)this.valueBlock.valueHexView[s]=e.charCodeAt(s)}r&&(this.fromDate(r),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,G.BufferSourceConverter.toUint8Array(e)))}toBuffer(){let e=this.toString(),r=new ArrayBuffer(e.length),n=new Uint8Array(r);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return r}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}let s=parseInt(n[1],10);s>=50?this.year=1900+s:this.year=2e3+s,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){let r=new Array(7);return r[0]=ae.padNumber(this.year<2e3?this.year-1900:this.year-2e3,2),r[1]=ae.padNumber(this.month,2),r[2]=ae.padNumber(this.day,2),r[3]=ae.padNumber(this.hour,2),r[4]=ae.padNumber(this.minute,2),r[5]=ae.padNumber(this.second,2),r[6]="Z",r.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}};zp=Dn;P.UTCTime=zp;Dn.NAME="UTCTime";var Xp,js=class extends Dn{constructor(e={}){var r;super(e),(r=this.millisecond)!==null&&r!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let r=!1,n="",s="",i=0,o,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),r=!0;else{let u=new Number(e[e.length-1]);if(isNaN(u.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(r){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let u=1,d=n.indexOf("+"),p="";if(d===-1&&(d=n.indexOf("-"),u=-1),d!==-1){if(p=n.substring(d+1),n=n.substring(0,d),p.length!==2&&p.length!==4)throw new Error("Wrong input string for conversion");let m=parseInt(p.substring(0,2),10);if(isNaN(m.valueOf()))throw new Error("Wrong input string for conversion");if(a=u*m,p.length===4){if(m=parseInt(p.substring(2,4),10),isNaN(m.valueOf()))throw new Error("Wrong input string for conversion");c=u*m}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){let u=new Number(`0${n.substring(l)}`);if(isNaN(u.valueOf()))throw new Error("Wrong input string for conversion");i=u.valueOf(),s=n.substring(0,l)}else s=n;switch(!0){case s.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case s.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let u=60*i;this.minute=Math.floor(u),u=60*(u-this.minute),this.second=Math.floor(u),u=1e3*(u-this.second),this.millisecond=Math.floor(u)}break;case s.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let u=60*i;this.second=Math.floor(u),u=1e3*(u-this.second),this.millisecond=Math.floor(u)}break;case s.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let u=1e3*i;this.millisecond=Math.floor(u)}break;default:throw new Error("Wrong input string for conversion")}let f=o.exec(s);if(f===null)throw new Error("Wrong input string for conversion");for(let u=1;u<f.length;u++)switch(u){case 1:this.year=parseInt(f[u],10);break;case 2:this.month=parseInt(f[u],10);break;case 3:this.day=parseInt(f[u],10);break;case 4:this.hour=parseInt(f[u],10)+a;break;case 5:this.minute=parseInt(f[u],10)+c;break;case 6:this.second=parseInt(f[u],10);break;default:throw new Error("Wrong input string for conversion")}if(r===!1){let u=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=u.getUTCFullYear(),this.month=u.getUTCMonth(),this.day=u.getUTCDay(),this.hour=u.getUTCHours(),this.minute=u.getUTCMinutes(),this.second=u.getUTCSeconds(),this.millisecond=u.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){let r=[];return r.push(ae.padNumber(this.year,4)),r.push(ae.padNumber(this.month,2)),r.push(ae.padNumber(this.day,2)),r.push(ae.padNumber(this.hour,2)),r.push(ae.padNumber(this.minute,2)),r.push(ae.padNumber(this.second,2)),this.millisecond!==0&&(r.push("."),r.push(ae.padNumber(this.millisecond,3))),r.push("Z"),r.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}};Xp=js;P.GeneralizedTime=Xp;js.NAME="GeneralizedTime";var Yp,Vs=class extends or{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}};Yp=Vs;P.DATE=Yp;Vs.NAME="DATE";var Zp,Fs=class extends or{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}};Zp=Fs;P.TimeOfDay=Zp;Fs.NAME="TimeOfDay";var Qp,qs=class extends or{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}};Qp=qs;P.DateTime=Qp;qs.NAME="DateTime";var eh,Gs=class extends or{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}};eh=Gs;P.Duration=eh;Gs.NAME="Duration";var th,Js=class extends or{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}};th=Js;P.TIME=th;Js.NAME="TIME";var fn=class{constructor({name:e=ut,optional:r=!1}={}){this.name=e,this.optional=r}},go=class extends fn{constructor({value:e=[],...r}={}){super(r),this.value=e}},Ws=class extends fn{constructor({value:e=new fn,local:r=!1,...n}={}){super(n),this.value=e,this.local=r}},xc=class{constructor({data:e=_o}={}){this.dataView=G.BufferSourceConverter.toUint8Array(e)}get data(){return this.dataView.slice().buffer}set data(e){this.dataView=G.BufferSourceConverter.toUint8Array(e)}fromBER(e,r,n){let s=r+n;return this.dataView=G.BufferSourceConverter.toUint8Array(e).subarray(r,s),s}toBER(e){return this.dataView.slice().buffer}};function In(t,e,r){if(r instanceof go){for(let i=0;i<r.value.length;i++)if(In(t,e,r.value[i]).verified)return{verified:!0,result:t};{let i={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(Cc)&&(i.name=r.name),i}}if(r instanceof fn)return r.hasOwnProperty(Cc)&&(t[r.name]=e),{verified:!0,result:t};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(E_ in r))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(P_ in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(B_ in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let n=r.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(r.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(r.idBlock.hasOwnProperty(C_)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:t};if(r.idBlock.hasOwnProperty(x_)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:t};if(r.idBlock.hasOwnProperty(k_)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:t};if(!(S_ in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:t};if(r.idBlock.isHexOnly){if(!(gp in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let i=r.idBlock.valueHexView,o=e.idBlock.valueHexView;if(i.length!==o.length)return{verified:!1,result:t};for(let a=0;a<i.length;a++)if(i[a]!==o[1])return{verified:!1,result:t}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&(t[r.name]=e)),r instanceof P.Constructed){let i=0,o={verified:!1,result:{error:"Unknown error"}},a=r.valueBlock.value.length;if(a>0&&r.valueBlock.value[0]instanceof Ws&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:t};if(e.valueBlock.value.length===0&&r.valueBlock.value.length!==0){let c=!0;for(let l=0;l<r.valueBlock.value.length;l++)c=c&&(r.valueBlock.value[l].optional||!1);return c?{verified:!0,result:t}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&delete t[r.name]),t.error="Inconsistent object length",{verified:!1,result:t})}for(let c=0;c<a;c++)if(c-i>=e.valueBlock.value.length){if(r.valueBlock.value[c].optional===!1){let l={verified:!1,result:t};return t.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&(delete t[r.name],l.name=r.name)),l}}else if(r.valueBlock.value[0]instanceof Ws){if(o=In(t,e.valueBlock.value[c],r.valueBlock.value[0].value),o.verified===!1)if(r.valueBlock.value[0].optional)i++;else return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&delete t[r.name]),o;if(Cc in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){let l={};O_ in r.valueBlock.value[0]&&r.valueBlock.value[0].local?l=e:l=t,typeof l[r.valueBlock.value[0].name]>"u"&&(l[r.valueBlock.value[0].name]=[]),l[r.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(o=In(t,e.valueBlock.value[c-i],r.valueBlock.value[c]),o.verified===!1)if(r.valueBlock.value[c].optional)i++;else return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&delete t[r.name]),o;if(o.verified===!1){let c={verified:!1,result:t};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&(delete t[r.name],c.name=r.name)),c}return{verified:!0,result:t}}if(r.primitiveSchema&&gp in e.valueBlock){let i=Mn(e.valueBlock.valueHexView);if(i.offset===-1){let o={verified:!1,result:i.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&(delete t[r.name],o.name=r.name)),o}return In(t,i.result,r.primitiveSchema)}return{verified:!0,result:t}}function $_(t,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let r=Mn(G.BufferSourceConverter.toUint8Array(t));return r.offset===-1?{verified:!1,result:r.result}:In(r.result,r.result,e)}M.Any=fn;M.BaseBlock=Le;M.BaseStringBlock=gs;M.BitString=Ss;M.BmpString=Ts;M.Boolean=As;M.CharacterString=Hs;M.Choice=go;M.Constructed=vr;M.DATE=Vs;M.DateTime=qs;M.Duration=Gs;M.EndOfContent=bs;M.Enumerated=Cs;M.GeneralString=Ls;M.GeneralizedTime=js;M.GraphicString=Ms;M.HexBlock=ar;M.IA5String=Ds;M.Integer=$n;M.Null=ws;M.NumericString=Is;M.ObjectIdentifier=ks;M.OctetString=vs;M.Primitive=_s;M.PrintableString=Ks;M.RawData=xc;M.RelativeObjectIdentifier=Bs;M.Repeated=Ws;M.Sequence=Os;M.Set=Rs;M.TIME=Js;M.TeletexString=$s;M.TimeOfDay=Fs;M.UTCTime=Dn;M.UniversalString=Ns;M.Utf8String=or;M.ValueBlock=Ve;M.VideotexString=Us;M.ViewWriter=Kn;M.VisibleString=Un;M.compareSchema=In;M.fromBER=T_;M.verifySchema=$_});var dn=w(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.AsnPropTypes=Ln.AsnTypeTypes=void 0;var rh;(function(t){t[t.Sequence=0]="Sequence",t[t.Set=1]="Set",t[t.Choice=2]="Choice"})(rh||(Ln.AsnTypeTypes=rh={}));var nh;(function(t){t[t.Any=1]="Any",t[t.Boolean=2]="Boolean",t[t.OctetString=3]="OctetString",t[t.BitString=4]="BitString",t[t.Integer=5]="Integer",t[t.Enumerated=6]="Enumerated",t[t.ObjectIdentifier=7]="ObjectIdentifier",t[t.Utf8String=8]="Utf8String",t[t.BmpString=9]="BmpString",t[t.UniversalString=10]="UniversalString",t[t.NumericString=11]="NumericString",t[t.PrintableString=12]="PrintableString",t[t.TeletexString=13]="TeletexString",t[t.VideotexString=14]="VideotexString",t[t.IA5String=15]="IA5String",t[t.GraphicString=16]="GraphicString",t[t.VisibleString=17]="VisibleString",t[t.GeneralString=18]="GeneralString",t[t.CharacterString=19]="CharacterString",t[t.UTCTime=20]="UTCTime",t[t.GeneralizedTime=21]="GeneralizedTime",t[t.DATE=22]="DATE",t[t.TimeOfDay=23]="TimeOfDay",t[t.DateTime=24]="DateTime",t[t.Duration=25]="Duration",t[t.TIME=26]="TIME",t[t.Null=27]="Null"})(nh||(Ln.AsnPropTypes=nh={}))});var ih=w(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.BitString=void 0;var Pc=Er(),sh=un(),Bc=class{constructor(e,r=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(sh.BufferSourceConverter.isBufferSource(e))this.unusedBits=r,this.value=sh.BufferSourceConverter.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof Pc.BitString))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new Pc.BitString({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new Pc.BitString({name:e})}toNumber(){let e="",r=new Uint8Array(this.value);for(let n of r)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let r=e.toString(2),n=r.length+7>>3;this.unusedBits=(n<<3)-r.length;let s=new Uint8Array(n);r=r.padStart(n<<3,"0").split("").reverse().join("");let i=0;for(;i<n;)s[i]=parseInt(r.slice(i<<3,(i<<3)+8),2),i++;this.value=s.buffer}};bo.BitString=Bc});var ah=w(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});wo.OctetString=void 0;var Oc=Er(),oh=un(),Rc=class{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):oh.BufferSourceConverter.isBufferSource(e)?this.buffer=oh.BufferSourceConverter.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof Oc.OctetString))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new Oc.OctetString({valueHex:this.buffer})}toSchema(e){return new Oc.OctetString({name:e})}};wo.OctetString=Rc});var Tc=w(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});var ch=(Nn(),ss(Tn));ch.__exportStar(ih(),Ao);ch.__exportStar(ah(),Ao)});var zs=w(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.defaultConverter=A.AsnNullConverter=A.AsnGeneralizedTimeConverter=A.AsnUTCTimeConverter=A.AsnCharacterStringConverter=A.AsnGeneralStringConverter=A.AsnVisibleStringConverter=A.AsnGraphicStringConverter=A.AsnIA5StringConverter=A.AsnVideotexStringConverter=A.AsnTeletexStringConverter=A.AsnPrintableStringConverter=A.AsnNumericStringConverter=A.AsnUniversalStringConverter=A.AsnBmpStringConverter=A.AsnUtf8StringConverter=A.AsnConstructedOctetStringConverter=A.AsnOctetStringConverter=A.AsnBooleanConverter=A.AsnObjectIdentifierConverter=A.AsnBitStringConverter=A.AsnIntegerBigIntConverter=A.AsnIntegerArrayBufferConverter=A.AsnEnumeratedConverter=A.AsnIntegerConverter=A.AsnAnyConverter=void 0;var me=Er(),ke=dn(),U_=Tc();A.AsnAnyConverter={fromASN:t=>t instanceof me.Null?null:t.valueBeforeDecodeView,toASN:t=>{if(t===null)return new me.Null;let e=me.fromBER(t);if(e.result.error)throw new Error(e.result.error);return e.result}};A.AsnIntegerConverter={fromASN:t=>t.valueBlock.valueHexView.byteLength>=4?t.valueBlock.toString():t.valueBlock.valueDec,toASN:t=>new me.Integer({value:+t})};A.AsnEnumeratedConverter={fromASN:t=>t.valueBlock.valueDec,toASN:t=>new me.Enumerated({value:t})};A.AsnIntegerArrayBufferConverter={fromASN:t=>t.valueBlock.valueHexView,toASN:t=>new me.Integer({valueHex:t})};A.AsnIntegerBigIntConverter={fromASN:t=>t.toBigInt(),toASN:t=>me.Integer.fromBigInt(t)};A.AsnBitStringConverter={fromASN:t=>t.valueBlock.valueHexView,toASN:t=>new me.BitString({valueHex:t})};A.AsnObjectIdentifierConverter={fromASN:t=>t.valueBlock.toString(),toASN:t=>new me.ObjectIdentifier({value:t})};A.AsnBooleanConverter={fromASN:t=>t.valueBlock.value,toASN:t=>new me.Boolean({value:t})};A.AsnOctetStringConverter={fromASN:t=>t.valueBlock.valueHexView,toASN:t=>new me.OctetString({valueHex:t})};A.AsnConstructedOctetStringConverter={fromASN:t=>new U_.OctetString(t.getValue()),toASN:t=>t.toASN()};function Kt(t){return{fromASN:e=>e.valueBlock.value,toASN:e=>new t({value:e})}}A.AsnUtf8StringConverter=Kt(me.Utf8String);A.AsnBmpStringConverter=Kt(me.BmpString);A.AsnUniversalStringConverter=Kt(me.UniversalString);A.AsnNumericStringConverter=Kt(me.NumericString);A.AsnPrintableStringConverter=Kt(me.PrintableString);A.AsnTeletexStringConverter=Kt(me.TeletexString);A.AsnVideotexStringConverter=Kt(me.VideotexString);A.AsnIA5StringConverter=Kt(me.IA5String);A.AsnGraphicStringConverter=Kt(me.GraphicString);A.AsnVisibleStringConverter=Kt(me.VisibleString);A.AsnGeneralStringConverter=Kt(me.GeneralString);A.AsnCharacterStringConverter=Kt(me.CharacterString);A.AsnUTCTimeConverter={fromASN:t=>t.toDate(),toASN:t=>new me.UTCTime({valueDate:t})};A.AsnGeneralizedTimeConverter={fromASN:t=>t.toDate(),toASN:t=>new me.GeneralizedTime({valueDate:t})};A.AsnNullConverter={fromASN:()=>null,toASN:()=>new me.Null};function D_(t){switch(t){case ke.AsnPropTypes.Any:return A.AsnAnyConverter;case ke.AsnPropTypes.BitString:return A.AsnBitStringConverter;case ke.AsnPropTypes.BmpString:return A.AsnBmpStringConverter;case ke.AsnPropTypes.Boolean:return A.AsnBooleanConverter;case ke.AsnPropTypes.CharacterString:return A.AsnCharacterStringConverter;case ke.AsnPropTypes.Enumerated:return A.AsnEnumeratedConverter;case ke.AsnPropTypes.GeneralString:return A.AsnGeneralStringConverter;case ke.AsnPropTypes.GeneralizedTime:return A.AsnGeneralizedTimeConverter;case ke.AsnPropTypes.GraphicString:return A.AsnGraphicStringConverter;case ke.AsnPropTypes.IA5String:return A.AsnIA5StringConverter;case ke.AsnPropTypes.Integer:return A.AsnIntegerConverter;case ke.AsnPropTypes.Null:return A.AsnNullConverter;case ke.AsnPropTypes.NumericString:return A.AsnNumericStringConverter;case ke.AsnPropTypes.ObjectIdentifier:return A.AsnObjectIdentifierConverter;case ke.AsnPropTypes.OctetString:return A.AsnOctetStringConverter;case ke.AsnPropTypes.PrintableString:return A.AsnPrintableStringConverter;case ke.AsnPropTypes.TeletexString:return A.AsnTeletexStringConverter;case ke.AsnPropTypes.UTCTime:return A.AsnUTCTimeConverter;case ke.AsnPropTypes.UniversalString:return A.AsnUniversalStringConverter;case ke.AsnPropTypes.Utf8String:return A.AsnUtf8StringConverter;case ke.AsnPropTypes.VideotexString:return A.AsnVideotexStringConverter;case ke.AsnPropTypes.VisibleString:return A.AsnVisibleStringConverter;default:return null}}A.defaultConverter=D_});var vo=w(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.isArrayEqual=Ur.isTypeOfArray=Ur.isConvertible=void 0;function lh(t){return typeof t=="function"&&t.prototype?t.prototype.toASN&&t.prototype.fromASN?!0:lh(t.prototype):!!(t&&typeof t=="object"&&"toASN"in t&&"fromASN"in t)}Ur.isConvertible=lh;function uh(t){var e;if(t){let r=Object.getPrototypeOf(t);return((e=r==null?void 0:r.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:uh(r)}return!1}Ur.isTypeOfArray=uh;function M_(t,e){if(!(t&&e)||t.byteLength!==e.byteLength)return!1;let r=new Uint8Array(t),n=new Uint8Array(e);for(let s=0;s<t.byteLength;s++)if(r[s]!==n[s])return!1;return!0}Ur.isArrayEqual=M_});var dh=w(So=>{"use strict";Object.defineProperty(So,"__esModule",{value:!0});So.AsnSchemaStorage=void 0;var _t=Er(),Hn=dn(),fh=vo(),Nc=class{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,r=!1){let n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(r&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){let r=this.get(e);r.schema||(r.schema=this.create(e,!0))}createDefault(e){let r={type:Hn.AsnTypeTypes.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(r,n),r.items=Object.assign({},r.items,n.items)),r}create(e,r){let n=this.items.get(e)||this.createDefault(e),s=[];for(let i in n.items){let o=n.items[i],a=r?i:"",c;if(typeof o.type=="number"){let f=Hn.AsnPropTypes[o.type],u=_t[f];if(!u)throw new Error(`Cannot get ASN1 class by name '${f}'`);c=new u({name:a})}else(0,fh.isConvertible)(o.type)?c=new o.type().toSchema(a):o.optional?this.get(o.type).type===Hn.AsnTypeTypes.Choice?c=new _t.Any({name:a}):(c=this.create(o.type,!1),c.name=a):c=new _t.Any({name:a});let l=!!o.optional||o.defaultValue!==void 0;if(o.repeated){c.name="";let f=o.repeated==="set"?_t.Set:_t.Sequence;c=new f({name:"",value:[new _t.Repeated({name:a,value:c})]})}if(o.context!==null&&o.context!==void 0)if(o.implicit)if(typeof o.type=="number"||(0,fh.isConvertible)(o.type)){let f=o.repeated?_t.Constructed:_t.Primitive;s.push(new f({name:a,optional:l,idBlock:{tagClass:3,tagNumber:o.context}}))}else{this.cache(o.type);let f=!!o.repeated,u=f?c:this.get(o.type,!0).schema;u="valueBlock"in u?u.valueBlock.value:u.value,s.push(new _t.Constructed({name:f?"":a,optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:u}))}else s.push(new _t.Constructed({optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:[c]}));else c.optional=l,s.push(c)}switch(n.type){case Hn.AsnTypeTypes.Sequence:return new _t.Sequence({value:s,name:""});case Hn.AsnTypeTypes.Set:return new _t.Set({value:s,name:""});case Hn.AsnTypeTypes.Choice:return new _t.Choice({value:s,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,r){return this.items.set(e,r),this}findParentSchema(e){let r=Object.getPrototypeOf(e);return r?this.items.get(r)||this.findParentSchema(r):null}};So.AsnSchemaStorage=Nc});var Co=w(Eo=>{"use strict";Object.defineProperty(Eo,"__esModule",{value:!0});Eo.schemaStorage=void 0;var L_=dh();Eo.schemaStorage=new L_.AsnSchemaStorage});var ph=w(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.AsnProp=ot.AsnSequenceType=ot.AsnSetType=ot.AsnChoiceType=ot.AsnType=void 0;var H_=zs(),Ic=dn(),Dr=Co(),j_=t=>e=>{let r;Dr.schemaStorage.has(e)?r=Dr.schemaStorage.get(e):(r=Dr.schemaStorage.createDefault(e),Dr.schemaStorage.set(e,r)),Object.assign(r,t)};ot.AsnType=j_;var V_=()=>(0,ot.AsnType)({type:Ic.AsnTypeTypes.Choice});ot.AsnChoiceType=V_;var F_=t=>(0,ot.AsnType)({type:Ic.AsnTypeTypes.Set,...t});ot.AsnSetType=F_;var q_=t=>(0,ot.AsnType)({type:Ic.AsnTypeTypes.Sequence,...t});ot.AsnSequenceType=q_;var G_=t=>(e,r)=>{let n;Dr.schemaStorage.has(e.constructor)?n=Dr.schemaStorage.get(e.constructor):(n=Dr.schemaStorage.createDefault(e.constructor),Dr.schemaStorage.set(e.constructor,n));let s=Object.assign({},t);if(typeof s.type=="number"&&!s.converter){let i=H_.defaultConverter(t.type);if(!i)throw new Error(`Cannot get default converter for property '${r}' of ${e.constructor.name}`);s.converter=i}n.items[r]=s};ot.AsnProp=G_});var hh=w(xo=>{"use strict";Object.defineProperty(xo,"__esModule",{value:!0});xo.AsnSchemaValidationError=void 0;var Kc=class extends Error{constructor(){super(...arguments),this.schemas=[]}};xo.AsnSchemaValidationError=Kc});var Uc=w($c=>{"use strict";Object.defineProperty($c,"__esModule",{value:!0});var J_=(Nn(),ss(Tn));J_.__exportStar(hh(),$c)});var Mc=w(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.AsnParser=void 0;var Cr=Er(),mh=dn(),W_=zs(),yh=Uc(),Xs=vo(),gh=Co(),Dc=class{static parse(e,r){let n=Cr.fromBER(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,r)}static fromASN(e,r){var n;try{if((0,Xs.isConvertible)(r))return new r().fromASN(e);let s=gh.schemaStorage.get(r);gh.schemaStorage.cache(r);let i=s.schema;if(e.constructor===Cr.Constructed&&s.type!==mh.AsnTypeTypes.Choice){i=new Cr.Constructed({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:s.schema.valueBlock.value});for(let c in s.items)delete e[c]}let o=Cr.compareSchema({},e,i);if(!o.verified)throw new yh.AsnSchemaValidationError(`Data does not match to ${r.name} ASN1 schema. ${o.result.error}`);let a=new r;if((0,Xs.isTypeOfArray)(r)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let c=s.itemType;if(typeof c=="number"){let l=W_.defaultConverter(c);if(!l)throw new Error(`Cannot get default converter for array item of ${r.name} ASN1 schema`);return r.from(e.valueBlock.value,f=>l.fromASN(f))}else return r.from(e.valueBlock.value,l=>this.fromASN(l,c))}for(let c in s.items){let l=o.result[c];if(!l)continue;let f=s.items[c],u=f.type;if(typeof u=="number"||(0,Xs.isConvertible)(u)){let d=(n=f.converter)!==null&&n!==void 0?n:(0,Xs.isConvertible)(u)?new u:null;if(!d)throw new Error("Converter is empty");if(f.repeated)if(f.implicit){let p=f.repeated==="sequence"?Cr.Sequence:Cr.Set,m=new p;m.valueBlock=l.valueBlock;let g=Cr.fromBER(m.toBER(!1));if(g.offset===-1)throw new Error(`Cannot parse the child item. ${g.result.error}`);if(!("value"in g.result.valueBlock&&Array.isArray(g.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let _=g.result.valueBlock.value;a[c]=Array.from(_,x=>d.fromASN(x))}else a[c]=Array.from(l,p=>d.fromASN(p));else{let p=l;if(f.implicit){let m;if((0,Xs.isConvertible)(u))m=new u().toSchema("");else{let g=mh.AsnPropTypes[u],_=Cr[g];if(!_)throw new Error(`Cannot get '${g}' class from asn1js module`);m=new _}m.valueBlock=p.valueBlock,p=Cr.fromBER(m.toBER(!1)).result}a[c]=d.fromASN(p)}}else if(f.repeated){if(!Array.isArray(l))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(l,d=>this.fromASN(d,u))}else a[c]=this.fromASN(l,u)}return a}catch(s){throw s instanceof yh.AsnSchemaValidationError&&s.schemas.push(r.name),s}}};ko.AsnParser=Dc});var jc=w(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.AsnSerializer=void 0;var Jt=Er(),z_=zs(),Po=dn(),Lc=vo(),_h=Co(),Hc=class t{static serialize(e){return e instanceof Jt.BaseBlock?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&(0,Lc.isConvertible)(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");let r=e.constructor,n=_h.schemaStorage.get(r);_h.schemaStorage.cache(r);let s=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){let o=z_.defaultConverter(n.itemType);if(!o)throw new Error(`Cannot get default converter for array item of ${r.name} ASN1 schema`);s=e.map(a=>o.toASN(a))}else s=e.map(o=>this.toAsnItem({type:n.itemType},"[]",r,o))}else for(let o in n.items){let a=n.items[o],c=e[o];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&(0,Lc.isArrayEqual)(this.serialize(a.defaultValue),this.serialize(c)))continue;let l=t.toAsnItem(a,o,r,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||(0,Lc.isConvertible)(a.type))){let f={};f.valueHex=l instanceof Jt.Null?l.valueBeforeDecodeView:l.valueBlock.toBER(),s.push(new Jt.Primitive({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...f}))}else s.push(new Jt.Constructed({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else s.push(new Jt.Constructed({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?s=s.concat(l):s.push(l)}let i;switch(n.type){case Po.AsnTypeTypes.Sequence:i=new Jt.Sequence({value:s});break;case Po.AsnTypeTypes.Set:i=new Jt.Set({value:s});break;case Po.AsnTypeTypes.Choice:if(!s[0])throw new Error(`Schema '${r.name}' has wrong data. Choice cannot be empty.`);i=s[0];break}return i}static toAsnItem(e,r,n,s){let i;if(typeof e.type=="number"){let o=e.converter;if(!o)throw new Error(`Property '${r}' doesn't have converter for type ${Po.AsnPropTypes[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(s))throw new TypeError("Parameter 'objProp' should be type of Array.");let a=Array.from(s,l=>o.toASN(l)),c=e.repeated==="sequence"?Jt.Sequence:Jt.Set;i=new c({value:a})}else i=o.toASN(s)}else if(e.repeated){if(!Array.isArray(s))throw new TypeError("Parameter 'objProp' should be type of Array.");let o=Array.from(s,c=>this.toASN(c)),a=e.repeated==="sequence"?Jt.Sequence:Jt.Set;i=new a({value:o})}else i=this.toASN(s);return i}};Bo.AsnSerializer=Hc});var bh=w(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});Oo.AsnArray=void 0;var Vc=class extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(let r of e)this.push(r)}}};Oo.AsnArray=Vc});var Ah=w(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.AsnConvert=void 0;var X_=Er(),wh=un(),Y_=Mc(),Z_=jc(),Fc=class t{static serialize(e){return Z_.AsnSerializer.serialize(e)}static parse(e,r){return Y_.AsnParser.parse(e,r)}static toString(e){let r=wh.BufferSourceConverter.isBufferSource(e)?wh.BufferSourceConverter.toArrayBuffer(e):t.serialize(e),n=X_.fromBER(r);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}};Ro.AsnConvert=Fc});var qc=w(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.AsnSerializer=be.AsnParser=be.AsnPropTypes=be.AsnTypeTypes=be.AsnSetType=be.AsnSequenceType=be.AsnChoiceType=be.AsnType=be.AsnProp=void 0;var Ys=(Nn(),ss(Tn));Ys.__exportStar(zs(),be);Ys.__exportStar(Tc(),be);var Zs=ph();Object.defineProperty(be,"AsnProp",{enumerable:!0,get:function(){return Zs.AsnProp}});Object.defineProperty(be,"AsnType",{enumerable:!0,get:function(){return Zs.AsnType}});Object.defineProperty(be,"AsnChoiceType",{enumerable:!0,get:function(){return Zs.AsnChoiceType}});Object.defineProperty(be,"AsnSequenceType",{enumerable:!0,get:function(){return Zs.AsnSequenceType}});Object.defineProperty(be,"AsnSetType",{enumerable:!0,get:function(){return Zs.AsnSetType}});var vh=dn();Object.defineProperty(be,"AsnTypeTypes",{enumerable:!0,get:function(){return vh.AsnTypeTypes}});Object.defineProperty(be,"AsnPropTypes",{enumerable:!0,get:function(){return vh.AsnPropTypes}});var Q_=Mc();Object.defineProperty(be,"AsnParser",{enumerable:!0,get:function(){return Q_.AsnParser}});var eb=jc();Object.defineProperty(be,"AsnSerializer",{enumerable:!0,get:function(){return eb.AsnSerializer}});Ys.__exportStar(Uc(),be);Ys.__exportStar(bh(),be);Ys.__exportStar(Ah(),be)});var Qc=w(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});var hn=class extends Error{constructor(e,r){super(r?`${e}. See the inner exception for more details.`:e),this.message=e,this.innerError=r}},To=class extends hn{constructor(e,r,n){super(r,n),this.schema=e}},pn=class extends To{constructor(e,r,n){super(e,`JSON doesn't match to '${e.target.name}' schema. ${r}`,n)}},zt=class extends hn{},jn=class extends hn{constructor(e,r,n){super(`Cannot serialize by '${e}' schema. ${r}`,n),this.schemaName=e}},Qs=class extends pn{constructor(e,r,n={}){super(e,"Some keys doesn't match to schema"),this.keys=r,this.errors=n}};(function(t){t[t.Any=0]="Any",t[t.Boolean=1]="Boolean",t[t.Number=2]="Number",t[t.String=3]="String"})(we.JsonPropTypes||(we.JsonPropTypes={}));function tb(t,e){switch(e){case we.JsonPropTypes.Boolean:return typeof t=="boolean";case we.JsonPropTypes.Number:return typeof t=="number";case we.JsonPropTypes.String:return typeof t=="string"}return!0}function Ko(t,e){if(!tb(t,e))throw new TypeError(`Value must be ${we.JsonPropTypes[e]}`)}function $o(t){return t&&t.prototype?t.prototype.toJSON&&t.prototype.fromJSON?!0:$o(t.prototype):!!(t&&t.toJSON&&t.fromJSON)}var Gc=class{constructor(){this.items=new Map}has(e){return this.items.has(e)||!!this.findParentSchema(e)}get(e){let r=this.items.get(e)||this.findParentSchema(e);if(!r)throw new Error("Cannot get schema for current target");return r}create(e){let r={names:{}},n=this.findParentSchema(e);if(n){Object.assign(r,n),r.names={};for(let s in n.names)r.names[s]=Object.assign({},n.names[s])}return r.target=e,r}set(e,r){return this.items.set(e,r),this}findParentSchema(e){let r=e.__proto__;return r?this.items.get(r)||this.findParentSchema(r):null}},ei="default",Wt=new Gc,Jc=class{constructor(e){this.pattern=new RegExp(e)}validate(e){let r=new RegExp(this.pattern.source,this.pattern.flags);if(typeof e!="string")throw new zt("Incoming value must be string");if(!r.exec(e))throw new zt(`Value doesn't match to pattern '${r.toString()}'`)}},Wc=class{constructor(e=Number.MIN_VALUE,r=Number.MAX_VALUE){this.min=e,this.max=r}validate(e){if(Ko(e,we.JsonPropTypes.Number),!(this.min<=e&&e<=this.max)){let r=this.min===Number.MIN_VALUE?"MIN":this.min,n=this.max===Number.MAX_VALUE?"MAX":this.max;throw new zt(`Value doesn't match to diapason [${r},${n}]`)}}},zc=class{constructor(e=Number.MIN_VALUE,r=Number.MAX_VALUE){this.min=e,this.max=r}validate(e){if(Ko(e,we.JsonPropTypes.Number),!(this.min<e&&e<this.max)){let r=this.min===Number.MIN_VALUE?"MIN":this.min,n=this.max===Number.MAX_VALUE?"MAX":this.max;throw new zt(`Value doesn't match to diapason (${r},${n})`)}}},No=class{constructor(e,r,n){this.length=e,this.minLength=r,this.maxLength=n}validate(e){if(this.length!==void 0){if(e.length!==this.length)throw new zt(`Value length must be exactly ${this.length}.`);return}if(this.minLength!==void 0&&e.length<this.minLength)throw new zt(`Value length must be more than ${this.minLength}.`);if(this.maxLength!==void 0&&e.length>this.maxLength)throw new zt(`Value length must be less than ${this.maxLength}.`)}},Xc=class{constructor(e){this.enumeration=e}validate(e){if(Ko(e,we.JsonPropTypes.String),!this.enumeration.includes(e))throw new zt(`Value must be one of ${this.enumeration.map(r=>`'${r}'`).join(", ")}`)}},Io=class{static checkValues(e,r){let n=Array.isArray(e)?e:[e];for(let s of n)for(let i of r.validations)i instanceof No&&r.repeated?i.validate(e):i.validate(s)}static checkTypes(e,r){if(r.repeated&&!Array.isArray(e))throw new TypeError("Value must be Array");if(typeof r.type=="number"){let n=Array.isArray(e)?e:[e];for(let s of n)Ko(s,r.type)}}static getSchemaByName(e,r=ei){return{...e.names[ei],...e.names[r]}}},Yc=class extends Io{static serialize(e,r,n,s){let i=this.toJSON(e,r);return JSON.stringify(i,n,s)}static toJSON(e,r={}){let n,s=r.targetSchema,i=r.schemaName||ei;if($o(e))return e.toJSON();if(Array.isArray(e)){n=[];for(let o of e)n.push(this.toJSON(o,r))}else if(typeof e=="object"){if(s&&!Wt.has(s))throw new hn("Cannot get schema for `targetSchema` param");if(s=s||e.constructor,Wt.has(s)){let o=Wt.get(s);n={};let a=this.getSchemaByName(o,i);for(let c in a)try{let l=a[c],f=e[c],u;if(l.optional&&f===void 0||l.defaultValue!==void 0&&f===l.defaultValue)continue;if(!l.optional&&f===void 0)throw new jn(s.name,`Property '${c}' is required.`);typeof l.type=="number"?l.converter?l.repeated?u=f.map(d=>l.converter.toJSON(d,e)):u=l.converter.toJSON(f,e):u=f:l.repeated?u=f.map(d=>this.toJSON(d,{schemaName:i})):u=this.toJSON(f,{schemaName:i}),this.checkTypes(u,l),this.checkValues(u,l),n[l.name||c]=u}catch(l){throw l instanceof jn?l:new jn(o.target.name,`Property '${c}' is wrong. ${l.message}`,l)}}else{n={};for(let o in e)n[o]=this.toJSON(e[o],{schemaName:i})}}else n=e;return n}},Zc=class t extends Io{static parse(e,r){let n=JSON.parse(e);return this.fromJSON(n,r)}static fromJSON(e,r){let n=r.targetSchema,s=r.schemaName||ei,i=new n;if($o(i))return i.fromJSON(e);let o=Wt.get(n),a=this.getSchemaByName(o,s),c={};r.strictProperty&&!Array.isArray(e)&&t.checkStrictProperty(e,a,o);for(let f in a)try{let u=a[f],d=u.name||f,p=e[d];if(p===void 0&&(u.optional||u.defaultValue!==void 0))continue;if(!u.optional&&p===void 0)throw new pn(o,`Property '${d}' is required.`);if(this.checkTypes(p,u),this.checkValues(p,u),typeof u.type=="number")u.converter?u.repeated?i[f]=p.map(m=>u.converter.fromJSON(m,i)):i[f]=u.converter.fromJSON(p,i):i[f]=p;else{let m={...r,targetSchema:u.type,schemaName:s};u.repeated?i[f]=p.map(g=>this.fromJSON(g,m)):i[f]=this.fromJSON(p,m)}}catch(u){if(u instanceof pn||(u=new pn(o,`Property '${f}' is wrong. ${u.message}`,u)),r.strictAllKeys)c[f]=u;else throw u}let l=Object.keys(c);if(l.length)throw new Qs(o,l,c);return i}static checkStrictProperty(e,r,n){let s=Object.keys(e),i=Object.keys(r),o=[];for(let a of s)i.indexOf(a)===-1&&o.push(a);if(o.length)throw new Qs(n,o)}};function rb(t){let e=[];return t.pattern&&e.push(new Jc(t.pattern)),(t.type===we.JsonPropTypes.Number||t.type===we.JsonPropTypes.Any)&&((t.minInclusive!==void 0||t.maxInclusive!==void 0)&&e.push(new Wc(t.minInclusive,t.maxInclusive)),(t.minExclusive!==void 0||t.maxExclusive!==void 0)&&e.push(new zc(t.minExclusive,t.maxExclusive)),t.enumeration!==void 0&&e.push(new Xc(t.enumeration))),(t.type===we.JsonPropTypes.String||t.repeated||t.type===we.JsonPropTypes.Any)&&(t.length!==void 0||t.minLength!==void 0||t.maxLength!==void 0)&&e.push(new No(t.length,t.minLength,t.maxLength)),e}var nb=(t={})=>(e,r)=>{let n=`Cannot set type for ${r} property of ${e.constructor.name} schema`,s;Wt.has(e.constructor)?(s=Wt.get(e.constructor),s.target!==e.constructor&&(s=Wt.create(e.constructor),Wt.set(e.constructor,s))):(s=Wt.create(e.constructor),Wt.set(e.constructor,s));let i={type:we.JsonPropTypes.Any,validations:[]},o=Object.assign(i,t);if(o.validations=rb(o),typeof o.type!="number"&&!Wt.has(o.type)&&!$o(o.type))throw new Error(`${n}. Assigning type doesn't have schema.`);let a;Array.isArray(t.schema)?a=t.schema:a=[t.schema||ei];for(let c of a){s.names[c]||(s.names[c]={});let l=s.names[c];l[r]=o}};we.JsonError=hn;we.JsonParser=Zc;we.JsonProp=nb;we.JsonSerializer=Yc;we.KeyError=Qs;we.ParserError=pn;we.SerializerError=jn;we.TransformError=To;we.ValidationError=zt});var Vh=w(V=>{"use strict";var F=un(),v=qc(),J=(Nn(),ss(Tn)),Ut=Qc(),sb=Er();function ib(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(r){if(r!=="default"){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}),e.default=t,Object.freeze(e)}var el=ib(sb),cr=class extends Error{},ti=class extends cr{},$t=class extends cr{constructor(e){super(`Unsupported operation: ${e?`${e}`:""}`)}},bt=class extends cr{},Uo=class extends cr{constructor(e){super(`${e}: Missing required property`)}},tl=class{static toArrayBuffer(e){let r=e.replace(/-{5}(BEGIN|END) .*-{5}/g,"").replace("\r","").replace(`
`,"");return F.Convert.FromBase64(r)}static toUint8Array(e){let r=this.toArrayBuffer(e);return new Uint8Array(r)}static fromBufferSource(e,r){let n=F.Convert.ToBase64(e),s,i=0,o=[];for(;i<n.length&&(s=n.slice(i,i+64),s.length);){o.push(s);i+=64}let a=r.toUpperCase();return`-----BEGIN ${a}-----
${o.join(`
`)}
-----END ${a}-----`}static isPEM(e){return/-----BEGIN .+-----[A-Za-z0-9+/+=\s\n]+-----END .+-----/i.test(e)}static getTagName(e){if(!this.isPEM(e))throw new Error("Bad parameter. Incoming data is not right PEM");let r=/-----BEGIN (.+)-----/.exec(e);if(!r)throw new Error("Cannot get tag from PEM");return r[1]}static hasTagName(e,r){let n=this.getTagName(e);return r.toLowerCase()===n.toLowerCase()}static isCertificate(e){return this.hasTagName(e,"certificate")}static isCertificateRequest(e){return this.hasTagName(e,"certificate request")}static isCRL(e){return this.hasTagName(e,"x509 crl")}static isPublicKey(e){return this.hasTagName(e,"public key")}};function Eh(t){return typeof t=="object"&&"kty"in t}var wt=class{async digest(...e){return this.checkDigest.apply(this,e),this.onDigest.apply(this,e)}checkDigest(e,r){this.checkAlgorithmName(e)}async onDigest(e,r){throw new $t("digest")}async generateKey(...e){return this.checkGenerateKey.apply(this,e),this.onGenerateKey.apply(this,e)}checkGenerateKey(e,r,n,...s){if(this.checkAlgorithmName(e),this.checkGenerateKeyParams(e),!(n&&n.length))throw new TypeError("Usages cannot be empty when creating a key.");let i;Array.isArray(this.usages)?i=this.usages:i=this.usages.privateKey.concat(this.usages.publicKey),this.checkKeyUsages(n,i)}checkGenerateKeyParams(e){}async onGenerateKey(e,r,n,...s){throw new $t("generateKey")}async sign(...e){return this.checkSign.apply(this,e),this.onSign.apply(this,e)}checkSign(e,r,n,...s){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(r,"sign")}async onSign(e,r,n,...s){throw new $t("sign")}async verify(...e){return this.checkVerify.apply(this,e),this.onVerify.apply(this,e)}checkVerify(e,r,n,s,...i){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(r,"verify")}async onVerify(e,r,n,s,...i){throw new $t("verify")}async encrypt(...e){return this.checkEncrypt.apply(this,e),this.onEncrypt.apply(this,e)}checkEncrypt(e,r,n,s={},...i){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(r,s.keyUsage?"encrypt":void 0)}async onEncrypt(e,r,n,...s){throw new $t("encrypt")}async decrypt(...e){return this.checkDecrypt.apply(this,e),this.onDecrypt.apply(this,e)}checkDecrypt(e,r,n,s={},...i){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(r,s.keyUsage?"decrypt":void 0)}async onDecrypt(e,r,n,...s){throw new $t("decrypt")}async deriveBits(...e){return this.checkDeriveBits.apply(this,e),this.onDeriveBits.apply(this,e)}checkDeriveBits(e,r,n,s={},...i){if(this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(r,s.keyUsage?"deriveBits":void 0),n%8!==0)throw new bt("length: Is not multiple of 8")}async onDeriveBits(e,r,n,...s){throw new $t("deriveBits")}async exportKey(...e){return this.checkExportKey.apply(this,e),this.onExportKey.apply(this,e)}checkExportKey(e,r,...n){if(this.checkKeyFormat(e),this.checkCryptoKey(r),!r.extractable)throw new cr("key: Is not extractable")}async onExportKey(e,r,...n){throw new $t("exportKey")}async importKey(...e){return this.checkImportKey.apply(this,e),this.onImportKey.apply(this,e)}checkImportKey(e,r,n,s,i,...o){this.checkKeyFormat(e),this.checkKeyData(e,r),this.checkAlgorithmName(n),this.checkImportParams(n),Array.isArray(this.usages)&&this.checkKeyUsages(i,this.usages)}async onImportKey(e,r,n,s,i,...o){throw new $t("importKey")}checkAlgorithmName(e){if(e.name.toLowerCase()!==this.name.toLowerCase())throw new ti("Unrecognized name")}checkAlgorithmParams(e){}checkDerivedKeyParams(e){}checkKeyUsages(e,r){for(let n of e)if(r.indexOf(n)===-1)throw new TypeError("Cannot create a key using the specified key usages")}checkCryptoKey(e,r){if(this.checkAlgorithmName(e.algorithm),r&&e.usages.indexOf(r)===-1)throw new cr("key does not match that of operation")}checkRequiredProperty(e,r){if(!(r in e))throw new Uo(r)}checkHashAlgorithm(e,r){for(let n of r)if(n.toLowerCase()===e.name.toLowerCase())return;throw new bt(`hash: Must be one of ${r.join(", ")}`)}checkImportParams(e){}checkKeyFormat(e){switch(e){case"raw":case"pkcs8":case"spki":case"jwk":break;default:throw new TypeError("format: Is invalid value. Must be 'jwk', 'raw', 'spki', or 'pkcs8'")}}checkKeyData(e,r){if(!r)throw new TypeError("keyData: Cannot be empty on empty on key importing");if(e==="jwk"){if(!Eh(r))throw new TypeError("keyData: Is not JsonWebToken")}else if(!F.BufferSourceConverter.isBufferSource(r))throw new TypeError("keyData: Is not ArrayBufferView or ArrayBuffer")}prepareData(e){return F.BufferSourceConverter.toArrayBuffer(e)}},xr=class extends wt{checkGenerateKeyParams(e){if(this.checkRequiredProperty(e,"length"),typeof e.length!="number")throw new TypeError("length: Is not of type Number");switch(e.length){case 128:case 192:case 256:break;default:throw new TypeError("length: Must be 128, 192, or 256")}}checkDerivedKeyParams(e){this.checkGenerateKeyParams(e)}},rl=class extends xr{constructor(){super(...arguments),this.name="AES-CBC",this.usages=["encrypt","decrypt","wrapKey","unwrapKey"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength!==16)throw new TypeError("iv: Must have length 16 bytes")}},nl=class extends xr{constructor(){super(...arguments),this.name="AES-CMAC",this.usages=["sign","verify"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"length"),typeof e.length!="number")throw new TypeError("length: Is not a Number");if(e.length<1)throw new bt("length: Must be more than 0")}},sl=class extends xr{constructor(){super(...arguments),this.name="AES-CTR",this.usages=["encrypt","decrypt","wrapKey","unwrapKey"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"counter"),!(e.counter instanceof ArrayBuffer||ArrayBuffer.isView(e.counter)))throw new TypeError("counter: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.counter.byteLength!==16)throw new TypeError("iv: Must have length 16 bytes");if(this.checkRequiredProperty(e,"length"),typeof e.length!="number")throw new TypeError("length: Is not a Number");if(e.length<1)throw new bt("length: Must be more than 0")}},il=class extends xr{constructor(){super(...arguments),this.name="AES-ECB",this.usages=["encrypt","decrypt","wrapKey","unwrapKey"]}},ol=class extends xr{constructor(){super(...arguments),this.name="AES-GCM",this.usages=["encrypt","decrypt","wrapKey","unwrapKey"]}checkAlgorithmParams(e){var r;if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength<1)throw new bt("iv: Must have length more than 0 and less than 2^64 - 1");switch((r=e.tagLength)!==null&&r!==void 0||(e.tagLength=128),e.tagLength){case 32:case 64:case 96:case 104:case 112:case 120:case 128:break;default:throw new bt("tagLength: Must be one of 32, 64, 96, 104, 112, 120 or 128")}}},al=class extends xr{constructor(){super(...arguments),this.name="AES-KW",this.usages=["wrapKey","unwrapKey"]}},cl=class extends wt{constructor(){super(...arguments),this.usages=["encrypt","decrypt","wrapKey","unwrapKey"]}checkAlgorithmParams(e){if(this.ivSize){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength!==this.ivSize)throw new TypeError(`iv: Must have length ${this.ivSize} bytes`)}}checkGenerateKeyParams(e){if(this.checkRequiredProperty(e,"length"),typeof e.length!="number")throw new TypeError("length: Is not of type Number");if(e.length!==this.keySizeBits)throw new bt(`algorithm.length: Must be ${this.keySizeBits}`)}checkDerivedKeyParams(e){this.checkGenerateKeyParams(e)}},Vn=class extends wt{constructor(){super(...arguments),this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"]}checkGenerateKeyParams(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");let r=F.Convert.ToBase64(e.publicExponent);if(!(r==="Aw=="||r==="AQAB"))throw new TypeError("publicExponent: Must be [3] or [1,0,1]");if(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength%8||e.modulusLength<256||e.modulusLength>16384)throw new TypeError("The modulus length must be a multiple of 8 bits and >= 256 and <= 16384")}checkImportParams(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}},ll=class extends Vn{constructor(){super(...arguments),this.name="RSASSA-PKCS1-v1_5",this.usages={privateKey:["sign"],publicKey:["verify"]}}},ul=class extends Vn{constructor(){super(...arguments),this.name="RSA-PSS",this.usages={privateKey:["sign"],publicKey:["verify"]}}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"saltLength"),typeof e.saltLength!="number")throw new TypeError("saltLength: Is not a Number");if(e.saltLength<0)throw new RangeError("saltLength: Must be positive number")}},fl=class extends Vn{constructor(){super(...arguments),this.name="RSA-OAEP",this.usages={privateKey:["decrypt","unwrapKey"],publicKey:["encrypt","wrapKey"]}}checkAlgorithmParams(e){if(e.label&&!(e.label instanceof ArrayBuffer||ArrayBuffer.isView(e.label)))throw new TypeError("label: Is not of type '(ArrayBuffer or ArrayBufferView)'")}},Fn=class extends wt{checkGenerateKeyParams(e){this.checkRequiredProperty(e,"namedCurve"),this.checkNamedCurve(e.namedCurve)}checkNamedCurve(e){for(let r of this.namedCurves)if(r.toLowerCase()===e.toLowerCase())return;throw new bt(`namedCurve: Must be one of ${this.namedCurves.join(", ")}`)}},dl=class extends Fn{constructor(){super(...arguments),this.name="ECDSA",this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],this.usages={privateKey:["sign"],publicKey:["verify"]},this.namedCurves=["P-256","P-384","P-521","K-256"]}checkAlgorithmParams(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}},ob=["secret","private","public"],ri=class{static create(e,r,n,s){let i=new this;return i.algorithm=e,i.type=r,i.extractable=n,i.usages=s,i}static isKeyType(e){return ob.indexOf(e)!==-1}get[Symbol.toStringTag](){return"CryptoKey"}},Do=class extends Fn{constructor(){super(...arguments),this.name="ECDH",this.usages={privateKey:["deriveBits","deriveKey"],publicKey:[]},this.namedCurves=["P-256","P-384","P-521","K-256"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"public"),!(e.public instanceof ri))throw new TypeError("public: Is not a CryptoKey");if(e.public.type!=="public")throw new bt("public: Is not a public key");if(e.public.algorithm.name!==this.name)throw new bt(`public: Is not ${this.name} key`)}},pl=class extends Do{constructor(){super(...arguments),this.name="ECDH-ES",this.namedCurves=["X25519","X448"]}},hl=class extends Fn{constructor(){super(...arguments),this.name="EdDSA",this.usages={privateKey:["sign"],publicKey:["verify"]},this.namedCurves=["Ed25519","Ed448"]}},ni=class{constructor(e){e&&(this.value=e)}};J.__decorate([v.AsnProp({type:v.AsnPropTypes.ObjectIdentifier})],ni.prototype,"value",void 0);ni=J.__decorate([v.AsnType({type:v.AsnTypeTypes.Choice})],ni);var kr=class{constructor(e){Object.assign(this,e)}};J.__decorate([v.AsnProp({type:v.AsnPropTypes.ObjectIdentifier})],kr.prototype,"algorithm",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Any,optional:!0})],kr.prototype,"parameters",void 0);var Mr=class{constructor(){this.version=0,this.privateKeyAlgorithm=new kr,this.privateKey=new ArrayBuffer(0)}};J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer})],Mr.prototype,"version",void 0);J.__decorate([v.AsnProp({type:kr})],Mr.prototype,"privateKeyAlgorithm",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.OctetString})],Mr.prototype,"privateKey",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Any,optional:!0})],Mr.prototype,"attributes",void 0);var si=class{constructor(){this.publicKeyAlgorithm=new kr,this.publicKey=new ArrayBuffer(0)}};J.__decorate([v.AsnProp({type:kr})],si.prototype,"publicKeyAlgorithm",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.BitString})],si.prototype,"publicKey",void 0);var Dt={fromJSON:t=>F.Convert.FromBase64Url(t),toJSON:t=>F.Convert.ToBase64Url(new Uint8Array(t))},Xt={fromASN:t=>{let e=t.valueBlock.valueHex;return new Uint8Array(e)[0]?t.valueBlock.valueHex:t.valueBlock.valueHex.slice(1)},toASN:t=>{let e=new Uint8Array(t)[0]>127?F.combine(new Uint8Array([0]).buffer,t):t;return new el.Integer({valueHex:e})}},ab=Object.freeze({__proto__:null,AsnIntegerArrayBufferConverter:Xt,JsonBase64UrlArrayBufferConverter:Dt}),At=class{constructor(){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0)}};J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:v.AsnIntegerConverter})],At.prototype,"version",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Xt}),Ut.JsonProp({name:"n",converter:Dt})],At.prototype,"modulus",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Xt}),Ut.JsonProp({name:"e",converter:Dt})],At.prototype,"publicExponent",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Xt}),Ut.JsonProp({name:"d",converter:Dt})],At.prototype,"privateExponent",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Xt}),Ut.JsonProp({name:"p",converter:Dt})],At.prototype,"prime1",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Xt}),Ut.JsonProp({name:"q",converter:Dt})],At.prototype,"prime2",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Xt}),Ut.JsonProp({name:"dp",converter:Dt})],At.prototype,"exponent1",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Xt}),Ut.JsonProp({name:"dq",converter:Dt})],At.prototype,"exponent2",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Xt}),Ut.JsonProp({name:"qi",converter:Dt})],At.prototype,"coefficient",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Any,optional:!0})],At.prototype,"otherPrimeInfos",void 0);var ii=class{constructor(){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0)}};J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Xt}),Ut.JsonProp({name:"n",converter:Dt})],ii.prototype,"modulus",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Xt}),Ut.JsonProp({name:"e",converter:Dt})],ii.prototype,"publicExponent",void 0);var qn=class{constructor(e){this.value=new ArrayBuffer(0),e&&(this.value=e)}toJSON(){let e=new Uint8Array(this.value);if(e[0]!==4)throw new cr("Wrong ECPoint. Current version supports only Uncompressed (0x04) point");e=new Uint8Array(this.value.slice(1));let r=e.length/2,n=0;return{x:F.Convert.ToBase64Url(e.buffer.slice(n,n+r)),y:F.Convert.ToBase64Url(e.buffer.slice(n+r,n+r+r))}}fromJSON(e){if(!("x"in e))throw new Error("x: Missing required property");if(!("y"in e))throw new Error("y: Missing required property");let r=F.Convert.FromBase64Url(e.x),n=F.Convert.FromBase64Url(e.y),s=F.combine(new Uint8Array([4]).buffer,r,n);return this.value=new Uint8Array(s).buffer,this}};J.__decorate([v.AsnProp({type:v.AsnPropTypes.OctetString})],qn.prototype,"value",void 0);qn=J.__decorate([v.AsnType({type:v.AsnTypeTypes.Choice})],qn);var mn=class{constructor(){this.version=1,this.privateKey=new ArrayBuffer(0)}fromJSON(e){if(!("d"in e))throw new Error("d: Missing required property");if(this.privateKey=F.Convert.FromBase64Url(e.d),"x"in e){let r=new qn;r.fromJSON(e);let n=v.AsnSerializer.toASN(r);"valueHex"in n.valueBlock&&(this.publicKey=n.valueBlock.valueHex)}return this}toJSON(){let e={};return e.d=F.Convert.ToBase64Url(this.privateKey),this.publicKey&&Object.assign(e,new qn(this.publicKey).toJSON()),e}};J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:v.AsnIntegerConverter})],mn.prototype,"version",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.OctetString})],mn.prototype,"privateKey",void 0);J.__decorate([v.AsnProp({context:0,type:v.AsnPropTypes.Any,optional:!0})],mn.prototype,"parameters",void 0);J.__decorate([v.AsnProp({context:1,type:v.AsnPropTypes.BitString,optional:!0})],mn.prototype,"publicKey",void 0);var Cl={fromASN:t=>{let e=new Uint8Array(t.valueBlock.valueHex);return e[0]===0?e.buffer.slice(1):e.buffer},toASN:t=>{let e=new Uint8Array(t);if(e[0]>127){let r=new Uint8Array(e.length+1);return r.set(e,1),new el.Integer({valueHex:r.buffer})}return new el.Integer({valueHex:t})}},cb=Object.freeze({__proto__:null,AsnIntegerWithoutPaddingConverter:Cl}),oi=class{static decodePoint(e,r){let n=F.BufferSourceConverter.toUint8Array(e);if(n.length===0||n[0]!==4)throw new Error("Only uncompressed point format supported");let s=(n.length-1)/2;if(s!==Math.ceil(r/8))throw new Error("Point does not match field size");let i=n.slice(1,s+1),o=n.slice(s+1,s+1+s);return{x:i,y:o}}static encodePoint(e,r){let n=Math.ceil(r/8);if(e.x.byteLength!==n||e.y.byteLength!==n)throw new Error("X,Y coordinates don't match point size criteria");let s=F.BufferSourceConverter.toUint8Array(e.x),i=F.BufferSourceConverter.toUint8Array(e.y),o=new Uint8Array(n*2+1);return o[0]=4,o.set(s,1),o.set(i,n+1),o}static getSize(e){return Math.ceil(e/8)}static encodeSignature(e,r){let n=this.getSize(r),s=F.BufferSourceConverter.toUint8Array(e.r),i=F.BufferSourceConverter.toUint8Array(e.s),o=new Uint8Array(n*2);return o.set(this.padStart(s,n)),o.set(this.padStart(i,n),n),o}static decodeSignature(e,r){let n=this.getSize(r),s=F.BufferSourceConverter.toUint8Array(e);if(s.length!==n*2)throw new Error("Incorrect size of the signature");let i=s.slice(0,n),o=s.slice(n);return{r:this.trimStart(i),s:this.trimStart(o)}}static trimStart(e){let r=0;for(;r<e.length-1&&e[r]===0;)r++;return r===0?e:e.slice(r,e.length)}static padStart(e,r){if(r===e.length)return e;let n=new Uint8Array(r);return n.set(e,r-e.length),n}},ai=class t{constructor(){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0)}static fromWebCryptoSignature(e){let r=e.byteLength/2,n=oi.decodeSignature(e,r*8),s=new t;return s.r=F.BufferSourceConverter.toArrayBuffer(n.r),s.s=F.BufferSourceConverter.toArrayBuffer(n.s),s}toWebCryptoSignature(e){if(!e){let n=Math.max(this.r.byteLength,this.s.byteLength);n<=32?e=256:n<=48?e=384:e=521}return oi.encodeSignature(this,e).buffer}};J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Cl})],ai.prototype,"r",void 0);J.__decorate([v.AsnProp({type:v.AsnPropTypes.Integer,converter:Cl})],ai.prototype,"s",void 0);var Mo=class extends Mr{};J.__decorate([v.AsnProp({context:1,implicit:!0,type:v.AsnPropTypes.BitString,optional:!0})],Mo.prototype,"publicKey",void 0);var Lo=class{constructor(){this.value=new ArrayBuffer(0)}fromJSON(e){if(!e.d)throw new Error("d: Missing required property");return this.value=F.Convert.FromBase64Url(e.d),this}toJSON(){return{d:F.Convert.ToBase64Url(this.value)}}};J.__decorate([v.AsnProp({type:v.AsnPropTypes.OctetString})],Lo.prototype,"value",void 0);Lo=J.__decorate([v.AsnType({type:v.AsnTypeTypes.Choice})],Lo);var Ho=class{constructor(e){this.value=new ArrayBuffer(0),e&&(this.value=e)}toJSON(){return{x:F.Convert.ToBase64Url(this.value)}}fromJSON(e){if(!("x"in e))throw new Error("x: Missing required property");return this.value=F.Convert.FromBase64Url(e.x),this}};J.__decorate([v.AsnProp({type:v.AsnPropTypes.BitString})],Ho.prototype,"value",void 0);Ho=J.__decorate([v.AsnType({type:v.AsnTypeTypes.Choice})],Ho);var jo=class{};J.__decorate([v.AsnProp({type:v.AsnPropTypes.OctetString}),Ut.JsonProp({type:Ut.JsonPropTypes.String,converter:Dt})],jo.prototype,"d",void 0);jo=J.__decorate([v.AsnType({type:v.AsnTypeTypes.Choice})],jo);var Ch="1.2.840.10045.3.1.7",Fo="1.3.132.0",xh=`${Fo}.34`,kh=`${Fo}.35`,Ph=`${Fo}.10`,at="1.3.36.3.3.2.8.1.1",Bh=`${at}.1`,Oh=`${at}.2`,Rh=`${at}.3`,Th=`${at}.4`,Nh=`${at}.5`,Ih=`${at}.6`,Kh=`${at}.7`,$h=`${at}.8`,Uh=`${at}.9`,Dh=`${at}.10`,Mh=`${at}.11`,Lh=`${at}.12`,Hh=`${at}.13`,jh=`${at}.14`,lb="1.3.101.110",ub="1.3.101.111",fb="1.3.101.112",db="1.3.101.113",pb=Object.freeze({__proto__:null,AlgorithmIdentifier:kr,get CurvePrivateKey(){return jo},EcDsaSignature:ai,EcPrivateKey:mn,get EcPublicKey(){return qn},get EdPrivateKey(){return Lo},get EdPublicKey(){return Ho},get ObjectIdentifier(){return ni},OneAsymmetricKey:Mo,PrivateKeyInfo:Mr,PublicKeyInfo:si,RsaPrivateKey:At,RsaPublicKey:ii,converters:cb,idBrainpoolP160r1:Bh,idBrainpoolP160t1:Oh,idBrainpoolP192r1:Rh,idBrainpoolP192t1:Th,idBrainpoolP224r1:Nh,idBrainpoolP224t1:Ih,idBrainpoolP256r1:Kh,idBrainpoolP256t1:$h,idBrainpoolP320r1:Uh,idBrainpoolP320t1:Dh,idBrainpoolP384r1:Mh,idBrainpoolP384t1:Lh,idBrainpoolP512r1:Hh,idBrainpoolP512t1:jh,idEd25519:fb,idEd448:db,idEllipticCurve:Fo,idSecp256k1:Ph,idSecp256r1:Ch,idSecp384r1:xh,idSecp521r1:kh,idVersionOne:at,idX25519:lb,idX448:ub}),Ce=class{constructor(){}static register(e){let r=new ni;r.value=e.id;let n=v.AsnConvert.serialize(r);this.items.push({...e,raw:n}),this.names.push(e.name)}static find(e){e=e.toUpperCase();for(let r of this.items)if(r.name.toUpperCase()===e||r.id.toUpperCase()===e)return r;return null}static get(e){let r=this.find(e);if(!r)throw new Error(`Unsupported EC named curve '${e}'`);return r}};Ce.items=[];Ce.names=[];Ce.register({name:"P-256",id:Ch,size:256});Ce.register({name:"P-384",id:xh,size:384});Ce.register({name:"P-521",id:kh,size:521});Ce.register({name:"K-256",id:Ph,size:256});Ce.register({name:"brainpoolP160r1",id:Bh,size:160});Ce.register({name:"brainpoolP160t1",id:Oh,size:160});Ce.register({name:"brainpoolP192r1",id:Rh,size:192});Ce.register({name:"brainpoolP192t1",id:Th,size:192});Ce.register({name:"brainpoolP224r1",id:Nh,size:224});Ce.register({name:"brainpoolP224t1",id:Ih,size:224});Ce.register({name:"brainpoolP256r1",id:Kh,size:256});Ce.register({name:"brainpoolP256t1",id:$h,size:256});Ce.register({name:"brainpoolP320r1",id:Uh,size:320});Ce.register({name:"brainpoolP320t1",id:Dh,size:320});Ce.register({name:"brainpoolP384r1",id:Mh,size:384});Ce.register({name:"brainpoolP384t1",id:Lh,size:384});Ce.register({name:"brainpoolP512r1",id:Hh,size:512});Ce.register({name:"brainpoolP512t1",id:jh,size:512});var ml=class extends wt{constructor(){super(...arguments),this.name="X25519",this.usages={privateKey:["deriveKey","deriveBits"],publicKey:[]}}checkAlgorithmParams(e){this.checkRequiredProperty(e,"public")}},yl=class extends wt{constructor(){super(...arguments),this.name="Ed25519",this.usages={privateKey:["sign"],publicKey:["verify"]}}},gl=class extends wt{constructor(){super(...arguments),this.name="HMAC",this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],this.usages=["sign","verify"]}getDefaultLength(e){switch(e.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":return 512;default:throw new Error(`Unknown algorithm name '${e}'`)}}checkGenerateKeyParams(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),"length"in e){if(typeof e.length!="number")throw new TypeError("length: Is not a Number");if(e.length<1)throw new RangeError("length: Number is out of range")}}checkImportParams(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}},_l=class extends wt{constructor(){super(...arguments),this.name="PBKDF2",this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],this.usages=["deriveBits","deriveKey"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"salt"),!(e.salt instanceof ArrayBuffer||ArrayBuffer.isView(e.salt)))throw new TypeError("salt: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(this.checkRequiredProperty(e,"iterations"),typeof e.iterations!="number")throw new TypeError("iterations: Is not a Number");if(e.iterations<1)throw new TypeError("iterations: Is less than 1")}checkImportKey(e,r,n,s,i,...o){if(super.checkImportKey(e,r,n,s,i,...o),s)throw new SyntaxError("extractable: Must be 'false'")}},bl=class extends wt{constructor(){super(...arguments),this.name="HKDF",this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],this.usages=["deriveKey","deriveBits"]}checkAlgorithmParams(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"salt"),!F.BufferSourceConverter.isBufferSource(e.salt))throw new TypeError("salt: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(this.checkRequiredProperty(e,"info"),!F.BufferSourceConverter.isBufferSource(e.info))throw new TypeError("salt: Is not of type '(ArrayBuffer or ArrayBufferView)'")}checkImportKey(e,r,n,s,i,...o){if(super.checkImportKey(e,r,n,s,i,...o),s)throw new SyntaxError("extractable: Must be 'false'")}},ci=class extends wt{constructor(){super(...arguments),this.usages=[],this.defaultLength=0}digest(...e){return e[0]={length:this.defaultLength,...e[0]},super.digest.apply(this,e)}checkDigest(e,r){super.checkDigest(e,r);let n=e.length||0;if(typeof n!="number")throw new TypeError("length: Is not a Number");if(n<0)throw new TypeError("length: Is negative")}},wl=class extends ci{constructor(){super(...arguments),this.name="shake128",this.defaultLength=16}},Al=class extends ci{constructor(){super(...arguments),this.name="shake256",this.defaultLength=32}},vl=class{get[Symbol.toStringTag](){return"Crypto"}randomUUID(){let e=this.getRandomValues(new Uint8Array(16));e[6]=e[6]&15|64,e[8]=e[8]&63|128;let r=F.Convert.ToHex(e).toLowerCase();return`${r.substring(0,8)}-${r.substring(8,12)}-${r.substring(12,16)}-${r.substring(16,20)}-${r.substring(20)}`}},Vo=class{constructor(){this.items={}}get(e){return this.items[e.toLowerCase()]||null}set(e){this.items[e.name.toLowerCase()]=e}removeAt(e){let r=this.get(e.toLowerCase());return r&&delete this.items[e],r}has(e){return!!this.get(e)}get length(){return Object.keys(this.items).length}get algorithms(){let e=[];for(let r in this.items){let n=this.items[r];e.push(n.name)}return e.sort()}},Sh={jwk:["private","public","secret"],pkcs8:["private"],spki:["public"],raw:["secret","public"]},hb=["pkcs8","spki","raw"],Sl=class t{constructor(){this.providers=new Vo}static isHashedAlgorithm(e){return!!(e&&typeof e=="object"&&"name"in e&&"hash"in e)}get[Symbol.toStringTag](){return"SubtleCrypto"}async digest(...e){this.checkRequiredArguments(e,2,"digest");let[r,n,...s]=e,i=this.prepareAlgorithm(r),o=F.BufferSourceConverter.toArrayBuffer(n);return await this.getProvider(i.name).digest(i,o,...s)}async generateKey(...e){this.checkRequiredArguments(e,3,"generateKey");let[r,n,s,...i]=e,o=this.prepareAlgorithm(r),a=this.getProvider(o.name);return await a.generateKey({...o,name:a.name},n,s,...i)}async sign(...e){this.checkRequiredArguments(e,3,"sign");let[r,n,s,...i]=e;this.checkCryptoKey(n);let o=this.prepareAlgorithm(r),a=F.BufferSourceConverter.toArrayBuffer(s),c=this.getProvider(o.name);return await c.sign({...o,name:c.name},n,a,...i)}async verify(...e){this.checkRequiredArguments(e,4,"verify");let[r,n,s,i,...o]=e;this.checkCryptoKey(n);let a=this.prepareAlgorithm(r),c=F.BufferSourceConverter.toArrayBuffer(i),l=F.BufferSourceConverter.toArrayBuffer(s),f=this.getProvider(a.name);return await f.verify({...a,name:f.name},n,l,c,...o)}async encrypt(...e){this.checkRequiredArguments(e,3,"encrypt");let[r,n,s,...i]=e;this.checkCryptoKey(n);let o=this.prepareAlgorithm(r),a=F.BufferSourceConverter.toArrayBuffer(s),c=this.getProvider(o.name);return await c.encrypt({...o,name:c.name},n,a,{keyUsage:!0},...i)}async decrypt(...e){this.checkRequiredArguments(e,3,"decrypt");let[r,n,s,...i]=e;this.checkCryptoKey(n);let o=this.prepareAlgorithm(r),a=F.BufferSourceConverter.toArrayBuffer(s),c=this.getProvider(o.name);return await c.decrypt({...o,name:c.name},n,a,{keyUsage:!0},...i)}async deriveBits(...e){this.checkRequiredArguments(e,3,"deriveBits");let[r,n,s,...i]=e;this.checkCryptoKey(n);let o=this.prepareAlgorithm(r),a=this.getProvider(o.name);return await a.deriveBits({...o,name:a.name},n,s,{keyUsage:!0},...i)}async deriveKey(...e){this.checkRequiredArguments(e,5,"deriveKey");let[r,n,s,i,o,...a]=e,c=this.prepareAlgorithm(s);this.getProvider(c.name).checkDerivedKeyParams(c);let f=this.prepareAlgorithm(r),u=this.getProvider(f.name);u.checkCryptoKey(n,"deriveKey");let d=await u.deriveBits({...f,name:u.name},n,s.length||512,{keyUsage:!1},...a);return this.importKey("raw",d,s,i,o,...a)}async exportKey(...e){this.checkRequiredArguments(e,2,"exportKey");let[r,n,...s]=e;if(this.checkCryptoKey(n),!Sh[r])throw new TypeError("Invalid keyFormat argument");if(!Sh[r].includes(n.type))throw new DOMException("The key is not of the expected type");return await this.getProvider(n.algorithm.name).exportKey(r,n,...s)}async importKey(...e){this.checkRequiredArguments(e,5,"importKey");let[r,n,s,i,o,...a]=e,c=this.prepareAlgorithm(s),l=this.getProvider(c.name);if(r==="jwk"){if(typeof n!="object"||!n.kty)throw new TypeError("Key data must be an object for JWK import")}else if(hb.includes(r)){if(!F.BufferSourceConverter.isBufferSource(n))throw new TypeError("Key data must be a BufferSource for non-JWK formats")}else throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView or JsonWebKey)'");return l.importKey(r,n,{...c,name:l.name},i,o,...a)}async wrapKey(e,r,n,s,...i){let o=await this.exportKey(e,r,...i);if(e==="jwk"){let f=JSON.stringify(o);o=F.Convert.FromUtf8String(f)}let a=this.prepareAlgorithm(s),c=F.BufferSourceConverter.toArrayBuffer(o),l=this.getProvider(a.name);return l.encrypt({...a,name:l.name},n,c,{keyUsage:!1},...i)}async unwrapKey(e,r,n,s,i,o,a,...c){let l=this.prepareAlgorithm(s),f=F.BufferSourceConverter.toArrayBuffer(r),u=this.getProvider(l.name),d=await u.decrypt({...l,name:u.name},n,f,{keyUsage:!1},...c);if(e==="jwk")try{d=JSON.parse(F.Convert.ToUtf8String(d))}catch(p){let m=new TypeError("wrappedKey: Is not a JSON");throw m.internal=p,m}return this.importKey(e,d,i,o,a,...c)}checkRequiredArguments(e,r,n){if(e.length<r)throw new TypeError(`Failed to execute '${n}' on 'SubtleCrypto': ${r} arguments required, but only ${e.length} present`)}prepareAlgorithm(e){if(typeof e=="string")return{name:e};if(t.isHashedAlgorithm(e)){let r={...e};return r.hash=this.prepareAlgorithm(e.hash),r}return{...e}}getProvider(e){let r=this.providers.get(e);if(!r)throw new ti("Unrecognized name");return r}checkCryptoKey(e){if(!(e instanceof ri))throw new TypeError("Key is not of type 'CryptoKey'")}},mb=Object.freeze({__proto__:null,converters:ab}),yb=["crv","e","k","kty","n","x","y"],El=class{static async thumbprint(e,r,n){let s=this.format(r,!0);return n.subtle.digest(e,F.Convert.FromBinary(JSON.stringify(s)))}static format(e,r=!1){let n=Object.entries(e);return r&&(n=n.filter(s=>yb.includes(s[0]))),n=n.sort(([s],[i])=>s>i?1:s<i?-1:0),Object.fromEntries(n)}};Object.defineProperty(V,"BufferSourceConverter",{enumerable:!0,get:function(){return F.BufferSourceConverter}});V.AesCbcProvider=rl;V.AesCmacProvider=nl;V.AesCtrProvider=sl;V.AesEcbProvider=il;V.AesGcmProvider=ol;V.AesKwProvider=al;V.AesProvider=xr;V.AlgorithmError=ti;V.Crypto=vl;V.CryptoError=cr;V.CryptoKey=ri;V.DesProvider=cl;V.EcCurves=Ce;V.EcUtils=oi;V.EcdhEsProvider=pl;V.EcdhProvider=Do;V.EcdsaProvider=dl;V.Ed25519Provider=yl;V.EdDsaProvider=hl;V.EllipticProvider=Fn;V.HkdfProvider=bl;V.HmacProvider=gl;V.JwkUtils=El;V.OperationError=bt;V.Pbkdf2Provider=_l;V.PemConverter=tl;V.ProviderCrypto=wt;V.ProviderStorage=Vo;V.RequiredPropertyError=Uo;V.RsaOaepProvider=fl;V.RsaProvider=Vn;V.RsaPssProvider=ul;V.RsaSsaProvider=ll;V.Shake128Provider=wl;V.Shake256Provider=Al;V.ShakeProvider=ci;V.SubtleCrypto=Sl;V.UnsupportedOperationError=$t;V.X25519Provider=ml;V.asn1=pb;V.isJWK=Eh;V.json=mb});var Yh=w(au=>{"use strict";var li=Vh(),b=require("buffer"),k=require("crypto"),gb=require("process"),_n=(Nn(),ss(Tn)),z=Qc(),Ht=un(),I=qc();function Jh(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(r){if(r!=="default"){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}),e.default=t,Object.freeze(e)}var y=Jh(li),_b=Jh(gb),iu={fromJSON:t=>b.Buffer.from(Ht.Convert.FromBase64Url(t)),toJSON:t=>Ht.Convert.ToBase64Url(t)},jt=class extends y.CryptoKey{constructor(){super(...arguments),this.data=b.Buffer.alloc(0),this.algorithm={name:""},this.extractable=!1,this.type="secret",this.usages=[],this.kty="oct",this.alg=""}};_n.__decorate([z.JsonProp({name:"ext",type:z.JsonPropTypes.Boolean,optional:!0})],jt.prototype,"extractable",void 0);_n.__decorate([z.JsonProp({name:"key_ops",type:z.JsonPropTypes.String,repeated:!0,optional:!0})],jt.prototype,"usages",void 0);_n.__decorate([z.JsonProp({type:z.JsonPropTypes.String})],jt.prototype,"kty",void 0);_n.__decorate([z.JsonProp({type:z.JsonPropTypes.String,optional:!0})],jt.prototype,"alg",void 0);var qo=class extends jt{constructor(){super(...arguments),this.kty="oct",this.type="secret"}},Lr=class extends jt{},ft=class extends qo{get alg(){switch(this.algorithm.name.toUpperCase()){case"AES-CBC":return`A${this.algorithm.length}CBC`;case"AES-CTR":return`A${this.algorithm.length}CTR`;case"AES-GCM":return`A${this.algorithm.length}GCM`;case"AES-KW":return`A${this.algorithm.length}KW`;case"AES-CMAC":return`A${this.algorithm.length}CMAC`;case"AES-ECB":return`A${this.algorithm.length}ECB`;default:throw new y.AlgorithmError("Unsupported algorithm name")}}set alg(e){}};_n.__decorate([z.JsonProp({name:"k",converter:iu})],ft.prototype,"data",void 0);var ee=class{static async generateKey(e,r,n){let s=new ft;return s.algorithm=e,s.extractable=r,s.usages=n,s.data=k.randomBytes(e.length>>3),s}static async exportKey(e,r){if(!(r instanceof ft))throw new Error("key: Is not AesCryptoKey");switch(e.toLowerCase()){case"jwk":return z.JsonSerializer.toJSON(r);case"raw":return new Uint8Array(r.data).buffer;default:throw new y.OperationError("format: Must be 'jwk' or 'raw'")}}static async importKey(e,r,n,s,i){let o;switch(e.toLowerCase()){case"jwk":o=z.JsonParser.fromJSON(r,{targetSchema:ft});break;case"raw":o=new ft,o.data=b.Buffer.from(r);break;default:throw new y.OperationError("format: Must be 'jwk' or 'raw'")}switch(o.algorithm=n,o.algorithm.length=o.data.length<<3,o.extractable=s,o.usages=i,o.algorithm.length){case 128:case 192:case 256:break;default:throw new y.OperationError("keyData: Is wrong key length")}return o}static async encrypt(e,r,n){switch(e.name.toUpperCase()){case"AES-CBC":return this.encryptAesCBC(e,r,b.Buffer.from(n));case"AES-CTR":return this.encryptAesCTR(e,r,b.Buffer.from(n));case"AES-GCM":return this.encryptAesGCM(e,r,b.Buffer.from(n));case"AES-KW":return this.encryptAesKW(e,r,b.Buffer.from(n));case"AES-ECB":return this.encryptAesECB(e,r,b.Buffer.from(n));default:throw new y.OperationError("algorithm: Is not recognized")}}static async decrypt(e,r,n){if(!(r instanceof ft))throw new Error("key: Is not AesCryptoKey");switch(e.name.toUpperCase()){case"AES-CBC":return this.decryptAesCBC(e,r,b.Buffer.from(n));case"AES-CTR":return this.decryptAesCTR(e,r,b.Buffer.from(n));case"AES-GCM":return this.decryptAesGCM(e,r,b.Buffer.from(n));case"AES-KW":return this.decryptAesKW(e,r,b.Buffer.from(n));case"AES-ECB":return this.decryptAesECB(e,r,b.Buffer.from(n));default:throw new y.OperationError("algorithm: Is not recognized")}}static async encryptAesCBC(e,r,n){let s=k.createCipheriv(`aes-${r.algorithm.length}-cbc`,r.data,new Uint8Array(e.iv)),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}static async decryptAesCBC(e,r,n){let s=k.createDecipheriv(`aes-${r.algorithm.length}-cbc`,r.data,new Uint8Array(e.iv)),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}static async encryptAesCTR(e,r,n){let s=k.createCipheriv(`aes-${r.algorithm.length}-ctr`,r.data,b.Buffer.from(e.counter)),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}static async decryptAesCTR(e,r,n){let s=k.createDecipheriv(`aes-${r.algorithm.length}-ctr`,r.data,new Uint8Array(e.counter)),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}static async encryptAesGCM(e,r,n){let s=k.createCipheriv(`aes-${r.algorithm.length}-gcm`,r.data,b.Buffer.from(e.iv),{authTagLength:(e.tagLength||128)>>3});e.additionalData&&s.setAAD(b.Buffer.from(e.additionalData));let i=s.update(n);return i=b.Buffer.concat([i,s.final(),s.getAuthTag()]),new Uint8Array(i).buffer}static async decryptAesGCM(e,r,n){let s=(e.tagLength||128)>>3,i=k.createDecipheriv(`aes-${r.algorithm.length}-gcm`,r.data,new Uint8Array(e.iv),{authTagLength:s}),o=n.slice(0,n.length-s),a=n.slice(n.length-s);e.additionalData&&i.setAAD(b.Buffer.from(e.additionalData)),i.setAuthTag(a);let c=i.update(o);return c=b.Buffer.concat([c,i.final()]),new Uint8Array(c).buffer}static async encryptAesKW(e,r,n){let s=k.createCipheriv(`id-aes${r.algorithm.length}-wrap`,r.data,this.AES_KW_IV),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}static async decryptAesKW(e,r,n){let s=k.createDecipheriv(`id-aes${r.algorithm.length}-wrap`,r.data,this.AES_KW_IV),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}static async encryptAesECB(e,r,n){let s=k.createCipheriv(`aes-${r.algorithm.length}-ecb`,r.data,new Uint8Array(0)),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}static async decryptAesECB(e,r,n){let s=k.createDecipheriv(`aes-${r.algorithm.length}-ecb`,r.data,new Uint8Array(0)),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}};ee.AES_KW_IV=b.Buffer.from("A6A6A6A6A6A6A6A6","hex");var Wh=new WeakMap;function S(t){let e=Wh.get(t);if(!e)throw new y.OperationError("Cannot get CryptoKey from secure storage");return e}function K(t){let e=y.CryptoKey.create(t.algorithm,t.type,t.extractable,t.usages);return Object.freeze(e),Wh.set(e,t),e}var xl=class extends y.AesCbcProvider{async onGenerateKey(e,r,n){let s=await ee.generateKey({name:this.name,length:e.length},r,n);return K(s)}async onEncrypt(e,r,n){return ee.encrypt(e,S(r),new Uint8Array(n))}async onDecrypt(e,r,n){return ee.decrypt(e,S(r),new Uint8Array(n))}async onExportKey(e,r){return ee.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await ee.importKey(e,r,{name:n.name},s,i);return K(o)}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof ft))throw new TypeError("key: Is not a AesCryptoKey")}},ou=b.Buffer.from([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Fh=b.Buffer.from([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,135]),gn=16;function qh(t){let e=b.Buffer.alloc(t.length),r=t.length-1;for(let n=0;n<r;n++)e[n]=t[n]<<1,t[n+1]&128&&(e[n]+=1);return e[r]=t[r]<<1,e}function Gn(t,e){let r=Math.min(t.length,e.length),n=b.Buffer.alloc(r);for(let s=0;s<r;s++)n[s]=t[s]^e[s];return n}function kl(t,e){let r=k.createCipheriv(`aes${t.length<<3}`,t,ou),n=r.update(e);return r.final(),n}function Gh(t,e){let r=b.Buffer.alloc(gn),n=e*gn,s=n+gn;return t.copy(r,0,n,s),r}function bb(t,e){let r=b.Buffer.alloc(gn),n=e*gn,s=t.length;return r.fill(0),t.copy(r,0,n,s),r[s-n]=128,r}function wb(t){let e=kl(t,ou),r=qh(e);e[0]&128&&(r=Gn(r,Fh));let n=qh(r);return r[0]&128&&(n=Gn(n,Fh)),{subkey1:r,subkey2:n}}function Ab(t,e){let r=wb(t),n=Math.ceil(e.length/gn),s,i;n===0?(n=1,s=!1):s=e.length%gn===0;let o=n-1;s?i=Gn(Gh(e,o),r.subkey1):i=Gn(bb(e,o),r.subkey2);let a=ou,c;for(let l=0;l<o;l++)c=Gn(a,Gh(e,l)),a=kl(t,c);return c=Gn(i,a),kl(t,c)}var Pl=class extends y.AesCmacProvider{async onGenerateKey(e,r,n){let s=await ee.generateKey({name:this.name,length:e.length},r,n);return K(s)}async onSign(e,r,n){let s=Ab(S(r).data,b.Buffer.from(n));return new Uint8Array(s).buffer}async onVerify(e,r,n,s){let i=await this.sign(e,r,s);return b.Buffer.from(n).compare(b.Buffer.from(i))===0}async onExportKey(e,r){return ee.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await ee.importKey(e,r,{name:n.name},s,i);return K(o)}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof ft))throw new TypeError("key: Is not a AesCryptoKey")}},Bl=class extends y.AesCtrProvider{async onGenerateKey(e,r,n){let s=await ee.generateKey({name:this.name,length:e.length},r,n);return K(s)}async onEncrypt(e,r,n){return ee.encrypt(e,S(r),new Uint8Array(n))}async onDecrypt(e,r,n){return ee.decrypt(e,S(r),new Uint8Array(n))}async onExportKey(e,r){return ee.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await ee.importKey(e,r,{name:n.name},s,i);return K(o)}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof ft))throw new TypeError("key: Is not a AesCryptoKey")}},Ol=class extends y.AesGcmProvider{async onGenerateKey(e,r,n){let s=await ee.generateKey({name:this.name,length:e.length},r,n);return K(s)}async onEncrypt(e,r,n){return ee.encrypt(e,S(r),new Uint8Array(n))}async onDecrypt(e,r,n){return ee.decrypt(e,S(r),new Uint8Array(n))}async onExportKey(e,r){return ee.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await ee.importKey(e,r,{name:n.name},s,i);return K(o)}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof ft))throw new TypeError("key: Is not a AesCryptoKey")}},Rl=class extends y.AesKwProvider{async onGenerateKey(e,r,n){let s=await ee.generateKey({name:this.name,length:e.length},r,n);return K(s)}async onExportKey(e,r){return ee.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await ee.importKey(e,r,{name:n.name},s,i);return K(o)}async onEncrypt(e,r,n){return ee.encrypt(e,S(r),new Uint8Array(n))}async onDecrypt(e,r,n){return ee.decrypt(e,S(r),new Uint8Array(n))}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof ft))throw new TypeError("key: Is not a AesCryptoKey")}},Tl=class extends y.AesEcbProvider{async onGenerateKey(e,r,n){let s=await ee.generateKey({name:this.name,length:e.length},r,n);return K(s)}async onEncrypt(e,r,n){return ee.encrypt(e,S(r),new Uint8Array(n))}async onDecrypt(e,r,n){return ee.decrypt(e,S(r),new Uint8Array(n))}async onExportKey(e,r){return ee.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await ee.importKey(e,r,{name:n.name},s,i);return K(o)}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof ft))throw new TypeError("key: Is not a AesCryptoKey")}},Pr=class extends qo{get alg(){switch(this.algorithm.name.toUpperCase()){case"DES-CBC":return"DES-CBC";case"DES-EDE3-CBC":return"3DES-CBC";default:throw new y.AlgorithmError("Unsupported algorithm name")}}set alg(e){}};_n.__decorate([z.JsonProp({name:"k",converter:iu})],Pr.prototype,"data",void 0);var Mt=class{static async generateKey(e,r,n){let s=new Pr;return s.algorithm=e,s.extractable=r,s.usages=n,s.data=k.randomBytes(e.length>>3),s}static async exportKey(e,r){switch(e.toLowerCase()){case"jwk":return z.JsonSerializer.toJSON(r);case"raw":return new Uint8Array(r.data).buffer;default:throw new y.OperationError("format: Must be 'jwk' or 'raw'")}}static async importKey(e,r,n,s,i){let o;switch(e.toLowerCase()){case"jwk":o=z.JsonParser.fromJSON(r,{targetSchema:Pr});break;case"raw":o=new Pr,o.data=b.Buffer.from(r);break;default:throw new y.OperationError("format: Must be 'jwk' or 'raw'")}return o.algorithm=n,o.extractable=s,o.usages=i,o}static async encrypt(e,r,n){switch(e.name.toUpperCase()){case"DES-CBC":return this.encryptDesCBC(e,r,b.Buffer.from(n));case"DES-EDE3-CBC":return this.encryptDesEDE3CBC(e,r,b.Buffer.from(n));default:throw new y.OperationError("algorithm: Is not recognized")}}static async decrypt(e,r,n){if(!(r instanceof Pr))throw new Error("key: Is not DesCryptoKey");switch(e.name.toUpperCase()){case"DES-CBC":return this.decryptDesCBC(e,r,b.Buffer.from(n));case"DES-EDE3-CBC":return this.decryptDesEDE3CBC(e,r,b.Buffer.from(n));default:throw new y.OperationError("algorithm: Is not recognized")}}static async encryptDesCBC(e,r,n){let s=k.createCipheriv("des-cbc",r.data,new Uint8Array(e.iv)),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}static async decryptDesCBC(e,r,n){let s=k.createDecipheriv("des-cbc",r.data,new Uint8Array(e.iv)),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}static async encryptDesEDE3CBC(e,r,n){let s=k.createCipheriv("des-ede3-cbc",r.data,b.Buffer.from(e.iv)),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}static async decryptDesEDE3CBC(e,r,n){let s=k.createDecipheriv("des-ede3-cbc",r.data,new Uint8Array(e.iv)),i=s.update(n);return i=b.Buffer.concat([i,s.final()]),new Uint8Array(i).buffer}},Nl=class extends y.DesProvider{constructor(){super(...arguments),this.keySizeBits=64,this.ivSize=8,this.name="DES-CBC"}async onGenerateKey(e,r,n){let s=await Mt.generateKey({name:this.name,length:this.keySizeBits},r,n);return K(s)}async onEncrypt(e,r,n){return Mt.encrypt(e,S(r),new Uint8Array(n))}async onDecrypt(e,r,n){return Mt.decrypt(e,S(r),new Uint8Array(n))}async onExportKey(e,r){return Mt.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await Mt.importKey(e,r,{name:this.name,length:this.keySizeBits},s,i);if(o.data.length!==this.keySizeBits>>3)throw new y.OperationError("keyData: Wrong key size");return K(o)}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof Pr))throw new TypeError("key: Is not a DesCryptoKey")}},Il=class extends y.DesProvider{constructor(){super(...arguments),this.keySizeBits=192,this.ivSize=8,this.name="DES-EDE3-CBC"}async onGenerateKey(e,r,n){let s=await Mt.generateKey({name:this.name,length:this.keySizeBits},r,n);return K(s)}async onEncrypt(e,r,n){return Mt.encrypt(e,S(r),new Uint8Array(n))}async onDecrypt(e,r,n){return Mt.decrypt(e,S(r),new Uint8Array(n))}async onExportKey(e,r){return Mt.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await Mt.importKey(e,r,{name:this.name,length:this.keySizeBits},s,i);if(o.data.length!==this.keySizeBits>>3)throw new y.OperationError("keyData: Wrong key size");return K(o)}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof Pr))throw new TypeError("key: Is not a DesCryptoKey")}};function zh(t){switch(t.name.toUpperCase()){case"RSA-OAEP":{let e=/(\d+)$/.exec(t.hash.name)[1];return`RSA-OAEP${e!=="1"?`-${e}`:""}`}case"RSASSA-PKCS1-V1_5":return`RS${/(\d+)$/.exec(t.hash.name)[1]}`;case"RSA-PSS":return`PS${/(\d+)$/.exec(t.hash.name)[1]}`;case"RSA-PKCS1":return"RS1";default:throw new y.OperationError("algorithm: Is not recognized")}}var Hr=class extends Lr{constructor(){super(...arguments),this.type="private"}getKey(){let e=I.AsnParser.parse(this.data,y.asn1.PrivateKeyInfo);return I.AsnParser.parse(e.privateKey,y.asn1.RsaPrivateKey)}toJSON(){let e=this.getKey(),r={kty:"RSA",alg:zh(this.algorithm),key_ops:this.usages,ext:this.extractable};return Object.assign(r,z.JsonSerializer.toJSON(e))}fromJSON(e){let r=z.JsonParser.fromJSON(e,{targetSchema:y.asn1.RsaPrivateKey}),n=new y.asn1.PrivateKeyInfo;n.privateKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",n.privateKeyAlgorithm.parameters=null,n.privateKey=I.AsnSerializer.serialize(r),this.data=b.Buffer.from(I.AsnSerializer.serialize(n))}},jr=class extends Lr{constructor(){super(...arguments),this.type="public"}getKey(){let e=I.AsnParser.parse(this.data,y.asn1.PublicKeyInfo);return I.AsnParser.parse(e.publicKey,y.asn1.RsaPublicKey)}toJSON(){let e=this.getKey(),r={kty:"RSA",alg:zh(this.algorithm),key_ops:this.usages,ext:this.extractable};return Object.assign(r,z.JsonSerializer.toJSON(e))}fromJSON(e){let r=z.JsonParser.fromJSON(e,{targetSchema:y.asn1.RsaPublicKey}),n=new y.asn1.PublicKeyInfo;n.publicKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",n.publicKeyAlgorithm.parameters=null,n.publicKey=I.AsnSerializer.serialize(r),this.data=b.Buffer.from(I.AsnSerializer.serialize(n))}},Ne=class{static async generateKey(e,r,n){let s=new Hr;s.algorithm=e,s.extractable=r,s.usages=n.filter(l=>this.privateKeyUsages.indexOf(l)!==-1);let i=new jr;i.algorithm=e,i.extractable=!0,i.usages=n.filter(l=>this.publicKeyUsages.indexOf(l)!==-1);let o=b.Buffer.concat([b.Buffer.alloc(4-e.publicExponent.byteLength,0),b.Buffer.from(e.publicExponent)]).readInt32BE(0),a=k.generateKeyPairSync("rsa",{modulusLength:e.modulusLength,publicExponent:o,publicKeyEncoding:{format:"der",type:"spki"},privateKeyEncoding:{format:"der",type:"pkcs8"}});return s.data=a.privateKey,i.data=a.publicKey,{privateKey:s,publicKey:i}}static async exportKey(e,r){switch(e.toLowerCase()){case"jwk":return z.JsonSerializer.toJSON(r);case"pkcs8":case"spki":return new Uint8Array(r.data).buffer;default:throw new y.OperationError("format: Must be 'jwk', 'pkcs8' or 'spki'")}}static async importKey(e,r,n,s,i){switch(e.toLowerCase()){case"jwk":if(r.d){let a=z.JsonParser.fromJSON(r,{targetSchema:y.asn1.RsaPrivateKey});return this.importPrivateKey(a,n,s,i)}else{let a=z.JsonParser.fromJSON(r,{targetSchema:y.asn1.RsaPublicKey});return this.importPublicKey(a,n,s,i)}case"spki":{let o=I.AsnParser.parse(new Uint8Array(r),y.asn1.PublicKeyInfo),a=I.AsnParser.parse(o.publicKey,y.asn1.RsaPublicKey);return this.importPublicKey(a,n,s,i)}case"pkcs8":{let o=I.AsnParser.parse(new Uint8Array(r),y.asn1.PrivateKeyInfo),a=I.AsnParser.parse(o.privateKey,y.asn1.RsaPrivateKey);return this.importPrivateKey(a,n,s,i)}default:throw new y.OperationError("format: Must be 'jwk', 'pkcs8' or 'spki'")}}static async sign(e,r,n){switch(e.name.toUpperCase()){case"RSA-PSS":case"RSASSA-PKCS1-V1_5":return this.signRsa(e,r,n);default:throw new y.OperationError("algorithm: Is not recognized")}}static async verify(e,r,n,s){switch(e.name.toUpperCase()){case"RSA-PSS":case"RSASSA-PKCS1-V1_5":return this.verifySSA(e,r,s,n);default:throw new y.OperationError("algorithm: Is not recognized")}}static async encrypt(e,r,n){switch(e.name.toUpperCase()){case"RSA-OAEP":return this.encryptOAEP(e,r,n);default:throw new y.OperationError("algorithm: Is not recognized")}}static async decrypt(e,r,n){switch(e.name.toUpperCase()){case"RSA-OAEP":return this.decryptOAEP(e,r,n);default:throw new y.OperationError("algorithm: Is not recognized")}}static importPrivateKey(e,r,n,s){let i=new y.asn1.PrivateKeyInfo;i.privateKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",i.privateKeyAlgorithm.parameters=null,i.privateKey=I.AsnSerializer.serialize(e);let o=new Hr;return o.data=b.Buffer.from(I.AsnSerializer.serialize(i)),o.algorithm=Object.assign({},r),o.algorithm.publicExponent=new Uint8Array(e.publicExponent),o.algorithm.modulusLength=e.modulus.byteLength<<3,o.extractable=n,o.usages=s,o}static importPublicKey(e,r,n,s){let i=new y.asn1.PublicKeyInfo;i.publicKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",i.publicKeyAlgorithm.parameters=null,i.publicKey=I.AsnSerializer.serialize(e);let o=new jr;return o.data=b.Buffer.from(I.AsnSerializer.serialize(i)),o.algorithm=Object.assign({},r),o.algorithm.publicExponent=new Uint8Array(e.publicExponent),o.algorithm.modulusLength=e.modulus.byteLength<<3,o.extractable=n,o.usages=s,o}static getCryptoAlgorithm(e){switch(e.hash.name.toUpperCase()){case"SHA-1":return"RSA-SHA1";case"SHA-256":return"RSA-SHA256";case"SHA-384":return"RSA-SHA384";case"SHA-512":return"RSA-SHA512";case"SHA3-256":return"RSA-SHA3-256";case"SHA3-384":return"RSA-SHA3-384";case"SHA3-512":return"RSA-SHA3-512";default:throw new y.OperationError("algorithm.hash: Is not recognized")}}static signRsa(e,r,n){let s=this.getCryptoAlgorithm(r.algorithm),i=k.createSign(s);i.update(b.Buffer.from(n)),r.pem||(r.pem=`-----BEGIN PRIVATE KEY-----
${r.data.toString("base64")}
-----END PRIVATE KEY-----`);let o={key:r.pem};e.name.toUpperCase()==="RSA-PSS"&&(o.padding=k.constants.RSA_PKCS1_PSS_PADDING,o.saltLength=e.saltLength);let a=i.sign(o);return new Uint8Array(a).buffer}static verifySSA(e,r,n,s){let i=this.getCryptoAlgorithm(r.algorithm),o=k.createVerify(i);o.update(b.Buffer.from(n)),r.pem||(r.pem=`-----BEGIN PUBLIC KEY-----
${r.data.toString("base64")}
-----END PUBLIC KEY-----`);let a={key:r.pem};return e.name.toUpperCase()==="RSA-PSS"&&(a.padding=k.constants.RSA_PKCS1_PSS_PADDING,a.saltLength=e.saltLength),o.verify(a,s)}static encryptOAEP(e,r,n){let s={key:`-----BEGIN PUBLIC KEY-----
${r.data.toString("base64")}
-----END PUBLIC KEY-----`,padding:k.constants.RSA_PKCS1_OAEP_PADDING};return e.label,new Uint8Array(k.publicEncrypt(s,n)).buffer}static decryptOAEP(e,r,n){let s={key:`-----BEGIN PRIVATE KEY-----
${r.data.toString("base64")}
-----END PRIVATE KEY-----`,padding:k.constants.RSA_PKCS1_OAEP_PADDING};return e.label,new Uint8Array(k.privateDecrypt(s,n)).buffer}};Ne.publicKeyUsages=["verify","encrypt","wrapKey"];Ne.privateKeyUsages=["sign","decrypt","unwrapKey"];var Kl=class extends y.RsaSsaProvider{constructor(){super(...arguments),this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512","shake128","shake256","SHA3-256","SHA3-384","SHA3-512"]}async onGenerateKey(e,r,n){let s=await Ne.generateKey({...e,name:this.name},r,n);return{privateKey:K(s.privateKey),publicKey:K(s.publicKey)}}async onSign(e,r,n){return Ne.sign(e,S(r),new Uint8Array(n))}async onVerify(e,r,n,s){return Ne.verify(e,S(r),new Uint8Array(n),new Uint8Array(s))}async onExportKey(e,r){return Ne.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await Ne.importKey(e,r,{...n,name:this.name},s,i);return K(o)}checkCryptoKey(e,r){super.checkCryptoKey(e,r);let n=S(e);if(!(n instanceof Hr||n instanceof jr))throw new TypeError("key: Is not RSA CryptoKey")}},$l=class extends y.RsaPssProvider{constructor(){super(...arguments),this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512","shake128","shake256","SHA3-256","SHA3-384","SHA3-512"]}async onGenerateKey(e,r,n){let s=await Ne.generateKey({...e,name:this.name},r,n);return{privateKey:K(s.privateKey),publicKey:K(s.publicKey)}}async onSign(e,r,n){return Ne.sign(e,S(r),new Uint8Array(n))}async onVerify(e,r,n,s){return Ne.verify(e,S(r),new Uint8Array(n),new Uint8Array(s))}async onExportKey(e,r){return Ne.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await Ne.importKey(e,r,{...n,name:this.name},s,i);return K(o)}checkCryptoKey(e,r){super.checkCryptoKey(e,r);let n=S(e);if(!(n instanceof Hr||n instanceof jr))throw new TypeError("key: Is not RSA CryptoKey")}},Qe=class{static size(e){switch(e.name.toUpperCase()){case"SHA-1":return 160;case"SHA-256":case"SHA3-256":return 256;case"SHA-384":case"SHA3-384":return 384;case"SHA-512":case"SHA3-512":return 512;default:throw new Error("Unrecognized name")}}static getAlgorithmName(e){switch(e.name.toUpperCase()){case"SHA-1":return"sha1";case"SHA-256":return"sha256";case"SHA-384":return"sha384";case"SHA-512":return"sha512";case"SHA3-256":return"sha3-256";case"SHA3-384":return"sha3-384";case"SHA3-512":return"sha3-512";default:throw new Error("Unrecognized name")}}static digest(e,r){let n=this.getAlgorithmName(e),s=k.createHash(n).update(b.Buffer.from(r)).digest();return new Uint8Array(s).buffer}},Ul=class extends y.RsaOaepProvider{async onGenerateKey(e,r,n){let s=await Ne.generateKey({...e,name:this.name},r,n);return{privateKey:K(s.privateKey),publicKey:K(s.publicKey)}}async onEncrypt(e,r,n){let s=S(r),i=new Uint8Array(n),o=Math.ceil(s.algorithm.modulusLength>>3),a=Qe.size(s.algorithm.hash)>>3,c=i.byteLength,l=o-c-2*a-2;if(c>o-2*a-2)throw new Error("Data too large");let f=new Uint8Array(o),u=f.subarray(1,a+1),d=f.subarray(a+1);d.set(i,a+l+1);let p=k.createHash(s.algorithm.hash.name.replace("-","")).update(y.BufferSourceConverter.toUint8Array(e.label||new Uint8Array(0))).digest();d.set(p,0),d[a+l]=1,k.randomFillSync(u);let m=this.mgf1(s.algorithm.hash,u,d.length);for(let x=0;x<d.length;x++)d[x]^=m[x];let g=this.mgf1(s.algorithm.hash,d,u.length);for(let x=0;x<u.length;x++)u[x]^=g[x];s.pem||(s.pem=`-----BEGIN PUBLIC KEY-----
${s.data.toString("base64")}
-----END PUBLIC KEY-----`);let _=k.publicEncrypt({key:s.pem,padding:k.constants.RSA_NO_PADDING},b.Buffer.from(f));return new Uint8Array(_).buffer}async onDecrypt(e,r,n){let s=S(r),i=Math.ceil(s.algorithm.modulusLength>>3),o=Qe.size(s.algorithm.hash)>>3;if(n.byteLength!==i)throw new Error("Bad data");s.pem||(s.pem=`-----BEGIN PRIVATE KEY-----
${s.data.toString("base64")}
-----END PRIVATE KEY-----`);let c=k.privateDecrypt({key:s.pem,padding:k.constants.RSA_NO_PADDING},b.Buffer.from(n)),l=c[0],f=c.subarray(1,o+1),u=c.subarray(o+1);if(l!==0)throw new Error("Decryption failed");let d=this.mgf1(s.algorithm.hash,u,f.length);for(let _=0;_<f.length;_++)f[_]^=d[_];let p=this.mgf1(s.algorithm.hash,f,u.length);for(let _=0;_<u.length;_++)u[_]^=p[_];let m=k.createHash(s.algorithm.hash.name.replace("-","")).update(y.BufferSourceConverter.toUint8Array(e.label||new Uint8Array(0))).digest();for(let _=0;_<o;_++)if(m[_]!==u[_])throw new Error("Decryption failed");let g=o;for(;g<u.length;g++){let _=u[g];if(_===1)break;if(_!==0)throw new Error("Decryption failed")}if(g===u.length)throw new Error("Decryption failed");return c=u.subarray(g+1),new Uint8Array(c).buffer}async onExportKey(e,r){return Ne.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await Ne.importKey(e,r,{...n,name:this.name},s,i);return K(o)}checkCryptoKey(e,r){super.checkCryptoKey(e,r);let n=S(e);if(!(n instanceof Hr||n instanceof jr))throw new TypeError("key: Is not RSA CryptoKey")}mgf1(e,r,n=0){let s=Qe.size(e)>>3,i=new Uint8Array(n),o=new Uint8Array(4),a=Math.ceil(n/s);for(let c=0;c<a;c++){o[0]=c>>>24,o[1]=c>>>16&255,o[2]=c>>>8&255,o[3]=c&255;let l=i.subarray(c*s),f=k.createHash(e.name.replace("-","")).update(r).update(o).digest();f.length>l.length&&(f=f.subarray(0,l.length)),l.set(f)}return i}},Dl=class extends y.ProviderCrypto{constructor(){super(...arguments),this.name="RSAES-PKCS1-v1_5",this.usages={publicKey:["encrypt","wrapKey"],privateKey:["decrypt","unwrapKey"]}}async onGenerateKey(e,r,n){let s=await Ne.generateKey({...e,name:this.name},r,n);return{privateKey:K(s.privateKey),publicKey:K(s.publicKey)}}checkGenerateKeyParams(e){if(this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");let r=Ht.Convert.ToBase64(e.publicExponent);if(!(r==="Aw=="||r==="AQAB"))throw new TypeError("publicExponent: Must be [3] or [1,0,1]");switch(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength){case 1024:case 2048:case 4096:break;default:throw new TypeError("modulusLength: Must be 1024, 2048, or 4096")}}async onEncrypt(e,r,n){let s=this.toCryptoOptions(r),i=k.publicEncrypt(s,new Uint8Array(n));return new Uint8Array(i).buffer}async onDecrypt(e,r,n){let s=this.toCryptoOptions(r),i=k.privateDecrypt(s,new Uint8Array(n));return new Uint8Array(i).buffer}async onExportKey(e,r){return Ne.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await Ne.importKey(e,r,{...n,name:this.name},s,i);return K(o)}checkCryptoKey(e,r){super.checkCryptoKey(e,r);let n=S(e);if(!(n instanceof Hr||n instanceof jr))throw new TypeError("key: Is not RSA CryptoKey")}toCryptoOptions(e){let r=e.type.toUpperCase();return{key:`-----BEGIN ${r} KEY-----
${S(e).data.toString("base64")}
-----END ${r} KEY-----`,padding:k.constants.RSA_PKCS1_PADDING}}},vb={"1.2.840.10045.3.1.7":"P-256","P-256":"1.2.840.10045.3.1.7","1.3.132.0.34":"P-384","P-384":"1.3.132.0.34","1.3.132.0.35":"P-521","P-521":"1.3.132.0.35","1.3.132.0.10":"K-256","K-256":"1.3.132.0.10",brainpoolP160r1:"1.3.36.3.3.2.8.1.1.1","1.3.36.3.3.2.8.1.1.1":"brainpoolP160r1",brainpoolP160t1:"1.3.36.3.3.2.8.1.1.2","1.3.36.3.3.2.8.1.1.2":"brainpoolP160t1",brainpoolP192r1:"1.3.36.3.3.2.8.1.1.3","1.3.36.3.3.2.8.1.1.3":"brainpoolP192r1",brainpoolP192t1:"1.3.36.3.3.2.8.1.1.4","1.3.36.3.3.2.8.1.1.4":"brainpoolP192t1",brainpoolP224r1:"1.3.36.3.3.2.8.1.1.5","1.3.36.3.3.2.8.1.1.5":"brainpoolP224r1",brainpoolP224t1:"1.3.36.3.3.2.8.1.1.6","1.3.36.3.3.2.8.1.1.6":"brainpoolP224t1",brainpoolP256r1:"1.3.36.3.3.2.8.1.1.7","1.3.36.3.3.2.8.1.1.7":"brainpoolP256r1",brainpoolP256t1:"1.3.36.3.3.2.8.1.1.8","1.3.36.3.3.2.8.1.1.8":"brainpoolP256t1",brainpoolP320r1:"1.3.36.3.3.2.8.1.1.9","1.3.36.3.3.2.8.1.1.9":"brainpoolP320r1",brainpoolP320t1:"1.3.36.3.3.2.8.1.1.10","1.3.36.3.3.2.8.1.1.10":"brainpoolP320t1",brainpoolP384r1:"1.3.36.3.3.2.8.1.1.11","1.3.36.3.3.2.8.1.1.11":"brainpoolP384r1",brainpoolP384t1:"1.3.36.3.3.2.8.1.1.12","1.3.36.3.3.2.8.1.1.12":"brainpoolP384t1",brainpoolP512r1:"1.3.36.3.3.2.8.1.1.13","1.3.36.3.3.2.8.1.1.13":"brainpoolP512r1",brainpoolP512t1:"1.3.36.3.3.2.8.1.1.14","1.3.36.3.3.2.8.1.1.14":"brainpoolP512t1"};function ui(t){let e=vb[t];if(!e)throw new y.OperationError(`Cannot convert WebCrypto named curve '${t}' to OID`);return e}var Wn=class extends Lr{constructor(){super(...arguments),this.type="private"}getKey(){let e=I.AsnParser.parse(this.data,y.asn1.PrivateKeyInfo);return I.AsnParser.parse(e.privateKey,y.asn1.EcPrivateKey)}toJSON(){let e=this.getKey(),r={kty:"EC",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(r,z.JsonSerializer.toJSON(e))}fromJSON(e){if(!e.crv)throw new y.OperationError("Cannot get named curve from JWK. Property 'crv' is required");let r=new y.asn1.PrivateKeyInfo;r.privateKeyAlgorithm.algorithm="1.2.840.10045.2.1",r.privateKeyAlgorithm.parameters=I.AsnSerializer.serialize(new y.asn1.ObjectIdentifier(ui(e.crv)));let n=z.JsonParser.fromJSON(e,{targetSchema:y.asn1.EcPrivateKey});return r.privateKey=I.AsnSerializer.serialize(n),this.data=b.Buffer.from(I.AsnSerializer.serialize(r)),this}},zn=class extends Lr{constructor(){super(...arguments),this.type="public"}getKey(){let e=I.AsnParser.parse(this.data,y.asn1.PublicKeyInfo);return new y.asn1.EcPublicKey(e.publicKey)}toJSON(){let e=this.getKey(),r={kty:"EC",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(r,z.JsonSerializer.toJSON(e))}fromJSON(e){if(!e.crv)throw new y.OperationError("Cannot get named curve from JWK. Property 'crv' is required");let r=z.JsonParser.fromJSON(e,{targetSchema:y.asn1.EcPublicKey}),n=new y.asn1.PublicKeyInfo;return n.publicKeyAlgorithm.algorithm="1.2.840.10045.2.1",n.publicKeyAlgorithm.parameters=I.AsnSerializer.serialize(new y.asn1.ObjectIdentifier(ui(e.crv))),n.publicKey=I.AsnSerializer.toASN(r).valueHex,this.data=b.Buffer.from(I.AsnSerializer.serialize(n)),this}},Ml=class extends y.ProviderCrypto{constructor(){super(...arguments),this.name="SHA-1",this.usages=[]}async onDigest(e,r){return Qe.digest(e,r)}},Ll=class extends y.ProviderCrypto{constructor(){super(...arguments),this.name="SHA-256",this.usages=[]}async onDigest(e,r){return Qe.digest(e,r)}},Hl=class extends y.ProviderCrypto{constructor(){super(...arguments),this.name="SHA-384",this.usages=[]}async onDigest(e,r){return Qe.digest(e,r)}},jl=class extends y.ProviderCrypto{constructor(){super(...arguments),this.name="SHA-512",this.usages=[]}async onDigest(e,r){return Qe.digest(e,r)}},Vl=class extends y.ProviderCrypto{constructor(){super(...arguments),this.name="SHA3-256",this.usages=[]}async onDigest(e,r){return Qe.digest(e,r)}},Fl=class extends y.ProviderCrypto{constructor(){super(...arguments),this.name="SHA3-384",this.usages=[]}async onDigest(e,r){return Qe.digest(e,r)}},ql=class extends y.ProviderCrypto{constructor(){super(...arguments),this.name="SHA3-512",this.usages=[]}async onDigest(e,r){return Qe.digest(e,r)}},vt=class{static async generateKey(e,r,n){let s=new Wn;s.algorithm=e,s.extractable=r,s.usages=n.filter(c=>this.privateKeyUsages.indexOf(c)!==-1);let i=new zn;i.algorithm=e,i.extractable=!0,i.usages=n.filter(c=>this.publicKeyUsages.indexOf(c)!==-1);let o=k.generateKeyPairSync("ec",{namedCurve:this.getOpenSSLNamedCurve(e.namedCurve),publicKeyEncoding:{format:"der",type:"spki"},privateKeyEncoding:{format:"der",type:"pkcs8"}});return s.data=o.privateKey,i.data=o.publicKey,{privateKey:s,publicKey:i}}static async sign(e,r,n){let s=Qe.getAlgorithmName(e.hash),i=k.createSign(s);i.update(b.Buffer.from(n)),r.pem||(r.pem=`-----BEGIN PRIVATE KEY-----
${r.data.toString("base64")}
-----END PRIVATE KEY-----`);let o={key:r.pem},a=i.sign(o),c=I.AsnParser.parse(a,y.asn1.EcDsaSignature);return y.EcUtils.encodeSignature(c,y.EcCurves.get(r.algorithm.namedCurve).size).buffer}static async verify(e,r,n,s){let i=Qe.getAlgorithmName(e.hash),o=k.createVerify(i);o.update(b.Buffer.from(s)),r.pem||(r.pem=`-----BEGIN PUBLIC KEY-----
${r.data.toString("base64")}
-----END PUBLIC KEY-----`);let a={key:r.pem},c=new y.asn1.EcDsaSignature,l=y.EcCurves.get(r.algorithm.namedCurve),f=y.EcUtils.decodeSignature(n,l.size);c.r=Ht.BufferSourceConverter.toArrayBuffer(f.r),c.s=Ht.BufferSourceConverter.toArrayBuffer(f.s);let u=b.Buffer.from(I.AsnSerializer.serialize(c));return o.verify(a,u)}static async deriveBits(e,r,n){let s=this.getOpenSSLNamedCurve(r.algorithm.namedCurve),i=k.createECDH(s),o=I.AsnParser.parse(r.data,y.asn1.PrivateKeyInfo),a=I.AsnParser.parse(o.privateKey,y.asn1.EcPrivateKey);i.setPrivateKey(b.Buffer.from(a.privateKey));let c=I.AsnParser.parse(e.public.data,y.asn1.PublicKeyInfo),l=i.computeSecret(b.Buffer.from(c.publicKey));return n===null?l:new Uint8Array(l).buffer.slice(0,n>>3)}static async exportKey(e,r){switch(e.toLowerCase()){case"jwk":return z.JsonSerializer.toJSON(r);case"pkcs8":case"spki":return new Uint8Array(r.data).buffer;case"raw":return I.AsnParser.parse(r.data,y.asn1.PublicKeyInfo).publicKey;default:throw new y.OperationError("format: Must be 'jwk', 'raw', pkcs8' or 'spki'")}}static async importKey(e,r,n,s,i){switch(e.toLowerCase()){case"jwk":if(r.d){let a=z.JsonParser.fromJSON(r,{targetSchema:y.asn1.EcPrivateKey});return this.importPrivateKey(a,n,s,i)}else{let a=z.JsonParser.fromJSON(r,{targetSchema:y.asn1.EcPublicKey});return this.importPublicKey(a,n,s,i)}case"raw":{let o=new y.asn1.EcPublicKey(r);return this.importPublicKey(o,n,s,i)}case"spki":{let o=I.AsnParser.parse(new Uint8Array(r),y.asn1.PublicKeyInfo),a=new y.asn1.EcPublicKey(o.publicKey);return this.assertKeyParameters(o.publicKeyAlgorithm.parameters,n.namedCurve),this.importPublicKey(a,n,s,i)}case"pkcs8":{let o=I.AsnParser.parse(new Uint8Array(r),y.asn1.PrivateKeyInfo),a=I.AsnParser.parse(o.privateKey,y.asn1.EcPrivateKey);return this.assertKeyParameters(o.privateKeyAlgorithm.parameters,n.namedCurve),this.importPrivateKey(a,n,s,i)}default:throw new y.OperationError("format: Must be 'jwk', 'raw', 'pkcs8' or 'spki'")}}static assertKeyParameters(e,r){if(!e)throw new y.CryptoError("Key info doesn't have required parameters");let n="";try{n=I.AsnParser.parse(e,y.asn1.ObjectIdentifier).value}catch{throw new y.CryptoError("Cannot read key info parameters")}if(ui(r)!==n)throw new y.CryptoError("Key info parameter doesn't match to named curve")}static async importPrivateKey(e,r,n,s){let i=new y.asn1.PrivateKeyInfo;i.privateKeyAlgorithm.algorithm="1.2.840.10045.2.1",i.privateKeyAlgorithm.parameters=I.AsnSerializer.serialize(new y.asn1.ObjectIdentifier(ui(r.namedCurve))),i.privateKey=I.AsnSerializer.serialize(e);let o=new Wn;return o.data=b.Buffer.from(I.AsnSerializer.serialize(i)),o.algorithm=Object.assign({},r),o.extractable=n,o.usages=s,o}static async importPublicKey(e,r,n,s){let i=new y.asn1.PublicKeyInfo;i.publicKeyAlgorithm.algorithm="1.2.840.10045.2.1";let o=ui(r.namedCurve);i.publicKeyAlgorithm.parameters=I.AsnSerializer.serialize(new y.asn1.ObjectIdentifier(o)),i.publicKey=e.value;let a=new zn;return a.data=b.Buffer.from(I.AsnSerializer.serialize(i)),a.algorithm=Object.assign({},r),a.extractable=n,a.usages=s,a}static getOpenSSLNamedCurve(e){switch(e.toUpperCase()){case"P-256":return"prime256v1";case"K-256":return"secp256k1";case"P-384":return"secp384r1";case"P-521":return"secp521r1";default:return e}}};vt.publicKeyUsages=["verify"];vt.privateKeyUsages=["sign","deriveKey","deriveBits"];var Gl=class extends y.EcdsaProvider{constructor(){super(...arguments),this.namedCurves=y.EcCurves.names,this.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512","shake128","shake256","SHA3-256","SHA3-384","SHA3-512"]}async onGenerateKey(e,r,n){let s=await vt.generateKey({...e,name:this.name},r,n);return{privateKey:K(s.privateKey),publicKey:K(s.publicKey)}}async onSign(e,r,n){return vt.sign(e,S(r),new Uint8Array(n))}async onVerify(e,r,n,s){return vt.verify(e,S(r),new Uint8Array(n),new Uint8Array(s))}async onExportKey(e,r){return vt.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await vt.importKey(e,r,{...n,name:this.name},s,i);return K(o)}checkCryptoKey(e,r){super.checkCryptoKey(e,r);let n=S(e);if(!(n instanceof Wn||n instanceof zn))throw new TypeError("key: Is not EC CryptoKey")}},Jl=class extends y.EcdhProvider{constructor(){super(...arguments),this.namedCurves=y.EcCurves.names}async onGenerateKey(e,r,n){let s=await vt.generateKey({...e,name:this.name},r,n);return{privateKey:K(s.privateKey),publicKey:K(s.publicKey)}}async onExportKey(e,r){return vt.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await vt.importKey(e,r,{...n,name:this.name},s,i);return K(o)}checkCryptoKey(e,r){super.checkCryptoKey(e,r);let n=S(e);if(!(n instanceof Wn||n instanceof zn))throw new TypeError("key: Is not EC CryptoKey")}async onDeriveBits(e,r,n){return await vt.deriveBits({...e,public:S(e.public)},S(r),n)}},Sb={[y.asn1.idEd448]:"Ed448",ed448:y.asn1.idEd448,[y.asn1.idX448]:"X448",x448:y.asn1.idX448,[y.asn1.idEd25519]:"Ed25519",ed25519:y.asn1.idEd25519,[y.asn1.idX25519]:"X25519",x25519:y.asn1.idX25519};function Xh(t){let e=Sb[t.toLowerCase()];if(!e)throw new y.OperationError(`Cannot convert WebCrypto named curve '${t}' to OID`);return e}var Go=class extends Lr{constructor(){super(...arguments),this.type="private"}getKey(){let e=I.AsnParser.parse(this.data,y.asn1.PrivateKeyInfo);return I.AsnParser.parse(e.privateKey,y.asn1.CurvePrivateKey)}toJSON(){let e=this.getKey(),r={kty:"OKP",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(r,z.JsonSerializer.toJSON(e))}fromJSON(e){if(!e.crv)throw new y.OperationError("Cannot get named curve from JWK. Property 'crv' is required");let r=new y.asn1.PrivateKeyInfo;r.privateKeyAlgorithm.algorithm=Xh(e.crv);let n=z.JsonParser.fromJSON(e,{targetSchema:y.asn1.CurvePrivateKey});return r.privateKey=I.AsnSerializer.serialize(n),this.data=b.Buffer.from(I.AsnSerializer.serialize(r)),this}},Jo=class extends Lr{constructor(){super(...arguments),this.type="public"}getKey(){return I.AsnParser.parse(this.data,y.asn1.PublicKeyInfo).publicKey}toJSON(){let e=this.getKey(),r={kty:"OKP",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(r,{x:Ht.Convert.ToBase64Url(e)})}fromJSON(e){if(!e.crv)throw new y.OperationError("Cannot get named curve from JWK. Property 'crv' is required");if(!e.x)throw new y.OperationError("Cannot get property from JWK. Property 'x' is required");let r=new y.asn1.PublicKeyInfo;return r.publicKeyAlgorithm.algorithm=Xh(e.crv),r.publicKey=Ht.Convert.FromBase64Url(e.x),this.data=b.Buffer.from(I.AsnSerializer.serialize(r)),this}},St=class{static async generateKey(e,r,n){let s=new Go;s.algorithm=e,s.extractable=r,s.usages=n.filter(l=>this.privateKeyUsages.indexOf(l)!==-1);let i=new Jo;i.algorithm=e,i.extractable=!0,i.usages=n.filter(l=>this.publicKeyUsages.indexOf(l)!==-1);let o=e.namedCurve.toLowerCase(),a=k.generateKeyPairSync(o,{publicKeyEncoding:{format:"der",type:"spki"},privateKeyEncoding:{format:"der",type:"pkcs8"}});return s.data=a.privateKey,i.data=a.publicKey,{privateKey:s,publicKey:i}}static async sign(e,r,n){r.pem||(r.pem=`-----BEGIN PRIVATE KEY-----
${r.data.toString("base64")}
-----END PRIVATE KEY-----`);let s={key:r.pem},i=k.sign(null,b.Buffer.from(n),s);return y.BufferSourceConverter.toArrayBuffer(i)}static async verify(e,r,n,s){r.pem||(r.pem=`-----BEGIN PUBLIC KEY-----
${r.data.toString("base64")}
-----END PUBLIC KEY-----`);let i={key:r.pem};return k.verify(null,b.Buffer.from(s),i,b.Buffer.from(n))}static async deriveBits(e,r,n){let s=k.createPublicKey({key:e.public.data,format:"der",type:"spki"}),i=k.createPrivateKey({key:r.data,format:"der",type:"pkcs8"}),o=k.diffieHellman({publicKey:s,privateKey:i});return new Uint8Array(o).buffer.slice(0,n>>3)}static async exportKey(e,r){switch(e.toLowerCase()){case"jwk":return z.JsonSerializer.toJSON(r);case"pkcs8":case"spki":return new Uint8Array(r.data).buffer;case"raw":return I.AsnParser.parse(r.data,y.asn1.PublicKeyInfo).publicKey;default:throw new y.OperationError("format: Must be 'jwk', 'raw', pkcs8' or 'spki'")}}static async importKey(e,r,n,s,i){switch(e.toLowerCase()){case"jwk":{let o=r;if(o.d){let a=z.JsonParser.fromJSON(r,{targetSchema:y.asn1.CurvePrivateKey});return this.importPrivateKey(a,n,s,i)}else{if(!o.x)throw new TypeError("keyData: Cannot get required 'x' filed");return this.importPublicKey(Ht.Convert.FromBase64Url(o.x),n,s,i)}}case"raw":return this.importPublicKey(r,n,s,i);case"spki":{let o=I.AsnParser.parse(new Uint8Array(r),y.asn1.PublicKeyInfo);return this.importPublicKey(o.publicKey,n,s,i)}case"pkcs8":{let o=I.AsnParser.parse(new Uint8Array(r),y.asn1.PrivateKeyInfo),a=I.AsnParser.parse(o.privateKey,y.asn1.CurvePrivateKey);return this.importPrivateKey(a,n,s,i)}default:throw new y.OperationError("format: Must be 'jwk', 'raw', 'pkcs8' or 'spki'")}}static importPrivateKey(e,r,n,s){let i=new Go;return i.fromJSON({crv:r.namedCurve,d:Ht.Convert.ToBase64Url(e.d)}),i.algorithm=Object.assign({},r),i.extractable=n,i.usages=s,i}static async importPublicKey(e,r,n,s){let i=new Jo;return i.fromJSON({crv:r.namedCurve,x:Ht.Convert.ToBase64Url(e)}),i.algorithm=Object.assign({},r),i.extractable=n,i.usages=s,i}};St.publicKeyUsages=["verify"];St.privateKeyUsages=["sign","deriveKey","deriveBits"];var Wl=class extends y.EdDsaProvider{async onGenerateKey(e,r,n){let s=await St.generateKey({name:this.name,namedCurve:e.namedCurve.replace(/^ed/i,"Ed")},r,n);return{privateKey:K(s.privateKey),publicKey:K(s.publicKey)}}async onSign(e,r,n){return St.sign(e,S(r),new Uint8Array(n))}async onVerify(e,r,n,s){return St.verify(e,S(r),new Uint8Array(n),new Uint8Array(s))}async onExportKey(e,r){return St.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await St.importKey(e,r,{...n,name:this.name},s,i);return K(o)}},zl=class extends y.EcdhEsProvider{async onGenerateKey(e,r,n){let s=await St.generateKey({name:this.name,namedCurve:e.namedCurve.toUpperCase()},r,n);return{privateKey:K(s.privateKey),publicKey:K(s.publicKey)}}async onDeriveBits(e,r,n){return await St.deriveBits({...e,public:S(e.public)},S(r),n)}async onExportKey(e,r){return St.exportKey(e,S(r))}async onImportKey(e,r,n,s,i){let o=await St.importKey(e,r,{...n,name:this.name},s,i);return K(o)}},di=class extends jt{constructor(e,r,n,s){super(),this.algorithm=e,this.extractable=r,this.usages=n,this.data=Buffer.from(s)}toJWK(){return{kty:"OKP",crv:this.algorithm.name,key_ops:this.usages,ext:this.extractable}}},fi=class extends di{constructor(){super(...arguments),this.type="private"}toJWK(){let e=k.createPublicKey({key:this.data,format:"pem"}).export({format:"jwk"}),r=y.PemConverter.toUint8Array(this.data.toString()),n=I.AsnConvert.parse(r,y.asn1.PrivateKeyInfo),s=I.AsnConvert.parse(n.privateKey,y.asn1.EdPrivateKey).value;return{...super.toJWK(),...e,d:Buffer.from(new Uint8Array(s)).toString("base64url")}}},Jn=class extends di{constructor(){super(...arguments),this.type="public"}toJWK(){let e=k.createPublicKey({key:this.data,format:"pem"}).export({format:"jwk"});return{...super.toJWK(),...e}}},Lt=class{static async generateKey(e,r,n){let s=e.name.toLowerCase(),i=k.generateKeyPairSync(s,{publicKeyEncoding:{format:"pem",type:"spki"},privateKeyEncoding:{format:"pem",type:"pkcs8"}}),o={name:s==="ed25519"?"Ed25519":"X25519"},a=n.filter(l=>this.privateKeyUsages.includes(l)),c=n.filter(l=>this.publicKeyUsages.includes(l));return{privateKey:new fi(o,r,a,i.privateKey),publicKey:new Jn(o,!0,c,i.publicKey)}}static async sign(e,r,n){let s=k.sign(null,Buffer.from(n),r.data);return y.BufferSourceConverter.toArrayBuffer(s)}static async verify(e,r,n,s){return k.verify(null,Buffer.from(s),r.data,n)}static async exportKey(e,r){switch(e){case"jwk":return r.toJWK();case"pkcs8":return y.PemConverter.toArrayBuffer(r.data.toString());case"spki":return y.PemConverter.toArrayBuffer(r.data.toString());case"raw":{let n=r.toJWK();return Ht.Convert.FromBase64Url(n.x)}default:return Promise.reject(new y.OperationError("format: Must be 'jwk', 'raw', pkcs8' or 'spki'"))}}static async importKey(e,r,n,s,i){switch(e){case"jwk":{let o=r;if(o.d){let a=new y.asn1.EdPrivateKey;a.value=y.BufferSourceConverter.toArrayBuffer(Buffer.from(o.d,"base64url"));let c=new y.asn1.PrivateKeyInfo;c.privateKeyAlgorithm.algorithm=n.name.toLowerCase()==="ed25519"?y.asn1.idEd25519:y.asn1.idX25519,c.privateKey=I.AsnConvert.serialize(a);let l=I.AsnConvert.serialize(c),f=y.PemConverter.fromBufferSource(l,"PRIVATE KEY");return new fi(n,s,i,f)}else if(o.x){let c=k.createPublicKey({format:"jwk",key:o}).export({format:"pem",type:"spki"});return new Jn(n,s,i,c)}else throw new y.OperationError("keyData: Cannot import JWK. 'd' or 'x' must be presented")}case"pkcs8":{let o=y.PemConverter.fromBufferSource(r,"PRIVATE KEY");return new fi(n,s,i,o)}case"spki":{let o=y.PemConverter.fromBufferSource(r,"PUBLIC KEY");return new Jn(n,s,i,o)}case"raw":{let o=r,c=k.createPublicKey({format:"jwk",key:{kty:"OKP",crv:n.name.toLowerCase()==="ed25519"?"Ed25519":"X25519",x:Ht.Convert.ToBase64Url(o)}}).export({format:"pem",type:"spki"});return new Jn(n,s,i,c)}default:return Promise.reject(new y.OperationError("format: Must be 'jwk', 'raw', pkcs8' or 'spki'"))}}};Lt.privateKeyUsages=["sign","deriveBits","deriveKey"];Lt.publicKeyUsages=["verify"];var Xl=class extends y.Ed25519Provider{async onGenerateKey(e,r,n){let s=await Lt.generateKey(e,r,n);return{privateKey:K(s.privateKey),publicKey:K(s.publicKey)}}async onSign(e,r,n){let s=S(r);return Lt.sign(e,s,new Uint8Array(n))}onVerify(e,r,n,s){let i=S(r);return Lt.verify(e,i,new Uint8Array(n),new Uint8Array(s))}async onExportKey(e,r){let n=S(r);return Lt.exportKey(e,n)}async onImportKey(e,r,n,s,i){let o=await Lt.importKey(e,r,n,s,i);return K(o)}},Yl=class extends y.X25519Provider{async onGenerateKey(e,r,n){let s=await Lt.generateKey(e,r,n);return{privateKey:K(s.privateKey),publicKey:K(s.publicKey)}}async onDeriveBits(e,r,n){let s=S(r),i=S(e.public),o=k.createPublicKey({key:i.data.toString(),format:"pem",type:"spki"}),a=k.createPrivateKey({key:s.data.toString(),format:"pem",type:"pkcs8"}),c=k.diffieHellman({publicKey:o,privateKey:a});return new Uint8Array(c).buffer.slice(0,n>>3)}async onExportKey(e,r){let n=S(r);return Lt.exportKey(e,n)}async onImportKey(e,r,n,s,i){let o=await Lt.importKey(e,r,n,s,i);return K(o)}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof di))throw new TypeError("key: Is not a Ed25519CryptoKey")}},Wo=class extends jt{},Zl=class extends y.Pbkdf2Provider{async onDeriveBits(e,r,n){return new Promise((s,i)=>{let o=y.BufferSourceConverter.toArrayBuffer(e.salt),a=e.hash.name.replace("-","");k.pbkdf2(S(r).data,b.Buffer.from(o),e.iterations,n>>3,a,(c,l)=>{c?i(c):s(new Uint8Array(l).buffer)})})}async onImportKey(e,r,n,s,i){if(e==="raw"){let o=new Wo;return o.data=b.Buffer.from(r),o.algorithm={name:this.name},o.extractable=!1,o.usages=i,K(o)}throw new y.OperationError("format: Must be 'raw'")}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof Wo))throw new TypeError("key: Is not PBKDF CryptoKey")}},yn=class extends jt{get alg(){return`HS${this.algorithm.hash.name.toUpperCase().replace("SHA-","")}`}set alg(e){}};_n.__decorate([z.JsonProp({name:"k",converter:iu})],yn.prototype,"data",void 0);var Ql=class extends y.HmacProvider{async onGenerateKey(e,r,n){let s=(e.length||this.getDefaultLength(e.hash.name))>>3<<3,i=new yn;return i.algorithm={...e,length:s,name:this.name},i.extractable=r,i.usages=n,i.data=k.randomBytes(s>>3),K(i)}async onSign(e,r,n){let s=Qe.getAlgorithmName(r.algorithm.hash),i=k.createHmac(s,S(r).data).update(b.Buffer.from(n)).digest();return new Uint8Array(i).buffer}async onVerify(e,r,n,s){let i=Qe.getAlgorithmName(r.algorithm.hash);return k.createHmac(i,S(r).data).update(b.Buffer.from(s)).digest().compare(b.Buffer.from(n))===0}async onImportKey(e,r,n,s,i){let o;switch(e.toLowerCase()){case"jwk":o=z.JsonParser.fromJSON(r,{targetSchema:yn});break;case"raw":o=new yn,o.data=b.Buffer.from(r);break;default:throw new y.OperationError("format: Must be 'jwk' or 'raw'")}return o.algorithm={hash:{name:n.hash.name},name:this.name,length:o.data.length<<3},o.extractable=s,o.usages=i,K(o)}async onExportKey(e,r){switch(e.toLowerCase()){case"jwk":return z.JsonSerializer.toJSON(S(r));case"raw":return new Uint8Array(S(r).data).buffer;default:throw new y.OperationError("format: Must be 'jwk' or 'raw'")}}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof yn))throw new TypeError("key: Is not HMAC CryptoKey")}},zo=class extends jt{},eu=class extends y.HkdfProvider{async onImportKey(e,r,n,s,i){if(e.toLowerCase()!=="raw")throw new y.OperationError("Operation not supported");let o=new zo;return o.data=b.Buffer.from(r),o.algorithm={name:this.name},o.extractable=s,o.usages=i,K(o)}async onDeriveBits(e,r,n){let s=e.hash.name.replace("-",""),i=k.createHash(s).digest().length,o=n/8,a=li.BufferSourceConverter.toUint8Array(e.info),c=k.createHmac(s,li.BufferSourceConverter.toUint8Array(e.salt)).update(li.BufferSourceConverter.toUint8Array(S(r).data)).digest(),l=[b.Buffer.alloc(0)],f=Math.ceil(o/i)+1;for(let u=1;u<f;++u)l.push(k.createHmac(s,c).update(b.Buffer.concat([l[u-1],a,b.Buffer.from([u])])).digest());return b.Buffer.concat(l).slice(0,o)}checkCryptoKey(e,r){if(super.checkCryptoKey(e,r),!(S(e)instanceof zo))throw new TypeError("key: Is not HKDF CryptoKey")}},Xo=class{static digest(e,r){let n=k.createHash(e.name.toLowerCase(),{outputLength:e.length}).update(b.Buffer.from(r)).digest();return new Uint8Array(n).buffer}},tu=class extends y.Shake128Provider{async onDigest(e,r){return Xo.digest(e,r)}},ru=class extends y.Shake256Provider{async onDigest(e,r){return Xo.digest(e,r)}},nu=class extends y.SubtleCrypto{constructor(){var e;super(),this.providers.set(new xl),this.providers.set(new Bl),this.providers.set(new Ol),this.providers.set(new Pl),this.providers.set(new Rl),this.providers.set(new Tl),k.getCiphers().includes("des-cbc")&&this.providers.set(new Nl),this.providers.set(new Il),this.providers.set(new Kl),this.providers.set(new $l),this.providers.set(new Ul),this.providers.set(new Dl),this.providers.set(new Gl),this.providers.set(new Jl),this.providers.set(new Ml),this.providers.set(new Ll),this.providers.set(new Hl),this.providers.set(new jl),this.providers.set(new Zl),this.providers.set(new Ql),this.providers.set(new eu);let n=(e=/^v(\d+)/.exec(_b.version))===null||e===void 0?void 0:e[1];n&&parseInt(n,10)>=12&&(this.providers.set(new tu),this.providers.set(new ru));let s=k.getHashes();s.includes("sha3-256")&&this.providers.set(new Vl),s.includes("sha3-384")&&this.providers.set(new Fl),s.includes("sha3-512")&&this.providers.set(new ql),n&&parseInt(n,10)>=14&&(this.providers.set(new Wl),this.providers.set(new zl),this.providers.set(new Xl),this.providers.set(new Yl))}},su=class extends y.Crypto{constructor(){super(...arguments),this.subtle=new nu}getRandomValues(e){if(!ArrayBuffer.isView(e))throw new TypeError("Failed to execute 'getRandomValues' on 'Crypto': parameter 1 is not of type 'ArrayBufferView'");let r=b.Buffer.from(e.buffer,e.byteOffset,e.byteLength);return k.randomFillSync(r),e}};Object.defineProperty(au,"CryptoKey",{enumerable:!0,get:function(){return li.CryptoKey}});au.Crypto=su});var Zt=ze(require("path")),Uu=ze(require("os")),Du=require("@prisma/client");var vn=class extends Error{constructor(r,n,s=null){super(r);this.data=null;this.message=r,this.code=n,this.data=s}};var N={Ok:(t,e,r=null)=>({data:t,code:e,error:null,profile:r}),Err:(t,e,r=null)=>({data:null,code:e,error:(()=>{if(!t)return new vn("\u672A\u77E5\u9519\u8BEF");if(typeof t=="string")return new vn(t,e);if(t instanceof Error)return new vn(t.message,e);let s=t;return e&&(s.error.code=e),s.error})(),profile:r})};function Qr(t){return async(...e)=>{try{let r=await t(...e);return N.Ok(r)}catch(r){let n=r;return N.Err(n.message)}}}var $u=ze(is());function py(t){return[hy(t),my(t)]}function hy(t){let{page:e=1,page_size:r=10,sorts:n=[],select:s,start:i,skip:o=0,search:a}=t,c={where:a,skip:(e-1)*r+Number(o),take:Number(r)};s&&(c.select=s),n.length!==0&&(c.orderBy=n.map(f=>{let{key:u,order:d}=f;return{[u]:d==="ASC"?"asc":"desc"}}));let l=Number(i);return Number.isNaN(l)||(c.skip=1,c.cursor={id:l}),c}function my(t){return(e,r)=>{let{page:n=1,page_size:s=10}=t;return{page:Number(n),page_size:Number(s),total:r,no_more:e.length<s,list:e}}}var Pi=class{constructor(e,r){this.model=e,this.params=r}async fetch(){let[e,r]=py(this.params),n=await this.model.count({where:e.where}),s=await this.model.findMany({...e}),i=r(s,n);return N.Ok(i)}};var Ta=["\u52A8\u4F5C\u5192\u9669","\u52A8\u753B","\u559C\u5267","\u72AF\u7F6A","\u7EAA\u5F55","\u5267\u60C5","\u5BB6\u5EAD","\u513F\u7AE5","\u60AC\u7591","\u65B0\u95FB","\u771F\u4EBA\u79C0","Sci-Fi & Fantasy","\u80A5\u7682\u5267","\u8131\u53E3\u79C0","War & Politics","\u897F\u90E8"],yy=Ta.map(t=>({[t]:t==="Sci-Fi & Fantasy"?"\u5947\u5E7B":t==="War & Politics"?"\u6218\u4E89/\u653F\u6CBB":t})).reduce((t,e)=>({...t,...e}),{}),Mw=Ta.map(t=>({label:yy[t],value:t}));var gy=["\u52A8\u4F5C","\u5192\u9669","\u52A8\u753B","\u559C\u5267","\u72AF\u7F6A","\u7EAA\u5F55","\u5267\u60C5","\u5BB6\u5EAD","\u5947\u5E7B","\u5386\u53F2","\u6050\u6016","\u97F3\u4E50","\u60AC\u7591","\u7231\u60C5","\u79D1\u5E7B","\u7535\u89C6\u7535\u5F71","\u60CA\u609A","\u6218\u4E89","\u897F\u90E8"],Lw=Ta.map(t=>({[t]:t})).reduce((t,e)=>({...t,...e}),{}),Hw=gy.map(t=>({label:t,value:t}));var Tu={drive_count:0,drive_total_size_count:0,drive_used_size_count:0,sync_task_count:0,movie_count:0,season_count:0,episode_count:0,unknown_media_count:0,invalid_season_count:0,invalid_movie_count:0,invalid_sync_task_count:0,report_count:0,media_request_count:0,new_file_count_today:0,file_size_count_today:0,updated_at:null};var Iu=ze(is()),nA=ze(Nu());Iu.default.locale("zh-cn");var by="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function Sn(){return wy(15)}function wy(t){return Ay(t,by)}function Ay(t,e){let r=new Array(t),n=e.length;for(let s=0;s<r.length;s++){let i=Math.floor(Math.random()*n);r[s]=e[i]}return r.join("")}function Ku(t){if(!t)return N.Err("\u4E0D\u662F\u5408\u6CD5\u7684 json");try{if(t[0]!=="{"&&t[0]!=="[")return N.Err("\u4E0D\u662F\u5408\u6CD5\u7684 json");let e=JSON.parse(t);return N.Ok(e)}catch(e){let r=e;return N.Err(r)}}var vy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function Sy(){return Ey(15)}function Ey(t){return Cy(t,vy)}function Cy(t,e){let r=new Array(t),n=e.length;for(let s=0;s<r.length;s++){let i=Math.floor(Math.random()*n);r[s]=e[i]}return r.join("")}function re(t,e={}){let{safe:r}=e;return async n=>{let{id:s,...i}=n;try{let o=await t.create({data:{id:s||Sy(),...i}});return N.Ok(o)}catch(o){let a=o;return N.Err(a)}}}function ue(t){return async(e,r)=>{try{let n=await t.update({where:{id:e},data:{updated:(0,$u.default)().toISOString(),...r}});return N.Ok(n)}catch(n){let s=n;return N.Err(s)}}}function fe(t){return async e=>{try{let r=await t.findFirst({where:e});return N.Ok(r)}catch(r){let n=r;return N.Err(n)}}}function de(t){return async(e={},r={})=>{let{sorts:n=[]}=r,s={};n.length!==0&&(s=n.map(i=>{let{key:o,order:a}=i;return{[o]:a==="ASC"?"asc":"desc"}}).reduce((i,o)=>({...i,...o}),{}));try{let i=await t.findMany({where:e,orderBy:s});return N.Ok(i)}catch(i){let o=i;return N.Err(o)}}}function Se(t){return async e=>{try{let r=await t.findFirst({where:e});if(r===null)return N.Err("There is no matched record");let n=await t.delete({where:{id:r.id}});return N.Ok(n)}catch(r){let n=r;return N.Err(n)}}}function he(t){return async(e,r={})=>{let{page:n=1,page_size:s=10,size:i=s,sorts:o=[]}=r;return await new Pi(t,{page:Number(n),page_size:Number(i),search:e.where||{},select:e.select,sorts:o}).fetch()}}var Bi=class{constructor(e){this.table_names=[];this.clear_dataset=e=>this.prisma[e].deleteMany({});this.prisma=e;let r=e;this.add_drive=re(r.drive),this.update_drive=ue(r.drive),this.delete_drive=Se(r.drive),this.find_drive=fe(r.drive),this.find_drive_list=de(r.drive),this.find_drive_list_with_pagination=he(r.drive),this.add_aliyun_drive_token=re(r.drive_token),this.update_aliyun_drive_token=ue(r.drive_token),this.find_aliyun_drive_token=fe(r.drive_token),this.find_aliyun_drive_token_list=de(r.drive_token),this.add_tv_profile=re(r.tv_profile),this.delete_tv_profile=Se(r.tv_profile),this.update_tv_profile=ue(r.tv_profile),this.find_tv_profile=fe(r.tv_profile),this.find_tv_profiles=de(r.tv_profile),this.find_tv_profiles_with_pagination=he(r.tv_profile),this.add_season_profile=re(r.season_profile),this.update_season_profile=ue(r.season_profile),this.find_season_profile=fe(r.season_profile),this.find_season_profile_list=de(r.season_profile),this.find_season_profile_list_with_pagination=he(r.season_profile),this.add_episode_profile=re(r.episode_profile),this.update_episode_profile=ue(r.episode_profile),this.find_episode_profile=fe(r.episode_profile),this.find_episode_profile_list=de(r.episode_profile),this.find_episode_profile_list_with_pagination=he(r.episode_profile),this.add_movie_profile=re(r.movie_profile),this.update_movie_profile=ue(r.movie_profile),this.find_movie_profile=fe(r.movie_profile),this.find_movie_profile_list=de(r.movie_profile),this.find_movie_profile_list_with_pagination=he(r.movie_profile),this.add_tv=re(r.tv),this.update_tv=ue(r.tv),this.delete_tv=Se(r.tv),this.find_tv=fe(r.tv),this.find_tvs=de(r.tv),this.find_tv_with_pagination=he(r.tv),this.add_season=re(r.season),this.update_season=ue(r.season),this.delete_season=Se(r.season),this.find_season=fe(r.season),this.find_seasons=de(r.season),this.find_seasons_with_pagination=he(r.season),this.add_episode=re(r.episode),this.update_episode=ue(r.episode),this.delete_episode=Se(r.episode),this.find_episode=fe(r.episode),this.find_episodes=de(r.episode),this.find_episodes_with_pagination=he(r.episode),this.add_movie=re(r.movie),this.update_movie=ue(r.movie),this.find_movie=fe(r.movie),this.find_movies=de(r.movie),this.add_parsed_tv=re(r.parsed_tv),this.update_parsed_tv=ue(r.parsed_tv),this.delete_parsed_tv=Se(r.parsed_tv),this.find_parsed_tv=fe(r.parsed_tv),this.find_parsed_tv_list=de(r.parsed_tv),this.find_parsed_tv_list_with_pagination=he(r.parsed_tv),this.add_parsed_season=re(r.parsed_season),this.update_parsed_season=ue(r.parsed_season),this.delete_parsed_season=Se(r.parsed_season),this.find_parsed_season=fe(r.parsed_season),this.find_parsed_season_list=de(r.parsed_season),this.find_parsed_season_list_with_pagination=he(r.parsed_season),this.add_parsed_episode=re(r.parsed_episode),this.update_parsed_episode=ue(r.parsed_episode),this.delete_parsed_episode=Se(r.parsed_episode),this.find_parsed_episode=fe(r.parsed_episode),this.find_parsed_episode_list=de(r.parsed_episode),this.find_parsed_episode_list_with_pagination=he(r.parsed_episode),this.add_parsed_movie=re(r.parsed_movie),this.update_parsed_movie=ue(r.parsed_movie),this.delete_parsed_movie=Se(r.parsed_movie),this.find_parsed_movie=fe(r.parsed_movie),this.find_parsed_movie_list=de(r.parsed_movie),this.find_parsed_movie_list_with_pagination=he(r.parsed_movie),this.add_history=re(r.play_history),this.update_history=ue(r.play_history),this.delete_history=Se(r.play_history),this.find_history=fe(r.play_history),this.find_histories=de(r.play_history),this.find_history_with_pagination=he(r.play_history),this.add_member_link=re(r.member_token),this.update_member_link=ue(r.member_token),this.delete_member_link=Se(r.member_token),this.find_member_link=fe(r.member_token),this.find_member_links=de(r.member_token),this.find_member_link_with_pagination=he(r.member_token),this.add_member=re(r.member),this.update_member=ue(r.member),this.delete_member=Se(r.member),this.find_member=fe(r.member),this.find_members=de(r.member),this.find_member_with_pagination=he(r.member),this.add_task=re(r.async_task),this.update_task=ue(r.async_task),this.find_task=fe(r.async_task),this.find_task_list=de(r.async_task),this.delete_task=Se(r.async_task),this.find_task_list_with_pagination=he(r.async_task),this.add_output_line=re(r.output_line),this.update_output_line=ue(r.output_line),this.find_output_line=fe(r.output_line),this.find_output_line_list=de(r.output_line),this.delete_output_line=Se(r.output_line),this.find_output_line_list_with_pagination=he(r.output_line),this.add_check_in=re(r.drive_check_in),this.add_shared_files=re(r.shared_file),this.add_shared_files_safely=async n=>{let{url:s}=n,i=await r.shared_file.findFirst({where:{url:s}});return i!==null?N.Ok(i):re(r.shared_file)(n)},this.update_shared_files=ue(r.shared_file),this.delete_shared_files=Se(r.shared_file),this.find_shared_files=fe(r.shared_file),this.find_shared_files_list=de(r.shared_file),this.find_shared_files_list_with_pagination=he(r.shared_file),this.add_sync_task=re(r.bind_for_parsed_tv),this.update_sync_task=ue(r.bind_for_parsed_tv),this.delete_sync_task=Se(r.bind_for_parsed_tv),this.find_sync_task=fe(r.bind_for_parsed_tv),this.find_sync_task_list=de(r.bind_for_parsed_tv),this.find_sync_task_list_with_pagination=he(r.bind_for_parsed_tv),this.add_file=re(r.file),this.update_file=ue(r.file),this.delete_file=Se(r.file),this.find_file=fe(r.file),this.find_files=de(r.file),this.find_file_with_pagination=he(r.file),this.add_tmp_file=re(r.tmp_file),this.update_tmp_file=ue(r.tmp_file),this.delete_tmp_file=Se(r.tmp_file),this.find_tmp_file=fe(r.tmp_file),this.find_tmp_files=de(r.tmp_file),this.find_tmp_file_with_pagination=he(r.tmp_file),this.add_report=re(r.report),this.update_report=ue(r.report),this.delete_report=Se(r.report),this.find_report=fe(r.report),this.find_report_list=de(r.report),this.find_report_list_with_pagination=he(r.report),this.add_permission=re(r.permission),this.update_permission=ue(r.permission),this.delete_permission=Se(r.permission),this.find_permission=fe(r.permission),this.find_permission_list=de(r.permission),this.find_permission_list_with_pagination=he(r.permission),this.add_shared_file_save=re(r.shared_file_in_progress),this.update_shared_file_save=ue(r.shared_file_in_progress),this.delete_shared_file_save=Se(r.shared_file_in_progress),this.find_shared_file_save=fe(r.shared_file_in_progress),this.find_shared_file_save_list=de(r.shared_file_in_progress),this.find_shared_files_save_with_pagination=he(r.shared_file_in_progress),this.add_user=re(r.user),this.update_user=ue(r.user),this.delete_user=Se(r.user),this.find_user=fe(r.user),this.find_users=de(r.user),this.find_user_with_pagination=he(r.user)}build_extra_args(e){let{next_marker:r,page_size:n=20}=e;return{take:n+1,...(()=>{let i={};return r?(i.id=r,{cursor:i}):{}})()}}get_next_marker(e,r){let{page_size:n=20}=r,s=null;return e.length===n+1&&(s=e[e.length-1].id),s}async list_with_cursor(e){let{fetch:r,next_marker:n="",page_size:s=20}=e;if(n===null)return{next_marker:null,list:[]};let i=this.build_extra_args({next_marker:n,page_size:s}),o=await r(i),a=o.slice(0,s);return{next_marker:this.get_next_marker(o,{page_size:s}),list:a}}async list_with_pagination(e){let{fetch:r,page:n=1,page_size:s=20}=e,i={skip:(n-1)*s,take:s};return{list:await r(i)}}};var fr=require("fs"),Ka=ze(require("path"));async function Yt(t,e=[]){let{ext:r,dir:n}=Ka.default.parse(t);r!==void 0&&r!==""&&(t=n);try{if(await(0,fr.accessSync)(t),e.length!==0){let i=e.pop();await(0,fr.mkdirSync)(i),await Yt(t,e)}}catch{let i=Ka.default.dirname(t);await Yt(i,e.concat(t))}}var $a=null,Oi=class{constructor(e){this.env={};this.args={};this.timer=null;this.listeners=[];let{root_path:r,env:n={},args:s={}}=e;this.root_path=r,this.env=n,this.args=s;let i=Zt.default.join(r,"data"),o="family-flix.db?connection_limit=1",a=Zt.default.join(r,"storage");this.database_path=Zt.default.join(i,o),this.database_dir=i,this.database_name=o,this.assets=a,Yt(this.assets),Yt(Zt.default.join(this.assets,"default")),Yt(Zt.default.join(this.assets,"poster")),Yt(Zt.default.join(this.assets,"thumbnail")),Yt(Zt.default.join(this.assets,"backdrop")),Yt(Zt.default.join(this.assets,"subtitle")),Yt(Zt.default.join(r,"logs")),(()=>{if($a){this.store=$a;return}this.store=new Bi(new Du.PrismaClient({datasources:{db:{url:Uu.default.type()!=="Windows_NT"?`file://${this.database_path}`:`file:${this.database_path}`}}})),$a=this.store})()}startInterval(e,r){this.timer===null&&(this.timer=setInterval(()=>{this.listeners.forEach(s=>{s.elapsed+=1e3,s.elapsed>=s.delay&&(s.handler(),s.elapsed=0)})},1e3*1)),!this.listeners.map(s=>s.handler).includes(e)&&this.listeners.push({handler:e,delay:r,elapsed:0})}clearInterval(e){this.listeners.map(n=>n.handler).includes(e)&&(this.listeners=this.listeners.filter(n=>n.handler!==e),this.listeners.length===0&&this.timer!==null&&clearInterval(this.timer))}};var Pa=ze(Ha());var Qm=ze(require("crypto")),ry=ze(Yh());var bw=ze(is());var Zh=ze(require("crypto")),Zo=new Uint8Array(256),Yo=Zo.length;function cu(){return Yo>Zo.length-16&&(Zh.default.randomFillSync(Zo),Yo=0),Zo.slice(Yo,Yo+=16)}var Fe=[];for(let t=0;t<256;++t)Fe.push((t+256).toString(16).slice(1));function Qh(t,e=0){return Fe[t[e+0]]+Fe[t[e+1]]+Fe[t[e+2]]+Fe[t[e+3]]+"-"+Fe[t[e+4]]+Fe[t[e+5]]+"-"+Fe[t[e+6]]+Fe[t[e+7]]+"-"+Fe[t[e+8]]+Fe[t[e+9]]+"-"+Fe[t[e+10]]+Fe[t[e+11]]+Fe[t[e+12]]+Fe[t[e+13]]+Fe[t[e+14]]+Fe[t[e+15]]}var em=ze(require("crypto")),lu={randomUUID:em.default.randomUUID};function Eb(t,e,r){if(lu.randomUUID&&!e&&!t)return lu.randomUUID();t=t||{};let n=t.random||(t.rng||cu)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(let s=0;s<16;++s)e[r+s]=n[s];return e}return Qh(n)}var uu=Eb;var pi=require("buffer");var tm=require("crypto"),Cb=(t,e)=>(0,tm.createHash)(t).update(e).digest(),rm=Cb;var dt=new TextEncoder,lr=new TextDecoder,Qo=2**32;function qe(...t){let e=t.reduce((s,{length:i})=>s+i,0),r=new Uint8Array(e),n=0;return t.forEach(s=>{r.set(s,n),n+=s.length}),r}function du(t,e){return qe(dt.encode(t),new Uint8Array([0]),e)}function fu(t,e,r){if(e<0||e>=Qo)throw new RangeError(`value must be >= 0 and <= ${Qo-1}. Received ${e}`);t.set([e>>>24,e>>>16,e>>>8,e&255],r)}function nm(t){let e=Math.floor(t/Qo),r=t%Qo,n=new Uint8Array(8);return fu(n,e,0),fu(n,r,4),n}function ea(t){let e=new Uint8Array(4);return fu(e,t),e}function ta(t){return qe(ea(t.length),t)}async function sm(t,e,r){let n=Math.ceil((e>>3)/32),s=new Uint8Array(n*32);for(let i=0;i<n;i++){let o=new Uint8Array(4+t.length+r.length);o.set(ea(i+1)),o.set(t,4),o.set(r,4+t.length),s.set(await rm("sha256",o),i*32)}return s.slice(0,e>>3)}var X;function xb(t){let e=t;return e instanceof Uint8Array&&(e=lr.decode(e)),e}pi.Buffer.isEncoding("base64url")?X=t=>pi.Buffer.from(t).toString("base64url"):X=t=>pi.Buffer.from(t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var Ge=t=>pi.Buffer.from(xb(t),"base64");var gi=require("crypto");var ur=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var r;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}},Je=class extends ur{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,r="unspecified",n="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=r,this.reason=n}},hi=class extends ur{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,r="unspecified",n="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=r,this.reason=n}},mi=class extends ur{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},$=class extends ur{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},Xn=class extends ur{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},ra=class extends ur{constructor(){super(...arguments),this.code="ERR_JWE_DECOMPRESSION_FAILED",this.message="decompression operation failed"}static get code(){return"ERR_JWE_DECOMPRESSION_FAILED"}},R=class extends ur{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}};var na=class extends ur{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}};var bn=require("crypto");function pu(t){switch(t){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new $(`Unsupported JWE Algorithm: ${t}`)}}var sa=t=>(0,bn.randomFillSync)(new Uint8Array(pu(t)>>3));var kb=(t,e)=>{if(e.length<<3!==pu(t))throw new R("Invalid Initialization Vector length")},ia=kb;var im=require("crypto"),hu=ze(require("util"),1),ve=hu.types.isKeyObject?t=>hu.types.isKeyObject(t):t=>t!=null&&t instanceof im.KeyObject;var Pb=(t,e)=>{let r;switch(t){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":r=parseInt(t.slice(-3),10);break;case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(t.slice(1,4),10);break;default:throw new $(`Content Encryption Algorithm ${t} is not supported either by JOSE or your javascript runtime`)}if(e instanceof Uint8Array){let n=e.byteLength<<3;if(n!==r)throw new R(`Invalid Content Encryption Key length. Expected ${r} bits, got ${n} bits`);return}if(ve(e)&&e.type==="secret"){let n=e.symmetricKeySize<<3;if(n!==r)throw new R(`Invalid Content Encryption Key length. Expected ${r} bits, got ${n} bits`);return}throw new TypeError("Invalid Content Encryption Key type")},oa=Pb;var om=require("crypto"),Bb=om.timingSafeEqual,am=Bb;var cm=require("crypto");function yi(t,e,r,n,s,i){let o=qe(t,e,r,nm(t.length<<3)),a=(0,cm.createHmac)(`sha${n}`,s);return a.update(o),a.digest().slice(0,i>>3)}var lm=ze(require("crypto"),1),mu=ze(require("util"),1),Ob=lm.webcrypto,aa=Ob,Ie=mu.types.isCryptoKey?t=>mu.types.isCryptoKey(t):t=>!1;function Vr(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function ca(t,e){return t.name===e}function Rb(t){return parseInt(t.name.slice(4),10)}function Tb(t,e){if(e.length&&!e.some(r=>t.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let n=e.pop();r+=`one of ${e.join(", ")}, or ${n}.`}else e.length===2?r+=`one of ${e[0]} or ${e[1]}.`:r+=`${e[0]}.`;throw new TypeError(r)}}function Et(t,e,...r){switch(e){case"A128GCM":case"A192GCM":case"A256GCM":{if(!ca(t.algorithm,"AES-GCM"))throw Vr("AES-GCM");let n=parseInt(e.slice(1,4),10);if(t.algorithm.length!==n)throw Vr(n,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!ca(t.algorithm,"AES-KW"))throw Vr("AES-KW");let n=parseInt(e.slice(1,4),10);if(t.algorithm.length!==n)throw Vr(n,"algorithm.length");break}case"ECDH":{switch(t.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw Vr("ECDH, X25519, or X448")}break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!ca(t.algorithm,"PBKDF2"))throw Vr("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!ca(t.algorithm,"RSA-OAEP"))throw Vr("RSA-OAEP");let n=parseInt(e.slice(9),10)||1;if(Rb(t.algorithm.hash)!==n)throw Vr(`SHA-${n}`,"algorithm.hash");break}default:throw new TypeError("CryptoKey does not support this operation")}Tb(t,r)}function um(t,e,...r){if(r.length>2){let n=r.pop();t+=`one of type ${r.join(", ")}, or ${n}.`}else r.length===2?t+=`one of type ${r[0]} or ${r[1]}.`:t+=`of type ${r[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&e.constructor&&e.constructor.name&&(t+=` Received an instance of ${e.constructor.name}`),t}var He=(t,...e)=>um("Key must be ",t,...e);function yu(t,e,...r){return um(`Key for the ${t} algorithm must be `,e,...r)}var fm=require("crypto"),gu,Br=t=>(gu||(gu=new Set((0,fm.getCiphers)())),gu.has(t));var _u=t=>ve(t)||Ie(t),pe=["KeyObject"];(globalThis.CryptoKey||!(aa===null||aa===void 0)&&aa.CryptoKey)&&pe.push("CryptoKey");function Nb(t,e,r,n,s,i){let o=parseInt(t.slice(1,4),10);ve(e)&&(e=e.export());let a=e.subarray(o>>3),c=e.subarray(0,o>>3),l=parseInt(t.slice(-3),10),f=`aes-${o}-cbc`;if(!Br(f))throw new $(`alg ${t} is not supported by your javascript runtime`);let u=yi(i,n,r,l,c,o),d;try{d=am(s,u)}catch{}if(!d)throw new Xn;let p;try{let m=(0,gi.createDecipheriv)(f,a,n);p=qe(m.update(r),m.final())}catch{}if(!p)throw new Xn;return p}function Ib(t,e,r,n,s,i){let a=`aes-${parseInt(t.slice(1,4),10)}-gcm`;if(!Br(a))throw new $(`alg ${t} is not supported by your javascript runtime`);try{let c=(0,gi.createDecipheriv)(a,e,n,{authTagLength:16});c.setAuthTag(s),i.byteLength&&c.setAAD(i,{plaintextLength:r.length});let l=c.update(r);return c.final(),l}catch{throw new Xn}}var Kb=(t,e,r,n,s,i)=>{let o;if(Ie(e))Et(e,t,"decrypt"),o=gi.KeyObject.from(e);else if(e instanceof Uint8Array||ve(e))o=e;else throw new TypeError(He(e,...pe,"Uint8Array"));switch(oa(t,o),ia(t,n),t){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return Nb(t,o,r,n,s,i);case"A128GCM":case"A192GCM":case"A256GCM":return Ib(t,o,r,n,s,i);default:throw new $("Unsupported JWE Content Encryption Algorithm")}},la=Kb;var bu=require("util"),ua=require("zlib");var $b=(0,bu.promisify)(ua.inflateRaw),Ub=(0,bu.promisify)(ua.deflateRaw),dm=t=>$b(t,{maxOutputLength:25e4}).catch(()=>{throw new ra}),pm=t=>Ub(t);var Db=(...t)=>{let e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let r;for(let n of e){let s=Object.keys(n);if(!r||r.size===0){r=new Set(s);continue}for(let i of s){if(r.has(i))return!1;r.add(i)}}return!0},fa=Db;function Mb(t){return typeof t=="object"&&t!==null}function Ct(t){if(!Mb(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}var wu=require("buffer"),Fr=require("crypto");function hm(t,e){if(t.symmetricKeySize<<3!==parseInt(e.slice(1,4),10))throw new TypeError(`Invalid key size for alg: ${e}`)}function mm(t,e,r){if(ve(t))return t;if(t instanceof Uint8Array)return(0,Fr.createSecretKey)(t);if(Ie(t))return Et(t,e,r),Fr.KeyObject.from(t);throw new TypeError(He(t,...pe,"Uint8Array"))}var _i=(t,e,r)=>{let s=`aes${parseInt(t.slice(1,4),10)}-wrap`;if(!Br(s))throw new $(`alg ${t} is not supported either by JOSE or your javascript runtime`);let i=mm(e,t,"wrapKey");hm(i,t);let o=(0,Fr.createCipheriv)(s,i,wu.Buffer.alloc(8,166));return qe(o.update(r),o.final())},bi=(t,e,r)=>{let s=`aes${parseInt(t.slice(1,4),10)}-wrap`;if(!Br(s))throw new $(`alg ${t} is not supported either by JOSE or your javascript runtime`);let i=mm(e,t,"unwrapKey");hm(i,t);let o=(0,Fr.createDecipheriv)(s,i,wu.Buffer.alloc(8,166));return qe(o.update(r),o.final())};var qr=require("crypto"),gm=require("util");var wi=require("buffer"),pa=require("crypto");var Lb=wi.Buffer.from([42,134,72,206,61,3,1,7]),Hb=wi.Buffer.from([43,129,4,0,34]),jb=wi.Buffer.from([43,129,4,0,35]),Vb=wi.Buffer.from([43,129,4,0,10]),da=new WeakMap,Fb=t=>{switch(t){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new $("Unsupported key curve for this operation")}},ym=(t,e)=>{var r;let n;if(Ie(t))n=pa.KeyObject.from(t);else if(ve(t))n=t;else throw new TypeError(He(t,...pe));if(n.type==="secret")throw new TypeError('only "private" or "public" type keys can be used for this operation');switch(n.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${n.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${n.asymmetricKeyType.slice(1)}`;case"ec":{if(da.has(n))return da.get(n);let s=(r=n.asymmetricKeyDetails)===null||r===void 0?void 0:r.namedCurve;if(!s&&n.type==="private")s=ym((0,pa.createPublicKey)(n),!0);else if(!s){let o=n.export({format:"der",type:"spki"}),a=o[1]<128?14:15,c=o[a],l=o.slice(a+1,a+1+c);if(l.equals(Lb))s="prime256v1";else if(l.equals(Hb))s="secp384r1";else if(l.equals(jb))s="secp521r1";else if(l.equals(Vb))s="secp256k1";else throw new $("Unsupported key curve for this operation")}if(e)return s;let i=Fb(s);return da.set(n,i),i}default:throw new TypeError("Invalid asymmetric key type for this operation")}};function Au(t,e){da.set(t,e)}var wn=ym;var vu=(0,gm.promisify)(qr.generateKeyPair);async function ha(t,e,r,n,s=new Uint8Array(0),i=new Uint8Array(0)){let o;if(Ie(t))Et(t,"ECDH"),o=qr.KeyObject.from(t);else if(ve(t))o=t;else throw new TypeError(He(t,...pe));let a;if(Ie(e))Et(e,"ECDH","deriveBits"),a=qr.KeyObject.from(e);else if(ve(e))a=e;else throw new TypeError(He(e,...pe));let c=qe(ta(dt.encode(r)),ta(s),ta(i),ea(n)),l=(0,qr.diffieHellman)({privateKey:a,publicKey:o});return sm(l,n,c)}async function _m(t){let e;if(Ie(t))e=qr.KeyObject.from(t);else if(ve(t))e=t;else throw new TypeError(He(t,...pe));switch(e.asymmetricKeyType){case"x25519":return vu("x25519");case"x448":return vu("x448");case"ec":{let r=wn(e);return vu("ec",{namedCurve:r})}default:throw new $("Invalid or unsupported EPK")}}var ma=t=>["P-256","P-384","P-521","X25519","X448"].includes(wn(t));var wm=require("util"),ga=require("crypto");function ya(t){if(!(t instanceof Uint8Array)||t.length<8)throw new R("PBES2 Salt Input must be 8 or more octets")}var Am=(0,wm.promisify)(ga.pbkdf2);function vm(t,e){if(ve(t))return t.export();if(t instanceof Uint8Array)return t;if(Ie(t))return Et(t,e,"deriveBits","deriveKey"),ga.KeyObject.from(t).export();throw new TypeError(He(t,...pe,"Uint8Array"))}var Sm=async(t,e,r,n=2048,s=(0,bn.randomFillSync)(new Uint8Array(16)))=>{ya(s);let i=du(t,s),o=parseInt(t.slice(13,16),10)>>3,a=vm(e,t),c=await Am(a,i,n,o,`sha${t.slice(8,11)}`);return{encryptedKey:await _i(t.slice(-6),c,r),p2c:n,p2s:X(s)}},Em=async(t,e,r,n,s)=>{ya(s);let i=du(t,s),o=parseInt(t.slice(13,16),10)>>3,a=vm(e,t),c=await Am(a,i,n,o,`sha${t.slice(8,11)}`);return bi(t.slice(-6),c,r)};var Or=require("crypto");var _a=new WeakMap,ba=(t,e)=>{let r=t.readUInt8(1);if(!(r&128))return e===0?r:ba(t.subarray(2+r),e-1);let n=r&127;r=0;for(let s=0;s<n;s++){r<<=8;let i=t.readUInt8(2+s);r|=i}return e===0?r:ba(t.subarray(2+r),e-1)},qb=(t,e)=>{let r=t.readUInt8(1);if(!(r&128))return ba(t.subarray(2),e);let n=r&127;return ba(t.subarray(2+n),e)},Gb=t=>{var e,r;if(_a.has(t))return _a.get(t);let n=(r=(e=t.asymmetricKeyDetails)===null||e===void 0?void 0:e.modulusLength)!==null&&r!==void 0?r:qb(t.export({format:"der",type:"pkcs1"}),t.type==="private"?1:0)-1<<3;return _a.set(t,n),n},Cm=(t,e)=>{_a.set(t,e)},xm=(t,e)=>{if(Gb(t)<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)};var km=(t,e)=>{if(t.asymmetricKeyType!=="rsa")throw new TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");xm(t,e)},Pm=t=>{switch(t){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return Or.constants.RSA_PKCS1_OAEP_PADDING;case"RSA1_5":return Or.constants.RSA_PKCS1_PADDING;default:return}},Bm=t=>{switch(t){case"RSA-OAEP":return"sha1";case"RSA-OAEP-256":return"sha256";case"RSA-OAEP-384":return"sha384";case"RSA-OAEP-512":return"sha512";default:return}};function Om(t,e,...r){if(ve(t))return t;if(Ie(t))return Et(t,e,...r),Or.KeyObject.from(t);throw new TypeError(He(t,...pe))}var Rm=(t,e,r)=>{let n=Pm(t),s=Bm(t),i=Om(e,t,"wrapKey","encrypt");return km(i,t),(0,Or.publicEncrypt)({key:i,oaepHash:s,padding:n},r)},Tm=(t,e,r)=>{let n=Pm(t),s=Bm(t),i=Om(e,t,"unwrapKey","decrypt");return km(i,t),(0,Or.privateDecrypt)({key:i,oaepHash:s,padding:n},r)};function Ai(t){switch(t){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new $(`Unsupported JWE Algorithm: ${t}`)}}var Gr=t=>(0,bn.randomFillSync)(new Uint8Array(Ai(t)>>3));var Ue=require("buffer"),Vt=require("crypto");var Oe=require("buffer");var Jb=2,Wb=3,zb=4,Xb=48,Su=Oe.Buffer.from([0]),wa=Oe.Buffer.from([Jb]),Yb=Oe.Buffer.from([Wb]),Zb=Oe.Buffer.from([Xb]),Qb=Oe.Buffer.from([zb]),Jr=t=>{if(t<128)return Oe.Buffer.from([t]);let e=Oe.Buffer.alloc(5);e.writeUInt32BE(t,1);let r=1;for(;e[r]===0;)r++;return e[r-1]=128|5-r,e.slice(r-1)},ew=new Map([["P-256",Oe.Buffer.from("06 08 2A 86 48 CE 3D 03 01 07".replace(/ /g,""),"hex")],["secp256k1",Oe.Buffer.from("06 05 2B 81 04 00 0A".replace(/ /g,""),"hex")],["P-384",Oe.Buffer.from("06 05 2B 81 04 00 22".replace(/ /g,""),"hex")],["P-521",Oe.Buffer.from("06 05 2B 81 04 00 23".replace(/ /g,""),"hex")],["ecPublicKey",Oe.Buffer.from("06 07 2A 86 48 CE 3D 02 01".replace(/ /g,""),"hex")],["X25519",Oe.Buffer.from("06 03 2B 65 6E".replace(/ /g,""),"hex")],["X448",Oe.Buffer.from("06 03 2B 65 6F".replace(/ /g,""),"hex")],["Ed25519",Oe.Buffer.from("06 03 2B 65 70".replace(/ /g,""),"hex")],["Ed448",Oe.Buffer.from("06 03 2B 65 71".replace(/ /g,""),"hex")]]),ct=class{constructor(){this.length=0,this.elements=[]}oidFor(e){let r=ew.get(e);if(!r)throw new $("Invalid or unsupported OID");this.elements.push(r),this.length+=r.length}zero(){this.elements.push(wa,Oe.Buffer.from([1]),Su),this.length+=3}one(){this.elements.push(wa,Oe.Buffer.from([1]),Oe.Buffer.from([1])),this.length+=3}unsignedInteger(e){if(e[0]&128){let r=Jr(e.length+1);this.elements.push(wa,r,Su,e),this.length+=2+r.length+e.length}else{let r=0;for(;e[r]===0&&!(e[r+1]&128);)r++;let n=Jr(e.length-r);this.elements.push(wa,Jr(e.length-r),e.slice(r)),this.length+=1+n.length+e.length-r}}octStr(e){let r=Jr(e.length);this.elements.push(Qb,Jr(e.length),e),this.length+=1+r.length+e.length}bitStr(e){let r=Jr(e.length+1);this.elements.push(Yb,Jr(e.length+1),Su,e),this.length+=1+r.length+e.length+1}add(e){this.elements.push(e),this.length+=e.length}end(e=Zb){let r=Jr(this.length);return Oe.Buffer.concat([e,r,...this.elements],1+r.length+this.length)}};var[Wr,Aa]=process.versions.node.split(".").map(t=>parseInt(t,10)),pC=Wr>=16||Wr===15&&Aa>=13,hC=!("electron"in process.versions)&&(Wr>=17||Wr===16&&Aa>=9),Nm=Wr>=16||Wr===15&&Aa>=9,Im=Wr>=16||Wr===15&&Aa>=12;var tw=t=>{if(Im&&t.kty!=="oct")return t.d?(0,Vt.createPrivateKey)({format:"jwk",key:t}):(0,Vt.createPublicKey)({format:"jwk",key:t});switch(t.kty){case"oct":return(0,Vt.createSecretKey)(Ge(t.k));case"RSA":{let e=new ct,r=t.d!==void 0,n=Ue.Buffer.from(t.n,"base64"),s=Ue.Buffer.from(t.e,"base64");r?(e.zero(),e.unsignedInteger(n),e.unsignedInteger(s),e.unsignedInteger(Ue.Buffer.from(t.d,"base64")),e.unsignedInteger(Ue.Buffer.from(t.p,"base64")),e.unsignedInteger(Ue.Buffer.from(t.q,"base64")),e.unsignedInteger(Ue.Buffer.from(t.dp,"base64")),e.unsignedInteger(Ue.Buffer.from(t.dq,"base64")),e.unsignedInteger(Ue.Buffer.from(t.qi,"base64"))):(e.unsignedInteger(n),e.unsignedInteger(s));let o={key:e.end(),format:"der",type:"pkcs1"},a=r?(0,Vt.createPrivateKey)(o):(0,Vt.createPublicKey)(o);return Cm(a,n.length<<3),a}case"EC":{let e=new ct,r=t.d!==void 0,n=Ue.Buffer.concat([Ue.Buffer.alloc(1,4),Ue.Buffer.from(t.x,"base64"),Ue.Buffer.from(t.y,"base64")]);if(r){e.zero();let a=new ct;a.oidFor("ecPublicKey"),a.oidFor(t.crv),e.add(a.end());let c=new ct;c.one(),c.octStr(Ue.Buffer.from(t.d,"base64"));let l=new ct;l.bitStr(n);let f=l.end(Ue.Buffer.from([161]));c.add(f);let u=c.end(),d=new ct;d.add(u);let p=d.end(Ue.Buffer.from([4]));e.add(p);let m=e.end(),g=(0,Vt.createPrivateKey)({key:m,format:"der",type:"pkcs8"});return Au(g,t.crv),g}let s=new ct;s.oidFor("ecPublicKey"),s.oidFor(t.crv),e.add(s.end()),e.bitStr(n);let i=e.end(),o=(0,Vt.createPublicKey)({key:i,format:"der",type:"spki"});return Au(o,t.crv),o}case"OKP":{let e=new ct;if(t.d!==void 0){e.zero();let i=new ct;i.oidFor(t.crv),e.add(i.end());let o=new ct;o.octStr(Ue.Buffer.from(t.d,"base64"));let a=o.end(Ue.Buffer.from([4]));e.add(a);let c=e.end();return(0,Vt.createPrivateKey)({key:c,format:"der",type:"pkcs8"})}let n=new ct;n.oidFor(t.crv),e.add(n.end()),e.bitStr(Ue.Buffer.from(t.x,"base64"));let s=e.end();return(0,Vt.createPublicKey)({key:s,format:"der",type:"spki"})}default:throw new $('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}},Eu=tw;async function Km(t,e,r){var n;if(!Ct(t))throw new TypeError("JWK must be an object");switch(e||(e=t.alg),t.kty){case"oct":if(typeof t.k!="string"||!t.k)throw new TypeError('missing "k" (Key Value) Parameter value');return r!=null||(r=t.ext!==!0),r?Eu({...t,alg:e,ext:(n=t.ext)!==null&&n!==void 0?n:!1}):Ge(t.k);case"RSA":if(t.oth!==void 0)throw new $('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Eu({...t,alg:e});default:throw new $('Unsupported "kty" (Key Type) Parameter value')}}var rw=(t,e)=>{if(!(e instanceof Uint8Array)){if(!_u(e))throw new TypeError(yu(t,e,...pe,"Uint8Array"));if(e.type!=="secret")throw new TypeError(`${pe.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},nw=(t,e,r)=>{if(!_u(e))throw new TypeError(yu(t,e,...pe));if(e.type==="secret")throw new TypeError(`${pe.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&e.type==="public")throw new TypeError(`${pe.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&e.type==="public")throw new TypeError(`${pe.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&r==="verify"&&e.type==="private")throw new TypeError(`${pe.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&r==="encrypt"&&e.type==="private")throw new TypeError(`${pe.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},sw=(t,e,r)=>{t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?rw(t,e):nw(t,e,r)},va=sw;var vi=require("crypto");function iw(t,e,r,n,s){let i=parseInt(t.slice(1,4),10);ve(r)&&(r=r.export());let o=r.subarray(i>>3),a=r.subarray(0,i>>3),c=`aes-${i}-cbc`;if(!Br(c))throw new $(`alg ${t} is not supported by your javascript runtime`);let l=(0,vi.createCipheriv)(c,o,n),f=qe(l.update(e),l.final()),u=parseInt(t.slice(-3),10),d=yi(s,n,f,u,a,i);return{ciphertext:f,tag:d}}function ow(t,e,r,n,s){let o=`aes-${parseInt(t.slice(1,4),10)}-gcm`;if(!Br(o))throw new $(`alg ${t} is not supported by your javascript runtime`);let a=(0,vi.createCipheriv)(o,r,n,{authTagLength:16});s.byteLength&&a.setAAD(s,{plaintextLength:e.length});let c=a.update(e);a.final();let l=a.getAuthTag();return{ciphertext:c,tag:l}}var aw=(t,e,r,n,s)=>{let i;if(Ie(r))Et(r,t,"encrypt"),i=vi.KeyObject.from(r);else if(r instanceof Uint8Array||ve(r))i=r;else throw new TypeError(He(r,...pe,"Uint8Array"));switch(oa(t,i),ia(t,n),t){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return iw(t,e,i,n,s);case"A128GCM":case"A192GCM":case"A256GCM":return ow(t,e,i,n,s);default:throw new $("Unsupported JWE Content Encryption Algorithm")}},Si=aw;async function $m(t,e,r,n){let s=t.slice(0,7);n||(n=sa(s));let{ciphertext:i,tag:o}=await Si(s,r,e,n,new Uint8Array(0));return{encryptedKey:i,iv:X(n),tag:X(o)}}async function Um(t,e,r,n,s){let i=t.slice(0,7);return la(i,e,r,n,s,new Uint8Array(0))}async function cw(t,e,r,n,s){switch(va(t,e,"decrypt"),t){case"dir":{if(r!==void 0)throw new R("Encountered unexpected JWE Encrypted Key");return e}case"ECDH-ES":if(r!==void 0)throw new R("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!Ct(n.epk))throw new R('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!ma(e))throw new $("ECDH with the provided key is not allowed or not supported by your javascript runtime");let i=await Km(n.epk,t),o,a;if(n.apu!==void 0){if(typeof n.apu!="string")throw new R('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{o=Ge(n.apu)}catch{throw new R("Failed to base64url decode the apu")}}if(n.apv!==void 0){if(typeof n.apv!="string")throw new R('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{a=Ge(n.apv)}catch{throw new R("Failed to base64url decode the apv")}}let c=await ha(i,e,t==="ECDH-ES"?n.enc:t,t==="ECDH-ES"?Ai(n.enc):parseInt(t.slice(-5,-2),10),o,a);if(t==="ECDH-ES")return c;if(r===void 0)throw new R("JWE Encrypted Key missing");return bi(t.slice(-6),c,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(r===void 0)throw new R("JWE Encrypted Key missing");return Tm(t,e,r)}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(r===void 0)throw new R("JWE Encrypted Key missing");if(typeof n.p2c!="number")throw new R('JOSE Header "p2c" (PBES2 Count) missing or invalid');let i=(s==null?void 0:s.maxPBES2Count)||1e4;if(n.p2c>i)throw new R('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if(typeof n.p2s!="string")throw new R('JOSE Header "p2s" (PBES2 Salt) missing or invalid');let o;try{o=Ge(n.p2s)}catch{throw new R("Failed to base64url decode the p2s")}return Em(t,e,r,n.p2c,o)}case"A128KW":case"A192KW":case"A256KW":{if(r===void 0)throw new R("JWE Encrypted Key missing");return bi(t,e,r)}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(r===void 0)throw new R("JWE Encrypted Key missing");if(typeof n.iv!="string")throw new R('JOSE Header "iv" (Initialization Vector) missing or invalid');if(typeof n.tag!="string")throw new R('JOSE Header "tag" (Authentication Tag) missing or invalid');let i;try{i=Ge(n.iv)}catch{throw new R("Failed to base64url decode the iv")}let o;try{o=Ge(n.tag)}catch{throw new R("Failed to base64url decode the tag")}return Um(t,e,r,i,o)}default:throw new $('Invalid or unsupported "alg" (JWE Algorithm) header value')}}var Dm=cw;function lw(t,e,r,n,s){if(s.crit!==void 0&&n.crit===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(o=>typeof o!="string"||o.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;r!==void 0?i=new Map([...Object.entries(r),...e.entries()]):i=e;for(let o of n.crit){if(!i.has(o))throw new $(`Extension Header Parameter "${o}" is not recognized`);if(s[o]===void 0)throw new t(`Extension Header Parameter "${o}" is missing`);if(i.get(o)&&n[o]===void 0)throw new t(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(n.crit)}var Sa=lw;var uw=(t,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(r=>typeof r!="string")))throw new TypeError(`"${t}" option must be an array of strings`);if(e)return new Set(e)},Cu=uw;async function Mm(t,e,r){var n;if(!Ct(t))throw new R("Flattened JWE must be an object");if(t.protected===void 0&&t.header===void 0&&t.unprotected===void 0)throw new R("JOSE Header missing");if(typeof t.iv!="string")throw new R("JWE Initialization Vector missing or incorrect type");if(typeof t.ciphertext!="string")throw new R("JWE Ciphertext missing or incorrect type");if(typeof t.tag!="string")throw new R("JWE Authentication Tag missing or incorrect type");if(t.protected!==void 0&&typeof t.protected!="string")throw new R("JWE Protected Header incorrect type");if(t.encrypted_key!==void 0&&typeof t.encrypted_key!="string")throw new R("JWE Encrypted Key incorrect type");if(t.aad!==void 0&&typeof t.aad!="string")throw new R("JWE AAD incorrect type");if(t.header!==void 0&&!Ct(t.header))throw new R("JWE Shared Unprotected Header incorrect type");if(t.unprotected!==void 0&&!Ct(t.unprotected))throw new R("JWE Per-Recipient Unprotected Header incorrect type");let s;if(t.protected)try{let ce=Ge(t.protected);s=JSON.parse(lr.decode(ce))}catch{throw new R("JWE Protected Header is invalid")}if(!fa(s,t.header,t.unprotected))throw new R("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let i={...s,...t.header,...t.unprotected};if(Sa(R,new Map,r==null?void 0:r.crit,s,i),i.zip!==void 0){if(!s||!s.zip)throw new R('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(i.zip!=="DEF")throw new $('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:o,enc:a}=i;if(typeof o!="string"||!o)throw new R("missing JWE Algorithm (alg) in JWE Header");if(typeof a!="string"||!a)throw new R("missing JWE Encryption Algorithm (enc) in JWE Header");let c=r&&Cu("keyManagementAlgorithms",r.keyManagementAlgorithms),l=r&&Cu("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(c&&!c.has(o))throw new mi('"alg" (Algorithm) Header Parameter not allowed');if(l&&!l.has(a))throw new mi('"enc" (Encryption Algorithm) Header Parameter not allowed');let f;if(t.encrypted_key!==void 0)try{f=Ge(t.encrypted_key)}catch{throw new R("Failed to base64url decode the encrypted_key")}let u=!1;typeof e=="function"&&(e=await e(s,t),u=!0);let d;try{d=await Dm(o,e,f,i,r)}catch(ce){if(ce instanceof TypeError||ce instanceof R||ce instanceof $)throw ce;d=Gr(a)}let p,m;try{p=Ge(t.iv)}catch{throw new R("Failed to base64url decode the iv")}try{m=Ge(t.tag)}catch{throw new R("Failed to base64url decode the tag")}let g=dt.encode((n=t.protected)!==null&&n!==void 0?n:""),_;t.aad!==void 0?_=qe(g,dt.encode("."),dt.encode(t.aad)):_=g;let x;try{x=Ge(t.ciphertext)}catch{throw new R("Failed to base64url decode the ciphertext")}let te=await la(a,d,x,p,m,_);i.zip==="DEF"&&(te=await((r==null?void 0:r.inflateRaw)||dm)(te));let ne={plaintext:te};if(t.protected!==void 0&&(ne.protectedHeader=s),t.aad!==void 0)try{ne.additionalAuthenticatedData=Ge(t.aad)}catch{throw new R("Failed to base64url decode the aad")}return t.unprotected!==void 0&&(ne.sharedUnprotectedHeader=t.unprotected),t.header!==void 0&&(ne.unprotectedHeader=t.header),u?{...ne,key:e}:ne}async function Lm(t,e,r){if(t instanceof Uint8Array&&(t=lr.decode(t)),typeof t!="string")throw new R("Compact JWE must be a string or Uint8Array");let{0:n,1:s,2:i,3:o,4:a,length:c}=t.split(".");if(c!==5)throw new R("Invalid Compact JWE");let l=await Mm({ciphertext:o,iv:i||void 0,protected:n||void 0,tag:a||void 0,encrypted_key:s||void 0},e,r),f={plaintext:l.plaintext,protectedHeader:l.protectedHeader};return typeof e=="function"?{...f,key:l.key}:f}var Yn=require("crypto");var Ei=class{constructor(e){if(e[0]!==48)throw new TypeError;if(this.buffer=e,this.offset=1,this.decodeLength()!==e.length-this.offset)throw new TypeError}decodeLength(){let e=this.buffer[this.offset++];if(e&128){let r=e&-129;e=0;for(let n=0;n<r;n++)e=e<<8|this.buffer[this.offset+n];this.offset+=r}return e}unsignedInteger(){if(this.buffer[this.offset++]!==2)throw new TypeError;let e=this.decodeLength();this.buffer[this.offset]===0&&(this.offset++,e--);let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}end(){if(this.offset!==this.buffer.length)throw new TypeError}};var Ea=t=>{let e;if(Ie(t)){if(!t.extractable)throw new TypeError("CryptoKey is not extractable");e=Yn.KeyObject.from(t)}else if(ve(t))e=t;else{if(t instanceof Uint8Array)return{kty:"oct",k:X(t)};throw new TypeError(He(t,...pe,"Uint8Array"))}if(Nm){if(e.type!=="secret"&&!["rsa","ec","ed25519","x25519","ed448","x448"].includes(e.asymmetricKeyType))throw new $("Unsupported key asymmetricKeyType");return e.export({format:"jwk"})}switch(e.type){case"secret":return{kty:"oct",k:X(e.export())};case"private":case"public":switch(e.asymmetricKeyType){case"rsa":{let r=e.export({format:"der",type:"pkcs1"}),n=new Ei(r);e.type==="private"&&n.unsignedInteger();let s=X(n.unsignedInteger()),i=X(n.unsignedInteger()),o;return e.type==="private"&&(o={d:X(n.unsignedInteger()),p:X(n.unsignedInteger()),q:X(n.unsignedInteger()),dp:X(n.unsignedInteger()),dq:X(n.unsignedInteger()),qi:X(n.unsignedInteger())}),n.end(),{kty:"RSA",n:s,e:i,...o}}case"ec":{let r=wn(e),n,s,i;switch(r){case"secp256k1":n=64,s=33,i=-1;break;case"P-256":n=64,s=36,i=-1;break;case"P-384":n=96,s=35,i=-3;break;case"P-521":n=132,s=35,i=-3;break;default:throw new $("Unsupported curve")}if(e.type==="public"){let a=e.export({type:"spki",format:"der"});return{kty:"EC",crv:r,x:X(a.subarray(-n,-n/2)),y:X(a.subarray(-n/2))}}let o=e.export({type:"pkcs8",format:"der"});return o.length<100&&(s+=i),{...Ea((0,Yn.createPublicKey)(e)),d:X(o.subarray(s,s+n/2))}}case"ed25519":case"x25519":{let r=wn(e);if(e.type==="public"){let s=e.export({type:"spki",format:"der"});return{kty:"OKP",crv:r,x:X(s.subarray(-32))}}let n=e.export({type:"pkcs8",format:"der"});return{...Ea((0,Yn.createPublicKey)(e)),d:X(n.subarray(-32))}}case"ed448":case"x448":{let r=wn(e);if(e.type==="public"){let s=e.export({type:"spki",format:"der"});return{kty:"OKP",crv:r,x:X(s.subarray(r==="Ed448"?-57:-56))}}let n=e.export({type:"pkcs8",format:"der"});return{...Ea((0,Yn.createPublicKey)(e)),d:X(n.subarray(r==="Ed448"?-57:-56))}}default:throw new $("Unsupported key asymmetricKeyType")}default:throw new $("Unsupported key type")}},Hm=Ea;async function jm(t){return Hm(t)}async function fw(t,e,r,n,s={}){let i,o,a;switch(va(t,r,"encrypt"),t){case"dir":{a=r;break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!ma(r))throw new $("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:c,apv:l}=s,{epk:f}=s;f||(f=(await _m(r)).privateKey);let{x:u,y:d,crv:p,kty:m}=await jm(f),g=await ha(r,f,t==="ECDH-ES"?e:t,t==="ECDH-ES"?Ai(e):parseInt(t.slice(-5,-2),10),c,l);if(o={epk:{x:u,crv:p,kty:m}},m==="EC"&&(o.epk.y=d),c&&(o.apu=X(c)),l&&(o.apv=X(l)),t==="ECDH-ES"){a=g;break}a=n||Gr(e);let _=t.slice(-6);i=await _i(_,g,a);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{a=n||Gr(e),i=await Rm(t,r,a);break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{a=n||Gr(e);let{p2c:c,p2s:l}=s;({encryptedKey:i,...o}=await Sm(t,r,a,c,l));break}case"A128KW":case"A192KW":case"A256KW":{a=n||Gr(e),i=await _i(t,r,a);break}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{a=n||Gr(e);let{iv:c}=s;({encryptedKey:i,...o}=await $m(t,r,a,c));break}default:throw new $('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:a,encryptedKey:i,parameters:o}}var Vm=fw;var dw=Symbol(),Ca=class{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,r){if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new R("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!fa(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new R("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let n={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(Sa(R,new Map,r==null?void 0:r.crit,this._protectedHeader,n),n.zip!==void 0){if(!this._protectedHeader||!this._protectedHeader.zip)throw new R('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(n.zip!=="DEF")throw new $('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:s,enc:i}=n;if(typeof s!="string"||!s)throw new R('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(typeof i!="string"||!i)throw new R('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');let o;if(s==="dir"){if(this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if(s==="ECDH-ES"&&this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");let a;{let m;({cek:a,encryptedKey:o,parameters:m}=await Vm(s,i,e,this._cek,this._keyManagementParameters)),m&&(r&&dw in r?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...m}:this.setUnprotectedHeader(m):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...m}:this.setProtectedHeader(m))}this._iv||(this._iv=sa(i));let c,l,f;this._protectedHeader?l=dt.encode(X(JSON.stringify(this._protectedHeader))):l=dt.encode(""),this._aad?(f=X(this._aad),c=qe(l,dt.encode("."),dt.encode(f))):c=l;let u,d;if(n.zip==="DEF"){let m=await((r==null?void 0:r.deflateRaw)||pm)(this._plaintext);({ciphertext:u,tag:d}=await Si(i,m,a,this._iv,c))}else({ciphertext:u,tag:d}=await Si(i,this._plaintext,a,this._iv,c));let p={ciphertext:X(u),iv:X(this._iv),tag:X(d)};return o&&(p.encrypted_key=X(o)),f&&(p.aad=f),this._protectedHeader&&(p.protected=lr.decode(l)),this._sharedUnprotectedHeader&&(p.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(p.header=this._unprotectedHeader),p}};var Zn=t=>Math.floor(t.getTime()/1e3);var pw=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,Qn=t=>{let e=pw.exec(t);if(!e)throw new TypeError("Invalid time period format");let r=parseFloat(e[1]);switch(e[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(r*60);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(r*3600);case"day":case"days":case"d":return Math.round(r*86400);case"week":case"weeks":case"w":return Math.round(r*604800);default:return Math.round(r*31557600)}};var Fm=t=>t.toLowerCase().replace(/^application\//,""),hw=(t,e)=>typeof t=="string"?e.includes(t):Array.isArray(t)?e.some(Set.prototype.has.bind(new Set(t))):!1,qm=(t,e,r={})=>{let{typ:n}=r;if(n&&(typeof t.typ!="string"||Fm(t.typ)!==Fm(n)))throw new Je('unexpected "typ" JWT header value',"typ","check_failed");let s;try{s=JSON.parse(lr.decode(e))}catch{}if(!Ct(s))throw new na("JWT Claims Set must be a top-level JSON object");let{requiredClaims:i=[],issuer:o,subject:a,audience:c,maxTokenAge:l}=r;l!==void 0&&i.push("iat"),c!==void 0&&i.push("aud"),a!==void 0&&i.push("sub"),o!==void 0&&i.push("iss");for(let p of new Set(i.reverse()))if(!(p in s))throw new Je(`missing required "${p}" claim`,p,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(s.iss))throw new Je('unexpected "iss" claim value',"iss","check_failed");if(a&&s.sub!==a)throw new Je('unexpected "sub" claim value',"sub","check_failed");if(c&&!hw(s.aud,typeof c=="string"?[c]:c))throw new Je('unexpected "aud" claim value',"aud","check_failed");let f;switch(typeof r.clockTolerance){case"string":f=Qn(r.clockTolerance);break;case"number":f=r.clockTolerance;break;case"undefined":f=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:u}=r,d=Zn(u||new Date);if((s.iat!==void 0||l)&&typeof s.iat!="number")throw new Je('"iat" claim must be a number',"iat","invalid");if(s.nbf!==void 0){if(typeof s.nbf!="number")throw new Je('"nbf" claim must be a number',"nbf","invalid");if(s.nbf>d+f)throw new Je('"nbf" claim timestamp check failed',"nbf","check_failed")}if(s.exp!==void 0){if(typeof s.exp!="number")throw new Je('"exp" claim must be a number',"exp","invalid");if(s.exp<=d-f)throw new hi('"exp" claim timestamp check failed',"exp","check_failed")}if(l){let p=d-s.iat,m=typeof l=="number"?l:Qn(l);if(p-f>m)throw new hi('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(p<0-f)throw new Je('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return s};async function xu(t,e,r){let n=await Lm(t,e,r),s=qm(n.protectedHeader,n.plaintext,r),{protectedHeader:i}=n;if(i.iss!==void 0&&i.iss!==s.iss)throw new Je('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(i.sub!==void 0&&i.sub!==s.sub)throw new Je('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(i.aud!==void 0&&JSON.stringify(i.aud)!==JSON.stringify(s.aud))throw new Je('replicated "aud" claim header parameter mismatch',"aud","mismatch");let o={payload:s,protectedHeader:i};return typeof e=="function"?{...o,key:n.key}:o}var xa=class{constructor(e){this._flattened=new Ca(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,r){let n=await this._flattened.encrypt(e,r);return[n.protected,n.encrypted_key,n.iv,n.ciphertext,n.tag].join(".")}};var ka=class{constructor(e){if(!Ct(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:e}:this._payload={...this._payload,nbf:Zn(new Date)+Qn(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:e}:this._payload={...this._payload,exp:Zn(new Date)+Qn(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:Zn(new Date)}:this._payload={...this._payload,iat:e},this}};var Ci=class extends ka{setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,r){let n=new xa(dt.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),n.setProtectedHeader(this._protectedHeader),this._iv&&n.setInitializationVector(this._iv),this._cek&&n.setContentEncryptionKey(this._cek),this._keyManagementParameters&&n.setKeyManagementParameters(this._keyManagementParameters),n.encrypt(e,r)}};var Pu=ze(require("crypto"),1);var ku=require("crypto"),Gm=(t,e,r,n,s)=>{let i=parseInt(t.substr(3),10)>>3||20,o=(0,ku.createHmac)(t,r.byteLength?r:new Uint8Array(i)).update(e).digest(),a=Math.ceil(s/i),c=new Uint8Array(i*a+n.byteLength+1),l=0,f=0;for(let u=1;u<=a;u++)c.set(n,f),c[f+n.byteLength]=u,c.set((0,ku.createHmac)(t,o).update(c.subarray(l,f+n.byteLength+1)).digest(),f),l=f,f+=i;return c.slice(0,s)};var Jm;typeof Pu.hkdf=="function"&&!process.versions.electron&&(Jm=async(...t)=>new Promise((e,r)=>{Pu.hkdf(...t,(n,s)=>{n?r(n):e(new Uint8Array(s))})}));var Wm=async(t,e,r,n,s)=>(Jm||Gm)(t,e,r,n,s);function mw(t){switch(t){case"sha256":case"sha384":case"sha512":case"sha1":return t;default:throw new TypeError('unsupported "digest" value')}}function Bu(t,e){if(typeof t=="string")return new TextEncoder().encode(t);if(!(t instanceof Uint8Array))throw new TypeError(`"${e}"" must be an instance of Uint8Array or a string`);return t}function yw(t){let e=Bu(t,"ikm");if(!e.byteLength)throw new TypeError('"ikm" must be at least one byte in length');return e}function gw(t){let e=Bu(t,"info");if(e.byteLength>1024)throw TypeError('"info" must not contain more than 1024 bytes');return e}function _w(t,e){if(typeof t!="number"||!Number.isInteger(t)||t<1)throw new TypeError('"keylen" must be a positive integer');let r=parseInt(e.substr(3),10)>>3||20;if(t>255*r)throw new TypeError('"keylen" too large');return t}async function zm(t,e,r,n,s){return Wm(mw(t),yw(e),Bu(r,"salt"),gw(n),_w(s,t))}var ww=30*24*60*60;async function Xm({token:t={},secret:e,maxAge:r=ww}){let n=await Zm(e);return await new Ci(t).setProtectedHeader({alg:"dir",enc:"A256GCM"}).setIssuedAt().setJti(uu()).encrypt(n)}async function Ym({token:t,secret:e}){if(!t)return null;let r=await Zm(e),{payload:n}=await xu(t,r,{clockTolerance:15});return n}async function Zm(t){return await zm("sha256",t,"","com.funzm Generated Encryption Key",32)}function Aw(t){for(var e="",r=t||11,n=Pw(r);r--;)e+=kw[n[r]&63];return e}function vw(t){let e=0,r="",n=new Uint8Array(t);for(;e<n.length;e++)r+=xw[n[e]];return r}var Sw=()=>Aw(128);function ey(t,e){return Cw("SHA-256",t,e,1e3,64).then(vw)}async function ty(t,e){return await ey(e,t.salt)===t.password}async function Ou(t){let e=Sw(),r=await ey(t,e);return{salt:e,password:r}}var ny=new ry.Crypto;function Ew(t,e,r){return ny.subtle.importKey("raw",sy(e),t,!1,r)}async function Cw(t,e,r,n,s){let i=await Ew("PBKDF2",e,["deriveBits"]),o={name:"PBKDF2",salt:sy(r),iterations:n,hash:t};return ny.subtle.deriveBits(o,i,s<<3)}var xw=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];var kw="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-_";function Pw(t){return Qm.default.randomBytes(t)}var Bw=new TextEncoder;var sy=t=>Bw.encode(t);async function iy({token:t,secret:e}){if(!t)return N.Err("\u7F3A\u5C11 token");let r=await Qr(Ym)({token:t,secret:e});if(r.error)return N.Err(r.error,900);let n=r.data;return n===null?N.Err("token \u4E0D\u5408\u6CD5",900):n.id?N.Ok({id:n.id}):N.Err("token \u4E0D\u5408\u6CD5",900)}var es=Pa.default.object({email:Pa.default.string().email().message("\u90AE\u7BB1\u683C\u5F0F\u9519\u8BEF").required(),password:Pa.default.string().min(6).max(20).required()}),pt=class pt{constructor(e){this.nickname="unknown";let{id:r,token:n,settings:s,store:i}=e;this.id=r,this.token=n,this.settings=(()=>{if(!s)return{};let{qiniu_access_token:o,qiniu_secret_token:a,qiniu_scope:c,tmdb_token:l,push_deer_token:f,telegram_token:u,third_douban:d,extra_filename_rules:p,ignore_files_when_sync:m,max_size_when_sync:g,can_register:_,no_need_invitation_code:x}=s;return{qiniu_access_token:o!=null?o:void 0,qiniu_secret_token:a!=null?a:void 0,qiniu_scope:c!=null?c:void 0,tmdb_token:l!=null?l:"c2e5d34999e27f8e0ef18421aa5dec38",telegram_token:u!=null?u:void 0,push_deer_token:f!=null?f:void 0,third_douban:(()=>{if(d&&d.hostname&&d.token)return d})(),extra_filename_rules:p!=null?p:"",ignore_files_when_sync:m,max_size_when_sync:g,can_register:_!=null?_:!1,no_need_invitation_code:x!=null?x:!1}})(),this.store=i}static async New(e,r){if(!e)return N.Err("\u7F3A\u5C11 token",900);let n=await iy({token:e,secret:pt.SECRET});if(n.error)return N.Err(n.error.message,900);let s=n.data.id,i=await r.prisma.user.findFirst({where:{id:s},include:{settings:!0}});if(!i)return N.Err("\u65E0\u6548\u7684 token",900);let o=await pt.ParseSettings(i.settings),a=new pt({id:s,token:e,settings:o,store:r});return N.Ok(a)}static async GetByPassword(e,r){let n=await Qr(es.validateAsync.bind(es))(e);if(n.error)return N.Err(n.error);let{email:s,password:i}=e,o=await r.prisma.credential.findUnique({where:{email:s},include:{user:{include:{settings:!0}}}});if(o===null)return N.Err("\u8BE5\u90AE\u7BB1\u4E0D\u5B58\u5728",904);if(!await ty(o,i))return N.Err("\u5BC6\u7801\u9519\u8BEF");let{id:c}=o.user,{settings:l}=o.user,f=await pt.ParseSettings(l),u=await pt.Token({id:c});if(u.error)return N.Err(u.error);let d=u.data,p=new pt({id:c,settings:f,token:d,store:r});return N.Ok(p)}static async Get(e,r){let{id:n}=e,s=await r.prisma.user.findUnique({where:{id:n},include:{profile:!0,settings:!0}});if(!s)return N.Err("\u4E0D\u5B58\u5728");let{settings:i}=s,o=await pt.ParseSettings(i);return N.Ok(new pt({id:n,token:"",settings:o,store:r}))}static async Existing(e,r){let{email:n}=e,s=await r.prisma.credential.findUnique({where:{email:n},include:{user:{include:{profile:!0}}}});if(s){let{email:i}=s,{id:o,profile:a}=s.user;return N.Ok({id:o,email:i,avatar:a==null?void 0:a.avatar,nickname:a==null?void 0:a.nickname})}return N.Err("\u4E0D\u5B58\u5728")}static async Create(e,r){var g;let n=await r.prisma.user.findMany({include:{credential:!0},take:1,orderBy:{created:"asc"}});if(n.length!==0)return N.Err(`\u5DF2\u7ECF\u6709\u7BA1\u7406\u5458\u8D26\u53F7\u4E86\uFF0C\u90AE\u7BB1\u4E3A ${(g=n[0].credential)==null?void 0:g.email}`);let s=await Qr(es.validateAsync.bind(es))(e);if(s.error)return N.Err(s.error);let{email:i,password:o}=e;if(await r.prisma.credential.findUnique({where:{email:i}})!==null)return N.Err("\u8BE5\u90AE\u7BB1\u5DF2\u6CE8\u518C");let{password:c,salt:l}=await Ou(o),f=i.split("@").shift(),u=await r.prisma.user.create({data:{id:Sn(),settings:{create:{id:Sn(),detail:"{}"}},credential:{create:{id:Sn(),email:i,password:c,salt:l}},profile:{create:{id:Sn(),nickname:f}},statistics:{create:{id:Sn(),data:JSON.stringify(Tu)}}}}),{id:d}=u,p=await pt.Token({id:d});if(p.error)return N.Err(p.error);let m=p.data;return N.Ok({id:d,token:m})}static async Token({id:e}){try{let r=await Xm({token:{id:e},secret:pt.SECRET});return N.Ok(r)}catch(r){let n=r;return N.Err(n)}}static async ChangePassword(e,r){let n=await Qr(es.validateAsync.bind(es))(e);if(n.error)return N.Err(n.error);let{email:s,password:i}=e,o=await r.prisma.credential.findUnique({where:{email:s}});if(!o)return N.Err("\u8BE5\u90AE\u7BB1\u672A\u6CE8\u518C");let{id:a}=o,{password:c,salt:l}=await Ou(i),f=await r.prisma.credential.update({where:{id:a},data:{password:c,salt:l},include:{user:!0}}),{user:u}=f,d=await pt.Token({id:u.id});if(d.error)return N.Err(d.error);let p=d.data;return N.Ok({id:u.id,token:p})}static async ParseSettings(e){if(!e)return{};let{detail:r}=e;if(!r)return{};let n=Ku(r);return n.error?{}:n.data}async register(e){}async login_with_password(e){}async update_settings(e){this.store.prisma.settings.update({where:{user_id:this.id},data:{}})}get_ignore_files(){let{ignore_files_when_sync:e=""}=this.settings;return e?e.split(`

`).filter(Boolean):[]}get_filename_rules(){let{extra_filename_rules:e=""}=this.settings;return e?e.split(`

`).map(s=>{let[i,o]=s.split(`
`);return{regexp:i,placeholder:o}}).filter(s=>{let{regexp:i,placeholder:o}=s;if(!i||!o)return!1;try{new RegExp(i)}catch{return!1}return!0}).map(s=>({replace:[s.regexp,s.placeholder]})):[]}};pt.SECRET="FLIX";var Ba=pt;async function Ow(){let t=process.env.OUTPUT_PATH;if(!t){console.error("\u7F3A\u5C11\u6570\u636E\u5E93\u6587\u4EF6\u8DEF\u5F84");return}let r=process.argv[2];if(!r){console.error("\u8BF7\u6307\u5B9A\u65B0\u5BC6\u7801\uFF0C\u5982 node pwd.js new_pwd");return}let s=new Oi({root_path:t}).store,i=await Ba.ChangePassword({email:"admin@flix.com",password:r},s);if(i.error){console.log(i.error.message);return}console.log("update password success!")}Ow();

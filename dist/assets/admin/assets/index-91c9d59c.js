import{d as ft,r as gl,t as vl,m as Dn,p as _l,q as qi,a as an,b as Pe,c as z,i as o,e as oe,f as be,g as r,S as X,h,L as Mt,j as $l,o as tt,s as Ns,k as xe,u as dt,l as Hs,n as ji,v as Ui,C as wl,w as pt,x as qs,P as js,F as ie,y as Lt,z as Qt,A as Mn,X as ys,B as Wi,M as cn,I as xl,D as bl,E as Cl,G as Sl,H as Yi,J as Bs,K as ot,N as yl,O as kl,Q as Ll,R as Tn,T as Bn,U as Gt,V as Pl,W as Rl,Y as Us,Z as Dl,_ as Ml,$ as Tl,a0 as Bl,a1 as Gi,a2 as El,a3 as Fl,a4 as En,a5 as ri,a6 as Ol,a7 as Jt,a8 as Il,a9 as Vl,aa as xt,ab as Al,ac as us,ad as zl,ae as Ws,af as Ji,ag as Es,ah as Dt,ai as Nl,aj as hs,ak as Ki,al as Zt,am as Xi,an as Fn,ao as Qi,ap as Hl,aq as ql,ar as On,as as jl,at as Ul,au as Wl,av as Zi,aw as Yl,ax as li,ay as Gl,az as Jl,aA as Kl,aB as Ys,aC as In,aD as er,aE as Xl,aF as Ql,aG as Zl,aH as eo,aI as to,aJ as so,aK as no,aL as io,aM as Fs,aN as ro,aO as lo,aP as oo,aQ as tr,aR as ao,aS as co,aT as uo}from"./vendor-b20170bd.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();class rs extends Error{message;code;data=null;constructor(e,s,n=null){super(e),this.message=e,this.code=s,this.data=n}}const P={Ok:t=>({data:t,error:null}),Err:(t,e,s=null)=>({data:s,code:e,error:(()=>typeof t=="string"?new rs(t,e,s):t instanceof rs?t:typeof t=="object"?new rs(t.message,e,s):t?t.error:new rs("未知错误",e,s))()})};ft.extend(gl);ft.locale("zh-cn");function de(...t){return vl(t)}function Wt(t){return t===null||t===void 0?"":Object.keys(t).filter(e=>t[e]!==void 0).map(e=>`${e}=${encodeURIComponent(t[e])}`).join("&")}function cs(t){if(!t||t===0)return"0KB";const e=["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"];let s=Math.floor(Math.log(t)/Math.log(1024));if(s<1)return t+" "+e[0];t=Number((t/Math.pow(1024,s)).toFixed(2));const n=t,i=e[s];if(Number.isInteger(n))return`${n}${i}`;function l(a){let c=Number(a);return String(a).indexOf(".")>-1&&(c=parseFloat(a.toString().replace(/0+?$/g,""))),c}return`${l(n.toFixed(2))}${i}`}function Os(t=1e3){return new Promise(e=>{setTimeout(()=>{e(null)},t)})}function ho(t){try{const e=new RegExp(t);return P.Ok(e)}catch(e){const s=e;return P.Err(s.message)}}const fo=/\.[mM][kK][vV]$|\.[mM][pP]4$|\.[tT][sS]$|\.[fF][lL][vV]$|\.[rR][mM][vV][bB]$|\.[mM][oO][vV]$/;function po(t){return fo.test(t)}const oi={get(t,e,s={}){const{headers:n}=s;return{url:[t,e?"?"+Wt(e):""].join(""),method:"GET",headers:n}},post(t,e,s={}){const{headers:n}=s;return{url:t,method:"POST",body:e,headers:n}}};function mo(t={}){const{hostnames:e={}}=t;let s=e.prod||"",n=t.headers??{},i=t.debug??!1;return{getHostname(){return s},setHostname(l){s=l},setHeaders(l){n=l},deleteHeaders(l){delete n[l]},appendHeaders(l){n={...n,...l}},setEnv(l){const{prod:a="",dev:c=a,test:d=a,beta:u=a}=e;l==="dev"&&(s=c),l==="test"&&(s=d),l==="beta"&&(s=u),l==="prod"&&(s=a)},setDebug(l){i=l},get(...l){const a=oi.get(...l),{url:c,method:d,query:u,params:f,body:p,headers:m}=a;return{hostname:s,url:c,method:d,query:u,params:f,body:p,headers:{...a.headers,...n},process:t.process}},post(...l){const a=oi.post(...l),{url:c,method:d,query:u,params:f,body:p={}}=a;return{hostname:s,url:c,method:d,query:u,params:f,body:p,headers:{...a.headers,...n},process:t.process}}}}const Y=mo({hostnames:{dev:"https://media-t.funzm.com",test:"https://media-t.funzm.com",prod:""},process(t){if(t.error)return P.Err(t.error.message);const{code:e,msg:s,data:n}=t.data;return e!==0?P.Err(s,e,n):P.Ok(n)}});let ai=0;function go(){return ai+=1,ai}function Vn(){const t=Dn();let e=[];return{off(s,n){t.off(s,n)},on(s,n){const i=()=>{e=e.filter(l=>l!==i),this.off(s,n)};return e.push(i),t.on(s,n),i},emit(s,n){t.emit(s,n)},destroy(){for(let s=0;s<e.length;s+=1){const n=e[s];n()}this.emit("__destroy",null)}}}class $e{unique_id="BaseDomain";debug=!1;_emitter=Dn();listeners={};constructor(e={}){const{unique_id:s,debug:n}=e;s&&(this.unique_id=s)}uid(){return go()}log(...e){return this.debug?[`%c CORE %c ${this.unique_id} %c`,"color:white;background:#dfa639;border-top-left-radius:2px;border-bottom-left-radius:2px;","color:white;background:#19be6b;border-top-right-radius:2px;border-bottom-right-radius:2px;","color:#19be6b;",...e]:[]}errorTip(...e){this.debug}off(e,s){this._emitter.off(e,s)}offEvent(e){const s=this.listeners[e]||[];for(let n=0;n<s.length;n+=1){const i=s[n];i()}}on(e,s){const n=()=>{const l=this.listeners[e]||[];this.listeners[e]=l.filter(a=>a!==n),this.off(e,s)};return(this.listeners[e]||[]).push(n),this._emitter.on(e,s),n}emit(e,s){this._emitter.emit(e,s)}tip(e){return this._emitter.emit("__tip",e),e.text.join(`
`)}destroy(){Object.keys(this.listeners).map(e=>{const s=this.listeners[e]||[];for(let n=0;n<s.length;n+=1){const i=s[n];i()}}),this.emit("__destroy")}onTip(e){return this.on("__tip",e)}onDestroy(e){return this.on("__destroy",e)}get[Symbol.toStringTag](){return"Domain"}}let wn=null;function vo(t){wn=t}class I extends $e{debug=!1;defaultResponse=null;service;process;client;delay=800;loading=!1;pending=null;args=[];response=null;error=null;id=String(this.uid());get state(){return{loading:this.loading,error:this.error,response:this.response}}constructor(e,s={}){super();const{client:n,delay:i,defaultResponse:l,process:a,onSuccess:c,onFailed:d,onCompleted:u,onCanceled:f,onLoading:p,beforeRequest:m}=s;this.service=e,this.process=a,this.client=n,i!==void 0&&(this.delay=i),l&&(this.defaultResponse=l,this.response=l),c&&this.onSuccess(c),d&&this.onFailed(d,{override:!0}),u&&this.onCompleted(u),f&&this.onCanceled(f),p&&this.onLoadingChange(p),m&&this.beforeRequest(m),wn&&wn(this)}async run(...e){if(!this.service)return P.Err("缺少 service");if(typeof this.service!="function")return P.Err("service 不是函数");if(!this.client)return P.Err("缺少 client");if(this.pending!==null){const d=await this.pending;this.loading=!1;const u=d.data;return this.pending=null,P.Ok(u)}this.loading=!0,this.response=this.defaultResponse,this.args=e,this.error=null,this.emit(2,!0),this.emit(7,{...this.state}),this.emit(0);let s=null;const n=(()=>{const{hostname:d="",url:u,method:f,query:p,body:m,headers:g,process:C}=this.service(...e);if(C&&(s=C),f==="GET"){const v=this.client.get(d+u,p,{id:this.id,headers:g});return P.Ok(v)}if(f==="POST"){const v=this.client.post(d+u,m,{id:this.id,headers:g});return P.Ok(v)}return P.Err(`未知的 method '${f}'`)})();if(n.error)return P.Err(n.error.message);this.pending=n.data;const[i]=await Promise.all([this.pending,this.delay===null?null:Os(this.delay)]);this.loading=!1;const l=(()=>s?s(i):i)(),a=this.process?this.process(l):l;if(this.emit(2,!1),this.emit(7,{...this.state}),this.emit(5),this.pending=null,a.error)return a.error.code==="CANCEL"?(this.emit(6),P.Err(a.error)):(this.error=a.error,this.emit(4,a.error),this.emit(7,{...this.state}),P.Err(a.error.message));const c=a.data;return this.response=c,this.emit(3,c),this.emit(7,{...this.state}),this.emit(8,c),P.Ok(c)}reload(){this.run(...this.args)}cancel(){if(!this.client)return P.Err("缺少 client");this.client.cancel(this.id)}clear(){this.response=null,this.emit(7,{...this.state}),this.emit(8,this.response)}modifyResponse(e){if(this.response===null)return;const s=e(this.response);this.response=s,this.emit(7,{...this.state}),this.emit(8,this.response)}onLoadingChange(e){return this.on(2,e)}beforeRequest(e){return this.on(0,e)}onSuccess(e){return this.on(3,e)}onFailed(e,s={}){return s.override&&this.offEvent(4),this.on(4,e)}onCanceled(e){return this.on(6,e)}onError(e){return this.on(4,e)}onCompleted(e){return this.on(5,e)}onStateChange(e){return this.on(7,e)}onResponseChange(e){return this.on(8,e)}}function _o(t){return Y.post("/api/admin/user/login",t)}function $o(t){return Y.post("/api/admin/user/register",t)}function wo(){return Y.get("/api/admin/user/profile")}function xo(t){return Y.post("/api/admin/user/validate",{token:t})}var sr=(t=>(t[t.Tip=0]="Tip",t[t.Error=1]="Error",t[t.Login=2]="Login",t[t.Logout=3]="Logout",t[t.Expired=4]="Expired",t[t.StateChange=5]="StateChange",t))(sr||{});class bo extends $e{name="UserCore";debug=!1;id="";username="Anonymous";avatar="";token="";isLogin=!1;needRegister=!1;get state(){return{id:this.id,username:this.username,avatar:this.avatar,token:this.token}}values={};$client;static Events=sr;constructor(e,s){super(e);const{id:n,username:i,avatar:l,token:a}=e;this.id=n,this.username=i,this.avatar=l,this.isLogin=!!a,this.token=a,this.$client=s}inputEmail(e){this.values.email=e}inputPassword(e){this.values.password=e}async validate(){if(!this.token)return this.emit(4),P.Err("缺少 token");const e=await new I(xo).run(this.token);return e.error?(e.error.code===900&&(this.isLogin=!1,this.emit(4)),P.Err(e.error)):P.Ok(null)}async login(){const{email:e,password:s}=this.values;if(!e){const d=this.tip({text:["请输入邮箱"]});return P.Err(d)}if(!s){const d=this.tip({text:["请输入密码"]});return P.Err(d)}const n=await new I(_o).run({email:e,password:s});if(n.error)return this.tip({text:["登录失败",n.error.message]}),P.Err(n.error);this.values={},this.isLogin=!0;const{id:i,username:l,avatar:a,token:c}=n.data;return this.id=i,this.username=l,this.avatar=a,this.token=c,this.emit(2,{...this.state,token:this.token}),P.Ok(n.data)}logout(){this.isLogin=!1,this.emit(3)}async register(){const{email:e,password:s}=this.values;if(!e){const d=this.tip({text:["请输入邮箱"]});return P.Err(d)}if(!s){const d=this.tip({text:["请输入密码"]});return P.Err(d)}const n=await new I($o).run({email:e,password:s});if(n.error)return this.tip({text:["注册失败",n.error.message]}),P.Err(n.error);this.values={},this.isLogin=!0;const{id:i,username:l,avatar:a,token:c}=n.data;return this.id=i,this.username=l,this.avatar=a,this.token=c,this.needRegister=!1,this.emit(2,{...this.state,token:this.token}),P.Ok(n.data)}async fetchProfile(){if(!this.isLogin)return P.Err("请先登录");const e=await new I(wo).run();return e.error?e:P.Ok(e.data)}onError(e){return this.on(1,e)}onLogin(e){return this.on(2,e)}onLogout(e){return this.on(3,e)}onExpired(e){return this.on(4,e)}}function nr(t,e){let s;return function(...i){s&&clearTimeout(s),s=setTimeout(()=>{e(...i),s=null},t)}}const Is=10,ls=1,xn=0,dn={dataSource:[],page:ls,pageSize:Is,total:xn,search:{},initial:!0,noMore:!1,loading:!1,refreshing:null,empty:!1,error:null},un={page:ls,pageSize:Is,next_marker:""};function Co(t,e){const s={...t};return e.forEach(n=>{delete s[n]}),s}const So=t=>{if(t===null)return{dataSource:[],page:1,pageSize:Is,total:xn,noMore:!1,empty:!1,error:new Error("process response fail, because response is null")};try{const e=t,{list:s,page:n=1,pageSize:i=10,total:l=0,isEnd:a}=e,c={dataSource:s,page:n,pageSize:i,total:l,noMore:!1,empty:!1,error:null};return l&&i&&n&&l<=i*n&&(c.noMore=!0),a!==void 0&&(c.noMore=a),i&&s.length<i&&(c.noMore=!0),s.length===0&&n===1&&(c.empty=!0),c}catch(e){return{dataSource:[],page:1,pageSize:Is,total:xn,noMore:!1,empty:!1,error:new Error(`process response fail, because ${e.message}`)}}};class Oe extends $e{debug=!1;static defaultResponse=()=>({...dn});static commonProcessor=So;request;beforeRequest=(e,s)=>({...s,...e});processor;initialParams;extraResponse;params={...un};response={...dn};rowKey;constructor(e,s={}){if(super(),!(e instanceof I))throw new Error("fetch must be a instance of RequestCore");const{debug:n,rowKey:i="id",beforeRequest:l,processor:a,extraDefaultResponse:c,onLoadingChange:d,onStateChange:u,beforeSearch:f,afterSearch:p}=s;this.debug=!!n,this.rowKey=i,this.request=e,this.processor=m=>{const g={...this.response,...Oe.commonProcessor(m)};if(a){const C=a(g,m);if(C!==void 0)return C}return g},l!==void 0&&(this.beforeRequest=l),this.initialParams={...un},this.extraResponse={...c},d&&this.onLoadingChange(d),u&&this.onStateChange(u),f&&this.onBeforeSearch(f),p&&this.onAfterSearch(p),this.initialize(s)}initialize(e){const{search:s,dataSource:n,page:i,pageSize:l,initial:a}=e;s!==void 0&&(this.initialParams={...this.initialParams,...s},this.extraResponse.search=s),n!==void 0&&(this.extraResponse.dataSource=n),i!==void 0&&(this.initialParams.page=i,this.extraResponse.page=i),l!==void 0&&(this.initialParams.pageSize=l,this.extraResponse.pageSize=l),a!==void 0&&(this.extraResponse.initial=a),this.params={...this.initialParams},this.response={...Oe.defaultResponse(),...this.extraResponse};const{page:c,pageSize:d,...u}=this.params,f={search:u};c&&(f.page=c),d&&(f.pageSize=d),this.response={...this.response,...f,search:{...this.response.search}}}setParams(e){let s={...this.params,...e};typeof e=="function"&&(s=e(this.params)),this.params=s,this.emit(3,{...this.params})}setDataSource(e){this.response.dataSource=e,this.emit(6,{...this.response})}async fetch(e,...s){this.response.error=null,this.response.loading=!0,this.emit(0,!0),this.emit(6,{...this.response});const n={...this.params,...e};let i=this.beforeRequest({...n},this.params);i===void 0&&(i=n);const l=[i,...s],a=await this.request.run(...l);if(this.response.loading=!1,this.response.search=Co({...n},["page","pageSize"]),this.response.initial&&(this.response.initial=!1),this.params={...i},this.emit(0,!1),this.emit(3,{...this.params}),this.emit(8),a.error)return P.Err(a.error);const c=a.data;let d=this.processor(c);return e.page===1&&d.dataSource.length===0&&(d.empty=!0),d.next_marker&&(this.params.next_marker=d.next_marker),d.dataSource===void 0&&(d.dataSource=[]),P.Ok(d)}async init(e={}){const s=await this.fetch({...this.initialParams,...e});return s.error?(this.tip({icon:"error",text:[s.error.message]}),this.response.error=s.error,this.emit(7,s.error),this.emit(6,{...this.response}),P.Err(s.error)):(this.response={...this.response,...s.data},this.emit(6,{...this.response}),this.emit(5,[...s.data.dataSource]),this.emit(4,[...this.response.dataSource]),P.Ok({...this.response}))}async initAny(){return this.response.initial?this.init():(this.emit(6,{...this.response}),P.Ok(this.response))}async next(){const{page:e,...s}=this.params,n=await this.fetch({...s,page:e+1});return n.error?(this.tip({icon:"error",text:[n.error.message]}),this.response.error=n.error,this.emit(7,n.error),this.emit(6,{...this.response}),P.Err(n.error)):(this.response={...this.response,...n.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),P.Ok({...this.response}))}async prev(){const{page:e,...s}=this.params,n=await this.fetch({...s,page:(()=>e<=ls?ls:e-1)()});return n.error?(this.tip({icon:"error",text:[n.error.message]}),this.response.error=n.error,this.emit(7,n.error),this.emit(6,{...this.response}),P.Err(n.error)):(this.response={...this.response,...n.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),P.Ok({...this.response}))}nextWithCursor(){}async loadMoreForce(){const{page:e,...s}=this.params,n=await this.fetch({...s,page:e+1});if(n.error)return this.tip({icon:"error",text:[n.error.message]}),this.response.error=n.error,this.emit(7,n.error),this.emit(6,{...this.response}),P.Err(n.error);n.data.dataSource.length===0&&(this.params.page-=1);const i=this.response.dataSource;return this.response={...this.response,...n.data},this.response.dataSource=i.concat(n.data.dataSource),this.emit(6,{...this.response}),this.emit(5,[...n.data.dataSource]),this.emit(4,[...this.response.dataSource]),P.Ok({...this.response})}async loadMore(){if(this.response.loading||this.response.noMore)return;const{page:e,...s}=this.params,n=await this.fetch({...s,page:e+1});if(n.error)return this.tip({icon:"error",text:[n.error.message]}),this.response.error=n.error,this.emit(7,n.error),this.emit(6,{...this.response}),P.Err(n.error);const i=this.response.dataSource;return this.response={...this.response,...n.data},this.response.dataSource=i.concat(n.data.dataSource),this.emit(6,{...this.response}),this.emit(5,[...n.data.dataSource]),this.emit(4,[...this.response.dataSource]),P.Ok({...this.response})}async goto(e,s){const{page:n,pageSize:i,...l}=this.params,a=await this.fetch({...l,page:(()=>e<=ls?ls:e)(),pageSize:(()=>s!==void 0?s:i)()});return a.error?(this.tip({icon:"error",text:[a.error.message]}),this.response.error=a.error,this.emit(7,a.error),this.emit(6,{...this.response}),P.Err(a.error)):(this.response={...this.response,...a.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),P.Ok({...this.response}))}async search(e){this.emit(1);const s=await this.fetch({...this.initialParams,...e});return this.emit(2,{params:e}),s.error?(this.tip({icon:"error",text:[s.error.message]}),this.response.error=s.error,this.emit(7,s.error),this.emit(6,{...this.response}),P.Err(s.error)):(this.response={...this.response,...s.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),P.Ok({...this.response}))}searchDebounce=nr(800,e=>this.search(e));async reset(e={}){this.params={...this.initialParams};const s=await this.fetch(e);return s.error?(this.tip({icon:"error",text:[s.error.message]}),this.response.error=s.error,this.emit(7,s.error),this.emit(6,{...this.response}),P.Err(s.error)):(this.response={...this.response,...s.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),P.Ok({...this.response}))}reload(){return this.fetch({})}async refresh(){const{page:e,...s}=this.params;this.response.refreshing=!0,this.emit(6,{...this.response});const n=await this.fetch({...s,page:1,next_marker:""});return this.response.refreshing=!1,n.error?(this.tip({icon:"error",text:[n.error.message]}),this.response.error=n.error,this.emit(7,n.error),this.emit(6,{...this.response}),P.Err(n.error)):(this.response={...this.response,...n.data},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource]),P.Ok({...this.response}))}clear(){this.response={...dn},this.params={...un},this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource])}deleteItem(e){const{dataSource:s}=this.response,n=s.filter(i=>!e(i));this.response.total=n.length,this.response.dataSource=n,this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource])}async deleteItems(e){const{dataSource:s}=this.response,n=s.filter(i=>!e.includes(i));this.response.total=n.length,this.response.dataSource=n,this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource])}modifyItem(e){const{dataSource:s}=this.response,n=[];for(let i=0;i<s.length;i+=1){const l=s[i];let a=e(l);a||(a=l),n.push(a)}this.response.dataSource=n,this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource])}replaceDataSource(e){this.response.dataSource=e,this.emit(4,[...this.response.dataSource])}modifyDataSource(e){this.response.dataSource=this.response.dataSource.map(s=>e(s)),this.emit(6,{...this.response}),this.emit(4,[...this.response.dataSource])}modifyResponse(e){this.response=e({...this.response}),this.emit(6,{...this.response})}modifyParams(e){this.params=e(this.params),this.emit(3,{...this.params})}modifySearch(e){this.params={...e(this.params),page:this.params.page,pageSize:this.params.pageSize},this.emit(3,{...this.params})}onStateChange(e){return this.on(6,e)}onLoadingChange(e){return this.on(0,e)}onBeforeSearch(e){return this.on(1,e)}onAfterSearch(e){return this.on(2,e)}onDataSourceChange(e){return this.on(4,e)}onDataSourceAdded(e){return this.on(5,e)}onError(e){return this.on(7,e)}onComplete(e){return this.on(8,e)}}class Fe extends $e{value=null;get state(){return this.value}constructor(e={}){super(e);const{defaultValue:s,onChange:n}=e;s&&(this.value=s),n&&this.onStateChange(n)}select(e){this.value=e,this.emit(0,this.value)}patch(e){this.value={...this.value,...e},this.emit(0,this.value)}isEmpty(){return this.value===null}clear(){this.value=null,this.emit(0)}onStateChange(e){return this.on(0,e)}}class Q extends $e{id=this.uid();cur;state={text:"Click it",loading:!1,disabled:!1};constructor(e={}){super(e),this.cur=new Fe;const{onClick:s}=e;s&&this.onClick(()=>{s(this.cur.value)})}click(){this.state.loading||this.state.disabled||this.emit(0)}disable(){this.state.disabled=!0,this.emit(1,{...this.state})}enable(){this.state.disabled=!1,this.emit(1,{...this.state})}bind(e){return this.cur.select(e),this}setLoading(e){this.state.loading!==e&&(this.state.loading=e,this.emit(1,{...this.state}))}onClick(e){this.on(0,e)}onStateChange(e){this.on(1,e)}}class Ae extends $e{btns=[];cur=null;constructor(e={}){super(e);const{onClick:s}=e;s&&this.onClick(s)}bind(e){const s=this.btns.find(i=>i.cur.value===e);if(s)return s;const n=new Q({onClick:i=>{this.cur=n,this.emit(0,i)}});return n.bind(e),this.btns.push(n),n}clear(){this.cur=null}setLoading(e){if(this.cur===null){for(let s=0;s<this.btns.length;s+=1)this.btns[s].setLoading(e);return}this.cur.setLoading(e)}click(){this.cur!==null&&this.cur.click()}onClick(e){this.on(0,e)}onStateChange(e){this.on(1,e)}}class kt extends $e{name="PresenceCore";debug=!1;animationName="none";mounted=!1;enter=!1;visible=!1;exit=!1;get state(){return{mounted:this.mounted,enter:this.enter,visible:this.visible,exit:this.exit,text:(()=>this.exit?"exit":this.enter?"enter":this.visible?"visible":"unknown")()}}constructor(e={}){super(e);const{mounted:s=!1,visible:n=!1}=e;this.mounted=s,this.visible=n,n&&(this.mounted=!0)}toggle(){if(this.visible){this.hide();return}this.show()}show(){this.mounted=!0,this.enter=!0,this.visible=!0,this.emit(0,{...this.state}),setTimeout(()=>{this.emit(2)},120)}hide(e={}){const{destroy:s=!0}=e;if(s===!1){this.visible=!1,this.emit(4),this.emit(0,{...this.state});return}this.exit=!0,this.emit(0,{...this.state}),setTimeout(()=>{this.visible=!1,this.emit(4),this.emit(0,{...this.state}),this.unmount()},120)}unmount(){this.mounted=!1,this.enter=!1,this.visible=!1,this.exit=!1,this.emit(6),this.emit(0,{...this.state})}reset(){this.mounted=!1,this.enter=!1,this.visible=!1,this.exit=!1,this.emit(0,{...this.state})}onTmpShow(e){return this.on(3,e)}onTmpHidden(e){return this.on(5,e)}onShow(e){return this.on(2,e)}onHidden(e){return this.on(4,e)}onUnmounted(e){return this.on(6,e)}onStateChange(e){return this.on(0,e)}onPresentChange(e){return this.on(1,e)}get[Symbol.toStringTag](){return"Presence"}}class mt extends $e{presence;label;disabled;checked;defaultChecked;get state(){return{label:this.label,checked:this.checked,disabled:this.disabled}}prevChecked=!1;constructor(e={}){super(e);const{label:s="",disabled:n=!1,checked:i=!1,onChange:l}=e;this.label=s,this.disabled=n,this.checked=i,this.defaultChecked=i,this.presence=new kt,l&&this.onChange(l)}toggle(){const e=this.checked;(()=>{if(e){this.presence.hide();return}this.presence.show()})(),this.checked=!0,e&&(this.checked=!1),this.prevChecked=e,this.emit(1,this.checked),this.emit(0,{...this.state})}check(){this.checked!==!0&&(this.presence.show(),this.prevChecked=this.checked,this.checked=!0,this.emit(0,{...this.state}))}uncheck(){this.checked!==!1&&(this.presence.hide(),this.prevChecked=this.checked,this.checked=!1,this.emit(0,{...this.state}))}reset(){this.checked=this.defaultChecked}onChange(e){return this.on(1,e)}onStateChange(e){return this.on(0,e)}}class An extends $e{_name="PopperCore";debug=!0;placement="bottom";strategy="absolute";middleware=[];reference=null;floating=null;container=null;arrow=null;state={strategy:"absolute",x:0,y:0,isPlaced:!1,placedSide:"bottom",placedAlign:"center",reference:!1};_enter=!1;_focus=!1;constructor(e={}){super(e);const{_name:s,side:n="bottom",align:i="center",strategy:l="absolute",middleware:a=[]}=e;s&&(this._name=s),this.strategy=l,this.placement=n+(i!=="center"?"-"+i:"")}setReference(e){this.reference===null&&(this.reference=e,this.state.reference=!0,this.emit(0,e),this.emit(5,{...this.state}))}updateReference(e){this.log("updateReference",this.reference),this.reference=e}removeReference(){this.reference!==null&&(this.state.reference=!1,this.reference=null,this.emit(5,{...this.state}))}setFloating(e){e!==null&&(this.floating=e,this.emit(1,e))}setArrow(e){this.arrow=e}setContainer(e){}setConfig(e){}async place(){if(this.middleware=[],this.reference===null||this.floating===null)return;const e=await this.computePosition(),{x:s,y:n,middlewareData:i}=e,[l,a]=yo(this.placement);this.state={x:s,y:n,strategy:this.strategy,isPlaced:!0,placedSide:l,placedAlign:a,reference:!0},this.emit(5,{...this.state})}async computePosition(){const{placement:s,strategy:n}=this;let i=s;const l=this.reference.getRect(),a=this.floating.getRect(),c={reference:l,floating:a};let{x:d,y:u}=this.computeCoordsFromPlacement(c,s,!0),f={};for(let p=0;p<this.middleware.length;p++){const{name:m,fn:g}=this.middleware[p],{x:C,y:v,data:w,reset:$}=await g({x:d,y:u,initialPlacement:s,placement:i,strategy:n,middlewareData:f,rects:c,elements:{reference:l,floating:a}});d=C??d,u=v??u,f={...f,[m]:{...f[m],...w}}}return{x:d,y:u,placement:i,strategy:n,middlewareData:f}}computeCoordsFromPlacement(e,s,n){const{reference:i,floating:l}=e,a=i.x+i.width/2-l.width/2,c=i.y+i.height/2-l.height/2,d=ko(s),u=Lo(d),f=i[u]/2-l[u]/2,p=ir(s),m=d==="x";let g;switch(p){case"top":g={x:a,y:i.y-l.height};break;case"bottom":g={x:a,y:i.y+i.height};break;case"right":g={x:i.x+i.width,y:c};break;case"left":g={x:i.x-l.width,y:c};break;default:g={x:i.x,y:i.y}}switch(Po(s)){case"start":g[d]-=f*(n&&m?-1:1);break;case"end":g[d]+=f*(n&&m?-1:1);break}return g}enter(){this._enter!==!0&&(this._enter=!0,this.emit(3))}leave(){this._enter!==!1&&(this._enter=!1,this.emit(4))}reset(){this._enter=!1,this._focus=!1}onReferenceMounted(e){return this.on(0,e)}onFloatingMounted(e){return this.on(1,e)}onContainerChange(e){return this.on(6,e)}onEnter(e){return this.on(3,e)}onLeave(e){return this.on(4,e)}onPlaced(e){return this.on(2,e)}onStateChange(e){return this.on(5,e)}get[Symbol.toStringTag](){return"PopperCore"}}function yo(t){const[e,s="center"]=t.split("-");return[e,s]}function ir(t){return t.split("-")[0]}function ko(t){return["top","bottom"].includes(ir(t))?"x":"y"}function Lo(t){return t==="y"?"height":"width"}function Po(t){return t.split("-")[1]}class zn extends $e{name="DismissableLayerCore";layers=new Set;layersWithOutsidePointerEventsDisabled=new Set;branches=new Set;isPointerInside=!1;state={};constructor(e={}){super(e)}handlePointerOutside(e){}pointerDown(){this.isPointerInside=!0}handlePointerDownOnTop(e){if(this.isPointerInside===!0){this.isPointerInside=!1;return}this.emit(2),this.emit(3),this.emit(0)}onDismiss(e){return this.on(0,e)}}class Cs extends $e{_name="MenuCore";debug=!0;popper;presence;layer;openTimer=null;state={open:!1,items:[]};constructor(e={}){super(e);const{_name:s,items:n=[],side:i,align:l,strategy:a}=e;s&&(this._name=s),this.state.items=n,this.items=n,this.popper=new An({side:i,align:l,strategy:a,_name:s?`${s}__popper`:"menu__popper"}),this.presence=new kt,this.layer=new zn,this.listenItems(n),this.popper.onEnter(()=>{this.emit(4)}),this.popper.onLeave(()=>{this.emit(5)}),this.layer.onDismiss(()=>{this.hide()}),this.presence.onHidden(()=>{this.reset(),this.curSub&&this.curSub.hide()})}subs=[];items=[];curSub=null;curItem=null;inside=!1;inSubMenu=!1;maybeHideSub=!1;hideSubTimer=null;toggle(){const{open:e}=this.state;if(e){this.hide();return}this.show()}show(){this.presence.show(),this.popper.place(),this.emit(0)}hide(){this.presence.hide(),this.emit(1),this.emit(6,{...this.state})}listenItems(e){for(let s=0;s<e.length;s+=1){const n=e[s];if(n.onEnter(()=>{this.maybeHideSub=!1,n.menu&&(this.maybeHideSub=!1,n.menu.show()),!n.menu&&this.curSub&&this.curSub.hide(),this.emit(2,n)}),n.onLeave(()=>{if(this.maybeHideSub=!0,this.emit(3,n),this.hideSubTimer!==null){clearInterval(this.hideSubTimer),this.hideSubTimer=setTimeout(()=>{this.checkNeedHideSubMenu(n)},100);return}this.hideSubTimer=setTimeout(()=>{this.checkNeedHideSubMenu(n)},100)}),!n.menu)continue;const i=n.menu;if(i.onShow(()=>{this.log("sub.onShow"),this.curSub=i}),i.onEnter(()=>{this.log("sub.onEnter"),this.inSubMenu=!0}),i.onLeave(()=>{this.log("sub.onLeave"),this.inSubMenu=!1}),i.onHide(()=>{this.log("sub.onHide"),this.curSub=null}),this.subs.includes(i))return;this.subs.push(i)}}setItems(e){this.log("set items",e),this.state.items=e,this.items=e,this.listenItems(e),this.emit(6,{...this.state})}checkNeedHideSubMenu(e){this.hideSubTimer&&clearTimeout(this.hideSubTimer),this.hideSubTimer=null,this.maybeHideSub!==!1&&this.curSub&&!this.inSubMenu&&this.curSub.hide()}reset(){this.inSubMenu=!1,this.curItem=null,this.curSub=null,this.maybeHideSub=!1,this.hideSubTimer=null,this.presence.reset(),this.popper.reset();for(let e=0;e<this.items.length;e+=1)this.items[e].reset()}unmount(){super.destroy(),this.layer.destroy(),this.popper.destroy(),this.presence.unmount();for(let e=0;e<this.subs.length;e+=1)this.subs[e].unmount();for(let e=0;e<this.items.length;e+=1)this.items[e].unmount();this.reset()}onShow(e){return this.on(0,e)}onHide(e){return this.on(1,e)}onEnterItem(e){return this.on(2,e)}onLeaveItem(e){return this.on(3,e)}onEnter(e){return this.on(4,e)}onLeave(e){return this.on(5,e)}onStateChange(e){return this.on(6,e)}get[Symbol.toStringTag](){return"Menu"}}class Ro extends $e{menu;state={items:[]};constructor(e){super(e);const{_name:s,items:n=[]}=e;this.state.items=n,this.menu=new Cs({...e,_name:s?`${s}__menu`:"menu-in-context-menu",side:"right",align:"start"})}show(e={}){const{x:s,y:n}=e;this.updateReference({...this.menu.popper.reference,getRect:()=>({width:5,height:5,left:s,top:n,x:s,y:n})}),this.menu.show()}hide(){this.menu.hide()}setReference(e){this.menu.popper.setReference(e)}updateReference(e){this.menu.popper.updateReference(e)}setItems(e){this.state.items=e,this.emit(0,{...this.state})}onStateChange(e){this.on(0,e)}onShow(e){this.on(1,e)}onHide(e){this.on(2,e)}}class ge extends $e{open=!1;title="";footer=!0;closeable=!0;present=new kt;okBtn=new Q;cancelBtn=new Q;get state(){return{open:this.open,title:this.title,footer:this.footer,closeable:this.closeable}}constructor(e={}){super(e);const{title:s,footer:n=!0,closeable:i=!0,onOk:l,onCancel:a,onUnmounted:c}=e;s&&(this.title=s),this.footer=n,this.closeable=i,l&&this.onOk(l),a&&this.onCancel(a),c&&this.onUnmounted(c),this.present.onShow(async()=>{this.open=!0,this.emit(5,!0),this.emit(10,{...this.state})}),this.present.onHidden(async()=>{this.open=!1,this.emit(6),this.emit(5,!1),this.emit(10,{...this.state})}),this.present.onUnmounted(()=>{this.emit(4)}),this.okBtn.onClick(()=>{this.ok()}),this.cancelBtn.onClick(()=>{this.hide()})}show(){this.open||this.present.show()}hide(){this.open!==!1&&this.present.hide()}ok(){this.emit(7)}cancel(){this.emit(6)}setTitle(e){this.title=e,this.emit(10,{...this.state})}onShow(e){return this.on(1,e)}onHidden(e){return this.on(3,e)}onUnmounted(e){return this.on(4,e)}onVisibleChange(e){return this.on(5,e)}onOk(e){return this.on(7,e)}onCancel(e){return this.on(6,e)}onStateChange(e){return this.on(10,e)}get[Symbol.toStringTag](){return"Dialog"}}class Gs extends $e{open=!1;disabled=!1;get state(){return{items:this.items,open:this.open,disabled:this.disabled}}menu;subs=[];items=[];constructor(e={}){super(e);const{_name:s,side:n,align:i,items:l=[],onHidden:a}=e;this.items=l,this.menu=new Cs({side:n,align:i,items:l,_name:s?`${s}__menu`:"menu-in-dropdown"}),this.menu.onHide(()=>{this.menu.reset(),a&&a()})}listenItems(e){for(let s=0;s<e.length;s+=1)e[s]}setItems(e){this.items=e,this.emit(0,{...this.state})}toggle(e){if(e){const{x:s,y:n}=e;this.menu.popper.updateReference({getRect(){return{width:8,height:8,x:s,y:n}}})}this.menu.toggle()}hide(){this.menu.hide()}unmount(){super.destroy(),this.menu.unmount()}onStateChange(e){this.on(0,e)}}class rr extends $e{fields=[];state={values:{}};constructor(e={}){super(e);const{fields:s=[]}=e;for(let n=0;n<s.length;n+=1){const i=s[n];i.onChange(l=>{this.setValue(i.name,l)})}this.fields=s}setValue(e,s){this.state.values[e]=s,this.emit(2,{...this.state})}input(e,s){this.state.values[e]=s,this.emit(0,s),this.emit(2,{...this.state})}submit(){this.emit(1,{...this.state.values})}onSubmit(e){this.on(1,e)}onInput(e){this.on(2,e)}}var qt=(t=>(t[t.Pending=0]="Pending",t[t.Loading=1]="Loading",t[t.Loaded=2]="Loaded",t[t.Failed=3]="Failed",t))(qt||{});class lt extends $e{static prefix="";static url(e){return e?e.includes("http")?e:lt.prefix+e:""}unique_uid;src;width;height;scale=null;fit;step=0;realSrc;get state(){return{src:this.src,step:this.step,width:this.width,height:this.height,scale:this.scale}}constructor(e){super();const{unique_id:s,width:n=200,height:i=200,src:l,scale:a,fit:c="cover"}=e;this.width=n,this.height=i,this.src="",this.fit=c,this.realSrc=l,a&&(this.scale=a),s&&(this.unique_uid=s)}setURL(e){if(e){if(this.realSrc&&e!==this.realSrc){this.realSrc=e,this.handleShow();return}this.realSrc=e,this.step===2&&(this.src=lt.url(this.realSrc),this.emit(0,{...this.state}))}}handleShow(){if(!this.realSrc){this.step=3,this.emit(0,{...this.state});return}this.step=1,this.src=lt.url(this.realSrc),this.emit(0,{...this.state})}handleLoaded(){this.step=2,this.emit(2),this.emit(0,{...this.state})}handleError(){this.step=3,this.emit(0,{...this.state}),this.emit(3)}onStateChange(e){return this.on(0,e)}onStartLoad(e){return this.on(1,e)}onLoad(e){return this.on(2,e)}onError(e){return this.on(3,e)}}class Ze extends $e{btns=[];cur=null;scale=null;constructor(e={}){super(e);const{scale:s}=e;s&&(this.scale=s)}bind(e){const s=this.btns.find(i=>i.unique_id===e);if(s)return s;const n=new lt({src:e,scale:this.scale||void 0});return this.btns.push(n),n}select(e){const s=this.btns.find(n=>n.unique_id===e);s&&(this.cur=s)}clear(){this.cur=null}onStateChange(e){this.on(0,e)}}class _e extends $e{defaultValue;value;placeholder;disabled;type;loading=!1;valueUsed;get state(){return{value:this.value,placeholder:this.placeholder,disabled:this.disabled,loading:this.loading,type:this.type}}constructor(e){super(e);const{defaultValue:s,placeholder:n="请输入",type:i="string",disabled:l=!1,onChange:a,onBlur:c,onEnter:d}=e;this.placeholder=n,this.type=i,this.disabled=l,this.defaultValue=s,this.value=s,this.valueUsed=s,a&&this.onChange(a),d&&this.onEnter(d),c&&this.onBlur(c)}setMounted(){this.emit(2)}handleEnter(){this.value!==this.valueUsed&&(this.valueUsed=this.value,this.emit(5,this.value))}handleBlur(){this.value!==this.valueUsed&&(this.valueUsed=this.value,this.emit(4,this.value))}setLoading(e){this.loading=e,this.emit(1,{...this.state})}focus(){}handleChange(e){if(this.type==="file"){const{target:i}=e,{files:l}=i;this.setValue(l);return}const{target:s}=e,{value:n}=s;this.setValue(n)}setValue(e){this.value=e,this.type==="number"&&(this.value=Number(e)),this.emit(0,e),this.emit(1,{...this.state})}enable(){this.disabled=!0,this.emit(1,{...this.state})}disable(){this.disabled=!1,this.emit(1,{...this.state})}clear(){this.value=this.defaultValue,this.emit(1,{...this.state})}reset(){this.value=this.defaultValue,this.emit(1,{...this.state})}onChange(e){return this.on(0,e)}onStateChange(e){return this.on(1,e)}onMounted(e){return this.on(2,e)}onFocus(e){return this.on(3,e)}onBlur(e){return this.on(4,e)}onEnter(e){return this.on(5,e)}}class Js extends $e{popper;present;layer;_side;_align;constructor(e={}){super();const{side:s="bottom",align:n="end",strategy:i}=e;this._side=s,this._align=n,this.popper=new An({side:s,align:n,strategy:i}),this.present=new kt,this.layer=new zn,this.layer.onDismiss(()=>{this.hide()})}visible=!1;get state(){return{visible:this.visible}}toggle(){const{visible:e}=this;if(e){this.hide();return}this.show()}show(e){e&&this.popper.updateReference({getRect(){const{x:s=0,y:n=0,width:i=0,height:l=0,left:a=0,top:c=0,right:d=0,bottom:u=0}=e;return{width:i,height:l,x:s,y:n,left:a,top:c,right:d,bottom:u}}}),this.visible=!0,this.present.show(),this.popper.place(),this.emit(0)}hide(){this.visible!==!1&&(this.visible=!1,this.present.hide(),this.emit(1))}unmount(){super.destroy(),this.layer.destroy(),this.popper.destroy(),this.present.unmount()}onShow(e){this.on(0,e)}onHide(e){this.on(1,e)}get[Symbol.toStringTag](){return"PopoverCore"}}const Do=100;class Mo extends $e{_value;_label;_max;constructor(e){super();const{value:s,max:n,getValueLabel:i=To}=e,l=Eo(n)?n:Do;this._max=l;const a=Fo(s,l)?s:null;this._value=a;const c=Nn(a)?i(a,l):void 0;this._label=c}get state(){return{state:Bo(this._value,this._max),value:this._value??void 0,max:this._max,label:this._label}}setValue(e){this._value=e,this.emit(0,e),this.emit(1,this.state)}update(e){this._value=e,this.emit(0,e),this.emit(1,this.state)}onValueChange(e){this.on(0,e)}onStateChange(e){this.on(1,e)}}function To(t,e){return`${Math.round(t/e*100)}%`}function Bo(t,e){return t==null?"indeterminate":t===e?"complete":"loading"}function Nn(t){return typeof t=="number"}function Eo(t){return Nn(t)&&!isNaN(t)&&t>0}function Fo(t,e){return Nn(t)&&!isNaN(t)&&t<=e&&t>=0}class Oo extends $e{itemMap=new Map;setWrap(e){}add(e,s){this.itemMap.set(e,s)}remove(e){this.itemMap.delete(e)}getItems(){return Array.from(this.itemMap.values())}}function ci(t){return t.touches?{x:t.touches[0].pageX,y:t.touches[0].pageY}:t.clientX&&t.clientY?{x:t.clientX,y:t.clientY}:{x:0,y:0}}function $s(t){t&&t.cancelable&&!t.defaultPrevented&&t.preventDefault&&t.preventDefault()}function Io(t,e){let s=Math.abs(t);return s=.82231*e/(1+4338.47/Math.pow(s,1.14791)),Math.round(t<0?-s:s)}function Vo(t,e){const s=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y),i=Math.sqrt(s*s+n*n);return i!==0?Math.asin(n/i)/Math.PI*180:0}let bn=null;function Ao(t){bn=t}class Ue extends $e{os={android:!0,ios:!1,pc:!1,wechat:!1};rect={width:0,height:0,scrollTop:0,contentHeight:0};canPullToRefresh;canReachBottom=!0;needHideIndicator=!1;scrollable=!0;pullToRefresh={step:"pending",pullStartX:0,pullStartY:0,pullMoveX:0,pullMoveY:0,distX:0,distY:0,distResisted:0};threshold=120;options;pullToRefreshOptions;isPullToRefreshing=!1;isLoadingMore=!1;startPoint={x:0,y:0};lastPoint={x:0,y:0};downHight=0;upHight=0;maxTouchMoveInstanceY=0;inTouchEnd=!1;inTopWhenPointDown=!1;inBottomWhenPointDown=!1;isMoveDown=!1;isMoveUp=!1;isScrollTo=!1;movetype="pending";preScrollY=0;isUpAutoLoad=!1;get state(){return{top:0,left:0,step:this.movetype,scrollTop:this.downHight,pullToRefresh:this.canPullToRefresh,scrollable:this.scrollable}}constructor(e={}){super(e);const{os:s,offset:n=80,onScroll:i,onReachBottom:l,onPullToRefresh:a,onPullToBack:c}=e;this.options=e,s&&(this.os=s),this.pullToRefreshOptions={isLock:!1,offset:n,bottomOffset:20,minAngle:45},this.canPullToRefresh=!!a,this.canPullToRefresh||(this.needHideIndicator=!0),this.needHideIndicator&&(this.pullToRefreshOptions.offset=9999),i&&this.onScroll(i),l&&this.onReachBottom(l),a&&this.onPullToRefresh(a),bn&&bn(this)}setReady(){this.emit(9)}setRect(e){this.rect={...this.rect,...e}}startPullToRefresh=()=>{this.isPullToRefreshing||(this.isPullToRefreshing=!0,this.downHight=this.pullToRefreshOptions.offset,this.setIndicatorHeightTransition(!0),this.changeIndicatorHeight(this.downHight),this.emit(3))};finishPullToRefresh=()=>{this.isPullToRefreshing&&(this.downHight=0,this.changeIndicatorHeight(0),this.isPullToRefreshing=!1,this.emit(4))};disablePullToRefresh=()=>{this.pullToRefreshOptions.isLock=!0};enablePullToRefresh=()=>{this.pullToRefreshOptions.isLock=!1};handleMouseDown=e=>{this.handlePointDown(e)};handleMouseMove=e=>{this.handlePointMove(e)};handleTouchStart=e=>{this.handlePointDown(e)};handleTouchMove=e=>{this.handlePointMove(e)};handlePointDown=e=>{this.isScrollTo&&$s(e);const s=ci(e);if(s.x<30){$s(e);return}this.startPoint=s,this.lastPoint=this.startPoint,this.maxTouchMoveInstanceY=this.getBodyHeight()-this.pullToRefreshOptions.bottomOffset,this.inTouchEnd=!1;const n=this.getScrollTop();this.inTopWhenPointDown=n===0};handlePointMove=e=>{if(!this.startPoint)return;const s=this.getScrollTop();s>0&&(this.inTopWhenPointDown=!1);const n=ci(e),i=n.y-this.startPoint.y;if(i>0&&s<=0&&($s(e),this.canPullToRefresh&&!this.inTouchEnd&&!this.isPullToRefreshing)){if(!this.inTopWhenPointDown)return;const l=Vo(this.lastPoint,n);if(l&&l<this.pullToRefreshOptions.minAngle)return;if(this.maxTouchMoveInstanceY>0&&n.y>=this.maxTouchMoveInstanceY){this.inTouchEnd=!0,this.handleTouchEnd();return}this.downHight<this.pullToRefreshOptions.offset?this.movetype!=="pulling"&&(this.movetype==="pending"&&(this.setIndicatorHeightTransition(!1),this.os.ios&&!this.inTopWhenPointDown&&this.optimizeScroll(!0)),this.movetype,this.movetype="pulling",this.emit(0),this.isMoveDown=!0):this.movetype!=="releasing"&&(this.movetype="releasing",this.emit(1),this.isMoveDown=!0),this.downHight=Io(n.y-this.startPoint.y,1e3),this.changeIndicatorHeight(this.downHight),this.emit(2,{instance:this.downHight})}if(i<0){const l=this.getScrollHeight(),a=this.getScrollClientHeight();l-a-s<=0&&$s(e)}this.lastPoint=n};handleTouchEnd=()=>{this.canPullToRefresh&&this.isMoveDown&&(this.downHight>=this.pullToRefreshOptions.offset?this.startPullToRefresh():(this.downHight=0,this.setIndicatorHeightTransition(!0),this.changeIndicatorHeight(0)),this.optimizeScroll(!1),this.movetype="pending",this.isMoveDown=!1)};handleScrolling=()=>{const e=this.getScrollTop(),s=e-this.preScrollY>0;this.isLoadingMore||this.getScrollHeight()-this.getScrollClientHeight()-e<=this.threshold&&s&&(this.isLoadingMore=!0,this.emit(8)),this.emit(7,{scrollTop:e})};finishLoadingMore(){this.isLoadingMore=!1}setMounted(){this.emit(9)}refreshRect(){}setBounce=e=>{};changeIndicatorHeight(e){}setIndicatorHeightTransition(e){}optimizeScroll(e){}hideIndicator=()=>{};scrollTo=(e,s=300)=>{};getToBottom(){return this.getScrollHeight()-this.getScrollClientHeight()-this.getScrollTop()}getOffsetTop(e){return 0}getScrollHeight(){return 0}getScrollClientHeight(){return 0}getScrollTop(){return 0}setScrollTop(e){}getBodyHeight(){return 0}destroy=()=>{};inDownOffset(e){return this.on(0,e)}outDownOffset(e){return this.on(1,e)}onPulling(e){return this.on(2,e)}onScroll(e){return this.on(7,e)}onReachBottom(e){return this.on(8,e)}onPullToRefresh(e){return this.canPullToRefresh=!0,this.on(3,e)}onMounted(e){return this.on(9,e)}}class Cn extends $e{name="SelectCore";debug=!0;placeholder;options=[];value=null;disabled=!1;open=!1;popper;collection;layer;position="popper";triggerPos={x:0,y:0};reference=null;trigger=null;wrap=null;content=null;viewport=null;selectedItem=null;_findFirstValidItem=!1;get state(){return{options:this.options,value:this.value,open:this.open,disabled:this.disabled,placeholder:this.placeholder,required:!1,dir:"ltr",styles:{}}}constructor(e){super(e);const{defaultValue:s,placeholder:n="点击选择",options:i=[],onChange:l}=e;this.options=i.map(c=>c),this.value=s,this.placeholder=n,this.options.find(c=>c.value===s)&&(this.emit(0,{...this.state}),this.emit(1,s)),this.popper=new An,this.layer=new zn,this.collection=new Oo,this.popper.onReferenceMounted(c=>{const{x:d,y:u,width:f,height:p}=c.getRect();this.reference={width:f,height:p,x:d,y:u,left:d,right:d+f,top:u,bottom:u+p}}),this.layer.onDismiss(()=>{this.hide()}),l&&this.onChange(l)}setTriggerPointerDownPos(e){this.triggerPos=e}setTrigger(e){this.trigger=e}setWrap(e){this.wrap=e}setContent(e){this.content=e}setViewport(e){this.viewport=e}setSelectedItem(e){this.selectedItem=e}async show(){this.disabled||(this.popper.place(),this.open=!0,this.emit(0,{...this.state}))}hide=()=>{this.open!==!1&&(this.open=!1,this.emit(0,{...this.state}))};addNativeOption(){}removeNativeOption(){}select(e){if(this.value!==e){this.value=e,this.emit(0,{...this.state}),this.emit(1,e);for(let s=0;s<this.options.length;s+=1)this.options[s];this.hide()}}focus(){this.emit(2)}setOptions(e){this.options=e,!(this.value===null||this.options.find(n=>n.value===this.value))&&(this.value=null,this.emit(0,{...this.state}),this.emit(1,this.value))}setValue(e){if(e===null){this.value=e,this.emit(0,{...this.state}),this.emit(1,e);return}this.options.find(n=>n.value===e)&&(this.value=e,this.emit(0,{...this.state}),this.emit(1,e))}clear(){this.value=null,this.emit(0,{...this.state}),this.emit(1,this.value)}setPosition(){}onStateChange(e){return this.on(0,e)}onValueChange(e){return this.on(1,e)}onChange(e){return this.on(1,e)}onFocus(e){return this.on(2,e)}}class hn extends $e{options=[];list=[];cached=new Map;values=new Map;constructor(e={}){super(e);const{options:s=[]}=e;this.options=s}bind(e,s){const{defaultValue:n}=s||{defaultValue:null},i=this.cached.get(e);if(i)return i;const l=new Cn({defaultValue:n,options:this.options,onChange:a=>{this.values.set(e,a),this.emit(1,[e,a])}});return this.list.push(l),this.values.set(e,n),this.cached.set(e,l),l}setOptions(e){if(this.options=e,this.list.length!==0)for(let s=0;s<this.list.length;s+=1)this.list[s].setOptions(e)}setValue(e){for(let s=0;s<this.list.length;s+=1)this.list[s].setValue(e)}getValue(e){return this.values.get(e)??null}clear(){this.list=[],this.cached=new Map,this.values=new Map}toJson(e){const s=[];for(const[n,i]of this.values){const l=e([n,i]);s.push(l)}return s}onChange(e){this.on(1,e)}onStateChange(e){this.on(0,e)}}class zo extends $e{name="ToastCore";present;delay=1200;timer=null;open=!1;state={icon:null,texts:[]};constructor(e={}){super(e);const{delay:s}=e;s&&(this.delay=s),this.present=new kt,this.present.onShow(()=>{this.open=!0,this.emit(4,!0)}),this.present.onHidden(()=>{this.open=!1,this.emit(4,!1)})}async show(e){const{icon:s,texts:n}=e;if(this.emit(7,{icon:s,texts:n}),this.timer!==null){this.clearTimer(),this.timer=setTimeout(()=>{this.hide(),this.clearTimer()},this.delay);return}this.present.show(),this.timer=setTimeout(()=>{this.hide(),this.clearTimer()},this.delay)}clearTimer(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}hide(){this.present.hide()}onShow(e){return this.on(1,e)}onHide(e){return this.on(3,e)}onOpenChange(e){return this.on(4,e)}onStateChange(e){return this.on(7,e)}get[Symbol.toStringTag](){return"ToastCore"}}class qe extends $e{_name="MenuItemCore";debug=!0;label;tooltip;icon;shortcut;menu=null;hidden=!1;state={label:"",icon:null,shortcut:"",open:!1,disabled:!1,focused:!1};_enter=!1;constructor(e){super(e);const{_name:s,tooltip:n,label:i,icon:l,shortcut:a,disabled:c=!1,hidden:d=!1,menu:u,onClick:f}=e;this.label=i,this.tooltip=n,this.icon=l,this.shortcut=a,this.hidden=d,s&&(this._name=s),this.state.label=i,this.state.icon=l,this.state.shortcut=a,this.state.disabled=c,u&&(this.menu=u,u.onShow(()=>{this.state.open=!0,this.emit(0,{...this.state})}),u.onHide(()=>{this.state.open=!1,this.emit(0,{...this.state})})),f&&this.onClick(f.bind(this))}setIcon(e){this.state.icon=e,this.emit(0,{...this.state})}disable(){this.state.disabled=!0,this.emit(0,{...this.state})}enable(){this.state.disabled=!1,this.emit(0,{...this.state})}enter(){this._enter||(this.log("enter"),this._enter=!0,this.state.focused=!0,this.emit(1),this.emit(0,{...this.state}))}move(){if(this.state.disabled){this.leave();return}this.enter()}leave(){this._enter!==!1&&(this.log("leave"),this._enter=!1,this.state.focused=!1,this.emit(2),this.emit(0,{...this.state}))}focus(){this.state.focused||(this.log("focus"),this.state.focused=!0,this.emit(3),this.emit(0,{...this.state}))}blur(){this.state.focused!==!1&&(this.log("blur"),this.state.focused=!1,this._enter=!1,this.emit(4),this.emit(0,{...this.state}))}click(){this.state.disabled||this.emit(5)}reset(){this.state={...this.state,focused:!1,open:!1},this._enter=!1,this.menu&&this.menu.reset()}hide(){this.hidden=!0}show(){this.hidden=!1}unmount(){super.destroy(),this.menu&&this.menu.unmount(),this.reset()}onStateChange(e){return this.on(0,e)}onEnter(e){return this.on(1,e)}onLeave(e){return this.on(2,e)}onFocus(e){return this.on(3,e)}onBlur(e){return this.on(4,e)}onClick(e){return this.on(5,e)}get[Symbol.toStringTag](){return"MenuItem"}}class bs extends $e{options=[];disabled;values=[];get indeterminate(){return this.values.length===this.options.length}get state(){return{values:this.values,options:this.options,disabled:this.disabled,indeterminate:this.indeterminate}}prevChecked=!1;constructor(e={}){super(e);const{options:s=[],disabled:n=!1,onChange:i}=e;this.disabled=n,this.options=s.map(l=>{const{label:a,value:c,checked:d,disabled:u}=l,f=new mt({label:a,checked:d,disabled:u,onChange:p=>{const m=this.values.includes(c);if(p&&!m){this.checkOption(c);return}!p&&m&&this.uncheckOption(c)}});return{label:a,value:c,core:f}}),i&&this.onChange(i)}checkOption(e){this.values=this.values.concat(e),this.emit(1,[...this.values]),this.emit(0,{...this.state})}uncheckOption(e){this.values=this.values.filter(s=>s!==e),this.emit(1,[...this.values]),this.emit(0,{...this.state})}reset(){this.values=[],this.emit(1,[...this.values]),this.emit(0,{...this.state})}setOptions(e){for(let s=0;s<this.options.length;s+=1)this.options[s].core.destroy();this.options=e.map(s=>{const{label:n,value:i,checked:l,disabled:a}=s,c=new mt({label:n,checked:l,disabled:a,onChange:d=>{const u=this.values.includes(i);if(d&&!u){this.checkOption(i);return}!d&&u&&this.uncheckOption(i)}});return{label:n,value:i,core:c}}),this.emit(0,{...this.state})}onChange(e){return this.on(1,e)}onStateChange(e){return this.on(0,e)}}const Ms={sm:0,md:768,lg:992,xl:1200,"2xl":1536};function di(t){return t>=Ms["2xl"]?"2xl":t>=Ms.xl?"xl":t>=Ms.lg?"lg":t>=Ms.md?"md":"sm"}const ui="(prefers-color-scheme: dark)";var lr=(t=>(t[t.Tip=0]="Tip",t[t.Error=1]="Error",t[t.Login=2]="Login",t[t.Logout=3]="Logout",t[t.ForceUpdate=4]="ForceUpdate",t[t.DeviceSizeChange=5]="DeviceSizeChange",t[t.Ready=6]="Ready",t[t.Show=7]="Show",t[t.Hidden=8]="Hidden",t[t.Resize=9]="Resize",t[t.Blur=10]="Blur",t[t.Keydown=11]="Keydown",t[t.OrientationChange=12]="OrientationChange",t[t.EscapeKeyDown=13]="EscapeKeyDown",t[t.StateChange=14]="StateChange",t))(lr||{});let No=class extends $e{$user;$storage;lifetimes;ready=!1;screen={width:0,height:0};env={wechat:!1,ios:!1,android:!1,pc:!1,weapp:!1,prod:"develop"};orientation="vertical";curDeviceSize="md";theme="system";safeArea=!1;Events=lr;get state(){return{ready:this.ready,theme:this.theme,env:this.env,deviceSize:this.curDeviceSize}}constructor(e){super();const{user:s,storage:n,beforeReady:i,onReady:l}=e;this.$user=s,this.$storage=n,this.lifetimes={beforeReady:i,onReady:l}}async start(e){const{width:s,height:n}=e;this.screen={...this.screen,width:s,height:n},this.curDeviceSize=di(s);const{beforeReady:i}=this.lifetimes;if(i){const l=await i();if(l.error)return P.Err(l.error)}return this.ready=!0,this.emit(6),this.emit(14,{...this.state}),P.Ok(null)}setTheme(e){let s=e;if(s&&e==="system"){const n=this.getSystemTheme();if(n.error)return;s=n.data}}applyTheme(e){const s="请在 connect.web 中实现 applyTheme 方法";return P.Err(s)}getTheme(){const e="请在 connect.web 中实现 getTheme 方法";return P.Err(e)}getSystemTheme(e){const s="请在 connect.web 中实现 getSystemTheme 方法";return P.Err(s)}tipUpdate(){this.emit(4)}vibrate(){}setSize(e){this.screen=e}setTitle(e){throw new Error("请实现 setTitle 方法")}openWindow(e){throw new Error("请实现 openWindow 方法")}setEnv(e){this.env={...this.env,...e}}copy(e){throw new Error("请实现 copy 方法")}getComputedStyle(e){throw new Error("请实现 getComputedStyle 方法")}notify(e){}disablePointer(){throw new Error("请实现 disablePointer 方法")}enablePointer(){throw new Error("请实现 enablePointer 方法")}keydown({key:e}){e==="Escape"&&this.escape(),this.emit(11,{key:e})}escape(){this.emit(13)}resize(e){this.screen=e,this.emit(9,e)}blur(){this.emit(10)}handleScreenOrientationChange(e){if(e===0){this.orientation="vertical",this.emit(12,this.orientation);return}this.orientation="horizontal",this.emit(12,this.orientation)}handleResize(e){this.screen=e;const s=di(e.width);s!==this.curDeviceSize&&(this.curDeviceSize=s,this.emit(5,this.curDeviceSize)),this.emit(9,e)}onReady(e){return this.on(6,e)}onDeviceSizeChange(e){return this.on(5,e)}onUpdate(e){return this.on(4,e)}onOrientationChange(e){return this.on(12,e)}onResize(e){return this.on(9,e)}onBlur(e){return this.on(10,e)}onShow(e){return this.on(7,e)}onHidden(e){return this.on(8,e)}onKeydown(e){return this.on(11,e)}onEscapeKeyDown(e){return this.on(13,e)}onStateChange(e){return this.on(14,e)}onError(e){return this.on(1,e)}};class wt extends $e{static prefix=null;static parse(e){const{pathname:s,query:n,...i}=_l(e),l=qi.parse(n,{ignoreQueryPrefix:!0});return wt.prefix&&s.startsWith(wt.prefix)?{...i,query:l,pathname:s.replace(wt.prefix,"")}:{...i,query:l,pathname:s}}unique_id="NavigatorCore";debug=!1;name="root";pathname="/";query={};params={};location={};href="/";histories=[];prevHistories=[];prevPathname=null;origin="";_pending={pathname:"/",search:"",type:"initialize"};get state(){return{pathname:this.pathname,search:this._pending.search,params:this.params,query:this.query,location:this.location}}async prepare(e){const{pathname:s,href:n,search:i,origin:l}=e,a=s.replace(wt.prefix,"");this.setPathname(a),this.origin=l,this.location=e;const c=Ho(n);this.query=c,this._pending={pathname:a,search:i,type:"initialize"}}start(){const{pathname:e}=this._pending;this.setPathname(e),this.histories=[{pathname:e}],this.emit(7,{...this._pending})}setPrevPathname(e){this.prevPathname=e}setPathname(e){this.pathname=e}pushState(e){const s=`${this.origin}${wt.prefix}${e}`,n=new URL(s),{pathname:i,search:l}=n,a=this.pathname;this.setPrevPathname(a),this.setPathname(i),this.histories.push({pathname:i}),this.emit(0,{from:a,to:i,path:i+l,pathname:i}),this.emit(10,[...this.histories])}async replaceState(e){const s=`${this.origin}${wt.prefix}${e}`,n=new URL(s),{pathname:i,search:l}=n;this.setPrevPathname(this.pathname),this.setPathname(i),this.histories[this.histories.length-1]={pathname:i},this.emit(1,{from:this.prevPathname,path:i+l,pathname:i}),this.emit(10,[...this.histories])}handlePopState({type:e,pathname:s,href:n}){if(e!=="popstate")return;const i=s,l=this.pathname;this.setPrevPathname(l),this.setPathname(i);const a=(()=>this.prevHistories.length===0?!1:this.prevHistories[this.prevHistories.length-1]?.pathname===i)();if(this._pending={pathname:s,search:"",type:(()=>a?"forward":"back")()},a){this.setPrevPathname(this.pathname),this.setPathname(i);const u=this.prevHistories.pop();u&&(this.histories=this.histories.concat([u])),this.emit(4),this.emit(10,[...this.histories]),this.emit(2,{type:"forward",pathname:s,href:n});return}this.emit(3);const c=this.histories[this.histories.length-1];this.prevHistories=this.prevHistories.concat([c]).filter(Boolean),this.setPrevPathname(this.pathname),this.setPathname(i);const d=this.histories.slice(0,this.histories.length-1);this.histories=d.filter(Boolean),this.emit(10,[...this.histories]),this.emit(2,{type:"back",pathname:s,href:n})}onStart(e){return this.on(6,e)}onHistoryChange(e){return this.on(10,e)}onPushState(e){return this.on(0,e)}onReplaceState(e){return this.on(1,e)}onPopState(e){return this.on(2,e)}onReload(e){return this.on(5,e)}onPathnameChange(e){return this.on(7,e)}onBack(e){return this.on(3,e)}onForward(e){return this.on(4,e)}onRelaunch(e){return this.on(8,e)}onHistoriesChange(e){return this.on(10,e)}}function Ho(t){const[,e]=t.split("?");return e?qi.parse(e):{}}function hi(t,e,s){const n=(()=>!s||Object.keys(s).length===0?"":"?"+Wt(s))();return(()=>!t.match(/:[a-z]{1,}/)||!e||Object.keys(e).length===0?t+n:t.replace(/:([a-z]{1,})/g,(...l)=>{const[,a]=l;return String(e[a]||"")})+n)()}function or(t,e=null){return Object.keys(t).map(n=>{const i=t[n],{title:l,pathname:a,options:c,children:d}=i,u=e?[e.name,n].filter(Boolean).join("."):n;if(d){const f=or(d,{name:u,pathname:a});return[{title:l,name:u,pathname:a,options:c,layout:!0,parent:e?{name:e.name}:null},...f]}return[{title:l,name:u,pathname:a,options:c,parent:e?{name:e.name}:null}]}).reduce((n,i)=>n.concat(i),[])}function qo(t){const e=or(t),s=e.map(i=>({[i.name]:i})).reduce((i,l)=>({...i,...l}),{}),n=e.map(i=>({[i.pathname]:i})).reduce((i,l)=>({...i,...l}),{});return{routes:s,routesWithPathname:n}}class is extends $e{unique_id="ViewCore";debug=!1;id=this.uid();name;pathname;title;animation={};query={};params={};_showed=!1;loaded=!1;mounted=!0;layered=!1;isRoot=!1;parent;curView=null;subViews=[];$presence=new kt;get state(){return{mounted:this.mounted,visible:this.visible,layered:this.layered}}get href(){return[this.pathname,Wt(this.query)].filter(Boolean).join("?")}get visible(){return this.$presence.visible}constructor(e){super(e);const{name:s,pathname:n,title:i,query:l={},visible:a=!1,animation:c={},parent:d=null,views:u=[]}=e;this.name=s,this.pathname=n,this.parent=d,this.title=i,this.unique_id=i,this.animation=c,this.subViews=u,u.length&&(this.curView=u[0]),this.query=l,a&&(this.mounted=!0);for(let f=0;f<u.length;f+=1){const p=u[f];p.parent=this}this.$presence.onStateChange(f=>{const{visible:p,mounted:m}=f,g=this.state.visible;g===!1&&p&&this.setShow(),g&&p===!1&&this.setHidden(),this.mounted=!!m,this.emit(13,{...this.state})})}appendView(e){e.parent=this,this.subViews.length===0&&e.visible&&(this.curView=e),this.subViews.includes(e)||this.subViews.push(e),this.emit(0,[...this.subViews])}replaceViews(e){this.subViews=e,this.emit(0,[...this.subViews])}removeView(e,s={}){const{reason:n,destroy:i,callback:l}=s;this.subViews.includes(e)&&(e.onUnmounted(()=>{e.destroy(),this.subViews=this.subViews.filter(a=>a!==e),l&&l(),this.emit(0,[...this.subViews])}),e.hide({reason:n,destroy:i}),this.emit(0,[...this.subViews]))}findCurView(){return this.curView?this.curView.findCurView():this}ready(){this.emit(3)}showView(e,s={}){e!==this&&(e.visible||((()=>{if(!this.visible){if(!this.parent){this.isRoot;return}this.parent.showView(this,s)}})(),this.curView&&this.curView.hide(s),this.appendView(e),this.emit(5),this.curView=e,e.show(),this.emit(1,this.curView)))}show(){if(this.visible){this.$presence.state.mounted=!0;return}this.$presence.show()}hide(e={}){if(this.visible!==!1){for(let s=0;s<this.subViews.length;s+=1)this.subViews[s].hide(e);this.emit(7),this.$presence.hide(e)}}setShow(){this._showed||(this._showed=!0,this.emit(6))}setHidden(){this._showed=!1,this.emit(8)}mount(){this.setMounted()}unmount(){}setMounted(){this.mounted||(this.mounted=!0,this.emit(4))}setUnmounted(){this.mounted=!1,this.emit(9)}setLoaded(){this.loaded=!0}setUnload(){this.loaded=!1}buildUrl(e){return hi(this.pathname,this.params,e)}buildUrlWithPrefix(e){const s=hi(this.pathname,this.params,e);return[wt.prefix,s].join("")}onStart(e){return this.on(12,e)}onReady(e){return this.on(3,e)}onMounted(e){return this.on(4,e)}onViewShow(e){return this.on(2,e)}onBeforeShow(e){return this.on(5,e)}onShow(e){return this.on(6,e)}onBeforeHide(e){return this.on(7,e)}onHidden(e){return this.on(8,e)}onLayered(e){return this.on(10,e)}onUncover(e){return this.on(11,e)}onUnmounted(e){return this.on(9,e)}onSubViewsChange(e){return this.on(0,e)}onCurViewChange(e){return this.on(1,e)}onMatched(e){return this.on(14,e)}onNotFound(e){return this.on(15,e)}onStateChange(e){return this.on(13,e)}}class jo extends $e{virtual=!1;routes;views;stacks=[];cursor=-1;$router;$view;get state(){return{href:this.$router.href,stacks:this.stacks.map(e=>{const{id:s,pathname:n,title:i,query:l,visible:a}=e;return{id:[n,Wt(l)].filter(Boolean).join("?"),key:n,title:i,query:JSON.stringify(l,null,2),visible:a}}),cursor:this.cursor}}constructor(e){super(e);const{virtual:s=!1,view:n,router:i,routes:l,views:a}=e;this.$view=n,this.$router=i,this.routes=l,this.views=a,this.virtual=s}push(e,s={},n={}){const{ignore:i}=n;if(this.isLayout(e))return;const l=this.routes[e];if(!l)return;const a=[l.pathname,Wt(s)].filter(Boolean).join("?");if(a===this.$router.href)return;const c=this.views[a];if(c){if(this.ensureParent(c),c.query=s,!c.parent)return;this.$router.href=c.href,this.$router.name=c.name,this.stacks=this.stacks.slice(0,this.cursor+1).concat(c),this.cursor+=1,c.parent.showView(c,{reason:"show_sibling",destroy:!1}),this.emit(1,{reason:"push",view:c,name:e,href:c.href,pathname:c.pathname,query:c.query,ignore:i}),this.emit(5,{...this.state});return}const d=(()=>{const f=this.routes[e];return f||null})();if(!d)return null;const u=new is({name:d.name,pathname:d.pathname,title:d.title,query:s,animation:d.options?.animation,parent:null});this.views[a]=u,this.ensureParent(u),u.parent&&(this.$router.href=u.href,this.$router.name=u.name,this.stacks=this.stacks.slice(0,this.cursor+1).concat(u),this.cursor+=1,u.parent.showView(u,{reason:"show_sibling",destroy:!1}),this.emit(1,{reason:"push",view:u,name:e,href:u.href,pathname:u.pathname,query:u.query,ignore:i}),this.emit(5,{...this.state}))}replace(e,s={}){const n=[e,Wt(s)].filter(Boolean).join("?");if(n===this.$router.href)return;const i=this.views[n];if(i){if(this.ensureParent(i),i.query=s,!i.parent)return;this.$router.href=i.href,this.$router.name=i.name;const d=this.stacks[this.stacks.length-1];d&&d.parent?.removeView(d),this.stacks[this.stacks.length-1]=i,i.parent.showView(i),this.emit(1,{reason:"replace",view:i,name:i.name,href:i.href,pathname:i.pathname,query:i.query}),this.emit(5,{...this.state});return}const l=(()=>{const d=this.routes[e];return d||null})();if(!l)return null;const a=new is({name:l.name,pathname:l.pathname,title:l.title,query:s,animation:l.options?.animation,parent:null});if(this.views[n]=a,this.ensureParent(a),!a.parent)return;this.$router.href=a.href,this.$router.name=a.name;const c=this.stacks[this.stacks.length-1];c&&c.parent?.removeView(c,{reason:"show_sibling",callback:()=>{delete this.views[n]}}),this.stacks[this.stacks.length-1]=a,a.parent.showView(a),this.emit(1,{reason:"replace",view:a,name:a.name,href:a.href,pathname:a.pathname,query:a.query}),this.emit(5,{...this.state})}realBack(){const e=this.cursor-1,s=this.stacks[e];if(!s)return;const n=s.href;if(!s.parent)return;this.$router.href=n,this.$router.name=s.name,this.cursor=e;const i=this.stacks.slice(e+1);for(let l=0;l<i.length;l+=1){const a=i[l];a.parent?.removeView(a,{reason:"back",destroy:!0,callback:()=>{delete this.views[a.href]}})}s.parent.showView(s,{reason:"back",destroy:!0}),this.emit(1,{reason:"back",view:s,name:s.name,href:s.href,pathname:s.pathname,query:s.query}),this.emit(3),this.emit(5,{...this.state})}back(){}forward(){const e=this.cursor+1,s=this.stacks[e];if(!s||!s.parent)return;const n=s.href;this.$router.href=n,this.$router.name=s.name,this.cursor=e;const i=this.stacks.slice(e+1);for(let l=0;l<i.length;l+=1){const a=i[l];a.parent?.removeView(a,{reason:"forward",callback:()=>{delete this.views[a.href]}})}s.parent.showView(s),this.emit(1,{reason:"forward",view:s,name:s.name,href:s.href,pathname:s.pathname,query:s.query}),this.emit(4),this.emit(5,{...this.state})}reload(){}ensureParent(e){const{name:s}=e;if(e.parent){if(e.parent.pathname==="/")return;this.ensureParent(e.parent);return}const n=this.routes[s];if(!n)return;const{parent:i}=n;if(this.views[i.name]){if(e.parent=this.views[i.name],i.name==="root")return;this.ensureParent(this.views[i.name]);return}const l=this.routes[i.name];if(!l)return null;const a=new is({name:l.name,pathname:l.pathname,title:l.title,parent:null});this.views[l.name]=a,e.parent=a,this.ensureParent(a)}buildURL(e,s={}){const n=(()=>{const l=this.routes[e];return l||null})();return n?new is({name:n.name,pathname:n.pathname,title:n.title,query:s,parent:null}).buildUrl(s):this.routes["root.notfound"].pathname}buildURLWithPrefix(e,s={}){const n=(()=>{const l=this.routes[e];return l||null})();return n?new is({name:n.name,pathname:n.pathname,title:n.title,query:s,parent:null}).buildUrlWithPrefix(s):this.routes["root.notfound"].pathname}isLayout(e){const s=this.routes[e];return s?s.layout:null}handleClickLink(e){const{href:s,target:n}=e;this.emit(2,{href:s,target:n})}onTopViewChange(e){return this.on(0,e)}onRouteChange(e){return this.on(1,e)}onBack(e){return this.on(3,e)}onForward(e){return this.on(4,e)}onClickLink(e){return this.on(2,e)}onStateChange(e){return this.on(5,e)}}function Uo(t){const e=globalThis.document;t.getComputedStyle=v=>window.getComputedStyle(v),t.setTitle=v=>{document.title=v},t.copy=v=>{const w=document.createElement("textarea");w.value=v,document.body.appendChild(w),w.select(),document.execCommand("copy"),document.body.removeChild(w)},t.openWindow=v=>{window.open(v)},window.addEventListener("DOMContentLoaded",v=>{const{innerWidth:w,innerHeight:$}=window;t.setSize({width:w,height:$})}),window.addEventListener("orientationchange",function(){t.handleScreenOrientationChange(window.orientation)}),window.addEventListener("load",()=>{}),window.addEventListener("beforeunload",v=>{}),window.addEventListener("resize",()=>{}),window.addEventListener("blur",()=>{t.emit(t.Events.Blur)}),document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="hidden"){t.emit(t.Events.Hidden);return}t.emit(t.Events.Show)});const s=navigator.userAgent,n=s.toLowerCase(),i=/iPad|iPhone|iPod/.test(s),l=/Android/.test(s);t.setEnv({wechat:n.indexOf("micromessenger")!==-1,ios:i,android:l});const a=window.matchMedia(ui);let c="light";const d=v=>{v||(v=window.matchMedia(ui));const $=v.matches?"dark":"light";return c=$,t.theme=$,P.Ok($)};a.addListener(d);let u="data-theme";const f="system",p=["light","dark"];t.applyTheme=v=>{const w=document.documentElement,$=c;$?w.setAttribute(u,$):w.removeAttribute(u);const E=p.includes(f)?f:null,_=p.includes(c)?c:E;return w.style.colorScheme=_,P.Ok(null)},t.getSystemTheme=d,t.setTheme=v=>{t.theme=v,t.emit(t.Events.StateChange,{...t.state}),t.$storage.set("theme",v)};const{availHeight:m,availWidth:g}=window.screen;if(window.navigator.userAgent.match(/iphone/i)){const v=["375-812","414-896","428-926","390-844","393-852","430-932"].includes(`${g}-${m}`);t.safeArea=!!v}e.addEventListener("keydown",v=>{const{key:w}=v;t.keydown({key:w})});const C=e.body.style.pointerEvents;t.disablePointer=()=>{e.body.style.pointerEvents="none"},t.enablePointer=()=>{e.body.style.pointerEvents=C}}const Wo=globalThis.document;function Yo(t){t.reload=()=>{window.location.reload()},t.back=()=>{window.history.back()},t.$router.onPopState(e=>{const{type:s,pathname:n,href:i}=e;if(s==="back"){t.realBack();return}if(s==="forward"){t.forward();return}}),t.$router.onPushState(({from:e,to:s,path:n,pathname:i})=>{window.history.pushState({from:e,to:s},"",n)}),t.$router.onReplaceState(({from:e,path:s,pathname:n})=>{window.history.replaceState({from:e},"",s)}),Wo.addEventListener("click",e=>{let s=e.target;if(s instanceof Document||s===null)return;let n=!1;for(;s;){const a=s;if(a.tagName==="A"){n=!0;break}s=a.parentNode}if(!n)return;const i=s,l=i.getAttribute("href");l&&l.startsWith("/")&&(l.startsWith("http")||i.getAttribute("target")!=="_blank"&&(e.preventDefault(),t.handleClickLink({href:l,target:null})))}),window.addEventListener("popstate",e=>{const{type:s}=e,{pathname:n,href:i}=window.location;t.$router.handlePopState({type:s,href:i,pathname:e.state?.to})})}const Go={root:{title:"ROOT",pathname:"/",children:{home_layout:{title:"首页布局",pathname:"/home",children:{index:{title:"首页",pathname:"/home/index",options:{require:["login"]}},drive_list:{title:"云盘列表",pathname:"/home/drive",options:{require:["login"]}},drive_profile:{title:"云盘详情",pathname:"/home/drive_profile",options:{require:["login"]}},season_list:{title:"电视剧列表",pathname:"/home/season",options:{require:["login"]}},season_profile:{title:"电视剧详情",pathname:"/home/season_profile",options:{require:["login"]}},movie_list:{title:"电影列表",pathname:"/home/movie",options:{require:["login"]}},movie_profile:{title:"电影详情",pathname:"/home/movie_profile",options:{require:["login"]}},invalid_media_list:{title:"影视剧待处理问题",pathname:"/home/invalid_media",options:{require:["login"]}},person_list:{title:"参演人员列表",pathname:"/home/person",options:{require:["login"]}},job_list:{title:"日志",pathname:"/home/log",options:{require:["login"]}},job_profile:{title:"日志详情",pathname:"/home/log_profile",options:{require:["login"]}},member_list:{title:"成员列表",pathname:"/home/member",options:{require:["login"]}},parse_result_layout:{title:"解析结果",pathname:"/home/unknown_media",children:{season:{title:"电视剧解析结果",pathname:"/home/unknown_media/season"},episode:{title:"剧集解析结果",pathname:"/home/unknown_media/episode"},movie:{title:"电影解析结果",pathname:"/home/unknown_media/movie"}},options:{require:["login"]}},permission:{title:"权限列表",pathname:"/home/permission",options:{require:["login"]}},resource_sync:{title:"同步任务列表",pathname:"/home/resource_sync",options:{require:["login"]}},subtitles_list:{title:"字幕列表",pathname:"/home/subtitles",options:{require:["login"]}},subtitles_create:{title:"字幕上传",pathname:"/home/subtitles/create",options:{require:["login"]}},collection_list:{title:"集合列表",pathname:"/home/collection",options:{require:["login"]}},collection_create:{title:"集合创建",pathname:"/home/collection/create",options:{require:["login"]}},collection_edit:{title:"集合编辑",pathname:"/home/collection/edit",options:{require:["login"]}},report_list:{title:"问题列表",pathname:"/home/report",options:{require:["login"]}},transfer:{title:"文件转存",pathname:"/home/transfer",options:{require:["login"]}},transfer_search_list:{title:"资源查询历史",pathname:"/home/transfer/search",options:{require:["login"]}},transfer_history_list:{title:"资源转存历史",pathname:"/home/transfer/history",options:{require:["login"]}}}},archive:{title:"电视剧归档",pathname:"/home/archive",options:{require:["login"]}},preview:{title:"预览",pathname:"/home/preview",options:{require:["login"]}},login:{title:"管理员登录",pathname:"/login"},register:{title:"管理员注册",pathname:"/register"},notfound:{title:"404",pathname:"/notfound"}}}},ar=qo(Go),cr=ar.routes,Hn=ar.routesWithPathname;globalThis.__routes_with_pathname__=Hn;globalThis.__routes__=cr;class Jo extends $e{hostname="";headers={};debug=!1;constructor(e={}){super(e);const{hostname:s="",headers:n={},debug:i=!1}=e;this.hostname=s,this.headers=n,this.debug=i}async get(e,s,n={}){try{const a={url:[this.hostname,e,s?"?"+Wt(s):""].join(""),method:"GET",id:n.id,headers:{...this.headers,...n.headers||{}}};this.debug;const c=await this.fetch(a);return P.Ok(c.data)}catch(i){const l=i,{message:a}=l;return P.Err(a)}}async post(e,s,n={}){const l=[this.hostname,e].join("");try{const a={url:l,method:"POST",data:s,id:n.id,headers:{...this.headers,...n.headers||{}}};this.debug;const c=await this.fetch(a);return P.Ok(c.data)}catch(a){const c=a,{message:d}=c;return P.Err(d)}}async fetch(e){return{data:{}}}cancel(e){const s="请在 connect 中实现 cancel 方法";return P.Err(s)}setHeaders(e){this.headers=e}appendHeaders(e){this.headers={...this.headers,...e}}setDebug(e){this.debug=e}onStateChange(e){return this.on(0,e)}}function Ko(t){let e=[];t.fetch=async s=>{const{url:n,method:i,id:l,data:a,headers:c}=s,d=an.CancelToken.source();if(l&&e.push({id:l,source:d}),i==="GET")try{const u=await an.get(n,{params:a,headers:c,cancelToken:d.token});return e=e.filter(f=>f.id!==l),u}catch(u){throw e=e.filter(f=>f.id!==l),u}if(i==="POST")try{const u=await an.post(n,a,{headers:c,cancelToken:d.token});return e=e.filter(f=>f.id!==l),u}catch(u){throw e=e.filter(f=>f.id!==l),u}return Promise.reject("unknown method")},t.cancel=s=>{const n=e.find(i=>i.id===s);return n?(e=e.filter(i=>i.id!==s),n.source.cancel("主动取消"),P.Ok(null)):P.Err("没有找到对应请求")}}const Nt=new Jo({headers:{}});Ko(Nt);class Xo extends $e{key;values;defaultValues;client;get state(){return{values:this.values}}constructor(e){super(e);const{key:s,client:n,defaultValues:i,values:l}=e;this.key=s,this.values=l,this.values={...i,...l},this.defaultValues=i,this.client=n}get(e,s){const n=this.values[e];if(n===void 0){if(s)return s[e];throw new Error("the default value no existing")}return n}set=nr(100,(e,s)=>{const n={...this.values,[e]:s};this.values=n,this.client.setItem(this.key,JSON.stringify(this.values)),this.emit(0,{...this.state})});merge=(e,s,n={})=>{const i=this.get(e)||{};if(Array.isArray(i)){let l=n.reverse?[...s,...i]:[...i,...s];return n.limit&&(l=l.slice(0,n.limit)),this.set(e,l),l}if(typeof i=="object"&&typeof s=="object"){const l={...i,...s};return this.set(e,l),l}return i};clear(e){if(this.values[e]===void 0)return null;this.values={...this.values,[e]:this.defaultValues[e]},this.client.setItem(this.key,JSON.stringify(this.values)),this.emit(0,{...this.state})}onStateChange(e){return this.on(0,e)}}const fi={user:{id:"",username:"anonymous",token:"",avatar:""},jobs:[]},dr="a_global",pi=globalThis.localStorage.getItem(dr),bt=new Xo({key:dr,defaultValues:fi,values:pi?JSON.parse(pi):fi,client:globalThis.localStorage});window.location.hostname==="media-t.funzm.com"&&Y.setEnv("dev");vo(t=>{t.onFailed(e=>{rt.tip({text:[e.message]}),e.code===900&&Qe.push("root.login")}),t.client||(t.client=Nt)});Ao(t=>t.os===rt.env);wt.prefix="/admin";lt.prefix=window.location.origin;class Qo extends bo{say(){}}const Yt=new Qo(bt.get("user"),Nt),Zo=new wt({location:window.location}),Sn=new is({name:"root",pathname:"/",title:"ROOT",visible:!0,parent:null});Sn.isRoot=!0;const Qe=new jo({view:Sn,router:Zo,routes:cr,views:{root:Sn}}),rt=new No({user:Yt,storage:bt,async beforeReady(){const{pathname:t,query:e}=Qe.$router,s=Hn[t];return Nt.appendHeaders({Authorization:rt.$user.token}),Y.appendHeaders({Authorization:rt.$user.token}),s?s.options?.require?.includes("login")?rt.$user.isLogin?Qe.isLayout(s.name)?(Qe.push("root.home_layout.index"),P.Ok(null)):(Qe.push(s.name,e,{ignore:!0}),P.Ok(null)):(rt.tip({text:["请先登录"]}),Qe.push("root.login",{redirect:s.pathname}),P.Err("need login")):Qe.isLayout(s.name)?P.Err("can't goto layout"):(Qe.push(s.name,e,{ignore:!0}),P.Ok(null)):(Qe.push("root.notfound"),P.Ok(null))}});rt.setEnv({prod:!0,dev:!1});Uo(rt);Yo(Qe);Qe.onClickLink(({href:t,target:e})=>{const{pathname:s,query:n}=wt.parse(t),i=Hn[s];if(!i){rt.tip({text:["没有匹配的页面"]});return}if(e==="_blank"){const l=Qe.buildURLWithPrefix(i.name,n);window.open(l);return}Qe.push(i.name,n)});Qe.onRouteChange(({ignore:t,reason:e,view:s,href:n})=>{const{title:i}=s;rt.setTitle(i),!t&&(e==="push"&&Qe.$router.pushState(n),e==="replace"&&Qe.$router.replaceState(n))});Yt.onTip(t=>{rt.tip(t)});Yt.onLogin(t=>{bt.set("user",t),Nt.appendHeaders({Authorization:Yt.token}),Y.appendHeaders({Authorization:Yt.token}),Qe.push("root.home_layout.index")});Yt.onLogout(()=>{bt.clear("user"),Qe.push("root.login")});Yt.onExpired(()=>{bt.clear("user"),rt.tip({text:["token 已过期，请重新登录"]}),Qe.push("root.login")});Oe.commonProcessor=t=>{if(t===null)return{dataSource:[],page:1,pageSize:20,total:0,noMore:!1,empty:!1,error:null};try{const e=t.data||t,{list:s,page:n,page_size:i,total:l,noMore:a,no_more:c,next_marker:d}=e,u={dataSource:s,page:n,pageSize:i,total:l,empty:!1,noMore:!1,error:null,next_marker:d};return l<=i*n&&(u.noMore=!0),c!==void 0&&(u.noMore=c),a!==void 0&&(u.noMore=a),d===null&&(u.noMore=!0),s.length===0&&n===1&&(u.empty=!0),s.length===0&&(u.noMore=!0),u}catch(e){return{dataSource:[],page:1,pageSize:20,total:0,noMore:!1,empty:!1,error:new rs(`${e.message}`)}}};var Xe=(t=>(t[t.Running=1]="Running",t[t.Paused=2]="Paused",t[t.Finished=3]="Finished",t))(Xe||{});function ea(t){return Y.post("/api/v2/admin/task/list",t)}function ta(t){if(t.error)return P.Err(t.error);const e={...t.data,list:t.data.list.map(s=>{const{created:n,output_id:i,status:l,percent:a,updated:c,...d}=s;return{...d,output_id:i,status:l,statusText:(()=>l===Xe.Running?"运行中":l===Xe.Paused?"已终止":l===Xe.Finished?"已完成":"未知")(),percent:a,created:ft(n).format("YYYY-MM-DD HH:mm:ss"),updated:ft(c).format("YYYY-MM-DD HH:mm:ss")}})};return P.Ok(e)}function ur(t){return Y.post("/api/v2/admin/task/profile",{id:t})}function sa(t){if(t.error)return P.Err(t.error);const{id:e,desc:s,status:n,type:i,lines:l,created:a}=t.data,c={id:e,desc:s,status:n,type:i,statusText:(()=>n===Xe.Running?"运行中":n===Xe.Paused?"已终止":n===Xe.Finished?"已完成":"未知")(),content:l.map(d=>{try{return JSON.parse(d)}catch{}return null}).filter(Boolean),hasMoreContent:!1,created:ft(a).format("YYYY-MM-DD HH:mm:ss")};return P.Ok(c)}function na(t){const{job_id:e,page:s,pageSize:n}=t;return Y.get("/api/v2/admin/task/logs",{page:s,page_size:n})}function ia(t){if(t.error)return P.Err(t.error);const{no_more:e,total:s,list:n}=t.data;return P.Ok({page:t.data.page,page_size:t.data.page_size,noMore:e,total:s,list:n.map(i=>{const{content:l,created:a}=i;return{...JSON.parse(l)}})})}function mi(t){return Y.post("/api/v2/admin/task/status",{id:t})}function qn(t){return Y.post("/api/v2/admin/task/pause",{id:t,force:"1"})}function ra(t){return Y.post("/api/admin/person/list",t)}class Ks extends $e{static async New(e){const{id:s}=e,n=await new I(ur).run(s);if(n.error)return P.Err(n.error);const i=new Ks({id:s});return P.Ok(i)}timer=null;id;loading=!1;completed=!1;start;get state(){return{loading:this.loading,completed:this.completed}}constructor(e){super();const{id:s}=e;this.id=s}async fetchStatus(){const e=await new I(mi).run(this.id);if(e.error)return P.Err(e.error);const{status:s}=e.data;return[Xe.Finished,Xe.Paused].includes(s)&&(this.completed=!0),P.Ok(e.data)}waitFinish(){this.start=ft(),this.timer=setInterval(async()=>{const e=await new I(mi).run(this.id);if(e.error){this.loading=!1,this.emit(0,{...this.state}),this.tip({text:["获取任务状态失败",e.error.message]}),this.timer&&(clearTimeout(this.timer),this.timer=null);return}const{status:s,error:n}=e.data;if(s===Xe.Paused){this.loading=!1,this.tip({text:n?["任务失败",n]:["任务被中断"]}),this.emit(0,{...this.state}),this.emit(2),this.emit(1),this.timer&&(clearInterval(this.timer),this.timer=null);return}s===Xe.Finished&&(this.loading=!1,this.tip({text:n?["任务失败",n]:["任务完成"]}),this.emit(0,{...this.state}),this.emit(1),this.timer&&(clearInterval(this.timer),this.timer=null))},5e3)}async forceFinish(){this.timer!==null&&(await qn(this.id),clearInterval(this.timer),this.timer=null)}onFinish(e){return this.on(1,e)}onPause(e){return this.on(2,e)}onFailed(e){return this.on(3,e)}onCompleted(e){return this.on(4,e)}onStateChange(e){return this.on(0,e)}}const Ut=[],Vs=Dn();async function Xs(){const t=bt.get("jobs").filter(Boolean);if(t.length===0){Vs.emit(0,[]);return}for(let e=0;e<t.length;e+=1){const s=new Ks({id:t[e]}),n=await s.fetchStatus();if(n.error)continue;const{status:i}=n.data;[Xe.Finished,Xe.Paused].includes(i)&&hr(s)}}function la(t){if(Ut.includes(t))return;const e=t.onFinish(()=>{hr(t);const n=Ut.filter(i=>i.id!==t.id);Vs.emit(0,n),e()}),s=bt.get("jobs").filter(Boolean);t.id&&!s.includes(t.id)&&(s.push(t.id),bt.set("jobs",s)),Ut.push(t),Vs.emit(0,Ut)}function hr(t){const e=bt.get("jobs"),s=e.filter(i=>i!==t.id);if(e.includes(t.id)&&bt.set("jobs",s),!Ut.includes(t))return;const n=Ut.findIndex(i=>i===t);n!==-1&&Ut[n]}function it(t){const{job_id:e,onTip:s,onFinish:n}=t,i=new Ks({id:e});i.onFinish(()=>{Xs(),n&&n()}),s&&i.onTip(l=>{s(l)}),la(i),i.waitFinish()}function oa(t){Vs.on(0,t)}const aa="2.5.0",ca="",fn=`${ca}var o=document,i=JSON,m=localStorage;function k(){let t="cna",e=i.parse(m.getItem("token")||"null");if(e===null){alert("请先登录");return}let n=v(o.cookie)[t];if(!n){alert("请先登录");return}let{access_token:r,avatar:s,default_drive_id:a,expire_time:g,nick_name:u,refresh_token:d,user_id:_,user_name:p}=e,f={app_id:window.Global.app_id,drive_id:a,device_id:n,user_id:_,nick_name:u,user_name:p,avatar:s,access_token:r,refresh_token:d},l=i.stringify(f);return y(l),console.log("云盘信息已复制到粘贴板，请粘贴到新增云盘处"),l}function v(t){if(!t)return{};let e={},c=t.split("; ");for(let n=0;n<c.length;n+=1){let[r,s]=c[n].split("=");e[r]=s}return e}function y(t){let e=o.createElement("textarea");e.value=t,o.body.appendChild(e),e.select(),o.execCommand("copy"),o.body.removeChild(e)}k();`;var at=(t=>(t[t.File=1]="File",t[t.Folder=2]="Folder",t))(at||{});const yn={CN:"国产剧",TW:"台剧",HK:"港剧",JP:"日剧",KR:"韩剧",US:"美剧",GB:"英剧",FR:"法国",IT:"意大利",BR:"巴西",DE:"德国",CA:"加拿大",AU:"澳大利亚",IN:"印度",RU:"俄罗斯",ES:"西班牙",MX:"墨西哥",ID:"印度尼西亚",TR:"土耳其",SA:"沙特阿拉伯",ZA:"南非",AR:"阿根廷",TH:"泰国",EG:"埃及",NL:"荷兰",CH:"瑞士",SE:"瑞典",PL:"波兰",PK:"巴基斯坦",NG:"尼日利亚",MY:"马来西亚",BD:"孟加拉国",BE:"比利时"},da={CN:"中国大陆",TW:"中国台湾",HK:"中国香港",JP:"日本",KR:"韩国",US:"美国",GB:"英国",FR:"法国",IT:"意大利",BR:"巴西",DE:"德国",CA:"加拿大",AU:"澳大利亚",IN:"印度",RU:"俄罗斯",BE:"比利时",ES:"西班牙",MX:"墨西哥",ID:"印度尼西亚",TR:"土耳其",SA:"沙特阿拉伯",ZA:"南非",AR:"阿根廷",TH:"泰国",EG:"埃及",NL:"荷兰",CH:"瑞士",SE:"瑞典",PL:"波兰",PK:"巴基斯坦",NG:"尼日利亚",MY:"马来西亚",BD:"孟加拉国"},ua=Object.keys(yn).slice(0,7).map(t=>({value:t,label:yn[t]})),ha=["动作冒险","动画","喜剧","犯罪","纪录","剧情","家庭","儿童","悬疑","新闻","真人秀","Sci-Fi & Fantasy","肥皂剧","脱口秀","War & Politics","西部"],fa=ha.map(t=>({label:t,value:t}));var ct=(t=>(t[t.TV=0]="TV",t[t.Movie=1]="Movie",t[t.Question=2]="Question",t[t.Want=3]="Want",t))(ct||{});const pa={0:"电视剧",1:"电影",2:"问题反馈",3:"想看"},gi={chs:"中文",cht:"中文繁体",eng:"英文",jpn:"日文","chs&eng":"中英对照"},vi=Object.keys(gi).map(t=>({value:t,label:gi[t]}));var nt=(t=>(t[t.AliyunBackupDrive=0]="AliyunBackupDrive",t[t.AliyunResourceDrive=1]="AliyunResourceDrive",t[t.Cloud189Drive=2]="Cloud189Drive",t[t.QuarkDrive=3]="QuarkDrive",t[t.XunleiDrive=4]="XunleiDrive",t[t.LocalFolder=5]="LocalFolder",t[t.AlipanOpenDrive=6]="AlipanOpenDrive",t[t.AlipanResourceOpenDrive=7]="AlipanResourceOpenDrive",t))(nt||{}),St=(t=>(t[t.Unknown=0]="Unknown",t[t.Season=1]="Season",t[t.Movie=2]="Movie",t[t.Episode=3]="Episode",t[t.TV=5]="TV",t[t.TVProfile=6]="TVProfile",t[t.SeasonProfile=7]="SeasonProfile",t[t.MovieProfile=8]="MovieProfile",t[t.EpisodeProfile=9]="EpisodeProfile",t))(St||{});const _i={0:"未知",6:"电视剧详情",7:"季详情",9:"剧集详情",8:"电影详情",5:"电视剧",1:"季",3:"剧集",2:"电影"};Object.keys(_i).map(t=>({value:Number(t),label:_i[t]}));var Me=(t=>(t[t.Season=1]="Season",t[t.Movie=2]="Movie",t))(Me||{}),os=(t=>(t[t.Manually=1]="Manually",t[t.DailyUpdate=2]="DailyUpdate",t[t.DailyUpdateDraft=3]="DailyUpdateDraft",t[t.DailyUpdateArchive=4]="DailyUpdateArchive",t[t.ManuallyRank=5]="ManuallyRank",t))(os||{});function ma(t){const{page:e,pageSize:s,...n}=t;return Y.post("/api/v2/admin/member/list",{...n,page:e,page_size:s})}function ga(t){return Y.post("/api/v2/admin/member/add",t)}function va(t){return Y.post("/api/v2/admin/member/add_token",t)}function _a(t){const{id:e}=t;return Y.post("/api/v2/admin/member/delete",{id:e})}function $a(t){const{member_id:e,permissions:s}=t;return Y.post("/api/v2/admin/member/update_permission",{member_id:e,permissions:s})}function wa(t){return Y.post("/api/v2/admin/report/list",t)}function xa(t){if(t.error)return P.Err(t.error);const{list:e,...s}=t.data;return P.Ok({...s,list:e.map(n=>{const{id:i,type:l,answer:a,data:c,created:d,media:u,media_source:f,member:p}=n;return{id:i,type:l,typeText:pa[l],answer:a,member:p,data:c,media:u,media_source:f,created:ft(d).format("YYYY-MM-DD HH:mm:ss")}})})}function ba(t){return Y.post("/api/v2/admin/sync_task/search_history",t)}function Ca(t){return Y.post("/api/v2/admin/sync_task/transfer_history",t)}function Sa(t){const{text:e,token1:s,token2:n}=t;return Y.post("/api/admin/notify/test",{text:e,token1:s,token2:n})}function $i(){return Y.post("/api/v2/admin/settings/profile",{})}function ya(t){const{third_douban:e,push_deer_token:s,telegram_token:n,extra_filename_rules:i,ignore_files_when_sync:l,max_size_when_sync:a,can_register:c,no_need_invitation_code:d}=t;return Y.post("/api/v2/admin/settings/update",{third_douban:e,push_deer_token:s,telegram_token:n,extra_filename_rules:i,ignore_files_when_sync:l,max_size_when_sync:a,can_register:c,no_need_invitation_code:d})}function ka(t){return Y.post("/api/admin/notify",t)}function La(t){const{report_id:e,content:s,media_id:n}=t;return Y.post("/api/v2/admin/report/reply",{id:e,content:s,media_id:n})}function fr(t){const{pageSize:e,...s}=t;return Y.post("/api/admin/permission/list",{page_size:e,...s})}function Pa(t){const{desc:e}=t,s={desc:e};return Y.post("/api/admin/permission/add",s)}function Ra(t){const{filenames:e}=t;return Y.post("/api/v2/admin/subtitle/parse",{filenames:e})}function Da(t){const{media_id:e,type:s,files:n}=t,i=new FormData;i.append("media_id",e),i.append("type",String(s));for(const l of n){const{file:a,filename:c,language:d}=l;i.append("files",a);const u={filename:c,language:d};s===Me.Season&&l.episode_id&&(u.episode_id=l.episode_id),i.append("payloads",JSON.stringify(u))}return Y.post("/api/v2/admin/subtitle/batch_create",i)}function Ma(t){const{page:e,pageSize:s}=t;return Y.post("/api/v2/admin/subtitle/list",{page:e,page_size:s})}function Ta(t){const{subtitle_id:e}=t;return Y.post("/api/v2/admin/subtitle/delete",{subtitle_id:e})}function Ba(t){return Y.post("/api/v2/admin/member/histories",t)}function Ea(t){return t.error?P.Err(t.error.message):P.Ok({...t.data,list:t.data.list.map(e=>{const{updated:s,...n}=e;return{...n,updated:ft(s).format("YYYY/MM/DD HH:mm")}})})}function Fa(){return Y.post("/api/v2/admin/collection/refresh_media_rank")}const Oa=h('<button role="button">'),Ia=h("<span>");function Va(t){const{store:e}=t,[s,n]=z(e.state);e.onStateChange(l=>{n(l)});const i=()=>s().disabled;return(()=>{const l=Oa();return l.$$click=a=>{a.preventDefault(),e.click()},o(l,()=>t.children),oe(a=>{const c=de("break-keep whitespace-nowrap",t.class),d=i();return c!==a._v$&&be(l,a._v$=c),d!==a._v$2&&(l.disabled=a._v$2=d),a},{_v$:void 0,_v$2:void 0}),l})()}function Aa(t){const{store:e}=t,[s,n]=z(e.state);e.onStateChange(l=>{n(l)});const i=()=>s().loading;return r(X,{get when(){return i()},get children(){return t.children}})}function za(t){const{store:e}=t,[s,n]=z(e.state);e.onStateChange(l=>{n(l)});const i=()=>s().loading;return r(X,{get when(){return!i()},get children(){return t.children}})}function Na(t){const{store:e}=t,[s,n]=z(e.state);return e.onStateChange(i=>{n(i)}),(()=>{const i=Ia();return o(i,()=>t.children),oe(()=>be(i,t.class)),i})()}Pe(["click"]);const Ha=$l("active:scale-95 inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 dark:hover:bg-slate-800 dark:hover:text-slate-100 disabled:opacity-50 dark:focus:ring-slate-400 disabled:pointer-events-none dark:focus:ring-offset-slate-900 data-[state=open]:bg-slate-100 dark:data-[state=open]:bg-slate-800",{variants:{variant:{default:"bg-slate-900 text-white hover:bg-slate-700 dark:bg-slate-50 dark:text-slate-900",destructive:"bg-red-500 text-white hover:bg-red-600 dark:hover:bg-red-600",outline:"bg-transparent border border-slate-200 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-100",subtle:"bg-slate-100 text-slate-900 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100",ghost:"bg-transparent hover:bg-slate-100 dark:hover:bg-slate-800 dark:text-slate-100 dark:hover:text-slate-100 data-[state=open]:bg-transparent dark:data-[state=open]:bg-transparent",link:"bg-transparent dark:bg-transparent underline-offset-4 hover:underline text-slate-900 dark:text-slate-100 hover:bg-transparent dark:hover:bg-transparent"},size:{default:"py-2 px-4",sm:"px-2 rounded-md",lg:"px-8 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function U(t){const{store:e,variant:s,size:n}=t;return r(Va,{store:e,get class(){return Ha({variant:s,size:n,class:de(t.class,"space-x-2")})},get children(){return[r(X,{get when(){return t.icon},get children(){return r(za,{store:e,get children(){return t.icon}})}}),r(Aa,{store:e,get children(){return r(Mt,{class:"animation animate-spin w-4 h-4"})}}),r(X,{get when(){return t.children},get children(){return r(Na,{store:e,get children(){return t.children}})}})]}})}function qa(t,e){t.focus=()=>{e.focus()}}const ja=h("<input multiple>"),Ua=t=>{const{store:e}=t;let s;const[n,i]=z(e.state);e.onStateChange(u=>{i(u)}),tt(()=>{const u=s;u&&(qa(e,u),e.setMounted())});const l=()=>{const{type:u,value:f}=n();return u==="file"?"":f},a=()=>n().placeholder,c=()=>n().disabled,d=()=>n().type;return(()=>{const u=ja();u.addEventListener("blur",()=>{e.handleBlur()}),u.$$keydown=p=>{p.key==="Enter"&&e.handleEnter()},u.$$input=p=>{e.handleChange(p)};const f=s;return typeof f=="function"?dt(f,u):s=u,oe(p=>{const m=de(t.class),g=t.style,C=a(),v=c(),w=d();return m!==p._v$&&be(u,p._v$=m),p._v$2=Ns(u,g,p._v$2),C!==p._v$3&&xe(u,"placeholder",p._v$3=C),v!==p._v$4&&(u.disabled=p._v$4=v),w!==p._v$5&&xe(u,"type",p._v$5=w),p},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),oe(()=>u.value=l()),u})()};Pe(["input","keydown"]);const Wa=h('<div class="relative w-full"><div class="absolute left-3 top-[50%] translate-y-[-50%] text-slate-400 ">'),Le=t=>{const{store:e,prefix:s}=t,[n,i]=z(e.state);e.onStateChange(f=>{i(f)});const{loading:l,value:a,placeholder:c,disabled:d,type:u}=n();return(()=>{const f=Wa(),p=f.firstChild;return o(p,()=>s?l?r(Hs,{class:"w-4 h-4 animate-spin"}):s:null),o(f,r(Ua,{get class(){return de("flex items-center h-10 w-full rounded-md leading-none border border-slate-300 bg-transparent py-2 px-3 text-sm","focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","dark:border-slate-700 dark:text-slate-50 dark:focus:ring-slate-400 dark:focus:ring-offset-slate-900","placeholder:text-slate-400",s?"pl-8":"",t.class)},style:{"vertical-align":"bottom"},store:e}),null),f})()};Le.displayName="Input";const Ya=h('<div role="presentation">'),ks=t=>{const{store:e}=t,[s,n]=z(e.state);e.onStateChange(a=>{n(a)});const i=()=>s().visible,l=()=>s().mounted;return r(X,{get when(){return l()},get children(){const a=Ya();return a.addEventListener("animationend",()=>{e.unmount()}),o(a,()=>t.children),oe(c=>{const d=de("presence",t.class),u=i()?"open":"closed";return d!==c._v$&&be(a,c._v$=d),u!==c._v$2&&xe(a,"data-state",c._v$2=u),c},{_v$:void 0,_v$2:void 0}),a}})},Ga=h('<button type="button" role="checkbox">'),Ja=h("<span>"),Ka=h('<input type="checkbox" aria-hidden>'),Xa=t=>{const{id:e,store:s}=t,[n,i]=z(s.state);return s.onStateChange(l=>{i(l)}),[(()=>{const l=Ga();return l.$$click=a=>{a.stopPropagation(),s.toggle()},o(l,()=>t.children),oe(a=>{const c=t.class,d=pr(n().checked)?"mixed":n().checked,u=n().required,f=mr(n().checked),p=n().disabled?"":void 0,m=n().disabled;return c!==a._v$&&be(l,a._v$=c),d!==a._v$2&&xe(l,"aria-checked",a._v$2=d),u!==a._v$3&&xe(l,"aria-required",a._v$3=u),f!==a._v$4&&xe(l,"data-state",a._v$4=f),p!==a._v$5&&xe(l,"data-disabled",a._v$5=p),m!==a._v$6&&(l.disabled=a._v$6=m),a},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0}),l})(),r(Za,{id:e,get checked(){return n().checked},get required(){return n().required},get disabled(){return n().disabled},style:{transform:"translateX(-100%)"}})]},Qa=t=>{const{store:e}=t,[s,n]=z(e.state);return e.onStateChange(i=>{n(i)}),r(ks,{get store(){return e.presence},class:"w-full h-full",get children(){const i=Ja();return i.style.setProperty("pointer-events","none"),o(i,()=>t.children),oe(l=>{const a=mr(s().checked),c=s().disabled?"":void 0;return a!==l._v$7&&xe(i,"data-state",l._v$7=a),c!==l._v$8&&xe(i,"data-disabled",l._v$8=c),l},{_v$7:void 0,_v$8:void 0}),i}})},Za=t=>{const{id:e,bubbles:s=!0,...n}=t;return(()=>{const i=Ka();return xe(i,"id",e),ji(i,Ui(n,{tabIndex:-1,style:{position:"absolute","pointer-events":"none",opacity:0,margin:0}}),!1,!1),i})()};function pr(t){return t==="indeterminate"}function mr(t){return pr(t)?"indeterminate":t?"checked":"unchecked"}Pe(["click"]);function Kt(t){const{id:e,store:s}=t;return r(Xa,{store:s,id:e,get class(){return de("peer h-4 w-4 shrink-0 rounded-sm border border-black ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground")},get children(){return r(Qa,{store:s,get class(){return de("flex items-center justify-center text-current")},get children(){return r(wl,{class:"h-4 w-4"})}})}})}const ec=h("<div>"),tc=h('<div tabindex="-1"><div>'),jn=t=>t.children,gr=t=>{const{store:e}=t;let s;return e.reference?t.children:(()=>{const n=ec();return dt(i=>{if(s=i,typeof t.ref=="function"){t.ref(i);return}t.ref=i,e.setReference({getRect(){return s.getBoundingClientRect()}})},n),o(n,()=>t.children),oe(()=>be(n,de("popper__anchor",t.class))),n})()},vr=t=>{const{store:e}=t,[s,n]=z(e.state);let i;e.onStateChange(p=>{n(p)}),tt(()=>{e.setFloating({getRect(){return i.getBoundingClientRect()}})});const l=()=>s().x,a=()=>s().y,c=()=>s().isPlaced,d=()=>s().strategy,u=()=>s().placedSide,f=()=>s().placedAlign;return(()=>{const p=tc(),m=p.firstChild;return p.addEventListener("pointerleave",()=>{e.leave()}),p.addEventListener("pointerenter",()=>{e.enter()}),dt(g=>{if(i=g,typeof t.ref=="function"){t.ref(g);return}t.ref=g},p),p.style.setProperty("left","0"),p.style.setProperty("top","0"),p.style.setProperty("min-width","max-content"),p.style.setProperty("z-index","99"),o(m,()=>t.children),oe(g=>{const C=t.role,v=d(),w=c()?`translate3d(${Math.round(l())}px, ${Math.round(a())}px, 0)`:"translate3d(0, -200%, 0)",$=de("popper__content",t.class),E=t.classList,_=u(),k=f();return C!==g._v$&&xe(p,"role",g._v$=C),v!==g._v$2&&((g._v$2=v)!=null?p.style.setProperty("position",v):p.style.removeProperty("position")),w!==g._v$3&&((g._v$3=w)!=null?p.style.setProperty("transform",w):p.style.removeProperty("transform")),$!==g._v$4&&be(m,g._v$4=$),g._v$5=pt(m,E,g._v$5),_!==g._v$6&&xe(m,"data-side",g._v$6=_),k!==g._v$7&&xe(m,"data-align",g._v$7=k),g},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0}),p})()},sc=h('<div class="dismissable-layer">'),nc=t=>{const{store:e}=t;let s,n=null;const i={},l=globalThis?.document,a=c=>{if(!c.target)return;const d=()=>{e.handlePointerDownOnTop()};if(c.pointerType==="touch"){l.removeEventListener("click",d),l.addEventListener("click",d,{once:!0});return}e.handlePointerDownOnTop()};return tt(()=>{e.layers.add(i),n=window.setTimeout(()=>{l.addEventListener("pointerdown",a)},0)}),qs(()=>{e.layers.delete(i),e.layersWithOutsidePointerEventsDisabled.delete(i),n!==null&&window.clearTimeout(n),l.removeEventListener("pointerdown",a),l.removeEventListener("click",e.handlePointerDownOnTop)}),(()=>{const c=sc();c.$$pointerdown=()=>{e.pointerDown()};const d=s;return typeof d=="function"?dt(d,c):s=c,o(c,()=>t.children),c})()};Pe(["pointerdown"]);const ic=h('<div role="menuitem" aria-haspopup="menu">'),_r=t=>{const{store:e}=t;return r(jn,{get class(){return t.class},get store(){return e.popper},get children(){return t.children}})},$r=t=>{const{store:e}=t;return r(gr,{get class(){return t.class},get store(){return e.popper},get children(){return t.children}})},wr=t=>{const{store:e}=t;return r(ks,{get store(){return e.presence},get children(){return r(js,{get children(){return t.children}})}})},xr=t=>{const{store:e}=t;return r(ks,{get store(){return e.presence},get children(){return r(rc,{store:e,get class(){return t.class},get children(){return t.children}})}})},rc=t=>{const{store:e}=t;return r(br,{store:e,get class(){return t.class},get children(){return t.children}})},br=t=>{const{store:e}=t;return r(nc,{get store(){return e.layer},get children(){return r(vr,{get store(){return e.popper},get class(){return t.class},get children(){return t.children}})}})},Cr=t=>{const{store:e}=t;return r(Sr,{get class(){return t.class},store:e,get children(){return t.children}})},Sr=t=>{const{store:e}=t;let s;const[n,i]=z(e.state);e.onStateChange(d=>{i(d)}),e.onFocus(()=>{}),e.onBlur(()=>{s.blur()});const l=()=>n().open,a=()=>n().disabled,c=()=>n().focused;return(()=>{const d=ic();return d.addEventListener("blur",()=>{e.blur()}),d.addEventListener("focus",()=>{e.focus()}),d.$$click=()=>{e.click()},d.addEventListener("pointerleave",u=>{u.pointerType==="mouse"&&(u.currentTarget.blur(),e.leave())}),d.$$pointermove=u=>{u.pointerType==="mouse"&&(e.state.disabled||u.currentTarget.focus(),e.move())},dt(u=>{if(s=u,typeof t.ref=="function"){t.ref(u);return}t.ref=s},d),o(d,()=>t.children),oe(u=>{const f=de("menu__item-impl",t.class),p=lc(l()),m=c()?"":void 0,g=a()||void 0,C=a()?"":void 0,v=a()?void 0:-1;return f!==u._v$&&be(d,u._v$=f),p!==u._v$2&&xe(d,"data-state",u._v$2=p),m!==u._v$3&&xe(d,"data-highlighted",u._v$3=m),g!==u._v$4&&xe(d,"aria-disabled",u._v$4=g),C!==u._v$5&&xe(d,"data-disabled",u._v$5=C),v!==u._v$6&&xe(d,"tabindex",u._v$6=v),u},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0}),d})()},yr=t=>{const{store:e}=t;return r(jn,{get store(){return e.popper},get children(){return t.children}})},kr=t=>{const{store:e}=t;let s;return tt(()=>{const n=s;n&&e.menu&&(t.onMounted&&t.onMounted(n),e.menu.popper.setReference({getRect(){return n.getBoundingClientRect()}}))}),qs(()=>{e.menu&&e.menu.popper.removeReference()}),r($r,{get store(){return e.menu},get children(){return r(Sr,{ref(n){const i=s;typeof i=="function"?i(n):s=n},get class(){return t.class},store:e,get children(){return t.children}})}})},Lr=t=>{const{store:e}=t;return r(ks,{get store(){return e.presence},get children(){return r(br,{store:e,get class(){return t.class},get children(){return t.children}})}})};function lc(t){return t?"open":"closed"}Pe(["pointermove","click"]);const oc=h('<div class="RightSlot">'),ac=h("<span>"),cc=t=>{const{store:e}=t,[s,n]=z(e.state);e.onStateChange(l=>{n(l)});const i=()=>s().items;return r(dc,{store:e,get children(){return[r(uc,{store:e,get children(){return t.children}}),r(Rr,{get store(){return e.menu},get children(){return r(hc,{get class(){return de("z-50 min-w-[8rem] w-56 overflow-hidden rounded-md border-2 border-slate-100 bg-white p-1 text-slate-700 shadow-md dark:border-slate-800 dark:bg-slate-800 dark:text-slate-400",t.class)},store:e,get children(){return r(ie,{get each(){return i()},children:l=>{const{label:a}=l;return l.menu?r(Pr,{get menu(){return e.menu},store:l}):r(Dr,{get class(){return de("relative flex cursor-default select-none items-center rounded-sm py-1.5 px-2 text-sm font-medium outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-700","focus:bg-slate-100")},store:l,children:a})}})}})}})]}})},Pr=t=>{const{menu:e,store:s}=t,[n,i]=z(s.state),[l,a]=z(s.menu.state);s.onStateChange(u=>{i(u)}),s.menu.onStateChange(u=>{a(u)});const c=()=>l().items,d=()=>n().label;return r(fc,{get subMenu(){return s.menu},get children(){return[r(pc,{class:"DropdownMenuSubTrigger",parent:e,item:s,get children(){return[Lt(()=>d()),(()=>{const u=oc();return o(u,r(Qt,{width:15,height:15})),u})()]}}),r(Rr,{get store(){return s.menu},get children(){return r(mc,{class:"DropdownMenuSubContent",get store(){return s.menu},get children(){return r(ie,{get each(){return c()},children:u=>{const{label:f}=u;return u.menu?r(Pr,{get menu(){return s.menu},store:u}):r(Dr,{class:"DropdownMenuItem",store:u,children:f})}})}})}})]}})},dc=t=>{const{store:e}=t;return r(_r,{get store(){return e.menu},get children(){return t.children}})},uc=t=>{const{store:e}=t;let s;return tt(()=>{const n=s;n&&e.setReference({getRect(){return n.getBoundingClientRect()}})}),(()=>{const n=ac();n.$$pointerup=()=>{},n.addEventListener("pointercancel",()=>{}),n.$$pointermove=()=>{},n.$$pointerdown=()=>{},n.$$contextmenu=l=>{l.preventDefault();const a=s;if(!a)return;const{pageX:c,pageY:d}=l;e.updateReference({getRect(){const u=a.getBoundingClientRect(),{top:f,left:p,right:m,bottom:g}=u;return{width:4,height:4,top:f,left:p,right:m,bottom:g,x:c,y:d}}}),e.show({x:c,y:d})};const i=s;return typeof i=="function"?dt(i,n):s=n,n.style.setProperty("-webkit-touch-callout","none"),o(n,()=>t.children),n})()},Rr=t=>{const{store:e}=t;return r(wr,{store:e,get children(){return t.children}})},hc=t=>{const{store:e}=t;return r(xr,{get class(){return t.class},get store(){return e.menu},get children(){return t.children}})},Dr=t=>{const{store:e}=t;return r(Cr,{get class(){return t.class},store:e,get children(){return t.children}})},fc=t=>{const{subMenu:e}=t;return r(yr,{store:e,get children(){return t.children}})},pc=t=>{const{item:e}=t;return r(kr,{get class(){return t.class},store:e,get children(){return t.children}})},mc=t=>{const{store:e}=t;return r(Lr,{get class(){return t.class},store:e,get children(){return t.children}})};Pe(["contextmenu","pointerdown","pointermove","pointerup"]);const gc=h('<div role="presentation">'),At=t=>{const{store:e,enterClassName:s,exitClassName:n,onClick:i}=t,[l,a]=z(e.state);return e.onStateChange(c=>a(c)),r(X,{get when(){return l().mounted},get children(){const c=gc();return Mn(c,"click",i,!0),o(c,()=>t.children),oe(d=>{const u=de("presence",l().enter&&s?s:"",l().exit&&n?n:"",t.class),f=l().visible?"open":"closed";return u!==d._v$&&be(c,d._v$=u),f!==d._v$2&&xe(c,"data-state",d._v$2=f),d},{_v$:void 0,_v$2:void 0}),c}})};Pe(["click"]);const Qs=h("<div>"),vc=h('<div><span class="sr-only">Close'),_c=t=>t.children,$c=t=>{const{store:e,enterClassName:s,exitClassName:n}=t;return r(At,{get store(){return e.present},enterClassName:s,exitClassName:n,get children(){return r(js,{get children(){const i=Qs();return o(i,()=>t.children),oe(()=>be(i,t.class)),i}})}})},wc=t=>{const{store:e,enterClassName:s,exitClassName:n}=t;return r(At,{get store(){return e.present},get class(){return de(t.class)},enterClassName:s,exitClassName:n,onClick:()=>{e.closeable&&e.hide()}})},xc=t=>{const{store:e,enterClassName:s,exitClassName:n}=t;return r(At,{get store(){return e.present},get class(){return de(t.class)},enterClassName:s,exitClassName:n,get children(){return t.children}})},bc=t=>{const{store:e}=t,[s,n]=z(e.state);return e.onStateChange(i=>{n(i)}),(()=>{const i=vc(),l=i.firstChild;return i.$$click=()=>{t.store.hide()},o(i,()=>t.children,l),oe(a=>{const c=t.class,d=Pc(s().open);return c!==a._v$&&be(i,a._v$=c),d!==a._v$2&&xe(i,"data-state",a._v$2=d),a},{_v$:void 0,_v$2:void 0}),i})()},Cc=t=>(()=>{const e=Qs();return o(e,()=>t.children),oe(()=>be(e,de(t.class))),e})(),Sc=t=>(()=>{const e=Qs();return o(e,()=>t.children),oe(()=>be(e,de(t.class))),e})(),yc=t=>(()=>{const e=Qs();return o(e,()=>t.children),oe(()=>be(e,de(t.class))),e})(),kc=t=>{const{store:e}=t;return r(U,{get store(){return e.okBtn},get children(){return t.children}})},Lc=t=>{const{store:e}=t;return r(U,{variant:"subtle",get store(){return e.cancelBtn},get children(){return t.children}})};function Pc(t){return t?"open":"closed"}Pe(["click"]);const Rc=h('<span class="sr-only">Close'),Dc=h('<div class="space-x-2">');function ve(t){const{store:e,width:s="w-full sm:max-w-lg"}=t,[n,i]=z(e.state);return e.onStateChange(l=>i(l)),r(_c,{store:e,get children(){return r($c,{class:"fixed inset-0 z-50 flex items-start justify-center sm:items-center",store:e,get children(){return[r(wc,{get class(){return de("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm","transition-all duration-200")},enterClassName:"animate-in fade-in",exitClassName:"animate-out fade-out",store:e}),r(xc,{get class(){return de("fixed z-50 grid gap-4 rounded-b-lg bg-white p-6 duration-200","sm:zoom-in-90 sm:rounded-lg","dark:bg-slate-900")},enterClassName:"animate-in fade-in-90",exitClassName:"animate-out fade-out",store:e,get children(){return[r(Cc,{class:"flex flex-col space-y-2 text-center sm:text-left",get children(){return r(yc,{get class(){return de("text-lg font-semibold text-slate-900","dark:text-slate-50")},get children(){return n().title}})}}),Lt(()=>t.children),r(X,{get when(){return n().closeable},get children(){return r(bc,{get class(){return de("absolute top-4 right-4 cursor-pointer rounded-sm","opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 disabled:pointer-events-none","dark:focus:ring-slate-400 dark:focus:ring-offset-slate-900","data-[state=open]:bg-slate-100 dark:data-[state=open]:bg-slate-800")},store:e,get children(){return[r(ys,{width:15,height:15}),Rc()]}})}}),r(X,{get when(){return n().footer},get children(){return r(Sc,{class:"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",get children(){const l=Dc();return o(l,r(Lc,{store:e,children:"取消"}),null),o(l,r(kc,{store:e,children:"确认"}),null),l}})}})]}})]}})}})}const Mc=h("<button>"),Tc=t=>{const{store:e}=t;return r(_r,{get class(){return t.class},get store(){return e.menu},get children(){return t.children}})},Bc=t=>{const{store:e}=t,[s,n]=z(e.state);e.onStateChange(l=>{n(l)});const i=()=>s().disabled;return r($r,{get class(){return t.class},get store(){return e.menu},get children(){const l=Mc();return l.$$keydown=a=>{if(!i()){if(["Enter"," "].includes(a.key)){e.toggle();return}a.key,["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault()}},l.$$pointerdown=()=>{e.toggle()},o(l,()=>t.children),l}})},Mr=t=>{const{store:e}=t;return r(wr,{get class(){return t.class},store:e,get children(){return t.children}})},Ec=t=>{const{store:e}=t;return r(xr,{get store(){return e.menu},get class(){return t.class},get children(){return t.children}})},Tr=t=>{const{store:e}=t;return r(Cr,{get class(){return t.class},store:e,get children(){return t.children}})},Fc=t=>{const{store:e}=t;return r(yr,{get class(){return t.class},store:e,get children(){return t.children}})},Oc=t=>{const{store:e}=t;return tt(()=>{e.log("[COMPONENT]SubTrigger - mounted")}),r(kr,{get class(){return t.class},store:e,get children(){return t.children}})},Ic=t=>{const{store:e}=t;return r(Lr,{store:e,get class(){return t.class},get children(){return t.children}})};Pe(["pointerdown","keydown"]);const Br=h('<div class="mr-2">'),Er=h("<div>"),Vc=h('<div class="ml-auto h-4 w-4">'),Zs=t=>{const{store:e}=t,[s,n]=z(e.state);return e.onStateChange(i=>{n(i)}),r(Tc,{store:e,get children(){return[r(X,{get when(){return t.children},get children(){return r(Bc,{class:"inline-block",store:e,get children(){return t.children}})}}),r(Mr,{get store(){return e.menu},get children(){return r(Ec,{get class(){return de("z-50 min-w-[8rem] w-56 overflow-hidden rounded-md border-2 border-slate-100 bg-white p-1 text-slate-700 shadow-md dark:border-slate-800 dark:bg-slate-800 dark:text-slate-400",t.class)},store:e,get children(){return r(ie,{get each(){return s().items},children:i=>i.hidden?null:r(X,{get when(){return!!i.menu},get fallback(){return r(Tr,{get class(){return de("relative flex cursor-default select-none items-center rounded-sm py-1.5 px-2 text-sm font-medium outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-700","focus:bg-slate-100")},store:i,get children(){return[r(X,{get when(){return!!i.icon},get children(){const l=Br();return o(l,()=>i.icon),l}}),(()=>{const l=Er();return o(l,()=>i.label),oe(()=>xe(l,"title",i.tooltip)),l})(),r(X,{get when(){return i.shortcut},get children(){return i.shortcut}})]}})},get children(){return r(Fr,{get subMenu(){return i.menu},store:i})}})})}})}})]}})},Fr=t=>{const{store:e,subMenu:s}=t,[n,i]=z(e.state),[l,a]=z(s.state);e.onStateChange(f=>{i(f)}),s.onStateChange(f=>{a(f)});const c=()=>l().items,d=()=>n().label,u=()=>n().icon;return r(Fc,{store:s,get children(){return[r(Oc,{get class(){return de("flex cursor-default select-none items-center rounded-sm py-1.5 px-2 text-sm font-medium outline-none focus:bg-slate-100 data-[highlighted]:bg-slate-100 data-[state=open]:bg-slate-100 dark:focus:bg-slate-700 dark:data-[state=open]:bg-slate-700",{"pl-8":!!u()},t.class)},store:e,get children(){return[r(X,{get when(){return!!u()},get children(){const f=Br();return o(f,u),f}}),Lt(()=>d()),(()=>{const f=Vc();return o(f,r(Qt,{class:"w-4 h-4"})),f})()]}}),r(Mr,{store:s,get children(){return r(Ic,{get class(){return de("z-50 min-w-[8rem] overflow-hidden rounded-md border-2 border-slate-100 bg-white p-1 text-slate-700 shadow-md dark:border-slate-800 dark:bg-slate-800 dark:text-slate-400",t.class)},store:s,get children(){return r(ie,{get each(){return c()},children:f=>f.menu?r(Fr,{get subMenu(){return f.menu},store:f}):r(Tr,{get class(){return de("relative flex cursor-default select-none items-center rounded-sm py-1.5 px-2 text-sm font-medium outline-none focus:bg-slate-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-700")},store:f,get children(){const p=Er();return o(p,()=>e.label),oe(()=>xe(p,"title",e.tooltip)),p}})})}})}})]}})},wi="enable-hardware";function Ac(t,e){function s(u){t.handlePointDown(u);const f=t.getScrollTop();t.os.pc&&f<=0&&(e.addEventListener("mousemove",t.handleMouseMove,{passive:!1}),document.ondragstart=function(){return!1})}function n(){t.handleTouchEnd(),t.os.pc&&(e.removeEventListener("mousemove",t.handleMouseMove),document.ondragstart=function(){return!0})}e.addEventListener("touchstart",s),e.addEventListener("touchmove",t.handleTouchMove,{passive:!1}),e.addEventListener("touchend",n),e.addEventListener("touchcancel",n),e.addEventListener("mousedown",s),e.addEventListener("mouseup",n),e.addEventListener("mouseleave",n),e.addEventListener("scroll",t.handleScrolling);let i=!1;t.optimizeScroll=u=>{u&&i===!1&&(e.classList.add(wi),e.style.webkitOverflowScrolling="auto",i=!0),u===!1&&i&&(e.style.webkitOverflowScrolling="touch",e.classList.remove(wi),i=!1)};let l=0,a=0;function c(u){let f=u.currentTarget,p=!0;for(;f&&f!==document.body&&f!==document;){const v=f.classList;if(v){if(v.contains("mescroll")||v.contains("mescroll-touch")){p=!1;break}else if(v.contains("mescroll-touch-x")||v.contains("mescroll-touch-y")){var m=u.touches?u.touches[0].pageX:0,g=u.touches?u.touches[0].pageY:0;l||(l=m),a||(a=g);const w=Math.abs(l-m),$=Math.abs(a-g),E=Math.sqrt(w*w+$*$);if(l=m,a=g,E!==0){var C=Math.asin($/E)/Math.PI*180;if(C<=45&&v.contains("mescroll-touch-x")||C>45&&v.contains("mescroll-touch-y")){p=!1;break}}}}f=f.parentNode}p&&$s(u)}t.refreshRect=()=>{const{scrollHeight:u}=e;t.setRect({contentHeight:u})},t.setBounce=u=>{t.os.ios&&(u===!1?window.addEventListener("touchmove",c,{passive:!1}):window.removeEventListener("touchmove",c))},t.setScrollTop=u=>{e.scrollTop=u},t.getScrollTop=()=>e.scrollTop,t.getScrollClientHeight=()=>e.clientHeight,t.getScrollHeight=()=>e.scrollHeight,t.getBodyHeight=()=>document.body.clientHeight||document.documentElement.clientHeight,t.getOffsetTop=u=>{let f=u.offsetTop,p=u.offsetParent;for(;p&&p!==e;)f+=p.offsetTop+p.clientTop,p=p.offsetParent;return f};function d(u,f,p,m=300,g=30){const C=f-u;if(m===0||C===0){p&&p(f);return}const v=m/g,w=C/v;let $=0;const E=window.setInterval(()=>{$<v-1?(u+=w,p&&p(u,E),$++):(p&&p(f,E),window.clearInterval(E))},g)}t.scrollTo=(u,f)=>{const{top:p=0}=u,m=t.getScrollTop();let g=p;if(g>0){const C=t.getScrollHeight()-t.getScrollClientHeight();g>C&&(g=C)}else g=0;t.isScrollTo=!0,e.style.overflow="hidden",d(m,g,C=>{t.setScrollTop(C),C===g&&(e.style.overflow="auto",t.isScrollTo=!1)},f)},t.destroy=()=>{e.removeEventListener("touchstart",s),e.removeEventListener("touchmove",t.handleTouchMove),e.removeEventListener("touchend",n),e.removeEventListener("touchcancel",n),e.removeEventListener("mousedown",s),e.removeEventListener("mousemove",t.handleMouseMove),e.removeEventListener("mouseup",n),e.removeEventListener("mouseleave",n),e.removeEventListener("scroll",t.handleScrolling),t.setBounce(!0)}}function zc(t,e){t.hideIndicator=()=>{e.innerHTML=""},t.changeIndicatorHeight=n=>{e.style.height=n+"px"};let s=!1;t.setIndicatorHeightTransition=n=>{n&&s===!1&&(e.style.transition="height 300ms",s=!0),!n&&s===!0&&(e.style.transition="unset",s=!1)}}const en=h("<div>"),Nc=t=>{const{store:e,children:s,...n}=t;let i;return tt(()=>{i&&(e.setRect({width:i.clientWidth,height:i.clientHeight}),e.setMounted(),Ac(e,i))}),(()=>{const l=en();Mn(l,"click",t.onClick,!0);const a=i;return typeof a=="function"?dt(a,l):i=l,o(l,()=>t.children),oe(c=>{const d=t.class,u=t.style;return d!==c._v$&&be(l,c._v$=d),c._v$2=Ns(l,u,c._v$2),c},{_v$:void 0,_v$2:void 0}),l})()},Hc=t=>{const{store:e}=t;let s;return tt(()=>{s&&(zc(e,s),e.needHideIndicator&&e.hideIndicator())}),(()=>{const n=en(),i=s;return typeof i=="function"?dt(i,n):s=n,n.style.setProperty("height","0"),o(n,()=>t.children),oe(()=>be(n,t.class)),n})()},qc=t=>{const{store:e}=t;let s;return e.inDownOffset(()=>{s&&(s.style.display="block")}),e.onPullToRefresh(()=>{s&&(s.style.display="none")}),(()=>{const n=en(),i=s;return typeof i=="function"?dt(i,n):s=n,o(n,()=>t.children),oe(()=>be(n,t.class)),n})()},jc=t=>{const{store:e}=t;let s;return e.inDownOffset(()=>{s&&(s.style.display="none")}),e.onPullToRefresh(()=>{s&&(s.style.display="inline-block")}),(()=>{const n=en(),i=s;return typeof i=="function"?dt(i,n):s=n,n.style.setProperty("display","none"),o(n,()=>t.children),oe(()=>be(n,t.class)),n})()};Pe(["click"]);const Uc=h("<div>"),Wc=h('<div class="inline-flex justify-center items-center w-full h-full">'),Yc=h('<div class="absolute left-0 bottom-0 w-full min-h-[30px] py-[10px]">'),We=t=>{const{store:e,children:s,...n}=t,[i,l]=z(!1);return e.inDownOffset(()=>{l(!1)}),e.outDownOffset(()=>{l(!0)}),r(Nc,{get class(){return de("scroll-view w-full h-full overflow-y-auto",t.class)},get style(){return t.style},store:e,get onClick(){return n.onClick},get children(){return[r(Hc,{class:"relative w-full overflow-hidden text-center",store:e,get children(){const a=Yc();return o(a,r(qc,{class:"w-[50px] h-[50px] mx-auto rounded-full bg-w-bg-0",store:e,get children(){const c=Uc();return c.style.setProperty("transition","all 300ms"),o(c,r(Wi,{width:18,height:18})),oe(()=>be(c,de("inline-flex justify-center items-center w-full h-full",i()?"rotate-[180deg]":"rotate-[0deg]"))),c}}),null),o(a,r(jc,{class:"w-[50px] h-[50px] mx-auto rounded-full bg-w-bg-0",store:e,get children(){const c=Wc();return o(c,r(Hs,{class:"animate animate-spin",width:18,height:18})),c}}),null),a}}),Lt(()=>t.children)]}})},Gc=h("<div>");function Un(t){const{store:e,index:s}=t,[n,i]=z(e.$presence.state);return e.$presence.onStateChange(l=>i(l)),e.ready(),tt(()=>{e.mounted||e.setShow()}),qs(()=>{e.setUnmounted(),e.destroy()}),(()=>{const l=Gc();return s!=null?l.style.setProperty("z-index",s):l.style.removeProperty("z-index"),o(l,()=>t.children),oe(a=>{const c=de(t.class,n().enter?`animate-in ${e.animation.in}`:"",n().exit?`animate-out ${e.animation.out}`:""),d=n().visible?"block":"none",u=n().visible?"open":"closed",f=e.title,p=e.href;return c!==a._v$&&be(l,a._v$=c),d!==a._v$2&&((a._v$2=d)!=null?l.style.setProperty("display",d):l.style.removeProperty("display")),u!==a._v$3&&xe(l,"data-state",a._v$3=u),f!==a._v$4&&xe(l,"data-title",a._v$4=f),p!==a._v$5&&xe(l,"data-href",a._v$5=p),a},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),l})()}const Jc=h("<div>");function j(t){return(()=>{const e=Jc();return oe(()=>be(e,de("animate-pulse w-full h-full rounded-md bg-gray-200",t.class))),e})()}const Kc=h("<textarea>"),gt=t=>{const{store:e,class:s,...n}=t,[i,l]=z(e.state);e.onStateChange(u=>{l(u)});const a=()=>i().value,c=()=>i().placeholder,d=()=>i().disabled;return(()=>{const u=Kc();u.$$input=p=>{const{value:m}=p.currentTarget;e.setValue(m)};const f=t.ref;return typeof f=="function"?dt(f,u):t.ref=u,ji(u,Ui({get class(){return de("flex h-20 w-full rounded-md border border-slate-300 bg-transparent py-2 px-3 text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:text-slate-50 dark:focus:ring-slate-400 dark:focus:ring-offset-slate-900",t.class)},get value(){return a()},get placeholder(){return c()},get disabled(){return d()}},n),!1,!1),u})()};gt.displayName="Textarea";Pe(["input"]);const Or=h("<button>"),Wn=t=>{const{store:e}=t;return r(jn,{get store(){return e.popper},get children(){return t.children}})},Yn=t=>{const{store:e}=t;return r(gr,{get store(){return e.popper},get class(){return t.class},get children(){const s=Or();return s.$$click=()=>{e.toggle()},o(s,()=>t.children),s}})},Gn=t=>{const{store:e}=t,[s,n]=z(e.popper.container);return e.popper.onContainerChange(i=>{n(i)}),r(ks,{get store(){return e.present},get children(){return r(js,{get mount(){return s()??void 0},get children(){return t.children}})}})},Jn=t=>{const{store:e}=t;return r(Xc,{store:e,get class(){return t.class},get children(){return t.children}})},Xc=t=>{const{store:e}=t;return r(Qc,{store:e,get class(){return t.class},get children(){return t.children}})},Qc=t=>{const{store:e}=t,[s,n]=z(e.present.state);return e.present.onStateChange(i=>{n(i)}),r(vr,{get store(){return e.popper},get class(){return t.class},get"data-state"(){return s().visible?"open":"closed"},get children(){return t.children}})},Ir=t=>{const{store:e}=t;return(()=>{const s=Or();return s.$$click=()=>{e.hide()},o(s,()=>t.children),oe(()=>be(s,t.class)),s})()};Pe(["click"]);const Vr=h("<div>"),Zc=t=>{const{store:e}=t;return r(Wn,{store:e,get children(){return[r(X,{get when(){return t.children},get children(){return r(Yn,{store:e,class:"inline-flex items-center justify-center",get children(){return t.children}})}}),r(Gn,{store:e,get children(){return r(Jn,{store:e,get class(){return de("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","relative rounded-md p-5 w-64 bg-white shadow-lg focus:shadow-md focus:ring-2 focus:ring-violet-700",t.class)},get children(){return[(()=>{const s=Vr();return o(s,()=>t.content),s})(),r(Ir,{store:e,class:"font-inherit rounded-full h-6 w-6 inline-flex items-center justify-center text-violet-900 absolute top-3 right-3",get children(){return r(ys,{class:"w-4 h-4"})}})]}})}})]}})},ed=t=>{const{children:e,side:s="bottom",align:n="end"}=t,i=new Js({side:s,align:n,strategy:"absolute"});return r(Wn,{store:i,get children(){return[r(Yn,{store:i,class:"inline-flex items-center justify-center",children:e}),r(Gn,{store:i,get children(){return r(Jn,{store:i,get class(){return de("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","relative rounded-md p-5 w-64 bg-white shadow-lg focus:shadow-md focus:ring-2 focus:ring-violet-700",t.class)},get children(){return[(()=>{const l=Vr();return o(l,()=>t.content),l})(),r(Ir,{store:i,class:"font-inherit rounded-full h-6 w-6 inline-flex items-center justify-center text-violet-900 absolute top-3 right-3",get children(){return r(ys,{class:"w-4 h-4"})}})]}})}})]}})},td=h('<div><div class="h-full w-full flex-1 bg-slate-900 transition-all dark:bg-slate-400">'),sd=t=>{const{store:e}=t,[s,n]=z(e.state);return e.onStateChange(i=>{n(i)}),(()=>{const i=td(),l=i.firstChild;return oe(a=>{const c=de("relative h-1 w-full overflow-hidden rounded-full bg-slate-100 dark:bg-slate-800",t.class),d=`translateX(-${100-(s().value||0)}%)`;return c!==a._v$&&be(i,a._v$=c),d!==a._v$2&&((a._v$2=d)!=null?l.style.setProperty("transform",d):l.style.removeProperty("transform")),a},{_v$:void 0,_v$2:void 0}),i})()};function nd(t,e){const s=new IntersectionObserver(n=>{n.forEach(i=>{i.isIntersecting&&(e.handleShow(),s.unobserve(t))})},{threshold:.01});s.observe(t)}const id=h("<img>"),rd=h("<div>");function je(t){const{store:e}=t;let s;const[n,i]=z(e.state);return e.onStateChange(l=>{i(l)}),tt(()=>{s&&nd(s,e)}),(()=>{const l=rd(),a=s;return typeof a=="function"?dt(a,l):s=l,o(l,r(Cl,{get children(){return[r(cn,{get when(){return n().step===qt.Failed},get children(){return r(xl,{class:"w-8 h-8 text-slate-500"})}}),r(cn,{get when(){return n().step===qt.Pending},get children(){return r(bl,{class:"w-8 h-8 text-slate-500"})}}),r(cn,{get when(){return[qt.Loading,qt.Loaded].includes(n().step)},get children(){const c=id();return c.addEventListener("error",()=>{e.handleError()}),oe(d=>{const u=t.class,f=n().fit,p=n().src,m=n().alt;return u!==d._v$&&be(c,d._v$=u),f!==d._v$2&&((d._v$2=f)!=null?c.style.setProperty("object-fit",f):c.style.removeProperty("object-fit")),p!==d._v$3&&xe(c,"src",d._v$3=p),m!==d._v$4&&xe(c,"alt",d._v$4=m),d},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),c}})]}})),oe(c=>pt(l,{[t.class]:!0,"flex items-center justify-center":!0,"bg-slate-200":![qt.Loading,qt.Loaded].includes(n().step)},c)),l})()}const ld=h('<div class="z-index-200 fixed right-4 bottom-24"><div class="flex items-center justify-center w-[64px] h-[64px] rounded-full bg-slate-300 opacity-100 dark:bg-black-900 safe-bottom">');function Ar(t){const{store:e}=t,[s,n]=z(!1);return e.onScroll(i=>{}),r(X,{get when(){return s()},get children(){const i=ld(),l=i.firstChild;return l.$$click=()=>{e.scrollTo({top:0})},o(l,r(Sl,{class:"w-6 h-6"})),i}})}Pe(["click"]);const od=h('<div><div class="text-sm">'),ad=h('<div class="flex items-center flex-wrap gap-2 max-w-full">'),cd=t=>{const{label:e,store:s}=t,[n,i]=z(s.state);return s.onStateChange(l=>{i(l)}),(()=>{const l=od(),a=l.firstChild;return l.$$click=()=>{s.toggle()},o(a,e),oe(()=>be(l,de("py-2 px-4 rounded-lg border cursor-pointer",n().checked?"bg-slate-500 text-slate-200 dark:text-slate-600":"",{"bg-slate-500":n().checked}))),l})()},Ts=t=>{const{store:e}=t,[s,n]=z(e.state);return e.onStateChange(i=>{n(i)}),(()=>{const i=ad();return o(i,r(ie,{get each(){return s().options},children:l=>{const{label:a,core:c}=l;return r(cd,{store:c,label:a})}})),i})()};Pe(["click"]);const dd=h('<div class="absolute top-0 z-10 w-full h-[360px] center flex items-center justify-center"><div class="flex flex-col items-center justify-center text-slate-500"><div class="mt-4 flex items-center space-x-2"><div class="text-xl text-center">'),ud=h('<div class="mt-4 flex justify-center py-4 text-slate-500"><div class="flex items-center space-x-2"><div class="text-center text-xl">没有数据了'),hd=h("<div><div>"),fd=h('<div class="w-full h-[360px] center flex items-center justify-center"><div class="flex flex-col items-center justify-center text-slate-500"><div class="mt-4 flex items-center space-x-2"><div class="text-center text-xl">'),pd=h('<div class="mt-4 flex justify-center py-4 text-slate-500"><div class="flex items-center space-x-2 cursor-pointer"><div class="text-center text-xl">');function Ye(t){const{store:e,skeleton:s}=t,[n,i]=z(e.response);return e.onStateChange(l=>{i(l)}),(()=>{const l=hd(),a=l.firstChild;return o(a,r(X,{get when(){return n().initial},get fallback(){return r(X,{get when(){return!n().empty},get fallback(){return(()=>{const c=fd(),d=c.firstChild,u=d.firstChild,f=u.firstChild;return o(d,r(Yi,{class:"w-24 h-24"}),u),o(u,r(X,{get when(){return n().loading},get children(){return r(Mt,{class:"w-6 h-6 animate-spin"})}}),f),o(f,()=>n().loading?"加载中":"列表为空"),c})()},get children(){return t.children}})},get children(){return r(X,{when:s,children:s})}})),o(l,r(X,{get when(){return!!n().error},get fallback(){return r(X,{get when(){return Lt(()=>!n().noMore)()&&!n().initial},get children(){const c=pd(),d=c.firstChild,u=d.firstChild;return d.$$click=()=>{e.loadMore()},o(d,r(X,{get when(){return n().loading},get fallback(){return r(Wi,{class:"w-6 h-6"})},get children(){return r(Mt,{class:"w-6 h-6 animate-spin"})}}),u),o(u,()=>n().loading?"加载中":"加载更多"),c}})},get children(){const c=dd(),d=c.firstChild,u=d.firstChild,f=u.firstChild;return o(d,r(Bs,{class:"w-24 h-24"}),u),o(f,()=>n().error?.message),c}}),null),o(l,r(X,{get when(){return Lt(()=>!!n().noMore)()&&!n().empty},get children(){const c=ud(),d=c.firstChild,u=d.firstChild;return o(d,r(X,{get when(){return n().loading},get children(){return r(Mt,{class:"w-6 h-6 animate-spin"})}}),u),u.$$click=()=>{e.loadMoreForce()},c}}),null),oe(c=>{const d=de("relative"),u=t.class;return d!==c._v$&&be(l,c._v$=d),u!==c._v$2&&be(a,c._v$2=u),c},{_v$:void 0,_v$2:void 0}),l})()}Pe(["click"]);const md="modulepreload",gd=function(t){return"/admin/"+t},xi={},vd=function(e,s,n){if(!s||s.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(s.map(l=>{if(l=gd(l),l in xi)return;xi[l]=!0;const a=l.endsWith(".css"),c=a?'[rel="stylesheet"]':"";if(!!n)for(let f=i.length-1;f>=0;f--){const p=i[f];if(p.href===l&&(!a||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${c}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":md,a||(u.as="script",u.crossOrigin=""),u.href=l,document.head.appendChild(u),a)return new Promise((f,p)=>{u.addEventListener("load",f),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>e()).catch(l=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=l,window.dispatchEvent(a),!a.defaultPrevented)throw l})};function _d(t,e){t.onloadstart=()=>{e.handleStartLoad()},t.onloadedmetadata=function(s){const n=this.videoWidth,i=this.videoHeight;e.handleLoadedmetadata({width:n,height:i,duration:t.duration})},t.onload=()=>{e.handleLoad()},t.oncanplay=s=>{e.handleCanPlay()},t.onplay=()=>{e.handlePlay()},t.onplaying=()=>{e.handlePlaying()},t.ontimeupdate=s=>{const{currentTime:n,duration:i}=s.currentTarget;e.handleTimeUpdate({currentTime:n,duration:i})},t.onpause=s=>{const{currentTime:n,duration:i}=s.currentTarget;e.handlePause({currentTime:n,duration:i})},t.onwaiting=()=>{},t.onended=()=>{e.handleEnded()},t.onvolumechange=s=>{const{volume:n}=s.currentTarget,i=n;e._curVolume!==i&&e.handleVolumeChange(i)},t.onresize=()=>{const{videoHeight:s,videoWidth:n}=t;e.handleResize({width:n,height:s})},t.onerror=s=>{const n=(()=>{if(typeof s=="string")return new Error(s);const i=s.target?.error?.code;return i===MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED?new Error("不支持的视频格式"):i===MediaError.MEDIA_ERR_DECODE?new Error("视频解码错误"):i===MediaError.MEDIA_ERR_ABORTED?new Error("视频加载中止"):new Error("unknown")})();e.handleError(n.message)},t.addEventListener("webkitstartfullscreen",()=>{e.handleFullscreenChange(!0)}),t.addEventListener("webkitendfullscreen",()=>{e.handleFullscreenChange(!1)}),e.bindAbstractNode({$node:t,async play(){try{await t.play()}catch{}},pause(){t.pause()},canPlayType(s){return!!t.canPlayType(s)},async load(s){if(t.canPlayType("application/vnd.apple.mpegurl")){t.src=s,t.load();return}const i=(await vd(()=>import("./hls.min-279adb22.js").then(l=>l.h),["assets/hls.min-279adb22.js","assets/vendor-b20170bd.js"])).default;if(i.isSupported()&&s.includes("m3u8")){const l=new i({fragLoadingTimeOut:2e3});l.attachMedia(t),l.on(i.Events.MEDIA_ATTACHED,()=>{l.loadSource(s)});return}t.src=s,t.load()},setCurrentTime(s){t.currentTime=s},setVolume(s){t.volume=s},setRate(s){t.playbackRate=s},enableFullscreen(){t.removeAttribute("webkit-playsinline"),t.removeAttribute("playsinline")},disableFullscreen(){t.setAttribute("webkit-playsinline","true"),t.setAttribute("playsinline","true")},requestFullscreen(){t.requestFullscreen&&t.requestFullscreen(),t.webkitRequestFullscreen&&t.webkitRequestFullscreen(),t.mozRequestFullScreen&&t.mozRequestFullScreen(),t.msRequestFullscreen&&t.msRequestFullscreen()},exitFullscreen(){},showSubtitle(){t.textTracks[0]&&(t.textTracks[0].mode="showing")},hideSubtitle(){t.textTracks[0]&&(t.textTracks[0].mode="hidden")},showAirplay(){if(t.webkitShowPlaybackTargetPicker){t.webkitShowPlaybackTargetPicker();return}alert("AirPlay not supported.")},pictureInPicture(){if(t.webkitSetPresentationMode){t.webkitSetPresentationMode("picture-in-picture");return}alert("Picture-in-Picture not supported.")}})}const $d=h('<div class="w-full"><video class="w-full relative z-10" webkit-playsinline="true" plays-in-line preload="none">');function wd(t){const{store:e}=t;let s;const[n,i]=z(e.state);e.onStateChange(u=>{i(u)}),tt(()=>{setTimeout(()=>{const u=s;u&&(e.setMounted(),_d(u,e))},200)});const{width:l,height:a,ready:c,poster:d}=n();return(()=>{const u=$d(),f=u.firstChild,p=s;return typeof p=="function"?dt(p,f):s=f,xe(f,"poster",d),f.controls=!0,xe(f,"height",a),u})()}const xd=h("<div>"),zr=t=>(()=>{const e=xd(),s=t.ref;return typeof s=="function"?dt(s,e):t.ref=e,o(e,()=>t.children),oe(()=>be(e,de(t.class))),e})();function bd(t){return t.children}Pe(["input","click"]);const Cd=h('<div><div class="tabs-wrapper relative"><div id="tabs-wrapper" class="flex">'),Sd=h("<div>"),yd=h('<div class="absolute bottom-0 w-4 bg-slate-900 transition-all">'),tn=t=>{const{store:e}=t,[s,n]=z(e.state),[i,l]=z(null);return e.onStateChange(a=>{n(a)}),e.onLinePositionChange(a=>{l(a.left)}),(()=>{const a=Cd(),c=a.firstChild,d=c.firstChild;return a.addEventListener("animationstart",u=>{const{width:f,height:p,left:m}=u.currentTarget.getBoundingClientRect();e.updateContainerClient({width:f,height:p,left:m})}),o(d,r(ie,{get each(){return s().tabs},children:(u,f)=>(()=>{const p=Sd();return p.addEventListener("animationend",m=>{m.stopPropagation();const g=m.currentTarget;e.updateTabClient(f(),{rect(){const{offsetLeft:C,clientWidth:v,clientHeight:w}=g;return{width:v,height:w,left:C}}})}),p.$$click=()=>{e.select(f())},pt(p,{"__a p-4 break-keep cursor-pointer":!0}),o(p,()=>u.text),p})()}),null),o(d,(()=>{const u=Lt(()=>i()!==null);return()=>u()?(()=>{const f=yd();return f.style.setProperty("height","4px"),f.style.setProperty("transform","translateX(-50%)"),oe(()=>`${i()}px`!=null?f.style.setProperty("left",`${i()}px`):f.style.removeProperty("left")),f})():null})(),null),oe(()=>be(a,de("__a tabs w-full overflow-x-auto scroll--hidden"))),a})()};Pe(["click"]);class Ls extends $e{key;tabs=[];count=0;mounted=!1;extra={};current=null;left=null;container={width:0,left:0,scrollLeft:0};targetLeftWhenSelected=null;get selectedTabId(){if(this.current===null)return null;const e=this.tabs[this.current];return e?e.id??null:this.tabs.length?this.tabs[0].id:null}get selectedTab(){return this.current===null?null:this.tabs[this.current]}get state(){return{tabs:this.tabs,curId:this.selectedTabId,current:this.current,left:this.targetLeftWhenSelected}}constructor(e){super(e);const{key:s="id",options:n,targetLeftWhenSelected:i=0,onChange:l,onMounted:a}=e;this.key=s,this.targetLeftWhenSelected=i,this.tabs=n,l&&this.onChange(l),a&&this.onMounted(a)}setTabs(e){if(e.length!==0){this.tabs=e;for(let s=0;s<e.length;s+=1){const{id:n}=e[s];this.extra[n]={rect(){return{left:0,width:0,height:0}}}}}}select(e){const s=this.tabs[e];if(!s)return;this.current=e;const n=this.calcLineLeft(this.current);n!==null&&(this.left=n,this.changeLinePosition(n)),this.emit(4,{...s,index:e}),this.emit(0,{...this.state})}pendingAction=null;selectById(e,s={}){if(!this.mounted){this.pendingAction={id:e,options:s};return}const{ignore:n}=s,i=this.tabs.findIndex(c=>c.id===e);if(i===-1)return;const l=this.tabs[i];if(!l)return;this.current=i;const a=this.calcLineLeft(this.current);a!==null&&this.changeLinePosition(a),this.emit(0,{...this.state}),n||this.emit(4,{...l,index:i})}handleChangeById(e){const s=this.tabs.findIndex(i=>i.id===e);if(s===-1)return;this.current=s;const n=this.calcLineLeft(this.current);n!==null&&this.changeLinePosition(n)}calcLineLeft(e){const s=this.tabs[e];if(!s)return null;const n=this.extra[s.id].rect();return n.left+n.width/2}updateTabClient(e,s){const n=this.tabs[e];n&&(this.extra[n.id]=s,Object.keys(this.extra).length===this.tabs.length&&((()=>{if(this.pendingAction){this.selectById(this.pendingAction.id,this.pendingAction.options),this.pendingAction=null;return}const i=this.calcLineLeft(0);i!==null&&this.changeLinePosition(i)})(),this.mounted=!0,this.emit(3)))}changeLinePosition(e){this.emit(2,{left:e})}updateTabClientById(e,s){const n=this.tabs.findIndex(l=>l.id===e);if(n===-1)return;const i=this.tabs[n];this.extra[i.id]=s}updateContainerClient(e){this.container={...this.container,...e}}calcScrollLeft(e){const{width:s,left:n}=this.container;if(e===null)return;const i=this.extra[e.id].rect(),l=i.left+i.width/2,a=(()=>this.targetLeftWhenSelected===null?0:this.targetLeftWhenSelected<=1?this.targetLeftWhenSelected*s:this.targetLeftWhenSelected)();if(l<=a){this.container.scrollLeft=0,this.emit(1,{left:0});return}const c=l-n-a;this.container.scrollLeft=c,this.emit(1,{left:c})}onScroll(e){return this.on(1,e)}onLinePositionChange(e){return this.on(2,e)}onChange(e){return this.on(4,e)}onMounted(e){return this.on(3,e)}onStateChange(e){return this.on(0,e)}}const kd=h('<div class="relative">'),Ld=h("<div>"),Pd=h('<div class="flex"><div class="flex-1 overflow-hidden text-ellipsis space-y-1">'),Rd=h('<div><div class="flex"><div class="flex-1 overflow-hidden text-ellipsis"><div class="text-2xl"></div><div class="text-slate-500"></div><div class="break-all whitespace-pre-wrap truncate line-clamp-4"></div><div>'),Dd=h("<div><div></div><div>"),Md=t=>{const{store:e}=t;new Ls({key:"id",options:[{id:"season",text:"电视剧"},{id:"movie",text:"电影"}],onChange(d){e.search({type:d.id})}});const s=new Ze({}),n=new Ue({async onReachBottom(){await e.$list.loadMore(),n.finishLoadingMore()}}),[i,l]=z(e.state);e.onStateChange(d=>{l(d)});const a=()=>i().response.dataSource,c=()=>i().cur;return(()=>{const d=Ld();return o(d,r(We,{store:n,class:"relative h-[480px] overflow-y-auto space-y-4",get children(){return r(Ye,{get store(){return e.$list},get skeleton(){return(()=>{const u=Pd(),f=u.firstChild;return o(u,r(j,{class:"w-[120px] h-[176px] rounded-sm mr-4"}),f),o(f,r(j,{class:"w-[128px] h-[32px]"}),null),o(f,r(j,{class:"w-[48px] h-[24px]"}),null),o(f,r(j,{class:"w-[320px] h-[48px]"}),null),o(f,r(j,{class:"w-[40px] h-[24px]"}),null),u})()},get children(){const u=kd();return o(u,r(ie,{get each(){return a()},children:f=>{const{name:p,original_name:m,overview:g,poster_path:C,air_date:v,episodes:w}=f;return(()=>{const $=Rd(),E=$.firstChild,_=E.firstChild,k=_.firstChild,T=k.nextSibling,O=T.nextSibling,F=O.nextSibling;return $.$$click=()=>{e.toggle(f)},o(E,r(je,{class:"w-[120px] h-[176px] rounded-sm object-fit mr-4",get store(){return s.bind(C)},alt:p}),_),o(k,p),o(T,m),o(O,g),o(F,v),o($,r(X,{when:w,get children(){return r(ie,{each:w,children:x=>{const{name:V,air_date:N}=x;return(()=>{const y=Dd(),R=y.firstChild,M=R.nextSibling;return o(R,V),o(M,N),y})()}})}}),null),oe(()=>be($,de("p-2",f.id===c()?.id?"bg-slate-300":"bg-white"))),$})()}})),u}})}})),d})()};Pe(["click"]);function Td(t){const{keyword:e,page:s,pageSize:n,type:i,...l}=t;return Y.post("/api/v2/media_profile/list",{...l,keyword:e,page:s,page_size:n,type:i})}function Bd(t){if(t.error)return P.Err(t.error.message);const{next_marker:e,list:s}=t.data;return P.Ok({list:s.map(n=>{const{id:i,name:l,original_name:a,overview:c,air_date:d,poster_path:u,vote_average:f,source_count:p,sources:m=[],genres:g,persons:C,origin_country:v}=n;return{id:i,type:n.type,name:l,original_name:a,overview:c,poster_path:u,air_date:d,vote_average:f,episode_count:p,episodes:n.type===Me.Movie?[]:m.map(w=>{const{id:$,name:E,air_date:_,order:k}=w;return{id:$,name:E,air_date:_,order:k}}),genres:g,persons:C,origin_country:v}}),next_marker:e})}function Ed(t){const{series_id:e}=t;return Y.post("/api/v2/media_profile/init_series",{series_id:e})}function Fd(t){const{media_id:e}=t;return Y.post("/api/v2/media_profile/init_season",{media_id:e})}function Od(t){const{keyword:e,page:s,pageSize:n,type:i,...l}=t;return Y.post("/api/v2/media_profile/search_tmdb",{...l,keyword:e,page:s,page_size:n,type:i})}function Id(t){const{media_id:e}=t;return Y.post("/api/v2/admin/media/refresh_profile",{media_id:e})}function Vd(t,e){return Y.post("/api/v2/media_profile/edit",{id:t,...e})}class Ad extends $e{$list=new Oe(new I(Td,{process:Bd}));form;input;searchBtn;resetBtn;type;cur=null;get state(){return{cur:this.cur,response:this.$list.response}}constructor(e={}){super(e);const{type:s,onSelect:n}=e;s&&(this.type=s,this.$list.setParams({type:s})),this.form=new rr,this.searchBtn=new Q({onClick:()=>{if(!this.input.value){this.tip({text:["请输入查询关键字"]});return}this.$list.search({keyword:this.input.value})}}),this.resetBtn=new Q({onClick:()=>{this.input.clear(),this.$list.clear()}}),this.input=new _e({defaultValue:"",placeholder:s===Me.Movie?"请输入电影名称":"请输入电视剧名称",onEnter:()=>{this.searchBtn.click()}}),this.$list.onStateChange(i=>{this.emit(2,{...this.state})}),this.$list.onLoadingChange(i=>{this.searchBtn.setLoading(i)}),n&&(this.onSelect(i=>{n(i)}),this.onUnSelect(()=>{n(null)}))}search(e){this.$list.search(e)}toggle(e){if(this.cur===e){this.cur=null,this.emit(1,null),this.emit(2,{...this.state});return}this.cur=e,this.emit(0,e),this.emit(2,{...this.state})}onSelect(e){this.on(0,e)}onUnSelect(e){this.on(1,e)}onStateChange(e){this.on(2,e)}}const zd=h('<div class="grid grid-cols-12 items-center gap-4"><div class="col-span-10">'),Nd=h('<div class="grid gap-4 py-4"><div class="grid grid-cols-12"><div class="col-span-2"></div><div class="space-x-2 col-span-10">'),Hd=h('<div class="h-[480px] overflow-y-auto space-y-2">'),qd=h("<div>"),jd=h('<div class="relative h-[360px] p-2 space-y-4"><div class="absolute inset-0 flex items-center justify-center"><div class="flex flex-col items-center justify-center text-slate-500"><div class="text-xl">搜索 TMDB 数据库'),Ud=h('<div><div class="flex"><div class="flex-1 overflow-hidden text-ellipsis"><div class="text-2xl"></div><div class="text-slate-500"></div><div class="break-all whitespace-pre-wrap truncate line-clamp-4"></div><div>'),Wd=h('<div class="p-2"><div>、</div><div></div><div>'),Pt=t=>{const{store:e}=t,s=new Ls({key:"id",options:[{id:"season",text:"电视剧"},{id:"movie",text:"电影"}],onChange(w){const $={season:Me.Season,movie:Me.Movie};e.search({type:$[w.id]})}}),n=new kt({visible:!0}),i=new kt,l=new kt,a=new Ad({type:Me.Season,async onSelect(w){if(e.needEpisode){if(!w)return;e.select(w);const $=await new I(Fd).run({media_id:w.id});if($.error){e.tip({text:["获取剧集失败",$.error.message]});return}i.hide(),l.show(),m($.data.list);return}if(w){e.select(w);return}e.unSelect()}}),c=new Ze({}),d=new Ue({async onReachBottom(){await e.$list.loadMore(),d.finishLoadingMore()}}),[u,f]=z(e.state),[p,m]=z([]);e.onStateChange(w=>{f(w)});const g=()=>u().response.dataSource,C=()=>u().cur,v=()=>u().curEpisode;return(()=>{const w=qd();return o(w,r(At,{classList:{"opacity-100":!0,"animate-in slide-in-from-right":!0,"data-[state=closed]:animate-out data-[state=closed]:slide-out-to-right":!0},store:n,get children(){return[(()=>{const $=Nd(),E=$.firstChild,_=E.firstChild,k=_.nextSibling;return o($,r(bd,{get store(){return e.$form},get children(){const T=zd(),O=T.firstChild;return o(T,r(zr,{class:"col-span-2 text-right",children:"名称"}),O),o(O,r(Le,{get store(){return e.$input}})),T}}),E),o(k,r(U,{class:"",get store(){return e.searchBtn},children:"搜索"}),null),o(k,r(U,{class:"",variant:"subtle",get store(){return e.resetBtn},children:"重置"}),null),$})(),r(X,{get when(){return!e.type},get children(){return r(tn,{store:s})}}),r(We,{store:d,class:"relative h-[360px] overflow-y-auto py-2 space-y-4",get children(){return r(Ye,{get store(){return e.$list},get skeleton(){return(()=>{const $=jd(),E=$.firstChild,_=E.firstChild,k=_.firstChild;return o(_,r(ot,{class:"w-24 h-24"}),k),$})()},get children(){return r(ie,{get each(){return g()},children:$=>{const{id:E,type:_,name:k,original_name:T,overview:O,poster_path:F,air_date:x}=$;return(()=>{const V=Ud(),N=V.firstChild,y=N.firstChild,R=y.firstChild,M=R.nextSibling,J=M.nextSibling,S=J.nextSibling;return V.$$click=async()=>{if(_===Me.Season){n.hide(),i.show();const A=await new I(Ed).run({series_id:String(E)});if(A.error)return;a.$list.modifyResponse(B=>({...B,initial:!1,dataSource:[...A.data.list],noMore:!A.data.next_marker}));return}e.toggle($)},o(N,r(je,{class:"w-[120px] rounded-sm object-fit mr-4",get store(){return c.bind(F)},alt:k}),y),o(R,k),o(M,T),o(J,O),o(S,x),oe(()=>be(V,de("p-2",$.id===C()?.id?"bg-slate-300":"bg-white"))),V})()}})}})}})]}}),null),o(w,r(At,{classList:{"opacity-100":!0,"animate-in slide-in-from-right":!0,"data-[state=closed]:animate-out data-[state=closed]:slide-out-to-right":!0},store:i,get children(){return r(Md,{store:a})}}),null),o(w,r(At,{classList:{"opacity-100":!0,"animate-in slide-in-from-right":!0,"data-[state=closed]:animate-out data-[state=closed]:slide-out-to-right":!0},store:l,get children(){const $=Hd();return o($,r(ie,{get each(){return p()},children:E=>{const{id:_,name:k,overview:T,air_date:O,order:F}=E;return(()=>{const x=Wd(),V=x.firstChild,N=V.firstChild,y=V.nextSibling,R=y.nextSibling;return x.$$click=()=>{e.selectEpisode(E)},o(V,F,N),o(V,k,null),o(y,T),o(R,O),oe(()=>x.classList.toggle("bg-slate-300",_===v()?.id)),x})()}})),$}}),null),w})()};Pe(["click"]);const Yd=h('<div class="w-[520px]">');function Gd(t){const{store:e}=t;return r(ve,{get store(){return e.dialog},get children(){const s=Yd();return o(s,r(Pt,{get store(){return e.tmdb}})),s}})}class Rt extends $e{type;$list=new Oe(new I(Od));$form;$input;searchBtn;resetBtn;cur=null;curEpisode=null;needEpisode=!1;get state(){return{response:this.$list.response,cur:this.cur,curEpisode:this.curEpisode}}constructor(e={}){super(e);const{type:s,episode:n=!1}=e;s&&(this.type=s),this.needEpisode=n,this.$list.setParams({type:s||Me.Season}),this.$form=new rr,this.searchBtn=new Q({onClick:()=>{if(!this.$input.value){this.tip({text:["请输入查询关键字"]});return}this.$list.search({keyword:this.$input.value})}}),this.resetBtn=new Q({onClick:()=>{this.$input.clear(),this.$list.clear()}}),this.$input=new _e({defaultValue:"",placeholder:s===Me.Movie?"请输入电影名称":"请输入电视剧名称",onEnter:()=>{this.searchBtn.click()}}),this.$list.onStateChange(i=>{this.emit(1,{...this.state})}),this.$list.onLoadingChange(i=>{this.searchBtn.setLoading(i)})}search(e){this.$list.search(e)}select(e){this.cur=e,this.emit(1,{...this.state})}selectEpisode(e){this.curEpisode=e,this.emit(1,{...this.state})}unSelect(){this.cur=null,this.emit(1,{...this.state})}toggle(e){if(this.cur===e){this.cur=null,this.emit(1,{...this.state});return}this.cur=e,this.emit(1,{...this.state})}onStateChange(e){this.on(1,e)}}class Jd extends $e{tmdb;dialog;okBtn;cancelBtn;state;constructor(e={}){super(e);const{type:s,footer:n=!0,onOk:i,onCancel:l}=e;this.dialog=new ge({title:s===Me.Movie?"搜索电影":"搜索电视剧",footer:n,onOk:()=>{i&&this.tmdb.state.cur&&i(this.tmdb.state.cur)},onCancel:l}),this.tmdb=new Rt({type:s}),this.state={value:null,list:this.tmdb.$list.response,showFooter:n},this.okBtn=this.dialog.okBtn,this.cancelBtn=this.dialog.cancelBtn,this.tmdb.$list.onStateChange(a=>{this.state.list=a,this.emit(2,{...this.state})}),this.tmdb.onTip(a=>{this.tip(a)})}show(){this.dialog.show()}hide(){this.dialog.hide()}refresh(){this.tmdb.$list.refresh()}input(e){this.tmdb.$input.setValue(e)}onOk(e){this.on(0,e)}onCancel(e){this.on(0,e)}onStateChange(e){this.on(2,e)}}const Kd=h('<div class="relative">'),Xd=h('<div><div class="grid gap-4 py-4"><div class="grid grid-cols-12 items-center gap-4"><div class="col-span-10"></div></div><div class="grid grid-cols-12"><div class="col-span-2"></div><div class="space-x-2 col-span-10">'),Qd=h('<div><div class="text-slate-500 text-sm"></div><div class="flex-1 overflow-hidden text-ellipsis"><div class="break-all">/'),Zd=t=>{const{store:e}=t,s=new Ue({async onReachBottom(){await e.$list.loadMore(),s.finishLoadingMore()}}),[n,i]=z(e.state);e.onStateChange(a=>{i(a)});const l=()=>n().list.dataSource;return(()=>{const a=Xd(),c=a.firstChild,d=c.firstChild,u=d.firstChild,f=d.nextSibling,p=f.firstChild,m=p.nextSibling;return o(d,r(zr,{class:"col-span-2 text-right",children:"名称"}),u),o(u,r(Le,{get store(){return e.form.input}})),o(m,r(U,{class:"",get store(){return e.form.btn},children:"搜索"}),null),o(m,r(U,{class:"",variant:"subtle",get store(){return e.form.reset},children:"重置"}),null),o(a,r(Ye,{get store(){return e.$list},get children(){const g=Kd();return o(g,r(We,{store:s,class:"relative max-h-[360px] overflow-y-auto p-2 space-y-2",get children(){return r(ie,{get each(){return l()},children:C=>{const{name:v,parent_paths:w,drive:$}=C;return(()=>{const E=Qd(),_=E.firstChild,k=_.nextSibling,T=k.firstChild,O=T.firstChild;return o(_,()=>$.name),o(T,w,O),o(T,v,null),oe(()=>be(E,de("py-2","bg-white"))),E})()}})}})),g}}),null),a})()},eu=h('<div class="w-[520px]">');function tu(t){const{store:e}=t;return r(ve,{get store(){return e.$dialog},get children(){const s=eu();return o(s,r(Zd,{store:e})),s}})}function kn(t){const{drive_id:e,file_id:s,name:n,next_marker:i,page:l,pageSize:a=24}=t;return Y.post("/api/v2/drive/file/list",{drive_id:e,name:n,file_id:s,next_marker:i,page:l,page_size:a})}function Ln(t){if(t.error)return P.Err(t.error);const{items:e,next_marker:s}=t.data;return P.Ok({list:e.map(n=>{const{file_id:i,name:l,parent_file_id:a,size:c,type:d,thumbnail:u}=n;return{file_id:i,name:l,type:d==="file"?at.File:at.Folder,size:c,parent_paths:[{file_id:a,name:""}]}}),no_more:s==="",next_marker:s})}function su(t){const{drive_id:e,file_id:s}=t;return Y.post("/api/v2/drive/file/profile",{drive_id:e,file_id:s})}function nu(t){const{drive_id:e,file_id:s,name:n,regexp:i,replace:l}=t;return Y.post("/api/v2/drive/rename_files",{drive_id:e,file_id:s,name:n,regexp:i,replace:l})}function iu(t){const{drive_id:e,file_id:s,name:n}=t;return Y.post("/api/v2/drive/file/rename",{drive_id:e,file_id:s,name:n})}function ru(t){const{drive_id:e,file_id:s,file_name:n}=t;return Y.post("/api/v2/drive/file/delete",{drive_id:e,file_id:s,file_name:n})}function lu(t){const{drive_id:e,to_drive_id:s,file_id:n}=t;return Y.post("/api/v2/drive/file/transfer",{file_id:n,from_drive_id:e,to_drive_id:s})}function ou(t){const{drive_id:e,file_id:s}=t;return Y.post("/api/v2/drive/file/to_resource_drive",{file_id:s,from_drive_id:e})}function au(){return Y.post("/api/admin/file/search")}function cu(t){return t.error?P.Err(t.error.message):P.Ok({...t.data,list:t.data.list.map(e=>{const{id:s,file_id:n,name:i,parent_paths:l,type:a,drive:c}=e;return{id:s,file_id:n,name:i,file_name:i,parent_paths:l,type:a,drive:c}})})}function du(t){const{file_id:e,drive_id:s}=t;return Y.post("/api/v2/drive/file/download",{file_id:e,drive_id:s})}function uu(t){const{drive_id:e}=t;return Y.post("/api/v2/admin/drive/delete",{drive_id:e})}class Nr extends $e{$dialog=new ge;$list=new Oe(new I(au,{process:cu}));form={input:new _e({defaultValue:""}),btn:new Q,reset:new Q};okBtn;cancelBtn;get state(){return{value:null,list:this.$list.response,showFooter:!0}}constructor(e={}){super(e);const{search:s,footer:n=!0,onCancel:i}=e;this.$dialog=new ge({title:"搜索云盘文件",footer:n,onCancel:i}),s&&this.$list.setParams(l=>({...l,...s})),this.$list.onLoadingChange(l=>{this.form.btn.setLoading(l),this.form.reset.setLoading(l)}),this.form.input.onEnter(()=>{this.form.btn.click()}),this.form.btn.onClick(()=>{const l=this.form.input.value;if(!l){this.tip({text:["请输入文件名称"]});return}this.$list.search({name:l})}),this.form.reset.onClick(()=>{this.$list.reset()}),this.okBtn=this.$dialog.okBtn,this.cancelBtn=this.$dialog.cancelBtn,this.$list.onStateChange(l=>{this.state.list=l,this.emit(2,{...this.state})})}show(){this.$dialog.show()}hide(){this.$dialog.hide()}refresh(){this.$list.refresh()}input(e){this.form.input.setValue(e)}onOk(e){this.on(0,e)}onCancel(e){this.on(0,e)}onStateChange(e){this.on(2,e)}}const hu=h('<div class="flex w-full h-full bg-white"><div class="w-[248px] py-4 pl-2 pr-2 border border-r-slate-300"><div class="flex flex-col justify-between h-full w-full"><div class="flex-1 space-y-1 p-2 w-full h-full overflow-y-auto rounded-xl self-start"></div><div class="flex justify-center"></div></div></div><div class="flex-1 bg-slate-100"><div class="relative w-full h-full">'),fu=h('<div class="w-12 h-12 rounded-full bg-slate-300">'),pu=h('<div class="absolute z-50 right-8 top-6">'),mu=h('<div class="w-[520px]"><div><div>PushDeer token</div><div class="mt-2 flex items-center space-x-2"></div></div><div class="mt-4"><div>三方豆瓣接口</div></div><div class="mt-4"><div>文件名解析规则</div></div><div class="mt-4"><div>转存忽略规则</div></div><div class="mt-4"><div>注册</div>开放注册<!>无需邀请码</div><div class="mt-4"><div>当前版本</div><div class="">v'),gu=h('<div class="absolute right-[-8px] top-0 w-2 h-2 rounded-full bg-red-500">'),vu=h('<div><div class="w-6 h-6"></div><div class="flex-1 text-lg text-slate-800"><div class="relative inline-block">'),_u=h("<div>"),$u=t=>{const{app:e,history:s,client:n,storage:i,pages:l,view:a}=t,c=new I($i,{onLoading(b){O.setLoading(b)},onSuccess(b){const{third_douban:L={hostname:"",token:""},push_deer_token:W="",telegram_token:D="",extra_filename_rules:K="",ignore_files_when_sync:te="",can_register:ee,no_need_invitation_code:se}=b;v.setValue(W),w.setValue(D),$.setValue(L.hostname),E.setValue(L.token),g.setValue(K),C.setValue(te),ee&&V.check(),se&&N.check()},onFailed(b){e.tip({text:["获取设置失败",b.message]})}});new I($i,{onLoading(b){F.setLoading(b)},onSuccess(b){e.tip({text:["清除成功"]})},onFailed(b){e.tip({text:["获取设置失败",b.message]})}});const d=new Jd({footer:!1}),u=new Nr({footer:!1}),f=new Q({async onClick(){f.setLoading(!0),e.$user.logout(),await Os(2e3),f.setLoading(!1)}}),p=new I(ya,{onLoading(b){m.okBtn.setLoading(b)},onSuccess(){e.tip({text:["更新成功"]})},onFailed(b){e.tip({text:["更新失败",b.message]})}}),m=new ge({title:"配置",onOk(){const b=v.value?.trim(),L=w.value?.trim(),W={hostname:$.value?.trim(),token:E.value?.trim()},D=C.value?.trim(),K=g.value?.trim(),te=V.checked,ee=N.checked,se={ignore_files_when_sync:D,push_deer_token:b,telegram_token:L,third_douban:W,extra_filename_rules:K,can_register:te,no_need_invitation_code:ee};if(b&&(se.push_deer_token=b),L&&(se.telegram_token=L),K&&(se.extra_filename_rules=K),Object.keys(se).filter(he=>!!se[he]).length===0){e.tip({text:["配置不能均为空"]});return}if(se.extra_filename_rules&&se.extra_filename_rules.split(`

`).map(fe=>{const[le,ce]=fe.split(`
`);return{regexp:le,placeholder:ce}}).some(fe=>{const{regexp:le,placeholder:ce}=fe;if(!le||!ce)return!0;try{new RegExp(le)}catch{return!0}})){e.tip({text:["存在不合法的解析规则，请检查后重新提交"]});return}p.run(se)}}),g=new _e({defaultValue:"",placeholder:"额外解析规则"}),C=new _e({defaultValue:"",placeholder:"转存时可忽略指定文件/文件夹"}),v=new _e({defaultValue:"",placeholder:"请输入 push deer token"}),w=new _e({defaultValue:"",placeholder:"请输入 Telegram token"}),$=new _e({defaultValue:"",placeholder:"请输入三方豆瓣 hostname"}),E=new _e({defaultValue:"",placeholder:"请输入三方豆瓣 token"}),_=new I(Sa,{onLoading(b){T.setLoading(b)},onSuccess(){e.tip({text:["发送成功"]})},onFailed(b){e.tip({text:["发送失败",b.message]})}}),k=new _e({defaultValue:"",placeholder:"请输入文本测试消息推送"}),T=new Q({onClick(){if(!v.value){e.tip({text:["请输入推送 token"]});return}if(!k.value){e.tip({text:["请输入推送文本"]});return}_.run({text:k.value,token1:v.value,token2:w.value})}}),O=new Q({onClick(){c.run(),m.show()}}),F=new Q({}),x=new Gs({align:"start",side:"bottom",items:[new qe({icon:r(yl,{class:"w-4 h-4"}),label:"设置",onClick(){c.run(),x.hide(),m.show()}}),new qe({icon:r(kl,{class:"w-4 h-4"}),label:"退出登录",async onClick(){f.setLoading(!0),e.$user.logout(),await Os(2e3),x.hide(),f.setLoading(!1)}})]}),V=new mt,N=new mt,[y,R]=z(a.curView),[M,J]=z(a.subViews);a.onSubViewsChange(b=>{J(b)}),a.onCurViewChange(b=>{R(b)}),d.onTip(b=>{e.tip(b)}),u.onTip(b=>{e.tip(b)});const[S,A]=z([{text:"首页",icon:r(Ll,{class:"w-6 h-6"}),url:"root.home_layout.index"},{text:"云盘管理",icon:r(Tn,{class:"w-6 h-6"}),url:"root.home_layout.drive_list"},{text:"电视剧",icon:r(Bn,{class:"w-6 h-6"}),url:"root.home_layout.season_list"},{text:"电影",icon:r(Gt,{class:"w-6 h-6"}),url:"root.home_layout.movie_list"},{text:"刮削结果",icon:r(Pl,{class:"w-6 h-6"}),url:"root.home_layout.parse_result_layout.season"},{text:"问题影视剧",icon:r(Rl,{class:"w-6 h-6"}),badge:!1,url:"root.home_layout.invalid_media_list"},{text:"集合管理",icon:r(Us,{class:"w-6 h-6"}),url:"root.home_layout.collection_list"},{text:"字幕管理",icon:r(Dl,{class:"w-6 h-6"}),url:"root.home_layout.subtitles_list"},{text:"同步任务",icon:r(Ml,{class:"w-6 h-6"}),url:"root.home_layout.resource_sync"},{text:"任务",icon:r(Tl,{class:"w-6 h-6"}),badge:!1,url:"root.home_layout.job_list"},{text:"问题反馈",icon:r(Bl,{class:"w-6 h-6"}),badge:!1,url:"root.home_layout.report_list"},{text:"云盘文件搜索",icon:r(Gi,{class:"w-6 h-6"}),onClick(){u.show()}},{text:"TMDB 数据库",icon:r(El,{class:"w-6 h-6"}),onClick(){d.show()}},{text:"成员",icon:r(Fl,{class:"w-6 h-6"}),url:"root.home_layout.member_list"},{text:"转存资源",icon:r(En,{class:"w-6 h-6"}),url:"root.home_layout.transfer"}]),[B,H]=z(s.$router.name);return s.onRouteChange(({name:b})=>{H(b)}),oa(b=>{A(S().map(L=>{const{url:W}=L;return W==="root.home_layout.job_list"?{...L,badge:b.length!==0}:L}))}),[(()=>{const b=hu(),L=b.firstChild,W=L.firstChild,D=W.firstChild,K=L.nextSibling,te=K.firstChild;return o(D,r(ie,{get each(){return S()},children:ee=>{const{icon:se,text:he,url:ae,badge:fe,onClick:le}=ee;return r(wu,{app:e,icon:se,history:s,get highlight(){return(()=>B()===ae)()},url:ae,badge:fe,onClick:le,children:he})}})),o(te,r(ie,{get each(){return M()},children:(ee,se)=>{const he=ee.name,ae=l[he];return r(Un,{get class(){return de("absolute inset-0","data-[state=open]:animate-in data-[state=open]:fade-in","data-[state=closed]:animate-out data-[state=closed]:fade-out")},store:ee,get index(){return se()},get children(){return r(ae,{app:e,client:n,storage:i,pages:l,history:s,view:ee})}})}})),b})(),(()=>{const b=pu();return o(b,r(Zs,{store:x,get children(){return fu()}})),b})(),r(Gd,{store:d}),r(tu,{store:u}),r(ve,{store:m,get children(){const b=mu(),L=b.firstChild,W=L.firstChild,D=W.nextSibling,K=L.nextSibling;K.firstChild;const te=K.nextSibling;te.firstChild;const ee=te.nextSibling;ee.firstChild;const se=ee.nextSibling,he=se.firstChild,ae=he.nextSibling,fe=ae.nextSibling;fe.nextSibling;const le=se.nextSibling,ce=le.firstChild,Ce=ce.nextSibling;return Ce.firstChild,o(L,r(gt,{store:v}),D),o(D,r(Le,{store:k}),null),o(D,r(U,{variant:"subtle",store:T,children:"发送"}),null),o(K,r(Le,{store:$}),null),o(K,r(Le,{class:"mt-2",store:E}),null),o(te,r(gt,{store:g}),null),o(ee,r(gt,{store:C}),null),o(se,r(Kt,{store:V}),ae),o(se,r(Kt,{store:N}),fe),o(Ce,aa,null),b}})]};function wu(t){const e=(()=>{const s=vu(),n=s.firstChild,i=n.nextSibling,l=i.firstChild;return Mn(s,"click",t.onClick,!0),o(n,()=>t.icon),o(l,()=>t.children,null),o(l,r(X,{get when(){return t.badge},get children(){return gu()}}),null),oe(()=>be(s,de("relative flex items-center px-4 py-2 space-x-2 rounded-lg opacity-80 cursor-pointer hover:bg-slate-300",t.highlight?"bg-slate-200":""))),s})();return r(X,{get when(){return t.url},fallback:e,get children(){const s=_u();return s.$$click=()=>{t.url&&t.history.push(t.url)},o(s,e),s}})}Pe(["click"]);function xu(){return Y.post("/api/v2/admin/dashboard",{})}const bu={drive_count:0,drive_total_size_count:0,drive_total_size_count_text:"0",drive_used_size_count:0,drive_used_size_count_text:"0",movie_count:0,season_count:0,episode_count:0,sync_task_count:0,report_count:0,media_request_count:0,invalid_season_count:0,invalid_movie_count:0,invalid_sync_task_count:0,unknown_media_count:0,new_file_count_today:0,file_size_count_today:0,updated_at:null};function Cu(){return Y.post("/api/v2/admin/dashboard/refresh",{})}function Su(t){return Y.post("/api/v2/admin/dashboard/added_media",t)}function yu(t){const{name:e,keys:s}=t;return Y.post("/api/admin/parse",{name:e,keys:s})}const Hr={name:"中文名称",original_name:"译名or外文原名",season:"季",episode:"集",episode_name:"集名称",resolution:"分辨率",year:"发布年",source:"来源",encode:"视频编码方式",voice_encode:"音频编码方式",episode_count:"总集数",type:"后缀",subtitle_lang:"字幕语言"},ku=Object.keys(Hr);class Lu extends $e{input;btn;loading=!1;fields=[];get state(){return{loading:this.loading,fields:this.fields}}constructor(e){super(e);const s=new I(yu,{onLoading:l=>{this.loading=!0,i.setLoading(l)},onSuccess:l=>{this.fields=Object.keys(l).map(a=>{const c=a,d=Hr[c],u=l[c];return{label:d,text:u}}),this.emit(0,{...this.state})}}),n=new _e({defaultValue:"",placeholder:"请输入要解析的文件名",onEnter(){i.click()}});this.input=n;const i=new Q({onClick:()=>{if(!n.value){this.tip({text:["请输入要解析的文件名"]});return}s.run({name:n.value,keys:ku})}});this.btn=i,s.onTip(l=>{this.tip(l)})}onStateChange(e){return this.on(0,e)}}const Pu=h("<div>"),bi=t=>{const{store:e,options:s}=t,[n,i]=z(e.state);return e.onStateChange(l=>{i(l)}),(()=>{const l=Pu();return o(l,()=>{const a=s.find(c=>c.value===n().value);return a?a.content:null}),oe(()=>be(l,t.class)),l})()};class Ci extends $e{unique_uid;value;get state(){return{value:this.value}}constructor(e){super(e);const{value:s,unique_id:n}=e;this.value=s,n&&(this.unique_uid=n)}show(e){this.value=e,this.emit(0,{...this.state})}onStateChange(e){return this.on(0,e)}}const Si=h("<div>"),Ru=h('<div class="flex items-center space-x-4"><h1 class="text-2xl"><div>数据统计</h1><div class="flex items-center space-x-2">'),Du=h('<div class="absolute inset-0 flex items-center justify-center"><div class="absolute inset-0 bg-white opacity-50">'),Mu=h('<div class="mt-8"><div class="grid grid-cols-12 gap-2"><div class="col-span-6 p-4 rounded-md border bg-white"><div><div class="text-lg">云盘信息</div></div><div class="flex items-center mt-4"><div class="w-[240px]"><div class="text-3xl"></div><div class="text-slate-800">云盘总容量</div></div><div class="w-[240px]"><div class="text-3xl"></div><div class="text-slate-800">云盘已用容量</div></div><div class="w-[240px] cursor-pointer"><div class="text-3xl"></div><div class="text-slate-800">云盘总数</div></div></div></div><div class="col-span-6 p-4 rounded-md border bg-white"><div><div class="text-lg">媒体信息</div></div><div class="flex items-center mt-4"><div class="w-[240px] cursor-pointer"><div class="text-3xl"></div><div class="text-slate-800">电视剧</div></div><div class="w-[240px] cursor-pointer"><div class="text-3xl"></div><div class="text-slate-800">电影</div></div><div class="w-[240px] cursor-pointer"><div class="text-3xl"></div><div class="text-slate-800">待处理解析</div></div></div></div></div><div class="mt-2 p-4 rounded-md border bg-white"><div><div class="text-lg">待处理问题</div></div><div class="flex items-center mt-4"><div class="w-[240px]"><span class="text-3xl cursor-pointer"></span><div class="text-slate-800">问题电视剧</div></div><div class="w-[240px]"><div class="text-3xl cursor-pointer"></div><div class="text-slate-800">问题电影</div></div><div class="w-[240px] cursor-pointer"><div class="text-3xl"></div><div class="text-slate-800">问题资源同步任务</div></div><div class="w-[240px] cursor-pointer"><div class="text-3xl"></div><div class="text-slate-800">用户想看</div></div><div class="w-[240px] cursor-pointer"><div class="text-3xl"></div><div class="text-slate-800">用户反馈</div></div></div></div><div class="mt-8"><h1 class="text-2xl"><div>今日更新</div></h1><div class="relative mt-4 p-4 min-h-[270px] rounded-md border bg-white max-w-full overflow-x-auto"><div class="flex flex-row space-x-4"></div></div></div><div class="mt-8"><h1 class="text-2xl"><div>常用工具</h1><div class="mt-4 flex items-center space-x-2"><div class=" relative"><div class="flex flex-col items-center p-4 rounded-md bg-white border cursor-pointer"></div><div class="mt-2 break-all text-sm text-center">消息推送</div></div><div class=" relative"><div class="flex flex-col items-center p-4 rounded-md bg-white border cursor-pointer"></div><div class="mt-2 break-all text-sm text-center">文件名解析</div></div><div class=" relative"><div class="flex flex-col items-center p-4 rounded-md bg-white border cursor-pointer"></div><div class="mt-2 break-all text-sm text-center">刷新排行榜'),Tu=h('<div class="w-[520px]"><div><div>消息内容'),Bu=h('<div class="w-[520px]"><div class="flex items-center space-x-2"></div><div class="mt-4">'),Eu=h('<div class="absolute inset-0 flex flex-col items-center justify-center"><div class="mt-2">暂无记录'),Fu=h('<div class="w-[128px]"><div class="max-w-full"><div class="truncate"></div><div class="max-w-full truncate text-sm">'),Ou=h('<div class="flex align-middle"><div class="align-left min-w-[114px]"></div><span>：</span><div class="align-left w-full break-all whitespace-pre-wrap">'),Iu=t=>{const{app:e,history:s,client:n,view:i}=t,l=new I(xu,{defaultResponse:bu,client:n}),a=new Oe(new I(Su,{client:n})),c=new I(ka,{onLoading(F){f.okBtn.setLoading(F)},onSuccess(){e.tip({text:["推送成功"]}),f.hide()}}),d=new I(Cu,{onSuccess(){e.tip({text:["刷新成功"]}),l.reload()}}),u=new _e({defaultValue:"",onEnter(){f.okBtn.click()}}),f=new ge({title:"群发消息",onOk(){if(!u.value){e.tip({text:["请输入推送内容"]});return}c.run({content:u.value})}}),p=new ge({title:"文件名解析",footer:!1}),m=new Lu({}),g=new Ze({}),C=new Ci({value:1}),v=new Ci({value:1}),w=new Ue({}),[$,E]=z(l.response),[_,k]=z(m.state),[T,O]=z(a.response);return a.onStateChange(F=>{O(F)}),l.onResponseChange(F=>{E(F)}),m.onStateChange(F=>{k(F)}),a.init(),l.run(),[r(We,{store:w,class:"h-screen p-8 whitespace-nowrap",get children(){return[(()=>{const F=Ru(),x=F.firstChild,V=x.nextSibling;return o(V,r(X,{get when(){return $()},get children(){return[(()=>{const N=Si();return o(N,()=>$()?.updated_at),N})(),(()=>{const N=Si();return N.$$click=async()=>{if(C.show(2),a.refresh(),(await d.run()).error){C.show(3);return}C.show(1)},o(N,r(bi,{store:C,get options(){return[{value:1,content:r(ri,{class:"w-4 h-4 cursor-pointer"})},{value:2,content:r(ri,{class:"w-4 h-4 animate animate-spin"})},{value:3,content:r(Ol,{class:"w-4 h-4"})}]}})),N})()]}})),F})(),(()=>{const F=Mu(),x=F.firstChild,V=x.firstChild,N=V.firstChild,y=N.nextSibling,R=y.firstChild,M=R.firstChild,J=R.nextSibling,S=J.firstChild,A=J.nextSibling,B=A.firstChild,H=V.nextSibling,b=H.firstChild,L=b.nextSibling,W=L.firstChild,D=W.firstChild,K=W.nextSibling,te=K.firstChild,ee=K.nextSibling,se=ee.firstChild,he=x.nextSibling,ae=he.firstChild,fe=ae.nextSibling,le=fe.firstChild,ce=le.firstChild,Ce=le.nextSibling,G=Ce.firstChild,re=Ce.nextSibling,me=re.firstChild,pe=re.nextSibling,Re=pe.firstChild,Te=pe.nextSibling,ze=Te.firstChild,Se=he.nextSibling,q=Se.firstChild,Z=q.nextSibling,ne=Z.firstChild,ue=Se.nextSibling,we=ue.firstChild,De=we.nextSibling,ye=De.firstChild,Ie=ye.firstChild,ke=ye.nextSibling,Be=ke.firstChild,Ee=ke.nextSibling,Je=Ee.firstChild;return o(M,()=>$()?.drive_total_size_count_text),o(S,()=>$()?.drive_used_size_count_text),A.$$click=()=>{s.push("root.home_layout.drive_list")},o(B,()=>$()?.drive_count),W.$$click=()=>{s.push("root.home_layout.season_list")},o(D,()=>$()?.season_count),K.$$click=()=>{s.push("root.home_layout.movie_list")},o(te,()=>$()?.movie_count),ee.$$click=()=>{s.push("root.home_layout.movie_list")},o(se,()=>$()?.unknown_media_count),ce.$$click=()=>{s.push("root.home_layout.invalid_media_list")},o(ce,()=>$()?.invalid_season_count),G.$$click=()=>{s.push("root.home_layout.invalid_media_list")},o(G,()=>$()?.invalid_movie_count),re.$$click=()=>{s.push("root.home_layout.resource_sync")},o(me,()=>$()?.invalid_sync_task_count),pe.$$click=()=>{s.push("root.home_layout.report_list",{type:String(ct.Want)})},o(Re,()=>$()?.media_request_count),Te.$$click=()=>{s.push("root.home_layout.report_list")},o(ze,()=>$()?.report_count),o(Z,r(X,{get when(){return T().loading},get children(){const Ve=Du();return Ve.firstChild,o(Ve,r(Mt,{class:"w-12 h-12 text-slate-500 animate animate-spin"}),null),Ve}}),ne),o(ne,r(X,{get when(){return!T().empty},get fallback(){return(()=>{const Ve=Eu(),et=Ve.firstChild;return o(Ve,r(Yi,{class:"w-16 h-16 text-slate-500"}),et),Ve})()},get children(){return r(ie,{get each(){return T().dataSource},children:Ve=>{const{id:et,media_id:Ne,name:Ge,poster_path:ut,text:vt}=Ve;return(()=>{const _t=Fu(),$t=_t.firstChild,Tt=$t.firstChild,Bt=Tt.nextSibling;return _t.$$click=()=>{},o(_t,r(je,{class:"w-[128px] h-[192px]",get store(){return g.bind(ut)}}),$t),o(Tt,Ge),o(Bt,vt),_t})()}})}})),Ie.$$click=()=>{f.show()},o(Ie,r(Jt,{class:"w-6 h-6"})),Be.$$click=()=>{p.show()},o(Be,r(Il,{class:"w-6 h-6"})),Je.$$click=async()=>{v.show(2);const Ve=await new I(Fa,{client:n}).run();v.show(1),!Ve.error&&e.tip({text:["刷新成功"]})},o(Je,r(bi,{store:v,get options(){return[{value:1,content:r(Vl,{class:"w-6 h-6"})},{value:2,content:r(Mt,{class:"w-6 h-6 animate animate-spin"})}]}})),F})()]}}),r(ve,{store:f,get children(){const F=Tu(),x=F.firstChild;return x.firstChild,o(x,r(gt,{store:u}),null),F}}),r(ve,{store:p,get children(){const F=Bu(),x=F.firstChild,V=x.nextSibling;return o(x,r(Le,{get store(){return m.input}}),null),o(x,r(U,{get store(){return m.btn},class:"btn btn--primary btn--block",children:"解析"}),null),o(V,r(ie,{get each(){return _().fields},children:N=>(()=>{const y=Ou(),R=y.firstChild,M=R.nextSibling,J=M.nextSibling;return o(R,()=>N.label),o(J,()=>N.text),y})()})),F}})]};Pe(["click"]);function qr(t){const{id:e,type:s,name:n,poster_path:i,air_date:l,episode_count:a,cur_episode_count:c,sources:d}=t,u={},f=[],p=d.map(w=>{const{id:$,name:E,order:_,files:k}=w,T={};for(let O=0;O<k.length;O+=1){const F=k[O],{drive:x}=F;T[x.id]=T[x.id]||[],u[x.id]=x;const V={id:F.id,file_id:F.file_id,file_name:F.file_name,parent_paths:F.parent_paths,size:F.size};T[x.id].push(V)}return f.push(...k.map(O=>({id:O.id,file_id:O.file_id,file_name:O.file_name,parent_paths:O.parent_paths,size:O.size}))),{id:$,name:E,episode_number:_,drives:Object.keys(T).map(O=>({id:O,name:u[O].name,sources:T[O]}))}}),g=f.reduce((w,$)=>w+$.size,0),C=c===a,v=Object.values(u);return{id:e,type:s,name:n,air_date:l,poster_path:i,episode_count:a,cur_episode_count:c,episodes:p,size_count:g,size_count_text:cs(g),drives:Object.values(u),need_to_resource:(()=>!(s===Me.Season&&!C||v.length!==1||v[0].type!==nt.AliyunBackupDrive))(),can_archive:(()=>!(s===Me.Season&&!C||v.length===0||v.length!==1||v[0].type!==nt.AliyunResourceDrive))()}}function jr(t){const{page:e,pageSize:s,...n}=t;return Y.post("/api/v2/admin/season/list",{...n,page:e,page_size:s})}function Ur(t){const{season_id:e}=t;return Y.post("/api/v2/admin/season/profile",{season_id:e})}function Wr(t){if(t.error)return P.Err(t.error);const{id:e,name:s,overview:n,poster_path:i,backdrop_path:l,air_date:a,genres:c,origin_country:d,episodes:u,series:f,profile_id:p}=t.data;return P.Ok({id:e,name:s,overview:n,poster_path:i,backdrop_path:l,air_date:a,series:f,origin_country:d.map(m=>yn[m]).filter(Boolean).join("、"),episodes:u,profile_id:p})}function Kn(t){const{page:e,pageSize:s,...n}=t;return Y.post("/api/v2/admin/movie/list",{...n,page:e,page_size:s})}function Xn(t){return t.error?t:P.Ok({...t.data,list:t.data.list.map(e=>{const{persons:s=[],genres:n,origin_country:i,...l}=e;return{...l,origin_country:i.map(a=>da[a]).filter(Boolean).join("、"),persons:s.slice(0,5)}})})}function Yr(t){const{movie_id:e}=t;return Y.post("/api/v2/admin/movie/profile",{media_id:e})}function Gr(t){if(t.error)return P.Err(t.error.message);const{id:e,name:s,overview:n,poster_path:i,backdrop_path:l,air_date:a,sources:c}=t.data;return P.Ok({id:e,name:s,overview:n,poster_path:i,backdrop_path:l,air_date:a,sources:c})}function Vu(t){const{media_id:e}=t;return Y.post("/api/v2/admin/season/partial",{media_id:e})}function Au(t){const{media_id:e}=t;return Y.post("/api/v2/admin/media/refresh_profile",{media_id:e})}function Jr(t){const{media_id:e,media_profile:s}=t;return Y.post("/api/v2/admin/media/set_profile",{media_id:e,media_profile:s})}function zu(t){const{page:e,pageSize:s,...n}=t;return Y.post("/api/v2/admin/media/archive/list",{...n,page:e,page_size:s})}function Nu(t){return t.error?P.Err(t.error.message):P.Ok({...t.data,list:t.data.list.map(e=>qr(e))})}function Hu(t){const{media_id:e}=t;return Y.post("/api/v2/admin/media/archive/partial",{media_id:e})}function qu(t){return t.error?P.Err(t.error.message):P.Ok(qr(t.data))}function Ps(t){const{media_id:e}=t;return Y.post("/api/v2/admin/media/delete",{media_id:e})}function ju(t){return Y.post("/api/v2/admin/media/invalid",t)}function Kr(t){const{media_id:e,to_drive_id:s}=t;return Y.post("/api/v2/admin/media/transfer",{media_id:e,to_drive_id:s})}function Uu(t){const{media_id:e}=t;return Y.post("/api/v2/admin/media/to_resource_drive",{media_id:e})}function Wu(t){const{media_id:e,page:s,pageSize:n,next_marker:i}=t;return Y.post("/api/v2/admin/media_source/list",{media_id:e,page:s,next_marker:i,page_size:n})}const Rs={};function Xr(t,e){Rs[t]=e}function Qn(t){delete Rs[t]}function Yu(t){try{if(t[0]!=="{")return P.Err("不是合法的 json");const e=JSON.parse(t);return P.Ok(e)}catch(e){const s=e;return P.Err(s)}}function Qr(t){const{type:e=nt.AliyunBackupDrive,payload:s}=t,n=Yu(s);return n.error?{}:Y.post("/api/v2/admin/drive/add",{type:e,payload:n.data})}function As(t){const{id:e,remark:s,hidden:n,root_folder_id:i,root_folder_name:l}=t;return Y.post("/api/v2/admin/drive/update",{id:e,remark:s,hidden:n,root_folder_id:i,root_folder_name:l})}function Gu(t){const{page:e,pageSize:s,hidden:n=0,...i}=t;return Y.post("/api/v2/admin/drive/list",{...i,page:e,page_size:s,hidden:n})}function Ju(t){if(t.error)return P.Err(t.error.message);const{total:e,page_size:s,list:n,next_marker:i}=t.data;return P.Ok({next_marker:i,total:e,page_size:s,list:n.map(l=>{const{id:a,type:c,name:d,avatar:u,drive_id:f,total_size:p,used_size:m,root_folder_id:g,vip:C=[]}=l,v=C.filter($=>ft($.expired_at*1e3).isAfter(ft())).map($=>({...$,expired_at_text:ft($.expired_at*1e3).format("YYYY/MM/DD HH:mm:ss")}));return{id:a,type:c,name:d,avatar:u,drive_id:f,total_size:cs(p),used_size:cs(m),used_percent:(()=>{const $=parseFloat((m/p*100).toFixed(2));return $>100?100:$})(),initialized:!!g,vip:v}})})}function Ku(t){const{drive_id:e}=t;return Y.post("/api/v2/admin/drive/refresh",{id:e})}function Xu(t){if(t.error)return P.Err(t.error);const{id:e,name:s,avatar:n,nick_name:i,user_name:l,total_size:a,used_size:c}=t.data;return P.Ok({id:e,name:s||l||i,user_name:l,avatar:n,total_size:cs(a),used_size:cs(c),used_percent:(()=>{const d=parseFloat((c/a*100).toFixed(2));return d>100?100:d})()})}function Qu(t){const{drive_id:e,target_folders:s}=t;return Y.post("/api/v2/admin/analysis",{drive_id:e,target_folders:s})}function Zu(t){const{drive_id:e,files:s}=t;return Y.post("/api/v2/admin/analysis/files",{drive_id:e,files:s})}function eh(t){const{drive_id:e,file:s}=t;return Y.post("/api/v2/drive/file/change_hash",{file_id:s.file_id,drive_id:e})}function th(t){const{drive_id:e}=t;return Y.post("/api/v2/admin/analysis/new_files",{drive_id:e})}function sh(t){const{drive_id:e}=t;return Y.post("/api/v2/admin/parsed_media/match_profile",{drive_id:e})}function nh(t){const{drive_id:e}=t;return Y.post("/api/v2/admin/drive/export",{id:e})}function ih(t){const{drive_id:e,refresh_token:s}=t;return Y.post("/api/v2/admin/drive/set_token",{id:e,refresh_token:s})}function rh(t){const{drive_id:e,name:s,parent_file_id:n="root"}=t;return Y.post("/api/v2/drive/files/add",{id:e,name:s,parent_file_id:n})}function lh(t){const{drive_id:e}=t;return Y.post("/api/v2/admin/drive/check_in",{id:e})}function oh(t){const{drive_id:e}=t;return Y.post("/api/v2/admin/drive/receive_rewards",{id:e})}function ah(t){const{parsed_media_source_id:e,name:s}=t;return Y.post("/api/v2/admin/parsed_media_source/rename",{parsed_media_source_id:e,name:s})}class Zr extends $e{id;loading=!1;initialized=!1;selectedFolder=null;virtualSelectedFolder=null;tmpSelectedColumn=null;paths=[{file_id:"root",name:"文件"}];folderColumns=[];get state(){return{initialized:this.initialized,curFolder:this.selectedFolder,tmpHoverFile:this.virtualSelectedFolder}}constructor(e){super();const{id:s,onError:n}=e;this.id=s,this.folderColumns=[],n&&this.onError(n)}createColumn(e){const s=this.id,{file_id:n}=e,i=new Oe(new I(kn,{process:Ln,onFailed:a=>{this.tip({text:[a.message]})}}),{pageSize:50,search:{drive_id:s,file_id:n},processor:(a,c)=>(i.setParams(d=>({...d,next_marker:c.next_marker})),{...a,dataSource:a.dataSource.map(d=>{const u=this.paths.slice(1);return{...d,parent_paths:u}})})});i.onStateChange(a=>{if(a.error){this.emit(6,new rs(a.error.message));return}a.initial===!1&&(this.initialized=!0,this.emit(5,{...this.state})),this.emit(1,[...this.folderColumns])}),i.onLoadingChange(a=>{this.loading=a,this.emit(4,a)});const l=new Ue({async onReachBottom(){await i.loadMore(),l.finishLoadingMore()}});return i.init(),{list:i,view:l}}appendColumn(e){this.folderColumns.push(this.createColumn(e)),this.emit(1,[...this.folderColumns])}replaceColumn(e,s){this.folderColumns=[...this.folderColumns.slice(0,s+1),this.createColumn(e)],this.emit(1,[...this.folderColumns])}clearFolderColumns(){this.folderColumns=[],this.emit(1,[...this.folderColumns])}select(e,s){this.selectedFolder=e,this.emit(3,[e,s]);const[n,i]=s,l=this.folderColumns[n];l.list.modifyItem(c=>({...c,selected:c.file_id===e.file_id,hover:!1}));const a=l.list.response.dataSource[i];e.type!==at.File&&((()=>{if(n<this.folderColumns.length-1){this.replaceColumn(e,n);return}this.appendColumn(a)})(),this.paths=(()=>{if(this.paths[n+1]){const c=this.paths.slice(0,n+2);return c[n+1]=e,c}return this.paths.concat(a)})(),this.emit(2,[...this.paths]))}virtualSelect(e,s){this.virtualSelectedFolder=[e,s],this.emit(3,[e,s]);const[n,i]=s,l=this.folderColumns[n];this.tmpSelectedColumn=l,l.list.modifyItem(a=>({...a,hover:a.file_id===e.file_id}))}clear(){this.selectedFolder=null}clearVirtualSelected(){if(this.virtualSelectedFolder=null,!this.tmpSelectedColumn)return;const e=this.tmpSelectedColumn;this.tmpSelectedColumn=null,e.list.modifyItem(s=>({...s,hover:!1}))}async deleteFile(e){const{file:s,position:n,onLoading:i,onFailed:l,onSuccess:a}=e,[c,d]=n,u=this.folderColumns;function f(){u[c].list.deleteItem(g=>g.file_id===s.file_id)}return new I(ru,{onLoading:i,onFailed:l,onSuccess:m=>{a&&a(m?{job_id:m.job_id,deleteFile:f}:{deleteFile:f})}}).run({drive_id:this.id,file_id:s.file_id,file_name:s.name})}rename(e){const{file:s,position:n,onLoading:i,onFailed:l,onSuccess:a}=e,[c,d]=n,u=this.folderColumns;return new I(iu,{onLoading:i,onFailed:l,onSuccess:()=>{u[c].list.modifyItem(m=>m.file_id===s.file_id?{...m,name:s.name}:m),a&&a()}}).run({drive_id:this.id,file_id:s.file_id,name:s.name})}onFolderColumnChange(e){return this.on(1,e)}onPathsChange(e){return this.on(2,e)}onSelectFolder(e){return this.on(3,e)}onLoadingChange(e){return this.on(4,e)}onError(e){return this.on(6,e)}onStateChange(e){return this.on(5,e)}}class el extends $e{static Delay=e=>{};id;type;name;timer=null;state;values={};list={keyword:"",loading:!1,pageSize:10,nextMarker:""};folderColumns=[];selectedFolderPos;paths=[];constructor(e){super(e);const{id:s,type:n,name:i,vip:l}=e;this.id=s,this.type=n,this.name=i,this.state={...e,loading:!1}}async startAnalysis(e={}){const{target_folders:s,quickly:n=!1}=e;if(this.state.loading)return P.Err("索引正在进行中");this.state.loading=!0,this.emit(0,{...this.state});const i=await(()=>n?new I(th).run({drive_id:this.id}):new I(Qu).run({drive_id:this.id,target_folders:s?s.map(a=>{const{file_id:c,name:d,parent_paths:u,type:f}=a;return{file_id:c,name:d,type:f===at.File?"file":"folder",parent_paths:u.map(p=>p.name).join("/")}}):void 0}))();if(i.error)return this.state.loading=!1,this.emit(0,{...this.state}),P.Err(i.error);this.tip({text:["开始索引，请等待一段时间后刷新查看"]});const{job_id:l}=i.data;return P.Ok({job_id:l})}async analysisSpecialFolders(e){const{target_folders:s}=e;if(this.state.loading)return P.Err("索引正在进行中");this.state.loading=!0,this.emit(0,{...this.state});const n=await new I(Zu).run({drive_id:this.id,files:s.map(l=>{const{file_id:a,name:c,type:d}=l;return{file_id:a,name:c,type:d}})});if(this.state.loading=!1,n.error)return this.emit(0,{...this.state}),P.Err(n.error);const{job_id:i}=n.data;return P.Ok({job_id:i})}finishAnalysis(){this.state.loading=!1,this.tip({text:["索引完成"]}),this.emit(0,{...this.state})}async changeFileHash(e){const{file:s}=e,n=await new I(eh).run({drive_id:this.id,file:s});if(n.error)return this.emit(0,{...this.state}),P.Err(n.error);const{job_id:i}=n.data;return P.Ok({job_id:i})}async matchMediaFilesProfile(){if(this.state.loading)return this.tip({text:["匹配正在进行中..."]}),P.Ok(null);this.state.loading=!0,this.emit(0,{...this.state});const e=await new I(sh).run({drive_id:this.id});if(e.error)return this.state.loading=!1,this.emit(0,{...this.state}),this.tip({text:["匹配失败",e.error.message]}),P.Err(e.error);this.tip({text:["开始匹配，请等待一段时间后刷新查看"]});const{job_id:s}=e.data;return P.Ok({job_id:s})}finishMediaMatch(){this.state.loading=!1,this.tip({text:["匹配完成"]}),this.emit(0,{...this.state})}async export(){const e=await new I(nh).run({drive_id:this.id});if(e.error){const s=this.tip({text:["导出失败",e.error.message]});return P.Err(s)}return P.Ok(e.data)}async delete(){const e=await new I(uu).run({drive_id:this.id});if(e.error){const s=this.tip({text:["删除失败",e.error.message]});return P.Err(s)}return this.tip({text:["删除成功"]}),P.Ok(null)}async update(){const e=await new I(As).run({id:this.id,...this.values});return this.values={},e.error?(this.tip({text:["更新失败",e.error.message]}),P.Err(e.error.message)):(this.tip({text:["更新云盘信息成功"]}),P.Ok("更新云盘信息成功"))}async _refresh(){const e=await new I(Ku,{process:Xu}).run({drive_id:this.id});if(e.error)return P.Err(e.error);const{name:s,user_name:n,avatar:i,used_size:l,total_size:a,used_percent:c}=e.data;return P.Ok({avatar:i,name:s,user_name:n,used_size:l,total_size:a,used_percent:c})}async refresh(){const e=await this._refresh();if(e.error){this.tip({text:["刷新失败",e.error.message]});return}const{name:s,user_name:n,avatar:i,used_size:l,total_size:a,used_percent:c}=e.data;this.state=Object.assign({},this.state,{avatar:i,name:s,user_name:n,used_size:l,total_size:a,used_percent:c}),this.tip({text:["刷新成功"]}),this.emit(0,{...this.state})}async receiveRewards(){const e=await new I(oh).run({drive_id:this.id});return e.error?P.Err(e.error.message):P.Ok({job_id:e.data.job_id})}async setRootFolder(e){const s=await new I(As).run({id:this.id,root_folder_id:e.file_id,root_folder_name:e.name});return s.error?P.Err(s.error):(this.state.initialized=!0,this.emit(0,{...this.state}),P.Ok(null))}setRefreshToken(e){this.values.refresh_token=e}refreshTokenRequest=new I(ih);async submitRefreshToken(){const{refresh_token:e}=this.values;if(!e)return P.Err("缺少 refresh_token 参数");const s=await this.refreshTokenRequest.run({refresh_token:e,drive_id:this.id});return s.error?(this.tip({text:["修改 refresh_token 失败",s.error.message]}),P.Err(s.error)):(this.tip({text:["修改 refresh_token 成功"]}),P.Ok(null))}curFolder={file_id:"root",name:"文件"};clearFolderColumns(){this.folderColumns=[],this.emit(2,[...this.folderColumns])}select(e,s){if(e.type===at.File)return;this.curFolder=e,this.selectedFolderPos=s;const[n,i]=s,a=this.folderColumns[n][i];this.paths[n],this.paths=(()=>{if(this.paths[n]){const c=this.paths.slice(0,n+1);return c[n]=e,c}return this.paths.concat(a)})(),this.emit(3,[...this.paths])}async search(e){}async loadMore(){}inputNewFolderName(e){this.values.root_folder_name=e}async addFolder(){const{root_folder_name:e}=this.values;if(!e){const n=this.tip({text:["请先输入文件夹名称"]});return P.Err(n)}const s=await new I(rh).run({drive_id:this.id,name:e});if(s.error){const n=this.tip({text:["添加文件夹失败",s.error.message]});return P.Err(n)}return this.tip({text:["添加文件夹成功"]}),P.Ok(s.data)}async checkIn(){const e=await new I(lh).run({drive_id:this.id});if(e.error){const d=this.tip({text:["签到失败",e.error.message]});return P.Err(d)}const s=await this._refresh();if(s.error){const d=this.tip({text:["刷新失败",s.error.message]});return P.Err(d)}const{user_name:n,avatar:i,used_size:l,total_size:a,used_percent:c}=s.data;return this.state=Object.assign({},this.state,{avatar:i,user_name:n,used_size:l,total_size:a,used_percent:c}),this.emit(0,{...this.state}),this.tip({text:["签到成功"]}),P.Ok(null)}onStateChange(e){this.on(0,e)}emitCompleted(e){this.emit(7,e)}onCompleted(e){this.on(7,e)}onFolderColumnChange(e){this.on(2,e)}onPathsChange(e){return this.on(3,e)}onValuesChange(e){this.on(1,e)}get[Symbol.toStringTag](){return"Drive"}}function ch(t){if(t.error)return P.Err(t.error);const e=Ju(t);if(e.error)return P.Err(e.error.message);const{list:s,...n}=e.data;return P.Ok({...n,list:s.map(i=>new el(i))})}const He=new Oe(new I(Gu,{process:ch,client:Nt}),{search:{hidden:0}}),dh=h('<div class="absolute top-[2px] right-[2px] w-2 h-2 rounded-full bg-red-500">'),uh=h('<div class="relative p-2 cursor-pointer">'),hh=h('<div class="space-y-4">'),fh=h('<div class="relative"><div class="flex items-center space-x-4"><h1 class="text-2xl">电视剧列表(<!>)</div><div class="mt-8"><div class="flex items-center space-x-2"></div><div class="flex items-center space-x-2 mt-4"></div><div class="mt-4">'),ph=h('<div class="w-[520px]"><div>确认删除吗？'),mh=h('<div class="h-[320px] py-4 pb-8 px-2 overflow-y-auto"><div><div>来源</div></div><div class="mt-4"><div>类型</div></div><div class="mt-4"><div>云盘'),gh=h('<div><div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 p-4"><div class="mt-2 space-y-1"></div><div class="flex items-center space-x-4 mt-2"></div><div class="flex space-x-2 mt-6">'),vh=h('<div class="flex items-center space-x-1 px-2 border border-blue-600 rounded-xl text-blue-600"><div>/'),_h=h('<div class="flex items-center space-x-1 px-2 border border-red-500 rounded-xl text-red-500"><div>个问题'),$h=h('<div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 w-0 p-4"><div class="flex items-center"><h2 class="text-2xl text-slate-800"><a target="_blank"></a></div><div class="mt-2 overflow-hidden text-ellipsis"><p class="text-slate-700 break-all whitespace-pre-wrap truncate line-clamp-3"></div><div class="flex items-center space-x-4 mt-2 break-keep overflow-hidden"><div class="flex items-center space-x-1 px-2 border border-slate-600 rounded-xl text-slate-600"><div class="break-keep whitespace-nowrap"></div></div><div class="flex items-center space-x-1 px-2 border border-yellow-600 rounded-xl text-yellow-600"><div></div></div></div><div class="space-x-2 mt-4 p-1 overflow-hidden whitespace-nowrap">'),wh=h('<div class="flex items-center space-x-1 px-2 border border-green-600 rounded-xl text-green-600"><div>全<!>集'),xh=h('<div class="space-y-2">'),bh=h('<div class="text-sm text-slate-800">'),Ch=t=>{const{app:e,history:s,view:n}=t,i=new Oe(new I(jr),{onLoadingChange(L){$.setLoading(L),E.setLoading(L),F.setLoading(L)}}),l=new I(Vu),a=new I(Ps),c=new Fe,d=new mt({onChange(L){i.search({invalid:Number(L)})}}),u=new mt({onChange(L){i.search({duplicated:Number(L)})}}),f=new bs({options:ua,onChange(L){b(!!L.length),i.search({language:L.join("|")})}}),p=new bs({options:fa,onChange(L){b(!!L.length),i.search({genres:L.join("|")})}}),m=new bs({options:He.response.dataSource.map(L=>{const{name:W,id:D}=L;return{value:D,label:W}}),onChange(L){b(!!L.length),i.search({drive_ids:L.join("|")})}}),g=new Fe({onChange(L){B(L)}}),C=new Js({align:"end"}),v=async L=>{const W=L||c.value?.id;if(!W)return P.Err("缺少季 id");const D=await l.run({media_id:W});return D.error?(e.tip({text:["获取电视剧最新信息失败",D.error.message]}),P.Err(D.error.message)):(i.modifyItem(K=>K.id!==W?K:{...D.data}),P.Ok(null))},w=new _e({defaultValue:"",placeholder:"请输入名称搜索",onEnter(){$.click()}}),$=new Q({onClick(){i.search({name:w.value})}}),E=new Q({onClick(){i.reset(),d.uncheck(),u.uncheck(),w.clear()}}),_=new Ae({async onClick(L){_.setLoading(!0);const W=await v(L.id);_.setLoading(!1),!W.error&&e.tip({text:["刷新成功"]})}}),k=new Ae({onClick(L){s.push("root.home_layout.season_profile",{id:L.id})}}),T=new ge({title:"删除电视剧",async onOk(){const L=c.value;if(!L){e.tip({text:["请选择要删除的电视剧"]});return}T.okBtn.setLoading(!0);const W=await a.run({media_id:L.id});if(T.okBtn.setLoading(!1),W.error){e.tip({text:["删除失败",W.error.message]});return}e.tip({text:["删除成功"]}),T.hide(),i.deleteItem(D=>D.id===L.id)}}),O=new Ae({onClick(L){c.select(L),T.show()}});new Q({onClick(){s.push("root.archive")}});const F=new Q({onClick(){i.refresh()}}),x=new Ue({async onReachBottom(){await i.loadMore(),x.finishLoadingMore()},onScroll(){C.hide()}}),V=new Ze({}),[N,y]=z(i.response),[R,M]=z([]),[J,S]=z(He.response),[A,B]=z(g.value),[H,b]=z(!1);return He.onStateChange(L=>{const W=L.dataSource.map(D=>{const{name:K,id:te}=D;return{value:te,label:K}});m.setOptions(W),S(L)}),i.onStateChange(L=>{y(L)}),n.onShow(()=>{const{deleteTV:L}=Rs;L&&(Qn("deleteTV"),i.deleteItem(W=>W.id===L.id))}),i.init(),He.initAny(),[r(We,{class:"h-screen p-8",store:x,get children(){const L=fh(),W=L.firstChild,D=W.firstChild,K=D.firstChild,te=K.nextSibling;te.nextSibling;const ee=W.nextSibling,se=ee.firstChild,he=se.nextSibling,ae=he.nextSibling;return o(D,()=>N().total,te),o(se,r(U,{class:"space-x-1",get icon(){return r(xt,{class:"w-4 h-4"})},store:F,children:"刷新"}),null),o(se,r(U,{class:"",store:E,children:"重置"}),null),o(se,r(ed,{align:"center",class:"w-96",get content(){return(()=>{const fe=mh(),le=fe.firstChild;le.firstChild;const ce=le.nextSibling;ce.firstChild;const Ce=ce.nextSibling;return Ce.firstChild,o(le,r(Ts,{store:f}),null),o(ce,r(Ts,{store:p}),null),o(Ce,r(Ts,{store:m}),null),fe})()},get children(){const fe=uh();return o(fe,r(Al,{get class(){return de("w-5 h-5")}}),null),o(fe,r(X,{get when(){return H()},get children(){return dh()}}),null),fe}}),null),o(he,r(Le,{class:"",store:w}),null),o(he,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:$,children:"搜索"}),null),o(ae,r(Ye,{store:i,get skeleton(){return(()=>{const fe=gh(),le=fe.firstChild,ce=le.firstChild,Ce=ce.firstChild,G=Ce.nextSibling,re=G.firstChild,me=re.nextSibling,pe=me.nextSibling;return o(Ce,r(j,{class:"w-[180px] h-[272px]"})),o(G,r(j,{class:"h-[36px] w-[180px]"}),re),o(re,r(j,{class:"h-[24px] w-[120px]"}),null),o(re,r(j,{class:"h-[24px] w-[240px]"}),null),o(me,r(j,{class:"w-10 h-6"}),null),o(me,r(j,{class:"w-10 h-6"}),null),o(me,r(j,{class:"w-10 h-6"}),null),o(pe,r(j,{class:"w-24 h-8"}),null),o(pe,r(j,{class:"w-24 h-8"}),null),fe})()},get children(){const fe=hh();return o(fe,r(ie,{get each(){return N().dataSource},children:le=>{const{id:ce,name:Ce,overview:G,poster_path:re,air_date:me,vote_average:pe,cur_episode_count:Re,episode_count:Te}=le,ze=s.buildURLWithPrefix("root.home_layout.season_profile",{id:ce});return(()=>{const Se=$h(),q=Se.firstChild,Z=q.firstChild,ne=Z.nextSibling,ue=ne.firstChild,we=ue.firstChild,De=we.firstChild,ye=ue.nextSibling,Ie=ye.firstChild,ke=ye.nextSibling,Be=ke.firstChild,Ee=Be.firstChild,Je=Be.nextSibling,Ve=Je.firstChild,et=ke.nextSibling;return o(Z,r(je,{class:"w-[180px] h-[272px]",get store(){return V.bind(re)},alt:Ce})),xe(De,"href",ze),o(De,Ce),o(Ie,G),o(Be,r(us,{class:"w-4 h-4 text-slate-800"}),Ee),o(Ee,me),o(Je,r(zl,{class:"w-4 h-4"}),Ve),o(Ve,pe),o(ke,r(X,{when:Re!==Te,get fallback(){return(()=>{const Ne=wh(),Ge=Ne.firstChild,ut=Ge.firstChild,vt=ut.nextSibling;return vt.nextSibling,o(Ne,r(Ws,{class:"w-4 h-4"}),Ge),o(Ge,Te,vt),Ne})()},get children(){const Ne=vh(),Ge=Ne.firstChild,ut=Ge.firstChild;return o(Ne,r(Jt,{class:"w-4 h-4"}),Ge),o(Ge,Re,ut),o(Ge,Te,null),Ne}}),null),o(ke,r(X,{get when(){return le.tips.length},get children(){const Ne=_h(),Ge=Ne.firstChild,ut=Ge.firstChild;return Ne.addEventListener("mouseleave",()=>{C.hide()}),Ne.addEventListener("mouseenter",vt=>{const{x:_t,y:$t,width:Tt,height:Bt,left:Et,top:ps,right:ms,bottom:es}=vt.currentTarget.getBoundingClientRect();M(le.tips),C.show({x:_t,y:$t,width:Tt,height:Bt+8,left:Et,top:ps,right:ms,bottom:es})}),o(Ne,r(Ji,{class:"w-4 h-4"}),Ge),o(Ge,()=>le.tips.length,ut),Ne}}),null),o(et,r(U,{get store(){return _.bind(le)},variant:"subtle",get icon(){return r(xt,{class:"w-4 h-4"})}}),null),o(et,r(U,{get store(){return k.bind(le)},variant:"subtle",get icon(){return r(Es,{class:"w-4 h-4"})},children:"详情"}),null),o(et,r(U,{get store(){return O.bind(le)},variant:"subtle",get icon(){return r(Dt,{class:"w-4 h-4"})},children:"删除"}),null),Se})()}})),fe}})),L}}),r(ve,{store:T,get children(){return ph()}}),r(Zc,{store:C,get content(){return(()=>{const L=xh();return o(L,r(ie,{get each(){return R()},children:W=>(()=>{const D=bh();return o(D,W),D})()})),L})()}}),r(Ar,{store:x})]},yi={LD:"标清",SD:"普清",HD:"高清",FHD:"4K"};function tl(t){const{page:e,pageSize:s,type:n,...i}=t;return Y.post("/api/v2/admin/parsed_media/list",{...i,type:n,page:e,page_size:s})}function sl(t){return t.error?P.Err(t.error.message):P.Ok({...t.data,list:t.data.list.map(e=>{const{id:s,name:n,season_text:i,profile:l,sources:a}=e;return{id:s,name:n,season_text:i,profile:l,sources:a}})})}function Sh(t){const{page:e,pageSize:s,...n}=t;return Y.post("/api/v2/admin/parsed_media_source/list",{...n,type:Me.Season,page:e,page_size:s})}function yh(t){return t.error?t:P.Ok({...t.data,list:t.data.list.map(e=>{const{id:s,name:n,season_text:i,episode_text:l,file_name:a,parent_paths:c,profile:d,drive:u}=e;return{id:s,name:n,season_text:i,episode_text:l,file_name:a,parent_paths:c,profile:d,drive:u}})})}function nl(t){const{parsed_media_id:e,media_profile:s}=t;return Y.post("/api/v2/admin/parsed_media/set_profile",{parsed_media_id:e,media_profile:s})}function ki(t){const{file_id:e,media_profile:s}=t;return Y.post("/api/v2/admin/parsed_media/set_profile_in_file_id",{file_id:e,media_profile:s})}function il(t){const{parsed_media_source_id:e,media_profile:s,media_source_profile:n}=t;return Y.post("/api/v2/admin/parsed_media_source/set_profile",{parsed_media_source_id:e,media_profile:s,media_source_profile:n})}function kh(t){const{parsed_media_id:e}=t;return Y.post("/api/v2/admin/parsed_media/delete",{id:e})}function sn(t){const{parsed_media_source_id:e}=t;return Y.post("/api/v2/admin/parsed_media_source/delete",{parsed_media_source_id:e})}function Lh(t){const{id:e}=t;return Y.post("/api/v2/admin/parsed_media_source/preview",{id:e})}function Ph(t){if(t.error)return P.Err(t.error);const{id:e,url:s,width:n,height:i,type:l,other:a,thumbnail:c}=t.data;return P.Ok({file_id:e,url:s,width:n,height:i,type:l,typeText:yi[l],thumbnail:c,resolutions:a.map(d=>{const{url:u,width:f,height:p,type:m,thumbnail:g}=d;return{file_id:e,url:u,width:f,height:p,type:m,typeText:yi[m],thumbnail:g}})})}class rl extends $e{hovering=!1;files=[];get state(){return{hovering:this.hovering}}constructor(e={}){super(e);const{onChange:s}=e;s&&this.onChange(s)}handleDragover(){this.hovering=!0,this.emit(0,{...this.state})}handleDragleave(){this.hovering=!1,this.emit(0,{...this.state})}handleDrop(e){this.hovering=!1,!(!e||e.length===0)&&(this.files=e,this.emit(1,[...e]),this.emit(0,{...this.state}))}getFileByName(e){return this.files.find(s=>s.name===e)}onStateChange(e){return this.on(0,e)}onChange(e){return this.on(1,e)}}function Rh(t){return new lt({}),new rl,{}}const Dh=h('<div><div class="flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0"><div class="space-y-4 rdp-caption_start rdp-caption_end"><div class="calendar__head flex justify-center pt-1 relative items-center"><div aria-live="polite" role="presentation" class="text-sm font-medium"> </div><div class="space-x-1 flex items-center"><button name="previous-month" aria-label="Go to previous month" class="rdp-button_reset rdp-button inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 border border-input shadow-sm hover:bg-accent hover:text-accent-foreground h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 absolute left-1"></button><button name="next-month" aria-label="Go to next month" class="rdp-button_reset rdp-button inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 border border-input shadow-sm hover:bg-accent hover:text-accent-foreground h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 absolute right-1"></button></div></div><table role="grid" class="calendar__table w-full border-collapse space-y-1"><thead class="rdp-head"><tr class="flex"><th class="text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]">一</th><th class="text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]">二</th><th class="text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]">三</th><th class="text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]">四</th><th class="text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]">五</th><th class="text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]">六</th><th class="text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]">天</thead><tbody role="rowgroup" class="rdp-tbody">'),Mh=h('<tr class="flex w-full mt-2">'),Th=h('<td><button name="day" role="gridcell" type="button" tabindex="-1" class="rdp-button_reset rdp-button inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground h-8 w-8 p-0 font-normal aria-selected:opacity-100 day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground">');function Bh(t){const{store:e}=t,[s,n]=z(e.state);return e.onChange(i=>{n(i)}),(()=>{const i=Dh(),l=i.firstChild,a=l.firstChild,c=a.firstChild,d=c.firstChild,u=d.firstChild,f=d.nextSibling,p=f.firstChild,m=p.nextSibling,g=c.nextSibling,C=g.firstChild,v=C.nextSibling;return o(d,()=>s().year.text,u),o(d,()=>s().month.text,null),p.$$click=()=>{e.nextMonth()},o(p,r(Nl,{class:"lucide lucide-chevron-left h-4 w-4 rdp-nav_icon"})),m.$$click=()=>{e.prevMonth()},o(m,r(Qt,{class:"lucide lucide-chevron-right h-4 w-4 rdp-nav_icon"})),o(v,r(ie,{get each(){return s().weeks},children:w=>(()=>{const $=Mh();return o($,r(ie,{get each(){return w.dates},children:E=>(()=>{const _=Th(),k=_.firstChild;return _.$$click=()=>{e.selectDay(E.value)},o(k,()=>E.text),oe(()=>be(_,de("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected])]:rounded-md",s().day.time===E.time?"text-green-500":""))),_})()})),$})()})),oe(()=>be(i,de("calendar rdp p-3 rounded-md border shadow",t.class))),i})()}Pe(["click"]);const Eh=h("<span>选择日期");function Fh(t){const{store:e}=t,[s,n]=z(e.state);return e.onChange(i=>n(i)),r(Wn,{get store(){return e.$popover},get children(){return[r(Yn,{get store(){return e.$popover},get children(){return r(U,{variant:"outline",get icon(){return r(us,{class:"mr-2 h-4 w-4"})},get class(){return de("flex justify-start w-[250px] text-left font-normal",!s().date&&"text-muted-foreground")},get store(){return e.$btn},get children(){return Lt(()=>!!s().date)()?s().date:Eh()}})}}),r(Gn,{get store(){return e.$popover},get children(){return r(Jn,{get store(){return e.$popover},get children(){return r(Bh,{class:"bg-white",get store(){return e.$calendar}})}})}})]}})}function Ct(t){const e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(t.getTime()):typeof t=="number"||e==="[object Number]"?new Date(t):new Date(NaN)}function Xt(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}function ll(t){const e=Ct(t);return e.setDate(1),e.setHours(0,0,0,0),e}function Li(t,e,s){const n=s?.ISOWeek?Hh(e):ol(e,s),i=s?.ISOWeek?Ss(t):zt(t,s),l=Jh(n,i),a=[];for(let d=0;d<=l;d++)a.push(al(i,d));return a.reduce((d,u)=>{const f=s?.ISOWeek?Ah(u):Oh(u,s),p=d.find(m=>m.weekNumber===f);return p?(p.dates.push(u),d):(d.push({weekNumber:f,dates:[u]}),d)},[])}function Oh(t,e){const s=Ct(t),n=zt(s,e).getTime()-Ih(s,e).getTime();return Math.round(n/Zn)+1}function Ih(t,e){const s=nn(),n=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,i=Vh(t,e),l=Xt(t,0);return l.setFullYear(i,0,n),l.setHours(0,0,0,0),zt(l,e)}function Vh(t,e){const s=Ct(t),n=s.getFullYear(),i=nn(),l=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,a=Xt(t,0);a.setFullYear(n+1,0,l),a.setHours(0,0,0,0);const c=zt(a,e),d=Xt(t,0);d.setFullYear(n,0,l),d.setHours(0,0,0,0);const u=zt(d,e);return s.getTime()>=c.getTime()?n+1:s.getTime()>=u.getTime()?n:n-1}function Ss(t){return zt(t,{weekStartsOn:1})}function Ah(t){const e=Ct(t),s=Ss(e).getTime()-zh(e).getTime();return Math.round(s/Zn)+1}function zh(t){const e=Nh(t),s=Xt(t,0);return s.setFullYear(e,0,4),s.setHours(0,0,0,0),Ss(s)}function Nh(t){const e=Ct(t),s=e.getFullYear(),n=Xt(t,0);n.setFullYear(s+1,0,4),n.setHours(0,0,0,0);const i=Ss(n),l=Xt(t,0);l.setFullYear(s,0,4),l.setHours(0,0,0,0);const a=Ss(l);return e.getTime()>=i.getTime()?s+1:e.getTime()>=a.getTime()?s:s-1}function Hh(t){return ol(t,{weekStartsOn:1})}function ol(t,e){const s=nn(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??s.weekStartsOn??s.locale?.options?.weekStartsOn??0,i=Ct(t),l=i.getDay(),a=(l<n?-7:0)+6-(l-n);return i.setDate(i.getDate()+a),i.setHours(23,59,59,999),i}function qh(t,e){const s=Li(ll(t),Gh(t),e);if(e?.useFixedWeeks){const n=jh(t,e);if(n<6){const i=s[s.length-1],l=i.dates[i.dates.length-1],a=Pi(l,6-n),c=Li(Pi(l,1),a,e);s.push(...c)}}return s}function jh(t,e){return Uh(Yh(t),ll(t),e)+1}function Uh(t,e,s){const n=zt(t,s),i=zt(e,s),l=n.getTime()-zs(n),a=i.getTime()-zs(i);return Math.round((l-a)/Zn)}function zt(t,e){const s=nn(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??s.weekStartsOn??s.locale?.options?.weekStartsOn??0,i=Ct(t),l=i.getDay(),a=(l<n?7:0)+l-n;return i.setDate(i.getDate()-a),i.setHours(0,0,0,0),i}let Wh={};function nn(){return Wh}function Yh(t){const e=Ct(t),s=e.getMonth();return e.setFullYear(e.getFullYear(),s+1,0),e.setHours(0,0,0,0),e}function Pi(t,e){const s=e*7;return al(t,s)}function al(t,e){const s=Ct(t);return isNaN(e)?Xt(t,NaN):(e&&s.setDate(s.getDate()+e),s)}function Gh(t){const e=Ct(t),s=e.getMonth();return e.setFullYear(e.getFullYear(),s+1,0),e.setHours(23,59,59,999),e}function Jh(t,e){const s=Ri(t),n=Ri(e),i=s.getTime()-zs(s),l=n.getTime()-zs(n);return Math.round((i-l)/Kh)}function zs(t){const e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}function Ri(t){const e=Ct(t);return e.setHours(0,0,0,0),e}const Kh=864e5,Zn=6048e5;function Xh(t){const{today:e}=t;function s(m){return`${m.getMonth()+1}月`}function n(m){d=[];const g=qh(m,{locale:{code:""},weekStartsOn:1});for(let C=0;C<g.length;C+=1){const{dates:v}=g[C];d.push({id:C,dates:v.map((w,$)=>(w.setHours(0),w.setMinutes(0),w.setSeconds(0),w.setMilliseconds(0),{id:$,text:w.getDate().toString(),is_prev_month:w.getMonth()<m.getMonth(),is_next_month:w.getMonth()>m.getMonth(),is_today:w.valueOf()===m.valueOf(),value:w,time:w.valueOf()}))})}}e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);let i={text:e.getDate().toString(),value:e,time:e.valueOf()},l={text:s(e),value:e,time:e.valueOf()},a={text:e.getFullYear(),value:e,time:e.valueOf()},c={text:e.toLocaleDateString()+e.toLocaleTimeString(),value:e,time:e.valueOf()},d=[];n(e);let u={get day(){return i},get month(){return l},get year(){return a},get weeks(){return d},get selectedDay(){return c}},f;(m=>{m[m.SelectDay=0]="SelectDay",m[m.Change=1]="Change"})(f||(f={}));const p=Vn();return{state:u,get value(){return c?c.value:null},selectDay(m){if(i.value!==m){if(m.setHours(0),m.setMinutes(0),m.setSeconds(0),m.setMilliseconds(0),i={text:m.getDate().toString(),value:m,time:m.valueOf()},p.emit(0,m),c){const g=c.value.getFullYear(),C=m.getFullYear(),v=c.value.getMonth(),w=m.getMonth();(g!==C||v!==w)&&(l={text:s(m),value:m,time:m.valueOf()},a={text:m.getFullYear(),value:m,time:m.valueOf()},n(m))}c={text:m.toLocaleDateString()+m.toLocaleTimeString(),value:m,time:m.valueOf()},p.emit(1,{...u})}},nextMonth(){},prevMonth(){},buildMonthText:s,onSelectDay(m){return p.on(0,m)},onChange(m){return p.on(1,m)}}}function Qh(t){const{today:e}=t,s=new Js({strategy:"fixed"}),n=Xh({today:e}),i=new Q({});n.onChange(()=>{c.emit(0,{...l})});const l={get date(){return n.value?ft(n.value).format("YYYY/MM/DD"):"请选择"}};let a;(d=>{d[d.Change=0]="Change"})(a||(a={}));const c=Vn();return{state:l,get value(){return n.value},$popover:s,$calendar:n,$btn:i,setValue(d){n.selectDay(d)},onChange(d){return c.on(0,d)}}}const Zh=h('<div><div class="fields space-y-4"><div class="field"><div class="field__label"><div>标题</div></div><div class="field__inner mt-2"><div class="field__input"></div></div></div><div class="field"><div class="field__label"><div>发布日期</div></div><div class="field__inner mt-2"><div class="field__input"></div></div></div><div class="field"><div class="field__label"><div>简介</div></div><div class="field__inner mt-2"><div class="field__input">');function ef(){const t=new _e({defaultValue:""}),e=Qh({today:new Date}),s=new _e({defaultValue:""}),n=Rh();return{ui:{$title:t,$airDate:e,$summary:s,$poster:n},setValues(i){if(i.title&&t.setValue(i.title),i.air_date){const l=ft(i.air_date);e.setValue(l.toDate())}i.summary&&s.setValue(i.summary)},getValues(){const i=t.value,l=e.value,a=s.value;return{name:i,air_date:l,overview:a}}}}function tf(t){const{store:e}=t;return(()=>{const s=Zh(),n=s.firstChild,i=n.firstChild,l=i.firstChild,a=l.nextSibling,c=a.firstChild,d=i.nextSibling,u=d.firstChild,f=u.nextSibling,p=f.firstChild,m=d.nextSibling,g=m.firstChild,C=g.nextSibling,v=C.firstChild;return o(c,r(Le,{get store(){return e.ui.$title}})),o(p,r(Fh,{get store(){return e.ui.$airDate}})),o(v,r(gt,{get store(){return e.ui.$summary}})),s})()}const sf=h('<div class="relative"><div class=""><div><div class="relative z-3"><div class="flex"><div class="flex-1"><h2 class="text-5xl"></h2><div class="mt-6 text-2xl">剧情简介</div><div class="mt-2"></div><div></div></div></div></div></div></div><div class="relative z-3 mt-4"><div class="flex items-center space-x-4 whitespace-nowrap"></div><div class="space-y-4 mt-8"></div><div class="mt-4 flex w-full pb-4 overflow-x-auto space-x-4">'),nf=h('<div class="py-2"><div class="mb-2 cursor-pointer">'),rf=h('<div class="h-[120px]">'),Di=h('<div class="w-[520px]">'),lf=h('<div class="w-[520px]"><div class="text-lg">确认删除「<!>」吗？</div><div class="mt-4 text-slate-800"><div>该仅删除本地索引记录，不影响实际文件</div><div>如需删除云盘文件请到云盘详情页操作'),of=h('<div class="relative"><div class=""><div><div class="relative z-3"><div class="flex"><div class="flex-1"><div class="mt-2 space-y-1">'),af=h('<span class="text-gray-500 text-sm">(<!>min)'),cf=h('<div><div class="text-lg">、</div><div class="pl-4 space-y-1">'),df=h('<div class="flex items-center space-x-4 text-slate-500"><span class="break-all">[<!>]<!>/</span><div class="flex items-center space-x-2"><div class="p-1 cursor-pointer" title="播放"></div><div class="p-1 cursor-pointer" title="删除源">'),uf=h('<div><a target="_blank"><div></div></a><div class="text-xl whitespace-nowrap"></div><div class="">'),hf=t=>{const{app:e,history:s,view:n}=t,i=new I(Ur,{process:Wr,onSuccess(B){O.setURL(B.poster_path),R(B)},onFailed(B){e.tip({text:["获取电视剧详情失败",B.message]})}}),l=new I(sn,{onSuccess(){const B=m.value,H=g.value;if(!B||!H){e.tip({text:["删除成功，请刷新页面"]});return}R(b=>{if(b===null)return null;const{episodes:L,...W}=b;return{...W,episodes:L.map(D=>D.id!==B.id?D:{...D,sources:D.sources.filter(K=>K.id!==H.id)})}}),e.tip({text:["删除成功"]})},onFailed(B){e.tip({text:["删除视频源失败",B.message]})}}),a=new Oe(new I(Wu),{search:{media_id:n.query.id}}),c=new I(Ps,{onLoading(B){_.okBtn.setLoading(B)},onFailed(B){e.tip({text:["删除失败",B.message]})},onSuccess(){e.tip({text:["删除成功"]}),Xr("deleteTV",{tv_id:n.query.id,id:n.query.id}),_.hide(),s.back()}}),d=new I(Jr,{onLoading(B){v.okBtn.setLoading(B)},onSuccess(){e.tip({text:["更新详情成功"]}),i.reload()}}),u=new I(Id,{onLoading(B){$.setLoading(B)},onSuccess(){e.tip({text:["刷新详情成功"]}),i.reload()}}),f=new I(Vd,{onLoading(B){x.okBtn.setLoading(B)},onSuccess(){e.tip({text:["编辑详情成功"]}),i.reload(),x.hide()}}),p=new Fe,m=new Fe,g=new Fe,C=new Rt,v=new ge({onOk(){const B=n.query.id;if(!B){e.tip({text:["更新详情失败","缺少电视剧 id"]});return}const H=C.cur;if(!H){e.tip({text:["请先选择详情"]});return}v.okBtn.setLoading(!0),d.run({media_id:B,media_profile:{id:String(H.id),type:H.type,name:H.name}})}});new Q({onClick(){i.response&&C.$input.setValue(i.response.name),v.show()}});const w=new Q({onClick(){i.response&&V.setValues({title:i.response.name,air_date:"2020/01/01",summary:i.response.overview}),x.show()}}),$=new Q({onClick(){$.setLoading(!0),u.run({media_id:n.query.id})}}),E=new Q({onClick(){}}),_=new ge({title:"删除季",onOk(){if(!p.value){e.tip({text:["请先选择要删除的季"]});return}c.run({media_id:p.value.id})}}),k=new qe({label:"删除",async onClick(){_.show(),T.hide()}});new ge({title:"删除视频源",onOk(){const B=g.value;if(!B){e.tip({text:["请先选择要删除的源"]});return}l.run({parsed_media_source_id:B.id})}});const T=new Ro({items:[k]}),O=new lt({}),F=new Ze({}),x=new ge({onOk(){const B=i.response;if(!B){e.tip({text:["请先等待详情请求完毕"]});return}const{name:H,overview:b,air_date:L}=V.getValues();f.run(B.profile_id,{name:H,overview:b,air_date:L?L.valueOf():void 0})}}),V=ef(),N=new Ue({async onReachBottom(){await a.loadMore(),N.finishLoadingMore()}}),[y,R]=z(null);z(a.response);const[M,J]=z(p.value),[S,A]=z(null);return p.onStateChange(B=>{J(B)}),tt(()=>{i.run({season_id:n.query.id})}),[r(We,{class:"h-screen py-4 px-8",store:N,get children(){return[(()=>{const B=nf(),H=B.firstChild;return H.$$click=()=>{s.back()},o(H,r(hs,{class:"w-6 h-6"})),o(B,r(X,{get when(){return!!y()},get fallback(){return(()=>{const b=of(),L=b.firstChild,W=L.firstChild,D=W.firstChild,K=D.firstChild,te=K.firstChild,ee=te.firstChild;return o(K,r(j,{class:"w-[240px] h-[360px] rounded-lg mr-4 object-cover"}),te),o(te,r(j,{class:"w-full h-[48px]"}),ee),o(te,r(j,{class:"mt-6 w-12 h-[36px]"}),ee),o(ee,r(j,{class:"w-12 h-[18px]"}),null),o(ee,r(j,{class:"w-full h-[18px]"}),null),o(ee,r(j,{class:"w-32 h-[18px]"}),null),b})()},get children(){const b=sf(),L=b.firstChild,W=L.firstChild,D=W.firstChild,K=D.firstChild,te=K.firstChild,ee=te.firstChild,se=ee.nextSibling,he=se.nextSibling,ae=he.nextSibling,fe=L.nextSibling,le=fe.firstChild,ce=le.nextSibling,Ce=ce.nextSibling;return o(K,r(je,{class:"overflow-hidden w-[240px] h-[360px] rounded-lg mr-4 object-cover",store:O}),te),o(ee,()=>y()?.name),o(he,()=>y()?.overview),o(ae,S),o(le,r(U,{store:$,children:"刷新详情"}),null),o(le,r(U,{store:w,children:"编辑详情"}),null),o(le,r(U,{store:E,children:"删除季"}),null),o(ce,r(ie,{get each(){return y()?.episodes},children:G=>{const{id:re,name:me,episode_number:pe,runtime:Re,sources:Te}=G;return(()=>{const ze=cf(),Se=ze.firstChild,q=Se.firstChild,Z=Se.nextSibling;return xe(ze,"title",re),o(Se,pe,q),o(Se,me,null),o(Se,r(X,{when:Re,get children(){const ne=af(),ue=ne.firstChild,we=ue.nextSibling;return we.nextSibling,o(ne,Re,we),ne}}),null),o(Z,r(ie,{each:Te,children:ne=>{const{id:ue,file_name:we,parent_paths:De,drive:ye}=ne;return(()=>{const Ie=df(),ke=Ie.firstChild,Be=ke.firstChild,Ee=Be.nextSibling,Je=Ee.nextSibling,Ve=Je.nextSibling;Ve.nextSibling;const et=ke.nextSibling,Ne=et.firstChild,Ge=Ne.nextSibling;return o(ke,()=>ye.name,Ee),o(ke,De,Ve),o(ke,we,null),Ne.$$click=()=>{s.push("root.preview",{id:ue})},o(Ne,r(Ki,{class:"w-4 h-4"})),Ge.$$click=()=>{m.select(G),g.select(ne),l.run({parsed_media_source_id:ue})},o(Ge,r(Dt,{class:"w-4 h-4"})),oe(()=>xe(ke,"title",`[${ye.name}]${De}/${we}`)),Ie})()}})),ze})()}})),o(Ce,r(ie,{get each(){return y()?.series},children:G=>{const{id:re,name:me,poster_path:pe,air_date:Re}=G,Te=`/home/season_profile?id=${re}`;return(()=>{const ze=uf(),Se=ze.firstChild,q=Se.firstChild,Z=Se.nextSibling,ne=Z.nextSibling;return xe(Se,"href",Te),o(q,r(je,{class:"w-[120px]",get store(){return F.bind(pe)}})),o(Z,me),o(ne,Re),ze})()}})),b}}),null),B})(),rf()]}}),r(ve,{title:"设置电视详情",store:v,get children(){const B=Di();return o(B,r(Pt,{store:C})),B}}),r(ve,{store:_,get children(){const B=lf(),H=B.firstChild,b=H.firstChild,L=b.nextSibling;return L.nextSibling,o(H,()=>M()?.name,L),B}}),r(ve,{store:x,get children(){const B=Di();return o(B,r(tf,{store:V})),B}}),r(cc,{store:T})]};Pe(["click"]);const ff=h('<div class="relative"><div class="p-8 pb-0"><h1 class="text-2xl">刮削结果</h1><div class="mt-8"></div></div><div class="flex-1 h-0 rounded-sm"><div class="w-full h-full">'),pf=h('<div class="flex items-center justify-center"><div class="py-8 text-xl text-slate-800">点击上方未知影视剧类型'),mf=t=>{const{app:e,history:s,pages:n,client:i,storage:l,view:a}=t,c=new Ue({}),d=new Ls({key:"id",options:[{id:"root.home_layout.parse_result_layout.season",text:"电视剧"},{id:"root.home_layout.parse_result_layout.episode",text:"剧集"},{id:"root.home_layout.parse_result_layout.movie",text:"电影"}],onChange(p){s.push(p.id)},onMounted(){d.handleChangeById(a.curView?.name||a.name)}}),[u,f]=z(a.subViews);return s.onRouteChange(p=>{d.mounted&&d.handleChangeById(p.name)}),a.onSubViewsChange(p=>f(p)),r(We,{store:c,class:"flex flex-col box-border h-screen",get children(){const p=ff(),m=p.firstChild,g=m.firstChild,C=g.nextSibling,v=m.nextSibling,w=v.firstChild;return o(C,r(tn,{store:d})),o(w,r(X,{get when(){return u().length!==0},get fallback(){return pf()},get children(){return r(ie,{get each(){return u()},children:($,E)=>{const _=$.name,k=n[_];return r(Un,{get class(){return de("relative w-full h-full")},store:$,get index(){return E()},get children(){return r(k,{app:e,history:s,client:i,storage:l,pages:n,parent:{view:a,scrollView:c},view:$})}})}})}})),p}})},gf=h('<div class="space-y-4">'),vf=h('<div class="px-8 pb-12"><div class="flex items-center my-4 space-x-2"><div class="flex items-center space-x-2"><span>待处理</div></div><div class="flex items-center space-x-2 mt-4">'),Mi=h('<div class="w-[520px]">'),_f=h("<div>"),$f=h('<div class="mt-4 py-2">'),wf=h('<div class="flex p-4 bg-white rounded-sm"><div class="mr-2 w-[80px]"></div><div class="flex-1 w-0"><div class="text-lg"></div><div class="flex items-center mt-4 space-x-2">'),xf=h('<div class="flex items-center space-x-2"><div class="text-sm text-gray-500">[<!>]<!>/</div><div class="p-1 cursor-pointer">'),bf=t=>{const{app:e,view:s,parent:n}=t,i=new Oe(new I(tl,{process:sl}),{pageSize:50,search:{type:Me.Movie},onLoadingChange(x){f.setLoading(x)}}),l=new I(nl,{onLoading(x){w.okBtn.setLoading(x)},onFailed(x){e.tip({text:["设置失败",x.message]})},onSuccess(){e.tip({text:["设置成功"]}),w.hide(),i.deleteItem(x=>x.id===c.value?.id)}}),a=new I(il,{onLoading(x){E.okBtn.setLoading(x)},onFailed(x){e.tip({text:["设置失败",x.message]})},onSuccess(){e.tip({text:["设置成功"]}),E.hide();const x=u.value;if(!x)return;const V=c.value;V&&i.modifyItem(N=>N.id!==V.id?N:{...N,sources:N.sources.filter(y=>y.id!==x.id)})}}),c=new Fe,d=new mt({onChange(x){i.search({empty:x?1:0})}}),u=new Fe,f=new Q({onClick(){i.refresh()}}),p=new Q({onClick(){i.reset()}}),m=new _e({defaultValue:"",onEnter(){g.click()}}),g=new Q({onClick(){m.value&&i.search({name:m.value})}}),C=new Ae({onClick(x){c.select(x),w.show()}}),v=new Rt({type:Me.Movie}),w=new ge({onOk(){if(!c.value){e.tip({text:["请先选择未识别的电影"]});return}const x=v.cur;if(!x){e.tip({text:["请先选择电影详情"]});return}const{id:V}=c.value;l.run({parsed_media_id:V,media_profile:{id:String(x.id),type:x.type,name:x.name}})}});new Ae({onClick(x){u.select(x),E.show()}});const $=new Rt({episode:!0}),E=new ge({onOk(){if(!u.value){e.tip({text:["请先选择未识别的电影"]});return}const x=$.cur;if(!x){e.tip({text:["请先选择电影详情"]});return}const{id:V}=u.value,N=$.curEpisode;if(x.type===Me.Season){if(!N){e.tip({text:["请先选择剧集详情"]});return}a.run({parsed_media_source_id:V,media_profile:{id:String(x.id),type:x.type,name:x.name},media_source_profile:{id:String(N.id)}});return}a.run({parsed_media_source_id:V,media_profile:{id:String(x.id),type:x.type,name:x.name}})}}),_=new Ue({async onReachBottom(){await i.loadMore(),_.finishLoadingMore()}}),k=new Ze({}),T=new lt({src:"https://img.alicdn.com/imgextra/i1/O1CN01rGJZac1Zn37NL70IT_!!6000000003238-2-tps-230-180.png"}),[O,F]=z(i.response);if(n?.scrollView){const x=n.scrollView;x.onReachBottom(async()=>{s.visible&&(await i.loadMore(),x.finishLoadingMore())})}return i.onStateChange(x=>{F(x)}),i.init(),[(()=>{const x=vf(),V=x.firstChild,N=V.firstChild,y=N.firstChild,R=V.nextSibling;return o(V,r(U,{get icon(){return r(Zt,{class:"w-4 h-4"})},store:f,children:"刷新"}),N),o(V,r(U,{store:p,children:"重置"}),N),o(N,r(Kt,{store:d}),y),o(R,r(Le,{class:"",store:m}),null),o(R,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:g,children:"搜索"}),null),o(x,r(Ye,{class:"mt-4",store:i,get children(){const M=gf();return o(M,r(ie,{get each(){return O().dataSource},children:J=>{const{id:S,name:A,profile:B,sources:H}=J;return(()=>{const b=wf(),L=b.firstChild,W=L.nextSibling,D=W.firstChild,K=D.nextSibling;return o(L,r(X,{when:B,get fallback(){return r(je,{class:"w-full object-contain",store:T})},get children(){return[r(je,{class:"w-full h-[120px] object-contain",get store(){return k.bind(B?.poster_path)}}),(()=>{const te=_f();return o(te,()=>B?.name),te})()]}})),o(D,A),o(W,r(X,{when:H,get children(){const te=$f();return o(te,r(ie,{each:H,children:ee=>{const{name:se,parent_paths:he,file_name:ae,drive:fe}=ee;return(()=>{const le=xf(),ce=le.firstChild,Ce=ce.firstChild,G=Ce.nextSibling,re=G.nextSibling,me=re.nextSibling;me.nextSibling;const pe=ce.nextSibling;return xe(le,"title",se),o(ce,()=>fe.name,G),o(ce,he,me),o(ce,ae,null),pe.$$click=()=>{c.select(J),u.select(ee),E.show()},o(pe,r(Xi,{class:"w-4 h-4"})),le})()}})),te}}),K),o(K,r(U,{class:"box-content",variant:"subtle",get store(){return C.bind(J)},get icon(){return r(Fn,{class:"w-4 h-4"})},children:"设置"})),b})()}})),M}}),null),x})(),r(ve,{store:w,get children(){const x=Mi();return o(x,r(Pt,{store:v})),x}}),r(ve,{store:E,get children(){const x=Mi();return o(x,r(Pt,{store:$})),x}})]};Pe(["click"]);const Cf=h('<div class="space-y-4">'),Sf=h('<div class="px-8 pb-12"><div class="my-4 flex items-center space-x-2"><div class="flex items-center space-x-2"><span>未匹配详情</div></div><div class="flex items-center space-x-2 mt-4">'),yf=h('<div class="w-[520px]">'),kf=h('<div class="w-[520px]"><div class="text-lg">确认删除 <!> 吗？</div><div class="text-sm text-slate-800"><div>该操作并不会删除云盘内文件</div><div>更新云盘内文件名或解析规则后可删除所有文件重新索引'),Lf=h("<div>"),Pf=h('<div class="mt-4 py-2 space-y-2">'),Rf=h('<div class="flex p-4 bg-white rounded-sm"><div class="mr-2 w-[80px]"></div><div class="flex-1 w-0"><div class="text-lg">/</div><div class="flex items-center mt-4 space-x-2">'),Df=h('<div class="flex items-center"><div>、</div><div>'),Mf=h('<div><div></div><div class="text-sm text-gray-500">[<!>]<!>/'),Tf=t=>{const{app:e,view:s,parent:n}=t,i=new Oe(new I(tl,{process:sl}),{pageSize:50,search:{type:Me.Season},onLoadingChange(x){d.setLoading(x)}}),l=new I(nl,{onLoading(x){w.okBtn.setLoading(x)},onFailed(x){e.tip({text:["修改失败",x.message]})},onSuccess(){e.tip({text:["修改成功 请刷新查看"]}),w.hide()}}),a=new I(kh,{onLoading(x){p.okBtn.setLoading(x),m.setLoading(x)},onSuccess(){e.tip({text:["删除成功"]}),p.hide();const x=g.value;x&&i.deleteItem(V=>V.id===x.id)},onFailed(x){e.tip({text:["删除失败",x.message]})}}),c=new Q({onClick(){u.clear(),C.reset(),i.reset()}}),d=new Q({onClick(){i.refresh()}}),u=new _e({defaultValue:"",onEnter(){f.click()}}),f=new Q({onClick(){u.value&&i.search({name:u.value})}}),p=new ge({title:"删除未识别电视剧",onOk(){if(!g.value){e.tip({text:["请选择要删除的记录"]});return}a.run({parsed_media_id:g.value.id})}}),m=new Ae({onClick(x){g.select(x),p.show()}}),g=new Fe,C=new mt({onChange(x){i.search({empty:x?1:0})}}),v=new Ae({onClick(x){g.select(x),w.show()}}),w=new ge({onOk(){if(!g.value){e.tip({text:["请先选择未识别的电视剧"]});return}const{id:x}=g.value,V=$.cur;if(!V){e.tip({text:["请先选择设置的详情"]});return}l.run({parsed_media_id:x,media_profile:{id:String(V.id),type:V.type,name:V.name}})}}),$=new Rt({}),E=new Ze({}),_=new lt({src:"https://img.alicdn.com/imgextra/i1/O1CN01rGJZac1Zn37NL70IT_!!6000000003238-2-tps-230-180.png"}),[k,T]=z(i.response),[O,F]=z(g.value);if(n?.scrollView){const x=n.scrollView;x.onReachBottom(async()=>{s.visible&&(await i.loadMore(),x.finishLoadingMore())})}return i.onStateChange(x=>{T(x)}),g.onStateChange(x=>{F(x)}),i.init(),[(()=>{const x=Sf(),V=x.firstChild,N=V.firstChild,y=N.firstChild,R=V.nextSibling;return o(V,r(U,{get icon(){return r(Zt,{class:"w-4 h-4"})},store:d,children:"刷新"}),N),o(V,r(U,{store:c,children:"重置"}),N),o(N,r(Kt,{store:C}),y),o(R,r(Le,{class:"",store:u}),null),o(R,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:f,children:"搜索"}),null),o(x,r(Ye,{class:"mt-4",store:i,get children(){const M=Cf();return o(M,r(ie,{get each(){return k().dataSource},children:J=>{const{id:S,name:A,season_text:B,profile:H,sources:b}=J;return(()=>{const L=Rf(),W=L.firstChild,D=W.nextSibling,K=D.firstChild,te=K.firstChild,ee=K.nextSibling;return o(W,r(X,{when:H,get fallback(){return r(je,{class:"w-full object-contain",store:_})},get children(){return[r(je,{class:"w-full h-[120px] object-contain",get store(){return E.bind(H?.poster_path)}}),(()=>{const se=Lf();return o(se,()=>H?.name),se})()]}})),o(K,A,te),o(K,B,null),o(D,r(X,{when:b,get children(){const se=Pf();return o(se,r(ie,{each:b,children:he=>{const{name:ae,episode_text:fe,parent_paths:le,profile:ce,file_name:Ce,drive:G}=he;return(()=>{const re=Mf(),me=re.firstChild,pe=me.nextSibling,Re=pe.firstChild,Te=Re.nextSibling,ze=Te.nextSibling,Se=ze.nextSibling;return Se.nextSibling,xe(re,"title",ae),o(me,fe),o(re,r(X,{when:ce,get children(){const q=Df(),Z=q.firstChild,ne=Z.firstChild,ue=Z.nextSibling;return o(q,r(Qi,{class:"w-4 h-4 text-green-500"}),Z),o(Z,()=>ce?.order,ne),o(ue,()=>ce?.name),q}}),pe),o(pe,()=>G.name,Te),o(pe,le,Se),o(pe,Ce,null),re})()}})),se}}),ee),o(ee,r(U,{class:"box-content",variant:"subtle",get store(){return v.bind(J)},get icon(){return r(Fn,{class:"w-4 h-4"})},children:"设置详情"})),L})()}})),M}}),null),x})(),r(ve,{store:w,get children(){const x=yf();return o(x,r(Pt,{store:$})),x}}),r(ve,{store:p,get children(){const x=kf(),V=x.firstChild,N=V.firstChild,y=N.nextSibling;return y.nextSibling,o(V,()=>O()?.name,y),x}})]},Bf=h('<div class="flex justify-center items-center h-screen bg-[#f8f9fa]"><form><div class="p-12 rounded-xl w-[480px] bg-white"><h1 class="text-4xl text-center">管理后台登录</h1><div class="mt-16"></div><div class="mt-4"></div><div class="grid grid-cols-1 mt-4">'),Ef=t=>{const{app:e,view:s}=t,n=new _e({defaultValue:"",placeholder:"请输入邮箱",onChange(a){e.$user.inputEmail(a)}}),i=new _e({defaultValue:"",type:"password",placeholder:"请输入密码",onChange(a){e.$user.inputPassword(a)}}),l=new Q({async onClick(){l.setLoading(!0),await e.$user.login(),l.setLoading(!1)}});return(()=>{const a=Bf(),c=a.firstChild,d=c.firstChild,u=d.firstChild,f=u.nextSibling,p=f.nextSibling,m=p.nextSibling;return o(f,r(Le,{store:n})),o(p,r(Le,{store:i})),o(m,r(U,{store:l,size:"default",children:"登录"})),a})()},Ff=h('<div class="flex justify-center items-center h-screen bg-[#f8f9fa]"><form><div class="p-12 rounded-xl w-[480px] bg-white"><h1 class="text-4xl text-center">管理员注册</h1><div class="mt-16"></div><div class="mt-4"></div><div class="grid grid-cols-1 mt-4">'),Of=t=>{const{app:e}=t,s=new _e({defaultValue:"",placeholder:"请输入邮箱",onChange(l){e.$user.inputEmail(l)}}),n=new _e({defaultValue:"",type:"password",placeholder:"请输入密码",onChange(l){e.$user.inputPassword(l)}}),i=new Q({async onClick(){i.setLoading(!0);const l=await e.$user.register();if(i.setLoading(!1),l.error){e.tip({text:[l.error.message]});return}e.tip({text:["注册成功"]})}});return(()=>{const l=Ff(),a=l.firstChild,c=a.firstChild,d=c.firstChild,u=d.nextSibling,f=u.nextSibling,p=f.nextSibling;return o(u,r(Le,{store:s})),o(f,r(Le,{store:n})),o(p,r(U,{store:i,size:"default",children:"注册"})),l})()},If=h("<div>Not Found"),Vf=()=>If(),Af=h('<h1 class="text-2xl">任务列表'),zf=h('<div class="mt-8 flex space-x-2">'),Nf=h('<div class="space-y-4">'),Hf=h('<div class="p-4 rounded-sm bg-white"><div><div class="flex space-x-4"></div><div class="flex space-x-2">'),qf=h('<div class="mt-4"><div><div class="h-full w-full flex-1 bg-slate-900 transition-all dark:bg-slate-400">'),jf=h('<div><div></div><h2 class="text-xl"></h2><div class="flex space-x-4"><div></div><div class="flex items-center space-x-1"><div></div></div></div><div class="flex items-center mt-4 space-x-2">'),Uf=t=>{const{app:e,history:s,view:n}=t,i=new Oe(new I(ea,{process:ta}),{}),l=new I(qn,{onLoading(v){a.setLoading(v)},onFailed:v=>{e.tip({text:["中止任务失败",v.message]})},onSuccess:()=>{e.tip({text:["中止任务成功"]}),i.refresh()}}),a=new Ae({onClick(v){l.run(v.id)}}),c=new Ae({onClick(v){s.push("root.home_layout.job_profile",{id:v.id})}}),d=new Q({onClick(){Xs(),i.refresh()}});new mt({onChange(v){i.search({})}});const u=new Ue,f=new Ls({key:"id",options:[{id:String(Xe.Running),text:"进行中"},{id:String(Xe.Finished),text:"已完成"}],onChange(v){i.search({status:Number(v.id)})},onMounted(){f.selectById(String(Xe.Running))}});i.onLoadingChange(v=>{d.setLoading(v)}),u.onReachBottom(async()=>{await i.loadMore(),u.finishLoadingMore()});const[p,m]=z(i.response);i.onStateChange(v=>{m(v)});const g={[Xe.Finished]:()=>r(Qi,{class:"w-4 h-4"}),[Xe.Paused]:()=>r(Hl,{class:"w-4 h-4"}),[Xe.Running]:()=>r(ql,{class:"w-4 h-4"})};tt(()=>{f.selectById(String(Xe.Running))});const C=()=>p().dataSource;return r(We,{store:u,class:"h-screen p-8",get children(){return[Af(),(()=>{const v=zf();return o(v,r(U,{class:"space-x-1",get icon(){return r(xt,{class:"w-4 h-4"})},store:d,children:"刷新"})),v})(),r(tn,{store:f}),r(Ye,{class:"mt-4",store:i,get skeleton(){return(()=>{const v=Hf(),w=v.firstChild,$=w.firstChild,E=$.nextSibling;return o(w,r(j,{class:"w-[240px] h-8"}),$),o($,r(j,{class:"w-[320px] h-4"})),o(E,r(j,{class:"w-24 h-8"}),null),o(E,r(j,{class:"w-24 h-8"}),null),oe(()=>be(w,de("space-y-1"))),v})()},get children(){const v=Nf();return o(v,r(ie,{get each(){return C()},children:(w,$)=>{const{id:E,desc:_,output_id:k,created:T,status:O,statusText:F}=w;return(()=>{const x=jf(),V=x.firstChild,N=V.nextSibling,y=N.nextSibling,R=y.firstChild,M=R.nextSibling,J=M.firstChild,S=y.nextSibling;return o(V,k),o(N,_),o(R,T),o(M,r(On,{get component(){return g[O]}}),J),o(J,F),o(x,r(X,{get when(){return O===Xe.Running},get children(){const A=qf(),B=A.firstChild,H=B.firstChild;return oe(b=>{const L=de("relative h-1 w-full overflow-hidden rounded-full bg-slate-100 dark:bg-slate-800"),W=`translateX(-${100-w.percent*100}%)`;return L!==b._v$&&be(B,b._v$=L),W!==b._v$2&&((b._v$2=W)!=null?H.style.setProperty("transform",W):H.style.removeProperty("transform")),b},{_v$:void 0,_v$2:void 0}),A}}),S),o(S,r(U,{get store(){return c.bind(w)},variant:"subtle",children:"详情"}),null),o(S,r(X,{get when(){return O===Xe.Running},get children(){return r(U,{get store(){return a.bind(w)},get icon(){return r(jl,{class:"w-4 h-4"})},variant:"subtle",children:"停止任务"})}}),null),oe(A=>{const B=de("space-y-1 p-4 rounded-sm bg-white"),H=de({});return B!==A._v$3&&be(x,A._v$3=B),H!==A._v$4&&be(J,A._v$4=H),A},{_v$3:void 0,_v$4:void 0}),x})()}})),v}})]}})};var Vt=(t=>(t[t.Line=0]="Line",t[t.Section=1]="Section",t[t.Head=2]="Head",t[t.Text=3]="Text",t[t.Link=4]="Link",t[t.List=5]="List",t[t.ListItem=6]="ListItem",t[t.Card=7]="Card",t))(Vt||{});const Wf=h("<p>"),Yf=h('<div class="mt-4">'),Gf=h('<h1 class="text-2xl">'),Jf=h('<h2 class="text-xl">'),Kf=h('<h3 class="text-lg">'),Xf=h("<span>"),Qf=h("<a>"),Zf=h("<ol>"),ep=h("<li>");function tp(t){return r(ie,{get each(){return t.nodes},children:e=>e.type===Vt.Line?r(ei,{node:e}):e.type===Vt.Section?r(sp,{node:e}):"unknown"})}function ei(t){return(()=>{const e=Wf();return o(e,r(ie,{get each(){return t.node.children},children:s=>s.type===Vt.Head?r(np,{node:s}):s.type===Vt.Text?r(ip,{node:s}):s.type===Vt.Link?r(rp,{node:s}):s.type===Vt.List?r(cl,{node:s}):null})),e})()}function sp(t){return(()=>{const e=Yf();return o(e,r(ie,{get each(){return t.node.children},children:s=>s.type===Vt.List?r(cl,{node:s}):r(ei,{node:s})})),e})()}function np(t){const{node:{text:e,level:s,color:n}}=t,i={1:()=>(()=>{const l=Gf();return n!=null?l.style.setProperty("color",n):l.style.removeProperty("color"),o(l,e),l})(),2:()=>(()=>{const l=Jf();return n!=null?l.style.setProperty("color",n):l.style.removeProperty("color"),o(l,e),l})(),3:()=>(()=>{const l=Kf();return n!=null?l.style.setProperty("color",n):l.style.removeProperty("color"),o(l,e),l})()};return r(On,{get component(){return i[s]}})}function ip(t){const{node:{color:e,text:s}}=t;return(()=>{const n=Xf();return e!=null?n.style.setProperty("color",e):n.style.removeProperty("color"),o(n,s),n})()}function rp(t){const{node:{text:e,href:s}}=t;return(()=>{const n=Qf();return xe(n,"href",s),o(n,e),n})()}function cl(t){const{node:{children:e}}=t;return(()=>{const s=Zf();return o(s,r(ie,{each:e,children:n=>(()=>{const i=ep();return o(i,r(ei,{node:n})),i})()})),s})()}const lp=h('<div><div class="mb-2 cursor-pointer">'),op=h('<div><h1 class="text-3xl"></h1><div class="mt-2 flex items-center space-x-4"><div class="flex items-center space-x-1"><div></div></div><p></div><div class="flex items-center mt-4 space-x-2">'),ap=h('<div class="mt-8">'),cp=h('<div><div><div class="mt-2 flex items-center space-x-4"></div><div class="mt-4 space-y-1"></div></div><div class="mt-8 space-y-1">'),dp=t=>{const{app:e,history:s,view:n}=t,i=new Q({onClick(){l.run(n.query.id)}}),l=new I(qn,{onLoading(C){i.setLoading(C)},onSuccess(){e.tip({text:["任务暂停成功"]})},onFailed(C){e.tip({text:["任务暂停失败",C.message]})}}),a=new Oe(new I(na,{process:ia,delay:null}),{pageSize:100}),c=new I(ur,{process:sa,onLoading(C){d.setLoading(C)},onSuccess(C){p(C),a.setDataSource(C.content)},onFailed(C){e.tip({text:["获取任务详情失败",C.message]})}}),d=new Q({onClick(){c.reload()}}),u=new Ue({}),[f,p]=z(c.response),[m,g]=z(a.response);return a.onStateChange(C=>{g(C)}),tt(()=>{const{id:C}=n.query;C&&c.run(C)}),r(We,{store:u,class:"h-screen p-8",get children(){return[(()=>{const C=lp(),v=C.firstChild;return v.$$click=()=>{s.back()},o(v,r(hs,{class:"w-6 h-6"})),C})(),r(X,{get when(){return!!f()},get fallback(){return(()=>{const C=cp(),v=C.firstChild,w=v.firstChild,$=w.nextSibling,E=v.nextSibling;return o(v,r(j,{class:"w-32 h-[36px]"}),w),o(w,r(j,{class:"w-64 h-[24px]"})),o($,r(j,{class:"w-[60px] h-[36px]"})),o(E,r(j,{class:"w-12 h-[24px]"}),null),o(E,r(j,{class:"w-full h-[24px]"}),null),o(E,r(j,{class:"w-32 h-[24px]"}),null),o(E,r(j,{class:"w-64 h-[24px]"}),null),C})()},get children(){return[(()=>{const C=op(),v=C.firstChild,w=v.nextSibling,$=w.firstChild,E=$.firstChild,_=$.nextSibling,k=w.nextSibling;return o(v,()=>f().desc),o($,r(us,{class:"w-4 h-4"}),E),o(E,()=>f().created),o(_,()=>f().statusText),o(k,r(U,{store:d,children:"刷新"}),null),o(k,r(X,{get when(){return f().status===Xe.Running},get children(){return r(U,{store:i,children:"暂停任务"})}}),null),C})(),(()=>{const C=ap();return o(C,r(tp,{get nodes(){return m().dataSource}})),C})()]}})]}})};Pe(["click"]);function Pn(t){const{store:e,renderItem:s}=t,[n,i]=z(e.response.dataSource);return e.onStateChange(l=>{i(l.dataSource)}),r(ie,{get each(){return n()},children:(l,a)=>s(l,a())})}const up=h('<div class="p-2 cursor-pointer">'),hp=h('<div class="mt-4 space-y-2">'),fp=h('<div class="flex-1 flex space-x-2 max-w-full max-h-full overflow-x-auto bg-white"><div class="flex-shrink-0 px-2 pb-12 border-r-2 overflow-x-hidden min-w-[240px] max-h-full overflow-y-auto">'),pp=h('<div class=" overflow-x-auto w-[520px] h-[320px]">'),pn=h('<div class="w-[520px]">'),mp=h('<div class="w-[520px]"><div>删除后索引到的影视剧也会删除</div><div class="mt-2">确认删除该云盘吗？'),gp=h('<div class="relative p-4 bg-white rounded-xl border border-1"><div><div class=""><div class="absolute top-2 right-2"></div><div class="flex"><div class="mr-4 "></div><div class="flex-1 w-0 pr-12"><div class="text-xl truncate"></div><div class="text-sm text-slate-500"></div><div class="mt-2">/</div><div class="flex items-center mt-4 space-x-2">'),vp=h('<div class="flex text-sm text-slate-800"><div></div><div class="ml-2">'),_p=h('<div class="position h-full"><div class="flex items-center justify-center space-x-2 text-slate-800"><div>加载中'),$p=h('<div class="position"><div class="flex items-center justify-center">'),wp=h('<div><div class="text-center">发生了错误'),xp=h("<div>"),bp=h('<div><div class="space-y-2">'),Cp=h('<div><div class="flex items-center justify-between p-2 cursor-pointer rounded-sm hover:bg-slate-300"><div class="flex-1 overflow-hidden whitespace-nowrap text-ellipsis">'),Sp=t=>{const{app:e,store:s,onClick:n,onRefresh:i}=t,l=new I(Qr,{onSuccess(){e.tip({text:["资源盘创建成功"]}),i&&i()},onFailed(D){e.tip({text:["资源盘创建失败",D.message]})}}),a=new I(As,{onSuccess(){e.tip({text:["操作成功"]}),i&&i()},onFailed(D){e.tip({text:["操作失败",D.message]})}}),c=new I(As,{onLoading(D){f.okBtn.setLoading(D)},onSuccess(){e.tip({text:["编辑成功"]}),f.hide(),i&&i()},onFailed(D){e.tip({text:["编辑失败",D.message]})}}),d=new Zr({id:s.id}),u=new ge({title:"设置索引根目录",async onOk(){if(d.selectedFolder===null){e.tip({text:["请先选择文件夹"]});return}u.okBtn.setLoading(!0);const D=await s.setRootFolder(d.selectedFolder);if(u.okBtn.setLoading(!1),d.clear(),D.error){e.tip({text:["设置索引目录失败",D.error.message]});return}e.tip({text:["设置索引目录成功"]}),u.hide()},onUnmounted(){s.clearFolderColumns()}}),f=new ge({title:"编辑备注",onOk(){if(!F.value){e.tip({text:[F.placeholder]});return}c.run({id:s.id,remark:F.value})}}),p=new ge({title:"新增索引目录",async onOk(){p.okBtn.setLoading(!0);const D=await s.addFolder();if(D.error){p.okBtn.setLoading(!1),e.tip({text:["新增文件夹失败",D.error.message]});return}const K=await s.setRootFolder(D.data);if(p.okBtn.setLoading(!1),K.error){e.tip({text:["设置索引目录失败",K.error.message]});return}e.tip({text:["设置索引目录成功"]}),p.hide()}}),m=new ge({async onOk(){m.okBtn.setLoading(!0),await s.delete(),m.okBtn.setLoading(!1),m.hide(),i&&i()}}),g=new ge({title:"修改 refresh token",async onOk(){g.okBtn.setLoading(!0);const D=await s.submitRefreshToken();g.okBtn.setLoading(!1),D.error||g.hide()}}),C=new qe({label:"签到",icon:r(Ul,{class:"mr-2 w-4 h-4"}),async onClick(){C.disable(),await s.checkIn(),C.enable(),_.hide()}}),v=new qe({label:"领取所有签到奖品",icon:r(Wl,{class:"mr-2 w-4 h-4"}),async onClick(){v.disable();const D=await s.receiveRewards();if(v.enable(),D.error){e.tip({text:["领取失败"]});return}_.hide(),e.tip({text:["开始领取"]}),it({job_id:D.data.job_id,onFinish(){e.tip({text:["领取完成"]}),y.click()}})}}),w=new qe({label:"导出云盘信息",icon:r(Zi,{class:"mr-2 w-4 h-4"}),async onClick(){w.disable();const D=await s.export();w.enable(),!D.error&&(e.copy(JSON.stringify(D.data)),e.tip({text:["云盘信息已复制到剪贴板"]}),_.hide())}}),$=new qe({label:"设置索引根目录",icon:r(Yl,{class:"mr-2 w-4 h-4"}),onClick(){_.hide(),u.show(),d.initialized||d.appendColumn({file_id:"root",name:"文件"})}});new qe({label:"匹配解析结果",icon:r(li,{class:"mr-2 w-4 h-4"}),async onClick(){_.hide();const D=await s.matchMediaFilesProfile();D.error||it({job_id:D.data.job_id,onFinish(){s.finishMediaMatch()}})}});const E=new qe({label:"创建资源盘",tooltip:"阿里云盘包含备份盘与资源盘，该按扭将创建对应的资源盘记录",hidden:s.type===nt.AlipanResourceOpenDrive||s.type===nt.AliyunResourceDrive,icon:r(Gl,{class:"mr-2 w-4 h-4"}),onClick(){l.run({type:(()=>s.type===nt.AlipanOpenDrive?nt.AlipanResourceOpenDrive:nt.AliyunResourceDrive)(),payload:JSON.stringify({drive_id:s.id})}),_.hide()}}),_=new Gs({items:[new qe({label:"详情",icon:r(Jl,{class:"mr-2 w-4 h-4"}),onClick:()=>{n&&n(),_.hide()}}),E,w,$,new qe({label:"创建索引根目录",icon:r(Us,{class:"mr-2 w-4 h-4"}),onClick(){_.hide(),p.show()}}),new qe({label:"编辑备注",icon:r(Kl,{class:"mr-2 w-4 h-4"}),onClick(){_.hide(),f.show()}}),new qe({label:"隐藏",icon:r(Ys,{class:"mr-2 w-4 h-4"}),onClick(){a.run({id:s.id,hidden:1})}}),new qe({label:"设置 refresh_token",icon:r(In,{class:"mr-2 w-4 h-4"}),onClick(){g.show(),_.hide()}}),new qe({label:"删除",icon:r(Dt,{class:"mr-2 w-4 h-4"}),async onClick(){m.setTitle(`删除云盘 ${s.name}`),m.show(),_.hide()}})]}),k=new Mo({value:s.state.used_percent}),T=new _e({defaultValue:"",onChange(D){s.inputNewFolderName(D)}}),O=new _e({defaultValue:"",placeholder:"请输入refresh_token",onChange(D){s.setRefreshToken(D)}}),F=new _e({defaultValue:"",placeholder:"请输入备注"}),x=new Q({async onClick(){if(!s.state.initialized){u.show(),d.appendColumn({file_id:"root",name:"文件"});return}const D=await s.startAnalysis();if(D.error){e.tip({text:["索引失败",D.error.message]});return}it({job_id:D.data.job_id,onFinish(){s.finishAnalysis(),x.setLoading(!1)}})}}),V=new Q({async onClick(){_.hide();const D=await s.startAnalysis({quickly:!0});D.error||it({job_id:D.data.job_id,onFinish(){s.finishAnalysis(),x.setLoading(!1)}})}}),N=new Q({onClick(){p.show()}}),y=new Q({async onClick(){y.setLoading(!0),await s.refresh(),k.update(s.state.used_percent),y.setLoading(!1)}}),R=new lt({src:s.state.avatar}),[M,J]=z(s.state),[S,A]=z(d.folderColumns),[B,H]=z(null),[b,L]=z(d.state);s.onStateChange(D=>{x.setLoading(D.loading),R.setURL(D.avatar),J(D)}),d.onFolderColumnChange(D=>{A(D)}),d.onError(D=>{H(D)}),d.onStateChange(D=>{L(D)}),s.onTip(D=>{e.tip(D)});const W=()=>{const D=S()[0];return!(!D||D.list.response.dataSource.length===0)};return(()=>{const D=gp(),K=D.firstChild,te=K.firstChild,ee=te.firstChild,se=ee.nextSibling,he=se.firstChild,ae=he.nextSibling,fe=ae.firstChild,le=fe.nextSibling,ce=le.nextSibling,Ce=ce.firstChild,G=ce.nextSibling;return o(ee,r(Zs,{store:_,get children(){const re=up();return o(re,r(er,{class:"w-6 h-6 text-gray-600"})),re}})),o(he,r(je,{class:"overflow-hidden w-16 h-16 rounded",store:R,get alt(){return M().name}})),o(fe,()=>M().name),o(le,()=>M().drive_id),o(ae,r(sd,{class:"mt-2",store:k}),ce),o(ce,()=>M().used_size,Ce),o(ce,()=>M().total_size,null),o(ae,r(X,{get when(){return M().vip},get children(){const re=hp();return o(re,r(ie,{get each(){return M().vip},children:me=>(()=>{const pe=vp(),Re=pe.firstChild,Te=Re.nextSibling;return o(Re,()=>me.name),o(Te,()=>me.expired_at_text),pe})()})),re}}),G),o(G,r(U,{store:x,variant:"subtle",get icon(){return r(li,{class:"w-4 h-4"})},children:"索引"}),null),o(G,r(U,{store:V,variant:"subtle",children:"仅索引新增"}),null),o(G,r(U,{variant:"subtle",store:y,get icon(){return r(Xl,{class:"w-4 h-4"})},children:"刷新"}),null),o(D,r(ve,{get title(){return M().name},store:u,get children(){const re=pp();return o(re,r(X,{get when(){return b().initialized},get fallback(){return(()=>{const me=_p(),pe=me.firstChild,Re=pe.firstChild;return o(pe,r(Mt,{class:"w-6 h-6 animate-spin"}),Re),me})()},get children(){return r(X,{get when(){return W()},get fallback(){return r(X,{get when(){return!B()},get fallback(){return wp()},get children(){const me=$p(),pe=me.firstChild;return o(pe,r(U,{store:N,children:"添加文件夹"})),me}})},get children(){const me=fp(),pe=me.firstChild;return o(me,r(ie,{get each(){return S()},children:(Re,Te)=>r(We,{get store(){return Re.view},class:"flex-shrink-0 px-2 pt-2 pb-12 border-r-2 overflow-x-hidden w-[240px] h-[320px] overflow-y-auto",get children(){return r(Ye,{get store(){return Re.list},get skeleton(){return(()=>{const ze=bp(),Se=ze.firstChild;return o(Se,r(j,{class:"w-12 h-[24px]"}),null),o(Se,r(j,{class:"w-full h-[24px]"}),null),o(Se,r(j,{class:"w-4 h-[24px]"}),null),ze})()},get children(){const ze=xp();return o(ze,r(Pn,{get store(){return Re.list},renderItem:(Se,q)=>{const{file_id:Z,name:ne,type:ue,selected:we}=Se;return(()=>{const De=Cp(),ye=De.firstChild,Ie=ye.firstChild;return ye.$$click=()=>{d.select(Se,[Te(),q])},ye.classList.toggle("bg-slate-200",!!we),o(Ie,ne),o(ye,r(X,{get when(){return ue===at.Folder},get children(){return r(Qt,{class:"ml-2 w-4 h-4"})}}),null),De})()}})),ze}})}})}),pe),me}})}})),re}}),null),o(D,r(ve,{title:"添加文件夹",store:p,get children(){const re=pn();return o(re,r(Le,{store:T})),re}}),null),o(D,r(ve,{title:"修改 refresh_token",store:g,get children(){const re=pn();return o(re,r(Le,{store:O})),re}}),null),o(D,r(ve,{title:"修改备注",store:f,get children(){const re=pn();return o(re,r(Le,{store:F})),re}}),null),o(D,r(ve,{title:"删除云盘",store:m,get children(){return mp()}}),null),D})()};Pe(["click"]);const yp=h('<div><div class="text-gray-600">Access Token</div><div class="mt-1 break-all">'),kp=h('<div class="mt-4"><div class="text-gray-600">Refresh Token</div><div class="mt-1 break-all">'),Lp=h('<div class="p-4"><div class="flex justify-center">'),Pp=h("<div>");function Rp(){return Y.post("/api/v2/alipan/get_qrcode")}function Dp(t){return Y.post("/api/v2/alipan/get_login_status",t)}function Mp(t){return Y.post("/api/v2/alipan/get_access_token",t)}const Ti={QRCode:new I(Rp),LoginStatus:new I(Dp),AccessToken:new I(Mp)};function Tp(t){let e=!1,s={access_token:"",refresh_token:""};const n=new Q({async onClick(){e=!1,s={access_token:"",refresh_token:""},n.setLoading(!0);const c=await Ti.QRCode.run();if(c.error){n.setLoading(!1),t.app.tip({text:["生成授权链接失败",c.error.message]});return}const{url:d,sid:u}=c.data;t.app.openWindow(d);async function f(){const p=await Ti.LoginStatus.run({sid:u});if(p.error){n.setLoading(!1),t.app.tip({text:["获取登录状态失败",p.error.message]});return}const{status:m,refresh_token:g,access_token:C}=p.data;if(m==="LoginSuccess"){n.setLoading(!1),e=!0,s.access_token=C,s.refresh_token=g,a.emit(l.Success,{...s}),a.emit(l.Change,{...i});return}f()}f()}}),i={get success(){return e},get token(){return s}};let l=function(c){return c[c.Success=0]="Success",c[c.Change=1]="Change",c}({});const a=Vn();return{state:i,ui:{$btn:n},onChange(c){return a.on(l.Change,c)},onSuccess(c){return a.on(l.Success,c)}}}function Bp(t){const e=Tp({app:t.app}),[s,n]=z(e.state);return e.onChange(i=>n(i)),e.onSuccess(i=>{t.store.setValue(JSON.stringify(i))}),(()=>{const i=Lp(),l=i.firstChild;return o(l,r(U,{get store(){return e.ui.$btn},get children(){return r(X,{get when(){return s().success},fallback:"授权",children:"重新授权"})}})),o(i,r(X,{get when(){return s().success},get children(){return[(()=>{const a=yp(),c=a.firstChild,d=c.nextSibling;return o(d,()=>s().token.access_token),a})(),(()=>{const a=kp(),c=a.firstChild,d=c.nextSibling;return o(d,()=>s().token.refresh_token),a})()]}}),null),i})()}function Ep(t){return(()=>{const e=Pp();return o(e,r(gt,{get store(){return t.store}})),e})()}const Fp=h('<div class="flex items-center space-x-4"><h1 class="text-2xl">云盘列表'),Op=h('<div class="grid grid-cols-1 gap-2 mt-4 lg:grid-cols-2">'),Ip=h('<div class="mt-8"><div class="flex items-center space-x-2"><div class="flex items-center space-x-2"><span>全部云盘</div></div><div class="flex items-center space-x-2 mt-4">'),Vp=h('<div class="w-[520px]">'),Ap=h('<div class="grid grid-cols-1 gap-2 mt-4 lg:grid-cols-2"><div class="relative p-4 bg-white rounded-xl border border-1"><div class="flex"><div class="flex-1 pr-12"><div class="flex items-center mt-4 space-x-2">'),zp=h('<div class="p-4"><p>1、在网页端登录阿里云盘</p><p>2、点击复制下面代码</p><div class="mt-2 border rounded-sm bg-gray-200"><div class="relative p-2"><div class="overflow-y-auto h-[120px] break-all whitespace-pre-wrap"></div></div></div><p>3、回到已登录的阿里云盘页面，在浏览器「地址栏」手动输入 `javascript:`</p><p>4、紧接着粘贴复制的代码并回车</p><p>5、将得到的代码粘贴到下方输入框，点击确认即可'),Np=t=>{const{app:e,history:s,view:n}=t,i=new I(Qr,{onLoading(_){a.okBtn.setLoading(_)},onSuccess(){e.tip({text:["添加云盘成功"]}),a.hide(),d.clear(),He.refresh()},onFailed(_){e.tip({text:["添加云盘失败",_.message]})}}),l=new Ls({key:"id",options:[{id:nt.AlipanOpenDrive,text:"阿里云盘/开放接口"},{id:nt.AliyunBackupDrive,text:"阿里云盘"},{id:nt.Cloud189Drive,text:"天翼云盘"},{id:nt.QuarkDrive,text:"夸克"},{id:nt.LocalFolder,text:"文件夹"}],onMounted(){l.selectById(nt.AlipanOpenDrive)}}),a=new ge({title:"新增云盘",onOk(){if(!d.value){e.tip({text:["请输入云盘信息"]});return}i.run({type:l.selectedTabId,payload:d.value})}}),c=new Q({onClick(){a.show()}}),d=new _e({defaultValue:"",placeholder:"请输入"}),u=new mt({onChange(_){He.search({hidden:_?null:0})}}),f=new Q({onClick(){He.refresh()}}),p=new Q({onClick(){if(!m.value){e.tip({text:["请输入搜索关键字"]});return}He.search({name:m.value})}}),m=new _e({defaultValue:"",onEnter(){p.click()}}),g=new Q({onClick(){He.reset()}}),C=new Ue({async onReachBottom(){await He.loadMore(),C.finishLoadingMore()}}),[v,w]=z(He.response),[$,E]=z(l.selectedTabId);return l.onChange(_=>E(_.id)),He.onLoadingChange(_=>f.setLoading(_)),He.onStateChange(_=>w(_)),He.initAny(),[r(We,{store:C,class:"h-screen p-8 whitespace-nowrap",get children(){return[Fp(),(()=>{const _=Ip(),k=_.firstChild,T=k.firstChild,O=T.firstChild,F=k.nextSibling;return o(k,r(U,{class:"space-x-1",get icon(){return r(Zt,{class:"w-4 h-4"})},store:f,children:"刷新"}),T),o(k,r(U,{class:"",store:g,children:"重置"}),T),o(k,r(U,{store:c,get icon(){return r(Tn,{class:"w-4 h-4"})},children:"新增云盘"}),T),o(T,r(Kt,{store:u}),O),o(F,r(Le,{class:"",store:m}),null),o(F,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:p,children:"搜索"}),null),o(_,r(Ye,{store:He,get skeleton(){return(()=>{const x=Ap(),V=x.firstChild,N=V.firstChild,y=N.firstChild,R=y.firstChild;return o(N,r(j,{class:"w-16 h-16 mr-4 rounded"}),y),o(y,r(j,{class:"h-[24px]"}),R),o(y,r(j,{class:"mt-2 h-[18px]"}),R),o(y,r(j,{class:"mt-2 h-[24px]"}),R),o(R,r(j,{class:"w-[56px] h-[28px]"}),null),o(R,r(j,{class:"w-[56px] h-[28px]"}),null),x})()},get children(){const x=Op();return o(x,r(ie,{get each(){return v().dataSource},children:V=>{const{name:N,avatar:y,drive_id:R,used_percent:M,used_size:J}=V.state;return r(Sp,{app:e,store:V,onRefresh:()=>{He.refresh()},onClick:()=>{s.push("root.home_layout.drive_profile",{id:V.id,name:N,avatar:y})}})}})),x}}),null),_})()]}}),r(ve,{store:a,get children(){const _=Vp();return o(_,r(tn,{store:l}),null),o(_,()=>{if($()===nt.AlipanOpenDrive)return r(Bp,{app:e,store:d});if($()===nt.AliyunBackupDrive)return[(()=>{const k=zp(),T=k.firstChild,O=T.nextSibling,F=O.nextSibling,x=F.firstChild,V=x.firstChild;return O.$$click=()=>{e.copy(fn),e.tip({text:["复制成功"]})},F.$$click=()=>{e.copy(fn),e.tip({text:["复制成功"]})},o(V,fn),k})(),r(Ep,{store:d})]},null),_}})]};Pe(["click"]);const Hp=h('<h1 class="text-2xl">演职人员'),qp=h('<div class="mt-8 flex space-x-2">'),jp=h('<div class="flex items-center space-x-2 mt-4">'),Up=h('<div class="space-y-4">'),Wp=h('<div class="p-4 rounded-sm bg-white"><div><div class="flex space-x-4"></div><div class="flex space-x-2">'),Yp=h('<div><div></div><h2 class="text-xl"></h2><div class="flex space-x-4"></div><div class="mt-2 space-x-2">'),Gp=t=>{const e=new Oe(new I(ra),{}),s=new Q({onClick(){e.refresh()}}),n=new mt({onChange(u){e.search({})}}),i=new Ue,l=new Ze({});e.onLoadingChange(u=>{s.setLoading(u)});const[a,c]=z(e.response);e.onStateChange(u=>{c(u)}),i.onReachBottom(async()=>{await e.loadMore(),i.finishLoadingMore()}),e.init();const d=()=>a().dataSource;return r(We,{store:i,class:"h-screen p-8",get children(){return[Hp(),(()=>{const u=qp();return o(u,r(U,{class:"space-x-1",get icon(){return r(xt,{class:"w-4 h-4"})},store:s,children:"刷新"})),u})(),(()=>{const u=jp();return o(u,r(Kt,{store:n})),u})(),r(Ye,{class:"mt-4",store:e,get skeleton(){return(()=>{const u=Wp(),f=u.firstChild,p=f.firstChild,m=p.nextSibling;return o(f,r(j,{class:"w-[240px] h-8"}),p),o(p,r(j,{class:"w-[320px] h-4"})),o(m,r(j,{class:"w-24 h-8"}),null),o(m,r(j,{class:"w-24 h-8"}),null),oe(()=>be(f,de("space-y-1"))),u})()},get children(){const u=Up();return o(u,r(ie,{get each(){return d()},children:(f,p)=>{const{id:m,name:g,avatar:C,unique_id:v}=f;return(()=>{const w=Yp(),$=w.firstChild,E=$.nextSibling;return w.$$click=()=>{window.open(`https://www.themoviedb.org/person/${v}`)},o($,r(je,{class:"w-[120px]",get store(){return l.bind(C)}})),o(E,g),oe(()=>be(w,de("space-y-1 p-4 rounded-sm bg-white"))),w})()}})),u}})]}})};Pe(["click"]);const Jp=h('<div class="flex items-center"><span>'),Kp=h('<div class="flex"><div class="mr-4"></div><div><div class="text-lg"></div><div></div><div class="text-sm">'),Xp=h('<div class="space-y-2">'),Qp=h('<div><div class="space-y-4"><div class="text-lg break-all"></div><div class=""></div><div></div><div class=""><div class="flex items-center flex-wrap mt-2 text-sm">'),Zp=h('<span class="text-slate-500">/'),em=h('<div class="flex"><div class="mr-4"><div class="w-[120px] h-[180px]"></div></div><div><div></div><div class="flex items-center"><div></div></div><div></div><div>没有匹配到详情信息'),tm=h('<div><div class="flex items-center"><span>'),sm=t=>{const{store:e,drive:s,footer:n}=t,i=new I(su),l=new lt({}),[a,c]=z(e.value),[d,u]=z(i.response);e.onStateChange(m=>{c(m)}),i.onStateChange(m=>{u(m.response),l.setURL(m.response?.media?.poster_path)});const f=()=>{const m=a();return m?[...m.parent_paths.map(g=>g.name)].filter(Boolean):[]},p=()=>{const m=d();if(!m)return null;if(m.size)return cs(m.size)};return tt(()=>{if(!e.value)return;const m=e.value;po(m.name)&&i.run({file_id:m.file_id,drive_id:s.id})}),(()=>{const m=Qp(),g=m.firstChild,C=g.firstChild,v=C.nextSibling,w=v.nextSibling,$=w.nextSibling,E=$.firstChild;return o(C,()=>a()?.name),o(v,()=>a()?.file_id),o(w,p),o(E,()=>f().map((_,k)=>[_,r(X,{get when(){return k!==f().length-1},get children(){return Zp()}})])),o(g,r(X,{get when(){return d()},get children(){const _=Xp();return o(_,r(X,{get when(){return d()?.media},get fallback(){return r(X,{get when(){return d()?.unknown_media},get children(){const k=em(),T=k.firstChild,O=T.nextSibling,F=O.firstChild,x=F.nextSibling,V=x.firstChild,N=x.nextSibling;return o(F,()=>d()?.unknown_media?.name),o(x,r(Bs,{class:"w-4 h-4 mr-1 text-red-800"}),V),o(V,()=>d()?.unknown_media?.type===Me.Movie?"电影":"电视剧"),o(N,()=>d()?.unknown_media?.episode_text),k}})},get children(){const k=Kp(),T=k.firstChild,O=T.nextSibling,F=O.firstChild,x=F.nextSibling,V=x.nextSibling;return o(T,r(je,{class:"w-[120px] h-[180px]",store:l})),o(F,()=>d()?.media?.name),o(x,()=>d()?.media?.type===Me.Movie?"电影":"电视剧"),o(V,r(X,{get when(){return d()?.media?.episode_name},get fallback(){return(()=>{const N=tm(),y=N.firstChild,R=y.firstChild;return o(y,r(Bs,{class:"w-4 h-4 mr-1 text-red-800"}),R),o(R,()=>d()?.media?.episode_text),N})()},get children(){const N=Jp(),y=N.firstChild;return o(N,r(Ql,{class:"w-4 h-4 mr-1 text-green-800"}),y),o(y,()=>d()?.media?.episode_name),N}})),k}})),_}}),null),o(m,n,null),m})()};function nm(t,e){const s=document.createElement("a");s.href=t,s.download=e,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)}const im=h('<div class="h-[80px] box-content p-4 border-b-2"><div class="flex items-center space-x-4"><div class="cursor-pointer"></div><div class="text-2xl"></div><div></div></div><div class="flex mt-2 space-x-2 text-slate-800">'),rm=h('<div class="flex-1 flex space-x-2 max-w-full max-h-full overflow-x-auto bg-white"><div class="flex-shrink-0 px-2 pb-12 border-r-2 overflow-x-hidden min-w-[240px] max-h-full overflow-y-auto">'),lm=h('<div class="w-[520px]"><p>该操作将删除云盘文件</p><p>该文件对应影视剧将无法观看，请谨慎操作'),om=h('<div class="w-[520px]"><div class="mt-2">该操作会删除该文件夹解析出的电视剧、电影，请谨慎操作。'),am=h('<div class="w-[520px]"><div class="space-y-1"><div class="flex items-center space-x-2"></div></div><div class="mt-4 grid grid-cols-2 gap-2"><div class="h-[360px] overflow-y-auto"></div><div class="h-[360px] overflow-y-auto">'),mn=h('<div class="w-[520px]">'),cm=h('<div class="h-[480px] overflow-y-auto">'),dm=h('<div class="w-[520px]"><div class="">'),um=h('<div class="flex items-center"><div class="">'),hm=h('<span class="text-slate-300">/'),fm=h("<div>"),Bi=h('<div><div class="space-y-2">'),Ei=h('<div><div class="flex items-center justify-between p-2 cursor-pointer rounded-sm hover:bg-slate-300"><div class="flex-1 overflow-hidden whitespace-nowrap text-ellipsis">'),Fi=h('<div class="p-2"><div>'),pm=h('<div class="mt-4 flex items-center space-x-2">'),mm=t=>{const{app:e,history:s,client:n,view:i}=t,l=new I(nu,{onSuccess(q){it({job_id:q.job_id,onFinish(){e.tip({text:["修改成功"]}),M.okBtn.setLoading(!1),M.hide()}})},onFailed(q){M.okBtn.setLoading(!1),e.tip({text:["修改失败",q.message]})}}),a=new I(kn,{process:Ln}),c=new I(lu,{onSuccess(q){it({job_id:q.job_id,onFinish(){e.tip({text:["完成归档"]})}})},onFailed(q){e.tip({text:["归档失败",q.message]})}}),d=new I(ou,{onSuccess(q){it({job_id:q.job_id,onFinish(){e.tip({text:["完成归档"]})}})},onFailed(q){e.tip({text:["归档失败",q.message]})}}),u=new I(ki,{onLoading(q){A.okBtn.setLoading(q)},onSuccess(){A.okBtn.setLoading(!1),A.hide(),v.clear(),e.tip({text:["完成设置"]})},onFailed(q){e.tip({text:["设置失败",q.message]})}}),f=new I(ki,{onLoading(q){J.okBtn.setLoading(q)},onFailed(q){e.tip({text:["修改失败",q.message]})},onSuccess(){e.tip({text:["修改成功"]}),J.hide()}}),p=new Zr({id:i.query.id,onError(q){e.tip({text:[q.message]})}}),m=new Oe(new I(kn,{process:Ln}),{pageSize:50,search:{drive_id:i.query.id}}),g=new el({...i.query});g.list.pageSize=50;const C=new Fe,v=new Fe,w=new Fe,$=new Ue,E=new ge({title:"文件详情",footer:!1}),_=new ge({async onOk(){if(!C.value){e.tip({text:["请先选择要删除的文件"]});return}const[q,Z]=C.value;p.deleteFile({file:q,position:Z,onLoading(ne){_.okBtn.setLoading(ne)},onSuccess(ne){e.tip({text:["删除成功"]}),ne.deleteFile(),_.hide(),C.clear()},onFailed(ne){e.tip({text:["删除文件失败",ne.message]})}})}}),k=new _e({defaultValue:"",onEnter(){T.okBtn.click()}}),T=new ge({title:"修改名称",onOk(){if(!C.value){e.tip({text:["请先选择要修改的文件"]});return}const[q,Z]=C.value;if(q.name===k.value){e.tip({text:["名称没有变化"]});return}p.rename({file:{file_id:q.file_id,name:k.value},position:Z,onLoading(ne){T.okBtn.setLoading(ne)},onFailed(ne){e.tip({text:["重命名失败",ne.message]})},onSuccess(){e.tip({text:["重命名成功"]}),T.hide(),k.clear(),C.clear()}})}}),O=new qe({label:"详情",onClick(){if(!p.virtualSelectedFolder){e.tip({text:["请先选择文件"]});return}const[q]=p.virtualSelectedFolder;v.select(q),ae.hide(),E.show()}}),F=new qe({label:"索引",async onClick(){if(!p.virtualSelectedFolder){e.tip({text:["请先选择要索引的文件"]});return}const[q]=p.virtualSelectedFolder;F.disable();const Z=await g.analysisSpecialFolders({target_folders:[q]});if(p.clearVirtualSelected(),F.enable(),Z.error){e.tip({text:["索引失败",Z.error.message]});return}e.tip({text:["开始索引"]}),ae.hide(),it({job_id:Z.data.job_id,onFinish(){g.finishAnalysis(),e.tip({text:["索引完成"]})}})}}),x=new qe({label:"洗码",async onClick(){if(!p.virtualSelectedFolder){e.tip({text:["请先选择要索引的文件"]});return}const[q]=p.virtualSelectedFolder;x.disable();const Z=await g.changeFileHash({file:q});if(p.clearVirtualSelected(),x.enable(),Z.error){e.tip({text:["洗码失败",Z.error.message]});return}ae.hide(),it({job_id:Z.data.job_id,onFinish(){e.tip({text:["洗码完成"]})}})}}),V=new qe({label:"修改名称",async onClick(){if(!p.virtualSelectedFolder){e.tip({text:["请先选择要修改的文件"]});return}const[q]=p.virtualSelectedFolder;C.select(p.virtualSelectedFolder),T.setTitle(`修改 '${q.name}' 名称`),k.setValue(q.name),T.show(),ae.hide()}}),N=new _e({defaultValue:""}),y=new _e({defaultValue:""}),R=new Q({async onClick(){if(!N.value){e.tip({text:["请输入正则"]});return}const q=ho(N.value);if(q.error){e.tip({text:["不符合正则格式",q.error.message]});return}if(!y.value){e.tip({text:["请输入替换后的正则"]});return}const Z=q.data,ne=w.value||[];pe({group1:ne,group2:ne.map(ue=>({name:ue.name.replace(Z,y.value)}))})}}),M=new ge({onOk(){const q=N.value;if(!q){e.tip({text:["请输入正则"]});return}const Z=y.value;if(!Z){e.tip({text:["请输入替换后的正则"]});return}if(!C.value){e.tip({text:["请选择文件"]});return}const[ne]=C.value;M.okBtn.setLoading(!0),l.run({drive_id:i.query.id,file_id:ne.file_id,name:ne.name,regexp:q,replace:Z}),e.tip({text:["开始修改"]})}}),J=new ge({onOk(){if(!v.value){e.tip({text:["请先选择未识别的电视剧"]});return}const{file_id:q}=v.value,Z=S.cur;if(!Z){e.tip({text:["请先选择设置的详情"]});return}f.run({file_id:q,media_profile:{id:String(Z.id),type:Z.type,name:Z.name}})}}),S=new Rt({}),A=new ge({onOk(){const q=v.value;if(!q){e.tip({text:["请先选择要设置的文件"]});return}const Z=B.cur;if(!Z){e.tip({text:["请先选择设置的详情"]});return}e.tip({text:["开始设置"]}),A.okBtn.setLoading(!0),u.run({file_id:q.file_id,media_profile:{id:String(Z.id),type:Z.type,name:Z.name}})}}),B=new Rt({type:Me.Movie}),H=new ge({title:"云盘文件搜索",footer:!1}),b=new _e({defaultValue:"",onEnter(q){m.search({name:q})}}),L=new qe({label:"修改子文件名称",async onClick(){if(!p.virtualSelectedFolder){e.tip({text:["请先选择要修改的文件"]});return}const[q]=p.virtualSelectedFolder;C.select(p.virtualSelectedFolder),M.setTitle(`修改 '${q.name}' 子文件名称`),M.show(),ae.hide();const Z=await a.run({file_id:q.file_id,drive_id:i.query.id,next_marker:"",page:1,pageSize:20});if(Z.error){e.tip({text:["获取子文件失败",Z.error.message]});return}const{list:ne}=Z.data;w.select(ne),pe({group1:ne.map(ue=>({name:ue.name})),group2:[]})}}),W=new Q({onClick(){if(!p.virtualSelectedFolder){e.tip({text:["请先选择要删除的文件"]});return}p.virtualSelectedFolder,C.select(p.virtualSelectedFolder),_.setTitle("删除文件"),_.show(),ae.hide()}}),D=new Q({onClick(){v.value&&J.show()}}),K=new qe({label:"删除",async onClick(){if(!p.virtualSelectedFolder){e.tip({text:["请先选择要删除的文件"]});return}C.select(p.virtualSelectedFolder),_.setTitle("删除文件"),_.show(),ae.hide()}}),te=new qe({label:"归档到资源盘",async onClick(){if(!p.virtualSelectedFolder){e.tip({text:["请先选择要归档的文件"]});return}const[q]=p.virtualSelectedFolder;e.tip({text:["开始归档"]}),d.run({file_id:q.file_id,drive_id:i.query.id}),ae.hide()}}),ee=new Cs({_name:"menus-of-drives",side:"right",align:"start"}),se=new qe({_name:"transfer_to",label:"移动到",icon:r(En,{class:"w-4 h-4"}),menu:ee}),he=new qe({label:"下载",icon:r(Zi,{class:"w-4 h-4"}),async onClick(){if(!p.virtualSelectedFolder){e.tip({text:["请先选择要归档的文件"]});return}const[q]=p.virtualSelectedFolder;e.tip({text:["开始下载"]});const ne=await new I(du,{client:n}).run({file_id:q.file_id,drive_id:i.query.id});if(ne.error){e.tip({text:[ne.error.message]});return}nm(ne.data.url,q.name),ae.hide()}}),ae=new Gs({side:"right",align:"start",items:[O,F,V,L,x,he,se,te,K],onHidden(){p.clearVirtualSelected()}}),[fe,le]=z(g.state),[ce,Ce]=z(p.paths),[G,re]=z(p.folderColumns),[me,pe]=z({group1:[],group2:[]}),[Re,Te]=z(v.value),[ze,Se]=z(m.response);return v.onStateChange(q=>{Te(q)}),m.onStateChange(q=>{Se(q)}),g.onStateChange(q=>{le(q)}),He.onStateChange(q=>{ee.setItems(q.dataSource.map(Z=>{const{name:ne}=Z,ue=new qe({label:ne,async onClick(){ue.disable();const we=p.virtualSelectedFolder;if(!we){e.tip({text:["请选择文件"]});return}e.tip({text:["开始归档"]});const[De]=we,ye=await c.run({file_id:De.file_id,drive_id:i.query.id,to_drive_id:Z.id});ye.data&&it({job_id:ye.data.job_id,onFinish(){e.tip({text:["转存完成"]})}}),ue.enable(),ae.hide()}});return ue}))}),p.onFolderColumnChange(q=>{re(q)}),p.onPathsChange(q=>{Ce(q)}),tt(()=>{e.setTitle(i.query.name),p.appendColumn({file_id:"root",name:"文件"}),He.initAny()}),[r(We,{store:$,class:"flex flex-col w-full h-screen",get children(){return[(()=>{const q=im(),Z=q.firstChild,ne=Z.firstChild,ue=ne.nextSibling,we=ue.nextSibling,De=Z.nextSibling;return ne.$$click=()=>{s.back()},o(ne,r(hs,{class:"w-6 h-6"})),o(ue,()=>fe().name),we.$$click=()=>{H.show()},o(we,r(ot,{class:"w-6 h-6 cursor-pointer"})),o(De,r(ie,{get each(){return ce()},children:(ye,Ie)=>{const{name:ke}=ye;return[(()=>{const Be=um(),Ee=Be.firstChild;return o(Ee,ke),Be})(),r(X,{get when(){return Ie()!==ce().length-1},get children(){return hm()}})]}})),q})(),(()=>{const q=rm(),Z=q.firstChild;return o(q,r(ie,{get each(){return G()},children:(ne,ue)=>r(We,{get store(){return ne.view},class:"flex-shrink-0 px-2 pt-2 pb-12 border-r-2 overflow-x-hidden w-[240px] max-h-full overflow-y-auto",get children(){return r(Ye,{get store(){return ne.list},get skeleton(){return(()=>{const we=Bi(),De=we.firstChild;return o(De,r(j,{class:"w-12 h-[24px]"}),null),o(De,r(j,{class:"w-full h-[24px]"}),null),o(De,r(j,{class:"w-4 h-[24px]"}),null),we})()},get children(){const we=fm();return o(we,r(Pn,{get store(){return ne.list},renderItem:(De,ye)=>{const{name:Ie,type:ke,selected:Be,hover:Ee}=De;return(()=>{const Je=Ei(),Ve=Je.firstChild,et=Ve.firstChild;return Je.$$contextmenu=Ne=>{Ne.preventDefault();const{x:Ge,y:ut}=Ne;p.virtualSelect(De,[ue(),ye]),ke===at.Folder&&ae.setItems([O,F,V,L,K]),ke===at.File&&ae.setItems([O,F,x,V,he,se,te,K]),ae.toggle({x:Ge,y:ut})},Ve.$$click=()=>{if(De.type===at.File){v.select(De),C.select([De,[ue(),ye]]),E.show();return}p.select(De,[ue(),ye])},xe(et,"title",Ie),o(et,Ie),o(Ve,r(X,{get when(){return ke===at.Folder},get children(){return r(Qt,{class:"ml-2 w-4 h-4"})}}),null),oe(Ne=>pt(Ve,{"bg-slate-200":Be,"outline outline-2 outline-slate-800":Ee},Ne)),Je})()}})),we}})}})}),Z),q})()]}}),r(Zs,{store:ae}),r(ve,{store:_,get children(){return lm()}}),r(ve,{store:T,get children(){const q=om(),Z=q.firstChild;return o(q,r(Le,{store:k}),Z),q}}),r(ve,{store:M,get children(){const q=am(),Z=q.firstChild,ne=Z.firstChild,ue=Z.nextSibling,we=ue.firstChild,De=we.nextSibling;return o(Z,r(Le,{store:N}),ne),o(ne,r(Le,{store:y}),null),o(ne,r(U,{store:R,children:"测试"}),null),o(we,r(ie,{get each(){return me().group1},children:ye=>(()=>{const Ie=Fi(),ke=Ie.firstChild;return o(ke,()=>ye.name),Ie})()})),o(De,r(ie,{get each(){return me().group2},children:ye=>(()=>{const Ie=Fi(),ke=Ie.firstChild;return o(ke,()=>ye.name),Ie})()})),q}}),r(ve,{store:E,get children(){const q=mn();return o(q,r(sm,{store:v,drive:g,get footer(){return(()=>{const Z=pm();return o(Z,r(U,{store:W,variant:"subtle",get icon(){return r(Dt,{class:"w-4 h-4"})},children:"删除"}),null),o(Z,r(U,{store:D,variant:"subtle",get icon(){return r(Zl,{class:"w-4 h-4"})},children:"设置详情"}),null),Z})()}})),q}}),r(ve,{store:J,get children(){const q=mn();return o(q,r(Pt,{store:S})),q}}),r(ve,{store:A,get children(){const q=mn();return o(q,r(Pt,{store:B})),q}}),r(ve,{store:H,get children(){const q=dm(),Z=q.firstChild;return o(Z,r(Le,{class:"",get prefix(){return r(ot,{class:"w-4 h-4"})},store:b})),o(q,r(Ye,{class:"mt-4",store:m,get skeleton(){return(()=>{const ne=Bi(),ue=ne.firstChild;return o(ue,r(j,{class:"w-12 h-[24px]"}),null),o(ue,r(j,{class:"w-full h-[24px]"}),null),o(ue,r(j,{class:"w-4 h-[24px]"}),null),ne})()},get children(){const ne=cm();return o(ne,r(Pn,{store:m,renderItem:(ue,we)=>{const{file_id:De,name:ye,type:Ie,hover:ke}=ue;return(()=>{const Be=Ei(),Ee=Be.firstChild,Je=Ee.firstChild;return Be.$$contextmenu=Ve=>{Ve.preventDefault(),v.select(ue),p.virtualSelect(ue,[0,we]);const{x:et,y:Ne}=Ve;Ie===at.Folder&&ae.setItems([O,F,V,L,K]),Ie===at.File&&ae.setItems([O,F,x,V,he,se,te,K]),ae.toggle({x:et,y:Ne})},Ee.$$click=()=>{if(ue.type===at.File){v.select(ue),p.virtualSelect(ue,[0,we]),E.show();return}},xe(Je,"title",ye),o(Je,ye),oe(Ve=>pt(Ee,{"bg-slate-200":De===Re()?.file_id,"outline outline-2 outline-slate-800":ke},Ve)),Be})()}})),ne}}),null),q}})]};Pe(["click","contextmenu"]);function gm(t){return Y.post("/api/v2/admin/sync_task/list",t)}function vm(t){const{url:e,pwd:s,resource_file_id:n,resource_file_name:i,drive_file_id:l,drive_file_name:a,drive_id:c}=t;return Y.post("/api/v2/admin/sync_task/create",{url:e,pwd:s,resource_file_id:n,resource_file_name:i,drive_file_id:l,drive_file_name:a,drive_id:c})}function _m(t){return Y.post("/api/v2/admin/sync_task/partial",{id:t.id})}function $m(t){const{id:e}=t;return Y.post("/api/v2/admin/sync_task/run",{id:e})}function wm(t){const{id:e,season_id:s}=t;return Y.post("/api/v2/admin/sync_task/update",{id:e,season_id:s})}function xm(t){const{id:e}=t;return Y.post("/api/v2/admin/sync_task/complete",{id:e})}function bm(t){const{id:e}=t;return Y.post("/api/v2/admin/sync_task/delete",{id:e})}function Cm(t){const{id:e,url:s,pwd:n,resource_file_id:i,resource_file_name:l}=t;return Y.post("/api/v2/admin/sync_task/override",{id:e,url:s,pwd:n,resource_file_id:i,resource_file_name:l})}function Sm(t){const{url:e,code:s,file_id:n,next_marker:i}=t;return Y.post("/api/v2/admin/resource/files",{url:e,code:s,file_id:n,next_marker:i})}function ym(t){const{url:e,code:s,keyword:n}=t;return Y.post("/api/admin/shared_file/search",{url:e,code:s,keyword:n})}function km(t){return Y.post("/api/v2/admin/resource/transfer",t)}class dl extends $e{url;code;file_id="";next_marker="";files=[];paths=[];selectedFolder=null;loading=!1;get state(){return{url:this.url,loading:this.loading,paths:this.paths,files:this.files,next_marker:this.next_marker}}constructor(e={}){super()}input(e){this.url=e,this.emit(0,e)}inputCode(e){this.code=e,this.emit(0,e)}async _fetch(e){if(this.file_id=e,this.loading)return P.Err("正在加载中");if(!this.url)return P.Err("请先指定分享链接");this.loading=!0,this.emit(1,this.loading);const[s]=await Promise.all([new I(Sm).run({url:this.url,code:this.code,file_id:e,next_marker:this.next_marker}),Os(1200)]);return this.loading=!1,this.emit(1,this.loading),s.error?P.Err(s.error):P.Ok(s.data)}reset(){this.paths=[],this.files=[]}async fetch(e={}){const{file_id:s="root",name:n="分享文件",type:i="folder"}=e;if(i==="file"){const c=this.tip({text:["仅文件夹可点击"]});return P.Err(c)}if(!this.url){const c=this.tip({text:["请先指定分享链接"]});return P.Err(c)}this.next_marker="";const l=this.paths.findIndex(c=>c.file_id===s),a=await this._fetch(s);if(a.error){const c=this.tip({text:["获取资源失败",a.error.message]});return P.Err(c)}return(()=>{if(this.paths.length===0){this.paths=[{file_id:s,name:n}];return}if(l!==-1){this.paths=this.paths.slice(0,l+1);return}this.paths=this.paths.concat([{file_id:s,name:n}])})(),this.files=[...a.data.items],this.next_marker=a.data.next_marker,this.emit(2,{...this.state}),P.Ok(null)}async loadMore(){if(!this.url){const s=this.tip({text:["请先指定分享链接"]});return P.Err(s)}const e=await this._fetch(this.file_id);if(e.error){this.emit(5,e.error.message);return}this.files=this.files.concat(e.data.items),this.next_marker=e.data.next_marker,this.emit(2,{...this.state})}async search(e){if(!this.url){const n=this.tip({text:["请先指定分享链接"]});return P.Err(n)}const s=await new I(ym).run({url:this.url,code:this.code,keyword:e});if(s.error){this.emit(5,s.error.message);return}this.files=s.data.items,this.next_marker="",this.emit(2,{...this.state})}selectFolder(e){this.selectedFolder=e}async transferSelectedFolderToDrive(e){if(!this.url){const n=this.tip({text:["请先指定分享链接"]});return P.Err(n)}if(!this.selectedFolder){const n=this.tip({text:["请先指定转存文件"]});return P.Err(new Error(n))}const s=await new I(km).run({url:this.url,code:this.code,file_id:this.selectedFolder.file_id,file_name:this.selectedFolder.name,drive_id:e.id});if(s.error){const n=this.tip({text:["转存失败",s.error.message]});return P.Err(n)}return this.tip({text:["开始转存任务"]}),P.Ok(s.data)}clear(){this.url="",this.files=[],this.paths=[],this.emit(2,{...this.state})}onInput(e){return this.on(0,e)}onLoadingChange(e){return this.on(1,e)}onStateChange(e){return this.on(2,e)}onBindSuccess(e){return this.on(3,e)}onShowTVProfile(e){return this.on(4,e)}}const Lm=h('<div class="flex flex-col items-center"><div class="flex items-center"></div><div class="mt-2 text-center break-all whitespace-pre-wrap truncate line-clamp-2">'),Pm=t=>{const{type:e,name:s,thumbnail:n}=t,i=new lt({src:(()=>e==="folder"?"https://img.alicdn.com/imgextra/i1/O1CN01rGJZac1Zn37NL70IT_!!6000000003238-2-tps-230-180.png":n||"https://img.alicdn.com/imgextra/i2/O1CN01ROG7du1aV18hZukHC_!!6000000003334-2-tps-140-140.png")()});return(()=>{const l=Lm(),a=l.firstChild,c=a.nextSibling;return o(a,r(je,{class:"h-[80px] object-contain",store:i})),xe(c,"title",s),o(c,s),l})()},Rm=h('<div class="flex items-center flex-wrap m-4 space-x-2">'),Dm=h('<div class="fixed right-12 bottom-12 p-4 bg-white rounded-md">'),Mm=h('<div class="grid grid-cols-3 gap-2 m-4 mt-8 lg:grid-cols-4 xl:grid-cols-6">'),Tm=h('<div class="text-center">加载更多'),Bm=h('<div class="h-screen p-8 overflow-y-auto"><h1 class="text-2xl">转存资源</h1><div class="mt-8"><div class="flex items-center space-x-2"></div><div class="flex items-center space-x-2 mt-4"><div class="flex items-center flex-1 space-x-2"><div class="flex-1"></div><div class="w-[180px]"></div></div></div><div class="relative overflow-hidden mt-4 bg-white rounded-sm">'),Em=h('<div class="flex items-center"><div class="cursor-pointer hover:text-blue-500">'),Fm=h('<div class="mx-1">'),Om=h("<div>"),Im=h('<div class="relative"><div class="w-full p-4 rounded cursor-pointer hover:bg-gray-300 dark:hover:bg-gray-500"></div><div class="absolute right-0 top-0 p-2 cursor-pointer">'),Vm=t=>{const{app:e,history:s,view:n}=t,i=new dl,l=new I(vm,{onSuccess(){e.tip({text:["新增同步任务成功"]})},onFailed(_){e.tip({text:["新增同步任务失败",_.message]}),_.code}}),a=new Cs({_name:"menus-of-drives",side:"right",align:"start"}),c=new Cs({_name:"menus-of-drives",side:"right",align:"start"});new qe({label:"建立同步任务",onClick(){if(!i.url){e.tip({text:["请先查询分享资源"]});return}const _={url:i.url},k=i.selectedFolder;k&&(_.resource_file_id=k.file_id,_.resource_file_name=k.name),l.run(_)}});const d=new Gs({_name:"shared-resource-dropdown",items:[new qe({_name:"transfer_to",label:"转存到",icon:r(En,{class:"w-4 h-4"}),menu:a}),new qe({label:"建立同步任务",menu:c,onClick(){}})]}),u=new _e({defaultValue:"",placeholder:"请输入分享链接",onChange(_){i.input(_)},onEnter(){p.click()}}),f=new _e({defaultValue:"",placeholder:"请输入提取码",onChange(_){i.inputCode(_)},onEnter(){p.click()}}),p=new Q({async onClick(){p.setLoading(!0),await i.fetch(),p.setLoading(!1)}}),m=new Q({onClick(){s.push("root.home_layout.transfer_search_list")}}),g=new Q({onClick(){s.push("root.home_layout.transfer_history_list")}}),C=new _e({defaultValue:"",placeholder:"输入关键字搜索文件",onEnter(_){_&&i.search(_)}});He.onStateChange(_=>{a.setItems(_.dataSource.map(k=>{const{name:T}=k,O=new qe({label:T,async onClick(){O.disable();const F=await i.transferSelectedFolderToDrive(k);F.data&&it({job_id:F.data.job_id,onFinish(){e.tip({text:["转存完成"]})}}),O.enable(),d.hide()}});return O})),c.setItems(_.dataSource.map(k=>{const{name:T}=k,O=new qe({label:T,async onClick(){if(!i.url){e.tip({text:["请先查询分享资源"]});return}O.disable();const F={url:i.url,pwd:i.code,drive_id:k.id},x=i.selectedFolder;x&&(F.resource_file_id=x.file_id,F.resource_file_name=x.name),await l.run(F),O.enable(),d.hide()}});return O}))}),i.onTip(_=>{e.tip(_)}),i.onStateChange(_=>{w(_)}),He.initAny();const[v,w]=z(i.state),$=()=>v().paths,E=()=>v().files;return(()=>{const _=Bm(),k=_.firstChild,T=k.nextSibling,O=T.firstChild,F=O.nextSibling,x=F.firstChild,V=x.firstChild,N=V.nextSibling,y=F.nextSibling;return o(O,r(U,{class:"space-x-1",store:m,children:"查询记录"}),null),o(O,r(U,{class:"space-x-1",store:g,children:"转存记录"}),null),o(V,r(Le,{store:u})),o(N,r(Le,{store:f})),o(F,r(U,{size:"default",variant:"default",get icon(){return r(Jt,{class:"w-4 h-4"})},store:p,children:"获取"}),null),o(y,r(X,{get when(){return $().length},get children(){return[(()=>{const R=Rm();return o(R,r(Us,{class:"w-4 h-4"}),null),o(R,r(ie,{get each(){return $()},children:(M,J)=>{const{file_id:S,name:A}=M;return(()=>{const B=Em(),H=B.firstChild;return H.$$click=()=>{i.fetch({file_id:S,name:A})},o(H,A),o(B,(()=>{const b=Lt(()=>J()===$().length-1);return()=>b()?null:(()=>{const L=Fm();return o(L,r(Qt,{class:"w-4 h-4"})),L})()})(),null),B})()}}),null),R})(),(()=>{const R=Dm();return o(R,r(Le,{store:C})),R})()]}}),null),o(y,r(X,{get when(){return E().length},get fallback(){return Om()},get children(){const R=Mm();return o(R,r(ie,{get each(){return E()},children:M=>{const{name:J,type:S}=M;return(()=>{const A=Im(),B=A.firstChild,H=B.nextSibling;return B.$$click=()=>{i.fetch(M)},o(B,r(Pm,{type:S,name:J})),H.$$click=b=>{const{pageX:L,pageY:W}=b;i.selectFolder(M),d.toggle({x:L,y:W})},o(H,r(er,{class:"w-6 h-6 text-gray-600"})),A})()}})),R}}),null),o(y,r(X,{get when(){return v().next_marker},get children(){const R=Tm();return R.$$click=()=>{i.loadMore()},R}}),null),o(_,r(Zs,{store:d}),null),_})()};Pe(["click"]);const Am=h('<h1 class="text-2xl">电影列表(<!>)'),zm=h('<div class="space-y-4">'),Nm=h('<div class="mt-8"><div class="flex items-center space-x-2"></div><div class="flex items-center space-x-2 mt-4"></div><div class="mt-4">'),Hm=h('<div class="w-[520px]"><div class="mt-2 space-y-4 h-[320px] overflow-y-auto">'),qm=h('<div class="w-[520px]"><div>确认删除吗？'),jm=h('<div><div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 p-4"><div class="mt-2 space-y-1"></div><div class="flex items-center space-x-4 mt-2"></div><div class="flex space-x-2 mt-6">'),Um=h('<div class="flex items-center space-x-1 px-2 border border-blue-600 rounded-xl text-blue-600"><div class="break-keep whitespace-nowrap">'),Wm=h('<div class="flex items-center space-x-1 px-2 border border-red-500 rounded-xl text-red-500"><div>个问题'),Ym=h('<div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 w-0 p-4"><h2 class="text-2xl text-slate-800"><a></a></h2><div class="mt-2 overflow-hidden text-ellipsis"><p class="text-slate-700 break-all whitespace-pre-wrap truncate line-clamp-4"></div><div class="flex items-center space-x-4 mt-2"><div class="flex items-center space-x-1 px-2 border border-slate-600 rounded-xl text-slate-600"><div class="break-keep whitespace-nowrap"></div></div><div class="flex items-center space-x-1 px-2 border border-green-600 rounded-xl text-green-600"><div></div></div></div><div class="space-x-2 mt-4 p-1 overflow-hidden whitespace-nowrap">'),Gm=h('<div><div class="py-2"><div class="text-xl"></div></div><div class="text-slate-500 text-sm">/'),Jm=t=>{const{app:e,history:s,view:n}=t,i=new I(Kr,{onLoading(M){w.okBtn.setLoading(M)},onFailed(M){e.tip({text:["归档失败",M.message]})},onSuccess(M){e.tip({text:["开始归档，请等待一段时间"]}),it({job_id:M.job_id,onFinish(){if(!c.value)return;const{name:J}=c.value;e.tip({text:[`完成电影 '${J}' 归档`]})}}),w.hide()}}),l=new Oe(new I(Kn,{process:Xn}),{onLoadingChange(M){f.setLoading(M),p.setLoading(M),E.setLoading(M)}}),a=new I(Ps),c=new Fe,d=new Fe({onChange(M){N(M)}}),u=new _e({defaultValue:"",placeholder:"请输入名称搜索",onEnter(){f.click()}}),f=new Q({onClick(){l.search({name:u.value})}}),p=new Q({onClick(){l.reset(),u.clear()}}),m=new Js({align:"end"}),g=new Ae({onClick(M){s.push("root.home_layout.movie_profile",{id:M.id})}}),C=new Ae({onClick(M){c.select(M),v.show()}}),v=new ge({title:"删除电影",async onOk(){const M=c.value;if(!M){e.tip({text:["请选择要删除的电影"]});return}v.okBtn.setLoading(!0);const J=await a.run({media_id:M.id});if(v.okBtn.setLoading(!1),J.error){e.tip({text:["删除失败",J.error.message]});return}e.tip({text:["删除成功"]}),v.hide(),l.deleteItem(S=>S.id===M.id)}}),w=new ge({title:"移动到其他云盘",onOk(){if(!d.value){e.tip({text:["请先选择目标云盘"]});return}const M=c.value;if(!M){e.tip({text:["请先选择电影"]});return}i.run({media_id:M.id,to_drive_id:d.value.id})},onCancel(){d.clear(),w.hide()}});new Ae({onClick(M){M!==null&&(c.select(M),w.show())}}),new Ze({});const $=new Ze({}),E=new Q({onClick(){l.refresh()}}),_=new bs({options:He.response.dataSource.map(M=>{const{name:J,id:S}=M;return{value:S,label:J}}),onChange(M){}}),k=new Ue,[T,O]=z(l.response),[F,x]=z(He.response),[V,N]=z(d.value),[y,R]=z([]);return n.onShow(()=>{const{deleteMovie:M}=Rs;M&&(Qn("deleteMovie"),l.deleteItem(J=>J.id===M.movie_id))}),k.onReachBottom(async()=>{await l.loadMore(),k.finishLoadingMore()}),l.onStateChange(M=>{O(M)}),He.onStateChange(M=>{const J=M.dataSource.map(S=>{const{name:A,id:B}=S;return{value:B,label:A}});_.setOptions(J),x(M)}),l.init(),He.initAny(),[r(We,{store:k,class:"h-screen p-8",get children(){return[(()=>{const M=Am(),J=M.firstChild,S=J.nextSibling;return S.nextSibling,o(M,()=>T().total,S),M})(),(()=>{const M=Nm(),J=M.firstChild,S=J.nextSibling,A=S.nextSibling;return o(J,r(U,{class:"space-x-1",get icon(){return r(xt,{class:"w-4 h-4"})},store:E,children:"刷新"}),null),o(J,r(U,{class:"",store:p,children:"重置"}),null),o(S,r(Le,{class:"",store:u}),null),o(S,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:f,children:"搜索"}),null),o(A,r(Ye,{store:l,get skeleton(){return(()=>{const B=jm(),H=B.firstChild,b=H.firstChild,L=b.firstChild,W=L.nextSibling,D=W.firstChild,K=D.nextSibling,te=K.nextSibling;return o(L,r(j,{class:"w-[180px] h-[272px]"})),o(W,r(j,{class:"h-[36px] w-[180px]"}),D),o(D,r(j,{class:"h-[24px] w-[120px]"}),null),o(D,r(j,{class:"h-[24px] w-[240px]"}),null),o(K,r(j,{class:"w-10 h-6"}),null),o(K,r(j,{class:"w-10 h-6"}),null),o(K,r(j,{class:"w-10 h-6"}),null),o(te,r(j,{class:"w-24 h-8"}),null),o(te,r(j,{class:"w-24 h-8"}),null),B})()},get children(){const B=zm();return o(B,r(ie,{get each(){return T().dataSource},children:H=>{const{id:b,name:L,overview:W,poster_path:D,air_date:K,vote_average:te,origin_country:ee,tips:se,persons:he}=H,ae=s.buildURLWithPrefix("root.home_layout.movie_profile",{id:b});return(()=>{const fe=Ym(),le=fe.firstChild,ce=le.firstChild,Ce=ce.nextSibling,G=Ce.firstChild,re=G.firstChild,me=G.nextSibling,pe=me.firstChild,Re=me.nextSibling,Te=Re.firstChild,ze=Te.firstChild,Se=Te.nextSibling,q=Se.firstChild,Z=Re.nextSibling;return o(ce,r(je,{class:"w-[180px] h-[272px]",get store(){return $.bind(D)},alt:L})),xe(re,"href",ae),o(re,L),o(pe,W),o(Te,r(us,{class:"w-4 h-4 text-slate-800"}),ze),o(ze,K),o(Re,r(X,{when:ee,get children(){const ne=Um(),ue=ne.firstChild;return o(ne,r(eo,{class:"w-4 h-4 text-blue-600"}),ue),o(ue,ee),ne}}),Se),o(Se,r(to,{class:"w-4 h-4"}),q),o(q,te),o(Re,r(X,{get when(){return se.length},get children(){const ne=Wm(),ue=ne.firstChild,we=ue.firstChild;return ne.addEventListener("mouseleave",()=>{m.hide()}),ne.addEventListener("mouseenter",De=>{const{x:ye,y:Ie,width:ke,height:Be,left:Ee,top:Je,right:Ve,bottom:et}=De.currentTarget.getBoundingClientRect();R(se),m.show({x:ye,y:Ie,width:ke,height:Be+8,left:Ee,top:Je,right:Ve,bottom:et})}),o(ne,r(Ji,{class:"w-4 h-4"}),ue),o(ue,()=>se.length,we),ne}}),null),o(Z,r(U,{get store(){return g.bind(H)},variant:"subtle",get icon(){return r(Es,{class:"w-4 h-4"})},children:"详情"}),null),o(Z,r(U,{get store(){return C.bind(H)},variant:"subtle",get icon(){return r(Dt,{class:"w-4 h-4"})},children:"删除"}),null),fe})()}})),B}})),M})()]}}),r(ve,{store:w,get children(){const M=Hm(),J=M.firstChild;return o(J,r(ie,{get each(){return F().dataSource},children:S=>{const{id:A,name:B,state:H}=S;return(()=>{const b=Gm(),L=b.firstChild,W=L.firstChild,D=L.nextSibling,K=D.firstChild;return b.$$click=()=>{d.select(S)},o(W,B),o(D,()=>H.used_size,K),o(D,()=>H.total_size,null),oe(te=>pt(b,{"bg-gray-100 border rounded-sm p-2 cursor-pointer hover:bg-gray-200":!0,"border-green-500":V()?.id===A},te)),b})()}})),M}}),r(ve,{store:v,get children(){return qm()}})]};Pe(["click"]);const Km=h('<div class="relative"><div class=""><div><div class="relative z-3"><div class="flex"><div class="flex-1"><h2 class="text-5xl"></h2><div class="mt-6 text-2xl">剧情简介</div><div class="mt-2"></div></div></div></div></div></div><div class="relative z-3 mt-4"><div class="flex items-center space-x-4"></div><div class="mt-8 text-2xl">可播放源</div><div class="mt-4 space-y-2">'),Xm=h('<div class="py-2"><div class="mb-2 cursor-pointer">'),Qm=h('<div class="w-[520px]">'),Zm=h('<div class="w-[520px]"><div>确认删除吗？</div><div>该操作不删除视频文件</div><div>请仅在需要重新索引关联的文件时进行删除操作'),eg=h('<div class="relative"><div class=""><div><div class="relative z-3"><div class="flex"><div class="flex-1"><div class="mt-2 space-y-1">'),tg=h('<div class=""><div class="flex items-center space-x-4 text-slate-500"><span class="break-all">[<!>]<!>/</span><div class="flex items-center space-x-2"><div class="p-1 cursor-pointer" title="播放"></div><div class="p-1 cursor-pointer" title="删除源">'),sg=t=>{const{app:e,history:s,view:n}=t,i=new I(Yr,{process:Gr,onSuccess(_){f.setURL(_.poster_path),E(_)}}),l=new I(Jr,{onLoading(_){v.okBtn.setLoading(_)},onSuccess(){e.tip({text:["更改详情成功"]}),v.hide(),i.reload()},onFailed(_){e.tip({text:["更改详情失败",_.message]})}}),a=new I(sn,{onSuccess(){const _=u.value;if(!_){e.tip({text:["删除成功，请刷新页面"]});return}i.modifyResponse(k=>({...k,sources:k.sources.filter(T=>T.id!==_.id)})),e.tip({text:["删除成功"]})}}),c=new I(Au,{onSuccess(){p.setLoading(!1),e.tip({text:["刷新详情成功"]}),i.reload()},onFailed(_){p.setLoading(!1),e.tip({text:["刷新详情失败",_.message]})}}),d=new I(Ps,{onLoading(_){g.okBtn.setLoading(_)},onSuccess(){e.tip({text:["删除成功"]}),g.hide(),Xr("deleteMovie",{movie_id:n.query.id}),s.back()},onFailed(_){e.tip({text:["删除失败",_.message]})}}),u=new Fe,f=new lt({}),p=new Q({onClick(){e.tip({text:["开始刷新"]}),p.setLoading(!0),c.run({media_id:n.query.id})}}),m=new Q({onClick(){g.show()}}),g=new ge({title:"删除电影",onOk(){d.run({media_id:n.query.id})}}),C=new Rt({type:Me.Movie}),v=new ge({onOk(){const _=n.query.id;if(!_){e.tip({text:["更新详情失败","缺少电影 id"]});return}const k=C.cur;if(!k){e.tip({text:["请选择详情"]});return}l.run({media_id:_,media_profile:{id:String(k.id),type:k.type,name:k.name}})}});new Q({onClick(){i.response&&C.$input.setValue(i.response.name),v.show()}});const w=new Ue({});i.onStateChange(_=>{E(_.response)});const[$,E]=z(null);return tt(()=>{i.run({movie_id:n.query.id})}),[r(We,{store:w,class:"h-screen py-4 px-8",get children(){const _=Xm(),k=_.firstChild;return k.$$click=()=>{s.back()},o(k,r(hs,{class:"w-6 h-6"})),o(_,r(X,{get when(){return!!$()},get fallback(){return(()=>{const T=eg(),O=T.firstChild,F=O.firstChild,x=F.firstChild,V=x.firstChild,N=V.firstChild,y=N.firstChild;return o(V,r(j,{class:"w-[240px] h-[360px] rounded-lg mr-4 object-cover"}),N),o(N,r(j,{class:"w-full h-[48px]"}),y),o(N,r(j,{class:"mt-6 w-12 h-[36px]"}),y),o(y,r(j,{class:"w-12 h-[18px]"}),null),o(y,r(j,{class:"w-full h-[18px]"}),null),o(y,r(j,{class:"w-32 h-[18px]"}),null),T})()},get children(){const T=Km(),O=T.firstChild,F=O.firstChild,x=F.firstChild,V=x.firstChild,N=V.firstChild,y=N.firstChild,R=y.nextSibling,M=R.nextSibling,J=O.nextSibling,S=J.firstChild,A=S.nextSibling,B=A.nextSibling;return o(V,r(je,{class:"overflow-hidden w-[240px] h-[360px] rounded-lg mr-4 object-cover",store:f}),N),o(y,()=>$()?.name),o(M,()=>$()?.overview),o(S,r(U,{store:p,children:"刷新详情"}),null),o(S,r(U,{store:m,variant:"subtle",children:"删除"}),null),o(B,r(ie,{get each(){return $()?.sources},children:H=>{const{id:b,file_id:L,file_name:W,parent_paths:D,drive:K}=H;return(()=>{const te=tg(),ee=te.firstChild,se=ee.firstChild,he=se.firstChild,ae=he.nextSibling,fe=ae.nextSibling,le=fe.nextSibling;le.nextSibling;const ce=se.nextSibling,Ce=ce.firstChild,G=Ce.nextSibling;return o(se,()=>K.name,ae),o(se,D,le),o(se,W,null),Ce.$$click=()=>{s.push("root.preview",{id:b})},o(Ce,r(Ki,{class:"w-4 h-4"})),G.$$click=()=>{u.select(H),a.run({parsed_media_source_id:b})},o(G,r(Dt,{class:"w-4 h-4"})),oe(()=>xe(se,"title",`[${K.name}]${D}/${W}`)),te})()}})),T}}),null),_}}),r(ve,{store:v,get children(){const _=Qm();return o(_,r(Pt,{store:C})),_}}),r(ve,{store:g,get children(){return Zm()}})]};Pe(["click"]);var ul=(t=>(t[t.Mounted=0]="Mounted",t[t.UrlChange=1]="UrlChange",t[t.CurrentTimeChange=2]="CurrentTimeChange",t[t.BeforeAdjustCurrentTime=3]="BeforeAdjustCurrentTime",t[t.TargetTimeChange=4]="TargetTimeChange",t[t.AfterAdjustCurrentTime=5]="AfterAdjustCurrentTime",t[t.ResolutionChange=6]="ResolutionChange",t[t.VolumeChange=7]="VolumeChange",t[t.RateChange=8]="RateChange",t[t.SizeChange=9]="SizeChange",t[t.Preload=10]="Preload",t[t.Ready=11]="Ready",t[t.Loaded=12]="Loaded",t[t.SourceLoaded=13]="SourceLoaded",t[t.CanPlay=14]="CanPlay",t[t.Play=15]="Play",t[t.Progress=16]="Progress",t[t.Pause=17]="Pause",t[t.BeforeLoadStart=18]="BeforeLoadStart",t[t.BeforeEnded=19]="BeforeEnded",t[t.CanSetCurrentTime=20]="CanSetCurrentTime",t[t.End=21]="End",t[t.Resize=22]="Resize",t[t.ExitFullscreen=23]="ExitFullscreen",t[t.Error=24]="Error",t[t.StateChange=25]="StateChange",t))(ul||{});class ng extends $e{metadata=null;static Events=ul;$app;_timer=null;_canPlay=!1;_ended=!1;_duration=0;_currentTime=0;_curVolume=.5;_curRate=1;get currentTime(){return this._currentTime}playing=!1;poster;subtitle=null;_mounted=!1;_target_current_time=0;_subtitleVisible=!1;prepareFullscreen=!1;_progress=0;virtualProgress=0;errorMsg="";_passPoint=!1;_size={width:0,height:0};_abstractNode=null;get state(){return{playing:this.playing,poster:this.poster,width:this._size.width,height:this._size.height,ready:this._canPlay,error:this.errorMsg,rate:this._curRate,volume:this._curVolume,currentTime:this._currentTime,subtitle:this.subtitle,prepareFullscreen:this.prepareFullscreen}}constructor(e){super();const{app:s,volume:n,rate:i}=e;n&&(this._curVolume=n),i&&(this._curRate=i),this.$app=s}bindAbstractNode(e){this._abstractNode=e,this._abstractNode&&(this.pendingRate&&(this.changeRate(this.pendingRate),this.pendingRate=null),this._abstractNode.setVolume(this._curVolume))}hasPlayed=!1;async play(){this._abstractNode!==null&&(this.playing||(this._abstractNode.play(),this.hasPlayed=!0,this._abstractNode.setRate(this._curRate),this.playing=!0,this.emit(25,{...this.state})))}async pause(){this._abstractNode!==null&&(this._abstractNode.pause(),this.playing=!1,this.emit(25,{...this.state}))}changeVolume(e){this._abstractNode!==null&&(this._curVolume=e,this._abstractNode.setVolume(e),this.emit(7,{volume:e}))}pendingRate=null;changeRate(e){if(this._abstractNode===null){this.pendingRate=e;return}this._curRate=e,this._abstractNode.setRate(e),this.emit(8,{rate:e})}showAirplay(){this._abstractNode!==null&&this._abstractNode.showAirplay()}pictureInPicture(){this._abstractNode!==null&&this._abstractNode.pictureInPicture()}toggleSubtitle(){this._subtitleVisible=!this._subtitleVisible}setPoster(e){e!==null&&(this.poster=e,this.emit(25,{...this.state}))}setCurrentTime(e=0){this._abstractNode!==null&&(this._currentTime=e||0,this._abstractNode.setCurrentTime(e||0))}speedUp(){let e=this._currentTime+10;this._duration&&e>=this._duration&&(e=this._duration),this.setCurrentTime(e)}rewind(){let e=this._currentTime-10;e<=0&&(e=0),this.setCurrentTime(e)}setSize(e){if(this._size.width!==0&&this._size.width===e.width&&this._size.height!==0&&this._size.height===e.height)return;const s=this.$app,{width:n,height:i}=e,l=Math.ceil(i/n*s.screen.width);Number.isNaN(l)||(this._size={width:s.screen.width,height:l},this.emit(9,{...this._size}),this.emit(25,{...this.state}))}setResolution(e){this.emit(6,e)}clearSubtitle(){this.subtitle=null,this.emit(25,{...this.state})}showSubtitle(e){this.subtitle=e,this.emit(25,{...this.state});const s=this._abstractNode;s&&setTimeout(()=>{this._subtitleVisible=!0,s.showSubtitle()},800)}toggleSubtitleVisible(){if(this._abstractNode){if(this._subtitleVisible){this._subtitleVisible=!1,this._abstractNode.hideSubtitle();return}this._subtitleVisible=!0,this._abstractNode.showSubtitle()}}requestFullScreen(){const e=this._abstractNode;if(e){if(this.$app.env.android){this.play(),e.requestFullscreen();return}this.pause(),e.enableFullscreen(),this.play()}}exitFullscreen=()=>{const e=this._abstractNode;e&&e.exitFullscreen()};loadSource(e){this.metadata=e,this._canPlay=!1,this.errorMsg="",this.emit(1,e),this.emit(25,{...this.state})}preloadSource(e){this.emit(10,{url:e})}canPlayType(e){return this._abstractNode?this._abstractNode.canPlayType(e):!1}load(e){this._canPlay=!1,this._abstractNode&&this._abstractNode.load(e)}startAdjustCurrentTime(){this.emit(3)}adjustProgressManually(e){const s=e*this._duration;this.virtualProgress=e,this.emit(4,s)}adjustCurrentTime(e){this.hasPlayed&&!this.playing&&this.play();let s=e;s<0&&(s=0),s>this._duration&&(s=this._duration),this.setCurrentTime(s),this.emit(5,{time:s})}async screenshot(){return P.Err("请实现 screenshot 方法")}node(){return this._abstractNode?this._abstractNode.$node:null}updated=!1;handleTimeUpdate({currentTime:e,duration:s}){if(this.startLoad&&!this.updated&&(this.emit(20),this.updated=!0),this._currentTime===e)return;this._currentTime=e,typeof s=="number"&&!Number.isNaN(s)&&(this._duration=s);const n=Math.floor(e/this._duration*100);if(this._progress=n,this.emit(16,{currentTime:this._currentTime,duration:this._duration,progress:this._progress}),e+10>=this._duration){if(this._passPoint)return;this.emit(19),this._passPoint=!0;return}this._passPoint=!1}enableFullscreen(){const e=this._abstractNode;e&&(this.prepareFullscreen=!0,e.enableFullscreen(),this.emit(25,{...this.state}))}disableFullscreen(){const e=this._abstractNode;e&&(this.prepareFullscreen=!1,e.disableFullscreen(),this.emit(25,{...this.state}))}setMounted(){this._mounted=!0,this.emit(0),this.emit(11)}setInvalid(e){this.errorMsg=e,this.emit(25,{...this.state})}isFullscreen=!1;handleFullscreenChange(e){this.isFullscreen=e,e===!1&&this.emit(23)}handlePause({currentTime:e,duration:s}){this.emit(17,{currentTime:e,duration:s})}handleVolumeChange(e){this._curVolume=e,this.emit(7,{volume:e})}handleResize(e){}startLoad=!1;handleStartLoad(){this.startLoad=!0}handleEnded(){this.playing=!1,this._ended=!0,this.emit(21,{current_time:this._currentTime,duration:this._duration})}handleLoadedmetadata(e){const{width:s,height:n}=e;this.setSize({width:s,height:n}),this._duration=e.duration,this.emit(13)}handleLoad(){this.emit(12)}handleCanPlay(){this._canPlay||(this._canPlay=!0,this.emit(14),this.emit(25,{...this.state}))}handlePlay(){}handlePlaying(){this.hasPlayed=!0}handleError(e){this.emit(24,new Error(e))}onReady(e){return this.on(11,e)}onBeforeStartLoad(e){return this.on(18,e)}onLoaded(e){return this.on(12,e)}onProgress(e){return this.on(16,e)}onCanPlay(e){return this.on(14,e)}onUrlChange(e){return this.on(1,e)}onExitFullscreen(e){return this.on(23,e)}onPreload(e){return this.on(10,e)}onBeforeEnded(e){return this.on(19,e)}onSizeChange(e){return this.on(9,e)}onVolumeChange(e){return this.on(7,e)}onRateChange(e){return this.on(8,e)}onPause(e){return this.on(17,e)}onResolutionChange(e){return this.on(6,e)}onCanSetCurrentTime(e){return this.on(20,e)}beforeAdjustCurrentTime(e){return this.on(3,e)}afterAdjustCurrentTime(e){return this.on(5,e)}onPlay(e){return this.on(15,e)}onSourceLoaded(e){return this.on(13,e)}onTargetTimeChange(e){return this.on(4,e)}onCurrentTimeChange(e){return this.on(2,e)}onEnd(e){return this.on(21,e)}onError(e){return this.on(24,e)}onStateChange(e){return this.on(25,e)}onMounted(e){return this.on(0,e)}}const ig=h('<div><div class="relative flex flex-wrap w-full h-screen bg-[#14161a]"><div class="z-10 absolute top-6 left-6 cursor-pointer"></div><div class="z-0 relative flex-1 flex items-center w-full h-full bg-black">'),rg=t=>{const{app:e,history:s,view:n}=t,i=new ng({app:e}),l=new I(Lh,{process:Ph,onSuccess(d){c(d),i.setSize({width:d.width,height:d.height}),i.loadSource(d)},onFailed(d){e.tip({text:["获取播放信息失败",d.message]})}}),[a,c]=z(l.response);return e.onHidden(()=>{i.pause()}),e.onShow(()=>{i.setCurrentTime(i.currentTime)}),n.onHidden(()=>{i.pause()}),i.onCanPlay(()=>{n.state.visible&&i.play()}),i.onPause(({currentTime:d,duration:u})=>{}),i.onEnd(()=>{}),i.onVolumeChange(({volume:d})=>{}),i.onSizeChange(({height:d})=>{}),i.onResolutionChange(({type:d})=>{}),i.onSourceLoaded(()=>{i.setCurrentTime(i.currentTime)}),i.onError(d=>{e.tip({text:["视频加载错误",d.message]}),i.pause()}),i.onUrlChange(({url:d})=>{i.load(d)}),tt(()=>{l.run({id:n.query.id})}),qs(()=>{}),(()=>{const d=ig(),u=d.firstChild,f=u.firstChild,p=f.nextSibling;return f.$$click=()=>{s.back()},o(f,r(hs,{class:"w-6 h-6 text-white"})),o(p,r(wd,{store:i})),d})()};Pe(["click"]);const lg=h('<div class="space-y-4">'),og=h('<div class="px-8 pb-12"><div class="my-4 flex items-center space-x-2"></div><div class="flex items-center space-x-2 mt-4">'),Oi=h('<div class="w-[520px]">'),ag=h("<div>仅删除该记录，不删除云盘文件。"),cg=h('<div class="w-[520px]"><div>该操作将修改云盘内的文件名称</div><div>'),dg=h("<div>"),ug=h('<div class="flex p-4 bg-white rounded-sm"><div class="mr-2 w-[80px]"></div><div class="flex-1 w-0"><div class="text-lg"></div><div>/</div><div class="mt-2 flex items-center space-x-2 text-slate-800"><div class="mt-4 py-2 text-sm break-all">[<!>]<!>/</div><div class="p-1 cursor-pointer"></div></div><div class="flex items-center mt-4 space-x-2">'),hg=t=>{const{app:e,view:s,parent:n}=t,i=new Oe(new I(Sh,{process:yh}),{onLoadingChange(y){l.setLoading(y)}}),l=new Q({onClick(){i.refresh()}}),a=new I(ah,{beforeRequest(){m.okBtn.setLoading(!0)},onSuccess(y){const R=d.value;it({job_id:y.job_id,onFinish(){e.tip({text:["重命名完成"]}),m.okBtn.setLoading(!1),R&&(i.modifyItem(M=>{if(M.id===R.id){const{id:J,name:S,episode_text:A,season_text:B,parent_paths:H,profile:b,drive:L}=M;return{id:J,name:S,episode_text:A,season_text:B,file_name:p.value,parent_paths:H,profile:b,drive:L}}return M}),m.hide())}})},onFailed(y){e.tip({text:["重命名失败",y.message]}),m.okBtn.setLoading(!1)}}),c=new I(sn,{onLoading(y){g.okBtn.setLoading(y)},onFailed(y){e.tip({text:["删除剧集失败",y.message]})},onSuccess(){e.tip({text:["删除成功"]}),g.hide(),i.deleteItem(y=>y.id===d.value?.id)}}),d=new Fe,u=new Fe,f=new Ae({onClick(y){d.select(y),w.show()}}),p=new _e({defaultValue:"",placeholder:"请输入新的文件名称"}),m=new ge({title:"修改文件名称",onOk(){if(!p.value){e.tip({text:[p.placeholder]});return}const y=d.value;if(!y){e.tip({text:["请选择要修改名称的剧集"]});return}const{id:R,drive:M}=y;a.run({parsed_media_source_id:R,name:p.value})}}),g=new ge({title:"删除",onOk(){if(!d.value){e.tip({text:["请先选择要删除的剧集"]});return}c.run({parsed_media_source_id:d.value.id})}});new Ae({onClick(y){d.select(y),g.setTitle(`确认删除 ${y.name} 吗？`),g.show()}});const C=new I(il,{onLoading(y){w.okBtn.setLoading(y)},onFailed(y){e.tip({text:["修改失败",y.message]})},onSuccess(){e.tip({text:["修改成功"]}),w.hide(),i.deleteItem(y=>y.id===d.value?.id)}}),v=new Rt({episode:!0}),w=new ge({onOk(){if(!d.value){e.tip({text:["请先选择设置的剧集"]});return}const y=v.cur,R=v.curEpisode;if(!y){e.tip({text:["请先选择详情"]});return}if(!R){e.tip({text:["请先选择剧集详情"]});return}const{id:M}=d.value;C.run({parsed_media_source_id:M,media_profile:{id:String(y.id),type:y.type,name:y.name},media_source_profile:{id:String(R.id)}})}}),$=new Rt({episode:!0}),E=new ge({onOk(){if(!u.value){e.tip({text:["请先选择未识别的电影"]});return}const y=$.cur;if(!y){e.tip({text:["请先选择电影详情"]});return}const{id:R}=u.value,M=$.curEpisode;if(y.type===Me.Season){if(!M){e.tip({text:["请先选择剧集详情"]});return}C.run({parsed_media_source_id:R,media_profile:{id:String(y.id),type:y.type,name:y.name},media_source_profile:{id:String(M.id)}});return}if(y.type===Me.Movie){C.run({parsed_media_source_id:R,media_profile:{id:String(y.id),type:y.type,name:y.name}});return}e.tip({text:["异常的 media profile type"]})}}),_=new Q({onClick(){k.clear(),i.reset()}}),k=new _e({defaultValue:"",onEnter(){T.click()}}),T=new Q({onClick(){k.value&&i.search({name:k.value})}}),O=new Ue({async onReachBottom(){await i.loadMore(),O.finishLoadingMore()}}),F=new Ze({}),x=new lt({src:"https://img.alicdn.com/imgextra/i1/O1CN01rGJZac1Zn37NL70IT_!!6000000003238-2-tps-230-180.png"}),[V,N]=z(i.response);if(n?.scrollView){const y=n.scrollView;y.onReachBottom(async()=>{s.$presence.visible&&(await i.loadMore(),y.finishLoadingMore())})}return i.onStateChange(y=>{N(y)}),i.init(),[(()=>{const y=og(),R=y.firstChild,M=R.nextSibling;return o(R,r(U,{get icon(){return r(Zt,{class:"w-4 h-4"})},store:l,children:"刷新"}),null),o(R,r(U,{store:_,children:"重置"}),null),o(M,r(Le,{class:"",store:k}),null),o(M,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:T,children:"搜索"}),null),o(y,r(Ye,{class:"mt-4",store:i,get children(){const J=lg();return o(J,r(ie,{get each(){return V().dataSource},children:S=>{const{id:A,name:B,episode_text:H,season_text:b,file_name:L,parent_paths:W,profile:D,drive:K}=S;return(()=>{const te=ug(),ee=te.firstChild,se=ee.nextSibling,he=se.firstChild,ae=he.nextSibling,fe=ae.firstChild,le=ae.nextSibling,ce=le.firstChild,Ce=ce.firstChild,G=Ce.nextSibling,re=G.nextSibling,me=re.nextSibling;me.nextSibling;const pe=ce.nextSibling,Re=le.nextSibling;return o(ee,r(X,{when:D,get fallback(){return r(je,{class:"w-full object-contain",store:x})},get children(){return[r(je,{class:"w-full h-[120px] object-contain",get store(){return F.bind(D?.poster_path)}}),(()=>{const Te=dg();return o(Te,()=>D?.name),Te})()]}})),o(he,B),o(ae,b,fe),o(ae,H,null),o(ce,()=>K.name,G),o(ce,W,me),o(ce,L,null),pe.$$click=()=>{d.select(S),u.select(S),E.show()},o(pe,r(Xi,{class:"w-4 h-4"})),o(Re,r(U,{class:"box-content",variant:"subtle",get store(){return f.bind(S)},get icon(){return r(Fn,{class:"w-4 h-4"})},children:"设置"})),te})()}})),J}}),null),y})(),r(ve,{store:w,get children(){const y=Oi();return o(y,r(Pt,{store:v})),y}}),r(ve,{store:E,get children(){const y=Oi();return o(y,r(Pt,{store:$})),y}}),r(ve,{store:g,get children(){return ag()}}),r(ve,{store:m,get children(){const y=cg(),R=y.firstChild,M=R.nextSibling;return o(M,r(Le,{store:p})),y}})]};Pe(["click"]);const fg=h('<div class="space-y-4">'),pg=h('<div><div class="flex items-center space-x-2">'),mg=h('<div><div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 p-4"><div class="mt-2 space-y-1">'),gg=h('<div class="flex items-center space-x-1 px-2 border border-blue-600 rounded-xl text-blue-600"><div>/'),vg=h('<div><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 w-0 p-4"><div class="flex items-center"><h2 class="text-2xl text-slate-800"></div><div class="mt-2 overflow-hidden text-ellipsis"><p class="text-slate-700 break-all whitespace-pre-wrap truncate line-clamp-3"></div><div class="flex items-center space-x-4 mt-2 break-keep overflow-hidden"><div class="flex items-center space-x-1 px-2 border border-slate-600 rounded-xl text-slate-600"><div class="break-keep whitespace-nowrap">'),_g=h('<div class="flex items-center space-x-1 px-2 border border-green-600 rounded-xl text-green-600"><div>全<!>集');var ws=function(t){return t[t.StateChange=0]="StateChange",t[t.ResponseChange=1]="ResponseChange",t[t.Change=2]="Change",t[t.Select=3]="Select",t[t.Clear=4]="Clear",t}(ws||{});class Ds extends $e{curSeason=new Fe;nameInput=new _e({defaultValue:"",placeholder:"请输入名称搜索",onEnter:()=>{this.searchBtn.click()}});searchBtn=new Q({onClick:()=>{this.list.search({name:this.nameInput.value})}});list=new Oe(new I(jr),{onLoadingChange:e=>{this.searchBtn.setLoading(e)}});response=this.list.response;value=this.curSeason.value;constructor(e){super(e);const{onSelect:s,onOk:n,onCancel:i}=e;this.dialog=new ge({title:"选择电视剧",onOk:n,onCancel:i}),this.okBtn=this.dialog.okBtn,this.cancelBtn=this.dialog.cancelBtn,this.list.onStateChange(l=>{this.response=l}),this.curSeason.onStateChange(l=>{this.value=l,l===null&&this.emit(ws.Clear)}),s&&this.onSelect(s)}show(){this.dialog.show()}hide(){this.dialog.hide()}clear(){this.curSeason.clear()}select(e){this.curSeason.select(e),this.emit(ws.Select,e)}onResponseChange(e){return this.list.onStateChange(e)}onCurSeasonChange(e){return this.curSeason.onStateChange(e)}onSelect(e){return this.on(ws.Select,e)}onClear(e){return this.on(ws.Clear,e)}}const fs=t=>{const{store:e}=t,[s,n]=z(e.response),[i,l]=z(e.value),a=new Ze({}),c=new Ue({async onReachBottom(){await e.list.loadMore(),c.finishLoadingMore()}});return e.onResponseChange(d=>{n(d)}),e.onCurSeasonChange(d=>{l(d)}),e.list.init(),(()=>{const d=pg(),u=d.firstChild;return o(u,r(Le,{get store(){return e.nameInput}}),null),o(u,r(U,{get store(){return e.searchBtn},variant:"subtle",children:"搜索"}),null),o(d,r(We,{class:"mt-2 h-[480px] overflow-y-auto",store:c,get children(){return r(Ye,{get store(){return e.list},get skeleton(){return(()=>{const f=mg(),p=f.firstChild,m=p.firstChild,g=m.firstChild,C=g.nextSibling,v=C.firstChild;return o(g,r(j,{class:"w-[120px] h-[180px]"})),o(C,r(j,{class:"h-[36px] w-[180px]"}),v),o(v,r(j,{class:"h-[24px] w-[120px]"}),null),o(v,r(j,{class:"h-[24px] w-[240px]"}),null),f})()},get children(){const f=fg();return o(f,r(ie,{get each(){return s().dataSource},children:p=>{const{id:m,name:g,overview:C,cur_episode_count:v,episode_count:w,air_date:$,poster_path:E}=p;return(()=>{const _=vg(),k=_.firstChild,T=k.firstChild,O=T.nextSibling,F=O.firstChild,x=F.firstChild,V=F.nextSibling,N=V.firstChild,y=V.nextSibling,R=y.firstChild,M=R.firstChild;return _.$$click=()=>{e.select(p)},o(T,r(je,{class:"w-[120px] h-[180px]",get store(){return a.bind(E)},alt:g})),o(x,g),o(N,C),o(R,r(us,{class:"w-4 h-4 text-slate-800"}),M),o(M,$),o(y,r(X,{when:v!==w,get fallback(){return(()=>{const J=_g(),S=J.firstChild,A=S.firstChild,B=A.nextSibling;return B.nextSibling,o(J,r(Ws,{class:"w-4 h-4"}),S),o(S,w,B),J})()},get children(){const J=gg(),S=J.firstChild,A=S.firstChild;return o(J,r(Jt,{class:"w-4 h-4"}),S),o(S,v,A),o(S,w,null),J}}),null),oe(J=>pt(_,{"rounded-md border bg-white shadow-sm":!0,"border-green-500":i()?.id===m,"border-slate-300 ":i()?.id!==m},J)),_})()}})),f}})}}),null),d})()};Pe(["click"]);const $g=h('<div class="space-y-4">'),wg=h('<div class="relative"><div class="flex items-center space-x-4"><h1 class="text-2xl">同步任务列表(<!>)</div><div class="mt-8"><div class="flex items-center space-x-2"><div class="flex items-center space-x-2"><span>待处理</div></div><div class="flex items-center space-x-2 mt-4"></div><div class="mt-4">'),xg=h('<div class="flex items-center space-x-2">'),bg=h('<div class="p-4 bg-white rounded-sm"><div class=""></div><div class="mt-2 max-h-[360px] overflow-auto">'),Cg=h('<div class="w-[680px] min-h-[360px]"><div class="flex items-center space-x-2 mt-4"></div><div class="mt-4"><div class="">'),Sg=h('<div class="w-[520px]">'),yg=h('<div class="w-[520px]"><p>确认删除该同步任务吗？'),kg=h('<div><div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 p-4"><div class="mt-2 space-y-1"></div><div class="flex items-center space-x-4 mt-2"></div><div class="flex space-x-2 mt-6">'),Lg=h('<div class="flex items-center space-x-1 px-2 border border-blue-600 rounded-xl text-blue-600"><div>/'),Pg=h('<div class="relative"><a></a><div class="absolute right-2 bottom-2 flex items-center space-x-4 mt-2 break-keep overflow-hidden">'),Rg=h('<div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 w-0 p-4"><div><div class="flex items-center"><div class="flex flex-1 flex-col items-center p-4 h-[132px] rounded-md bg-slate-100 border"><div></div><div class="mt-2"></div><div class="text-slate-500"><a target="_blank"></a></div></div><div class="mx-4"></div><div class="flex flex-1 flex-col items-center p-4 h-[132px] rounded-md bg-slate-100 border"><div></div><div class="mt-2"></div><div class="text-slate-500"><a target="_blank"></a></div></div></div></div><div class="space-x-2 mt-4 p-1 overflow-hidden whitespace-nowrap">'),Dg=h('<div class="w-[180px] h-[272px] bg-slate-200">'),Mg=h('<div class="flex items-center space-x-1 px-2 border border-green-600 rounded-xl text-green-600"><div>全<!>集'),Tg=h('<div class="flex items-center"><div class="cursor-pointer hover:text-blue-500">'),Bg=h('<div class="mx-1">'),Eg=h('<div class="relative"><div class="w-full p-4 rounded cursor-pointer hover:bg-gray-300 dark:hover:bg-gray-500"><div class="flex"><div class="w-[36px] mr-4"></div><div>');function Fg(t){return{ui:{$pwd:new _e({defaultValue:"",placeholder:""})}}}const Og=t=>{const{app:e,history:s,view:n}=t,i=new Oe(new I(gm),{onLoadingChange(G){_.setLoading(G),k.setLoading(G),S.setLoading(G)}}),l=new I(_m),a=new I(wm),c=new I(Cm,{onLoading(G){$.okBtn.setLoading(G)},onSuccess(){e.tip({text:["修改成功"]}),$.hide(),w()},onFailed(G){e.tip({text:["修改失败",G.message]})}}),d=new I(xm),u=new I(bm),f=new I($m,{beforeRequest(){M.setLoading(!0)},onSuccess(G){it({job_id:G.job_id,onFinish(){M.setLoading(!1),w()},onTip(re){e.tip(re)}})},onFailed(G){e.tip({text:["更新失败",G.message]}),M.setLoading(!1)}}),p=new Fe,m=new Fe,g=new Fe,C=new mt({onChange(G){i.search({invalid:Number(G)})}}),v=new mt({onChange(G){i.search({duplicated:Number(G)})}}),w=async G=>{const re=G||p.value?.id;if(!re)return P.Err("缺少任务 id");const me=await l.run({id:re});return me.error?(e.tip({text:["获取最新信息失败",me.error.message]}),P.Err(me.error.message)):(i.modifyItem(pe=>pe.id!==re?pe:{...me.data}),P.Ok(null))};new kt;const $=new ge({title:"修改同步任务",onOk(){if(!p.value){e.tip({text:["请选择同步任务"]});return}if(!T.value){e.tip({text:[T.placeholder]});return}c.run({id:p.value.id,url:T.value,pwd:D.ui.$pwd.value})}}),E=new _e({defaultValue:"",placeholder:"请输入名称搜索",onEnter(){_.click()}}),_=new Q({onClick(){i.search({name:E.value})}}),k=new Q({onClick(){i.reset(),C.uncheck(),v.uncheck(),E.clear()}}),T=new _e({defaultValue:"",placeholder:"请输入资源链接",onChange(G){A.input(G)},onEnter(){O.click()}}),O=new Q({onClick(){T.value&&A.fetch()}}),F=new Ae({async onClick(G){F.setLoading(!0);const re=await d.run({id:G.id});if(F.setLoading(!1),re.error){e.tip({text:["请求失败",re.error.message]});return}e.tip({text:["操作成功"]}),i.deleteItem(me=>me.id===G.id)}}),x=new ge({title:"删除同步任务",async onOk(){if(!p.value)return;const{id:G}=p.value;x.okBtn.setLoading(!0);const re=await u.run({id:G});if(x.okBtn.setLoading(!1),re.error){e.tip({text:["删除失败",re.error.message]});return}x.hide(),e.tip({text:["删除成功"]}),i.deleteItem(me=>me.id===G)}}),V=new Ae({async onClick(G){p.select(G),x.show()}}),N=new Ae({onClick(G){G!==null&&(p.select(G),$.show())}}),y=new ge({title:"关联电视剧",async onOk(){if(!p.value){e.tip({text:["请选择同步任务"]});return}if(!H.value){e.tip({text:["请选择电视剧"]});return}y.okBtn.setLoading(!0);const G=await a.run({id:p.value.id,season_id:H.value.id});if(y.okBtn.setLoading(!1),G.error){e.tip({text:["关联失败",G.error.message]});return}H.clear(),w(p.value.id),y.hide()}}),R=new Ae({onClick(G){p.select(G),H.list.init(),y.show()}}),M=new Ae({onClick(G){G!==null&&(p.select(G),f.run({id:G.id}))}}),J=new Ae({async onClick(G){J.setLoading(!0);const re=await w(G.id);J.setLoading(!1),!re.error&&e.tip({text:["刷新成功"]})}}),S=new Q({onClick(){i.refresh()}}),A=new dl,B=new Nr({search:{type:at.Folder},footer:!1}),H=new Ds({}),b=new Ue({async onReachBottom(){await i.loadMore(),b.finishLoadingMore()}}),L=new Ze({}),W=new Ze({}),D=Fg(),[K,te]=z(i.response),[ee,se]=z(A.state),[he,ae]=z([]),[fe,le]=z(m.value),[ce,Ce]=z(g.value);return i.onStateChange(G=>{te(G)}),B.onStateChange(G=>{const{list:re}=G;ae(re.dataSource)}),m.onStateChange(G=>{le(G)}),g.onStateChange(G=>{Ce(G)}),A.onLoadingChange(G=>{O.setLoading(G)}),A.onStateChange(G=>{se(G)}),i.init(),[r(We,{class:"h-screen p-8",store:b,get children(){const G=wg(),re=G.firstChild,me=re.firstChild,pe=me.firstChild,Re=pe.nextSibling;Re.nextSibling;const Te=re.nextSibling,ze=Te.firstChild,Se=ze.firstChild,q=Se.firstChild,Z=ze.nextSibling,ne=Z.nextSibling;return o(me,()=>K().total,Re),o(ze,r(U,{class:"space-x-1",get icon(){return r(xt,{class:"w-4 h-4"})},store:S,children:"刷新"}),Se),o(ze,r(U,{class:"",store:k,children:"重置"}),Se),o(Se,r(Kt,{store:C}),q),o(Z,r(Le,{class:"",store:E}),null),o(Z,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:_,children:"搜索"}),null),o(ne,r(Ye,{store:i,get skeleton(){return(()=>{const ue=kg(),we=ue.firstChild,De=we.firstChild,ye=De.firstChild,Ie=ye.nextSibling,ke=Ie.firstChild,Be=ke.nextSibling,Ee=Be.nextSibling;return o(ye,r(j,{class:"w-[180px] h-[272px]"})),o(Ie,r(j,{class:"h-[36px] w-[180px]"}),ke),o(ke,r(j,{class:"h-[24px] w-[120px]"}),null),o(ke,r(j,{class:"h-[24px] w-[240px]"}),null),o(Be,r(j,{class:"w-10 h-6"}),null),o(Be,r(j,{class:"w-10 h-6"}),null),o(Be,r(j,{class:"w-10 h-6"}),null),o(Ee,r(j,{class:"w-24 h-8"}),null),o(Ee,r(j,{class:"w-24 h-8"}),null),ue})()},get children(){const ue=$g();return o(ue,r(ie,{get each(){return K().dataSource},children:we=>{const{id:De,url:ye,resource_file_name:Ie,invalid:ke,drive_file_name:Be,season:Ee,drive:Je}=we,Ve=`${Ie} -> ${Be}`,et=s.buildURLWithPrefix("root.home_layout.drive_profile",{id:Je.id}),Ne=Ee?s.buildURLWithPrefix("root.home_layout.season_profile",{id:Ee.tv_id,season_id:Ee.id}):void 0;return(()=>{const Ge=Rg(),ut=Ge.firstChild,vt=ut.firstChild,_t=vt.nextSibling,$t=_t.firstChild,Tt=$t.firstChild,Bt=Tt.firstChild,Et=Bt.firstChild,ps=Et.nextSibling,ms=ps.nextSibling,es=ms.firstChild,gs=Bt.nextSibling,vs=gs.nextSibling,_s=vs.firstChild,ts=_s.nextSibling,pl=ts.nextSibling,si=pl.firstChild,ss=$t.nextSibling;return o(vt,r(X,{when:Ee,get fallback(){return Dg()},get children(){const ni=Pg(),ln=ni.firstChild,ml=ln.nextSibling;return xe(ln,"href",Ne),o(ln,r(je,{class:"w-[180px] h-[272px]",get store(){return L.bind(Ee?.poster_path)},alt:Ve})),o(ml,r(X,{when:Ee,get children(){return r(X,{get when(){return Ee?.cur_episode_count!==Ee?.episode_count},get fallback(){return(()=>{const Ht=Mg(),Ft=Ht.firstChild,on=Ft.firstChild,ii=on.nextSibling;return ii.nextSibling,o(Ht,r(Ws,{class:"w-4 h-4"}),Ft),o(Ft,()=>Ee?.episode_count,ii),Ht})()},get children(){const Ht=Lg(),Ft=Ht.firstChild,on=Ft.firstChild;return o(Ht,r(Jt,{class:"w-4 h-4"}),Ft),o(Ft,()=>Ee?.cur_episode_count,on),o(Ft,()=>Ee?.episode_count,null),Ht}})}})),ni}})),$t.classList.toggle("opacity-20",ke===1),o(Et,r(so,{class:"w-8 h-8"})),o(ps,Ie),xe(es,"href",ye),o(es,ye),o(gs,r(no,{class:"w-6 h-6 text-slate-800"})),o(_s,r(io,{class:"w-8 h-8"})),o(ts,Be),xe(si,"href",et),o(si,()=>Je.name),o(ss,r(U,{get store(){return J.bind(we)},variant:"subtle",get icon(){return r(xt,{class:"w-4 h-4"})}}),null),o(ss,r(U,{get store(){return R.bind(we)},variant:"subtle",children:"关联电视剧"}),null),o(ss,r(U,{get store(){return M.bind(we)},variant:"subtle",children:"运行"}),null),o(ss,r(U,{get store(){return N.bind(we)},variant:"subtle",children:"修改"}),null),o(ss,r(U,{get store(){return F.bind(we)},variant:"subtle",children:"完成"}),null),o(ss,r(U,{get store(){return V.bind(we)},variant:"subtle",get icon(){return r(Dt,{class:"w-4 h-4"})},children:"删除"}),null),Ge})()}})),ue}})),G}}),r(ve,{store:$,get children(){const G=Cg(),re=G.firstChild,me=re.nextSibling,pe=me.firstChild;return o(re,r(Le,{store:T}),null),o(re,r(Le,{get store(){return D.ui.$pwd}}),null),o(re,r(U,{size:"default",variant:"default",get icon(){return r(Jt,{class:"w-4 h-4"})},store:O,children:"获取"}),null),o(pe,r(X,{get when(){return ee().files.length},get children(){const Re=bg(),Te=Re.firstChild,ze=Te.nextSibling;return o(Te,r(X,{get when(){return ee().paths.length},get children(){const Se=xg();return o(Se,r(Us,{class:"w-4 h-4"}),null),o(Se,r(ie,{get each(){return ee().paths},children:(q,Z)=>{const{file_id:ne,name:ue}=q;return(()=>{const we=Tg(),De=we.firstChild;return De.$$click=()=>{A.fetch({file_id:ne,name:ue})},o(De,ue),o(we,(()=>{const ye=Lt(()=>Z()===ee().paths.length-1);return()=>ye()?null:(()=>{const Ie=Bg();return o(Ie,r(Qt,{class:"w-4 h-4"})),Ie})()})(),null),we})()}}),null),Se}})),o(ze,r(ie,{get each(){return ee().files},children:Se=>{const{name:q,type:Z}=Se;return(()=>{const ne=Eg(),ue=ne.firstChild,we=ue.firstChild,De=we.firstChild,ye=De.nextSibling;return o(De,r(je,{class:"max-w-full max-h-full object-contain",get store(){return W.bind((()=>Z==="folder"?"https://img.alicdn.com/imgextra/i1/O1CN01rGJZac1Zn37NL70IT_!!6000000003238-2-tps-230-180.png":"https://img.alicdn.com/imgextra/i2/O1CN01ROG7du1aV18hZukHC_!!6000000003334-2-tps-140-140.png")())}})),o(ye,q),ne})()}})),Re}})),G}}),r(ve,{store:y,get children(){const G=Sg();return o(G,r(fs,{store:H})),G}}),r(ve,{store:x,get children(){return yg()}}),r(Ar,{store:b})]};Pe(["click"]);const Ig=h('<div class="space-y-4">'),Vg=h('<div><div class="flex items-center space-x-2">'),Ag=h('<div><div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 p-4"><div class="mt-2 space-y-1">'),zg=h('<div><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 w-0 p-4"><div class="flex items-center"><h2 class="text-2xl text-slate-800"></div><div class="mt-2 overflow-hidden text-ellipsis"><p class="text-slate-700 break-all whitespace-pre-wrap truncate line-clamp-3"></div><div class="flex items-center space-x-4 mt-2 break-keep overflow-hidden"><div class="flex items-center space-x-1 px-2 border border-slate-600 rounded-xl text-slate-600"><div class="break-keep whitespace-nowrap">');var xs=function(t){return t[t.StateChange=0]="StateChange",t[t.ResponseChange=1]="ResponseChange",t[t.Change=2]="Change",t[t.Select=3]="Select",t[t.Clear=4]="Clear",t}(xs||{});class ti extends $e{curMovie=new Fe;nameInput=new _e({defaultValue:"",placeholder:"请输入名称搜索",onEnter:()=>{this.searchBtn.click()}});searchBtn=new Q({onClick:()=>{this.list.search({name:this.nameInput.value})}});list=new Oe(new I(Kn,{process:Xn}),{onLoadingChange:e=>{this.searchBtn.setLoading(e)}});response=this.list.response;value=this.curMovie.value;constructor(e){super(e);const{onSelect:s,onOk:n,onCancel:i}=e;this.dialog=new ge({title:"选择电影",onOk:n,onCancel:i}),this.okBtn=this.dialog.okBtn,this.cancelBtn=this.dialog.cancelBtn,this.list.onStateChange(l=>{this.response=l}),this.curMovie.onStateChange(l=>{this.value=l,l===null&&this.emit(xs.Clear)}),s&&this.onSelect(s)}show(){this.dialog.show()}hide(){this.dialog.hide()}clear(){this.curMovie.clear()}select(e){this.curMovie.select(e),this.emit(xs.Select,e)}onResponseChange(e){return this.list.onStateChange(e)}onCurSeasonChange(e){return this.curMovie.onStateChange(e)}onSelect(e){return this.on(xs.Select,e)}onClear(e){return this.on(xs.Clear,e)}}const rn=t=>{const{store:e}=t,s=new Ze({}),n=new Ue({async onReachBottom(){await e.list.loadMore(),n.finishLoadingMore()}}),[i,l]=z(e.response),[a,c]=z(e.value);return e.onResponseChange(d=>{l(d)}),e.onCurSeasonChange(d=>{c(d)}),e.list.init(),(()=>{const d=Vg(),u=d.firstChild;return o(u,r(Le,{get store(){return e.nameInput}}),null),o(u,r(U,{get store(){return e.searchBtn},variant:"subtle",children:"搜索"}),null),o(d,r(We,{class:"mt-2 h-[480px] overflow-y-auto",store:n,get children(){return r(Ye,{get store(){return e.list},get skeleton(){return(()=>{const f=Ag(),p=f.firstChild,m=p.firstChild,g=m.firstChild,C=g.nextSibling,v=C.firstChild;return o(g,r(j,{class:"w-[120px] h-[180px]"})),o(C,r(j,{class:"h-[36px] w-[180px]"}),v),o(v,r(j,{class:"h-[24px] w-[120px]"}),null),o(v,r(j,{class:"h-[24px] w-[240px]"}),null),f})()},get children(){const f=Ig();return o(f,r(ie,{get each(){return i().dataSource},children:p=>{const{id:m,name:g,overview:C,poster_path:v,air_date:w}=p;return(()=>{const $=zg(),E=$.firstChild,_=E.firstChild,k=_.nextSibling,T=k.firstChild,O=T.firstChild,F=T.nextSibling,x=F.firstChild,V=F.nextSibling,N=V.firstChild,y=N.firstChild;return $.$$click=()=>{e.select(p)},o(_,r(je,{class:"w-[120px] h-[180px]",get store(){return s.bind(v)},alt:g})),o(O,g),o(x,C),o(N,r(us,{class:"w-4 h-4 text-slate-800"}),y),o(y,w),oe(R=>pt($,{"rounded-md border bg-white shadow-sm":!0,"border-green-500":a()?.id===m,"border-slate-300 ":a()?.id!==m},R)),$})()}})),f}})}}),null),d})()};Pe(["click"]);const Ng=h("<select>"),Hg=h("<option>"),hl=t=>{const{store:e}=t,[s,n]=z(e.state);return e.onStateChange(i=>{n(i)}),(()=>{const i=Ng();return i.addEventListener("change",l=>{e.select(Number(l.target.value))}),o(i,r(ie,{get each(){return s().options},children:l=>(()=>{const a=Hg();return o(a,()=>l.label),oe(()=>a.value=String(l.value)),a})()})),oe(()=>i.value=String(s().value)),i})()};function qg(t){return Y.post("/api/v2/admin/collection/list",t)}function jg(t){const{title:e,sort:s,desc:n,type:i=os.Manually,medias:l}=t;return Y.post("/api/v2/admin/collection/create",{title:e,desc:n,sort:s,type:i,orders:l.map((a,c)=>({[a.id]:c})).reduce((a,c)=>({...a,...c}),{}),medias:l})}function Ug(t){const{collection_id:e}=t;return Y.post("/api/v2/admin/collection/profile",{id:e})}function Wg(t){if(t.error)return P.Err(t.error.message);const{id:e,title:s,desc:n,sort:i,type:l,medias:a}=t.data;return P.Ok({id:e,title:s,desc:n,sort:i,type:l,medias:a.sort((c,d)=>c.order-d.order)})}function Yg(t){const{collection_id:e,title:s,desc:n,sort:i,type:l,medias:a}=t;return Y.post("/api/v2/admin/collection/edit",{id:e,title:s,desc:n,sort:i,type:l,orders:a.map((c,d)=>({[c.id]:d})).reduce((c,d)=>({...c,...d}),{}),medias:a})}function Gg(t){const{collection_id:e}=t;return Y.post("/api/v2/admin/collection/delete",{id:e})}class Jg extends $e{defaultValue;options;value;get state(){return{value:this.value,options:this.options}}constructor(e){super(e);const{defaultValue:s,options:n}=e;this.defaultValue=s,this.value=s,this.options=n}select(e){this.value=e}setValue(e){this.value=e,this.emit(0,{...this.state})}onStateChange(e){return this.on(0,e)}}class fl extends $e{fields;createRequest=new I(jg,{onLoading:e=>{this.emit(1,e)},onSuccess:()=>{this.tip({text:["编辑成功"]})},onFailed:e=>{this.tip({text:["编辑失败",e.message]})}});updateRequest=new I(Yg,{onLoading:e=>{this.emit(1,e)},onSuccess:()=>{this.tip({text:["编辑成功"]})},onFailed:e=>{this.tip({text:["编辑失败",e.message]})}});profileRequest=new I(Ug,{process:Wg,onLoading:e=>{this.emit(1,e)},onSuccess:e=>{const{title:s,desc:n="",sort:i=0,type:l=os.Manually,medias:a}=e;this.fields.title.setValue(s),this.fields.desc.setValue(n),this.fields.sort.setValue(i),this.fields.type.setValue(l);const c=a.map(d=>{const{id:u,type:f,name:p,poster_path:m}=d;return{id:u,type:f,name:p,poster_path:m}});this.selectedSeasonsRef.select(c),this.emit(0,{...this.state})}});selectedSeasonsRef=new Fe({defaultValue:[]});seasonSelect=new Ds({onOk:()=>{const e=this.seasonSelect.value;if(!e){this.tip({text:["请选择电视剧"]});return}const s=this.selectedSeasonsRef.value||[];if(s.find(a=>a.id===e.id))return;const{id:n,name:i,poster_path:l}=e;this.selectedSeasonsRef.select(s.concat([{id:n,type:1,name:i,poster_path:l}])),this.seasonSelect.dialog.hide(),this.emit(0,{...this.state})}});get seasonSelectDialog(){return this.seasonSelect.dialog}movieSelect=new ti({onOk:()=>{const e=this.movieSelect.value;if(!e){this.tip({text:["请选择电影"]});return}const s=this.selectedSeasonsRef.value||[];if(s.find(a=>a.id===e.id))return;const{id:n,name:i,poster_path:l}=e;this.selectedSeasonsRef.select(s.concat([{id:n,type:Me.Movie,name:i,poster_path:l}])),this.movieSelect.dialog.hide(),this.emit(0,{...this.state})}});get movieSelectDialog(){return this.movieSelect.dialog}get state(){return{title:this.fields.title.value,desc:this.fields.desc.value,sort:this.fields.sort.value,medias:[...this.selectedSeasonsRef.value||[]]}}constructor(e){super(e);const s=new _e({defaultValue:""}),n=new _e({defaultValue:""}),i=new _e({defaultValue:0,type:"number"}),l=new Jg({defaultValue:os.Manually,options:[{value:os.Manually,label:"默认"},{value:os.ManuallyRank,label:"排行榜"}]});this.fields={title:s,desc:n,sort:i,type:l}}removeMedia(e){this.selectedSeasonsRef.value&&this.selectedSeasonsRef.select(this.selectedSeasonsRef.value.filter(s=>s.id!==e.id)),this.emit(0,{...this.state})}async create(){const e=this.fields.title.value,s=this.fields.desc.value,n=this.fields.sort.value,i=this.fields.type.value,l=this.state.medias;if(!e){this.tip({text:["请输入标题"]});return}if(!l.length){this.tip({text:["请选择集合内容"]});return}this.createRequest.run({title:e,desc:s,sort:n,type:i,medias:l})}async edit(e){const s=this.fields.title.value,n=this.fields.desc.value,i=this.fields.sort.value,l=this.fields.type.value,a=this.state.medias;if(!s){this.tip({text:["请输入标题"]});return}if(!a?.length){this.tip({text:["请选择集合内容"]});return}this.updateRequest.run({collection_id:e,title:s,desc:n,type:l,sort:i,medias:a})}onLoading(e){return this.on(1,e)}onStateChange(e){return this.on(0,e)}}const Kg=h('<div class="grid gap-2 grid-cols-6">'),Xg=h('<div class="flex mt-2 space-x-2"><div class="cursor-pointer"></div><div class="cursor-pointer">'),Qg=h('<div class="h-screen p-8"><h1 class="text-2xl">创建集合</h1><div class="w-[520px] mx-auto"><div class="space-y-4"><div class="space-y-2"><div>标题</div></div><div class="space-y-2"><div>描述</div></div><div class="space-y-2"><div>排序</div></div><div class="space-y-2"><div>类型</div></div><div class="space-y-2"><div>内容</div><div></div></div></div><div class="mt-12">'),Ii=h('<div class="w-[520px]">'),Zg=h('<div class="flex space-x-2"><div class="cursor-pointer"></div><div class="cursor-pointer">'),ev=h('<div class="relative"><div class="relative"><div class="absolute left-0 top-0"></div></div><div class="mt-2"><div></div></div><div class="absolute z-10 right-0 top-0 p-1 rounded-full bg-white cursor-pointer">'),tv=t=>{const{app:e,view:s}=t,n=new fl({}),i=new Ze({}),[l,a]=z(n.state);n.onStateChange(d=>{a(d)}),n.onLoading(d=>{c.setLoading(d)}),n.onTip(d=>{e.tip(d)});const c=new Q({onClick(){n.create()}});return[(()=>{const d=Qg(),u=d.firstChild,f=u.nextSibling,p=f.firstChild,m=p.firstChild;m.firstChild;const g=m.nextSibling;g.firstChild;const C=g.nextSibling;C.firstChild;const v=C.nextSibling;v.firstChild;const w=v.nextSibling,$=w.firstChild,E=$.nextSibling,_=p.nextSibling;return o(m,r(Le,{get store(){return n.fields.title}}),null),o(g,r(gt,{get store(){return n.fields.desc}}),null),o(C,r(Le,{get store(){return n.fields.sort}}),null),o(v,r(hl,{get store(){return n.fields.type}}),null),o(E,r(X,{get when(){return l().medias.length},get fallback(){return(()=>{const k=Zg(),T=k.firstChild,O=T.nextSibling;return T.$$click=()=>{n.seasonSelectDialog.show()},o(T,r(Fs,{class:"w-4 h-4"})),O.$$click=()=>{n.movieSelectDialog.show()},o(O,r(Gt,{class:"w-4 h-4"})),k})()},get children(){return[(()=>{const k=Kg();return o(k,r(ie,{get each(){return l().medias},children:T=>{const{id:O,type:F,name:x,poster_path:V}=T;return(()=>{const N=ev(),y=N.firstChild,R=y.firstChild,M=y.nextSibling,J=M.firstChild,S=M.nextSibling;return o(y,r(je,{class:"w-[78px] rounded-sm",get store(){return i.bind(V)}}),R),o(R,F===1?"电视剧":"电影"),o(J,x),S.$$click=()=>{n.removeMedia(T)},o(S,r(ys,{class:"w-2 h-2"})),N})()}})),k})(),(()=>{const k=Xg(),T=k.firstChild,O=T.nextSibling;return T.$$click=()=>{n.seasonSelectDialog.show()},o(T,r(Fs,{class:"w-4 h-4"})),O.$$click=()=>{n.movieSelectDialog.show()},o(O,r(Gt,{class:"w-4 h-4"})),k})()]}})),o(_,r(U,{store:c,children:"提交"})),d})(),r(ve,{get store(){return n.seasonSelectDialog},get children(){const d=Ii();return o(d,r(fs,{get store(){return n.seasonSelect}})),d}}),r(ve,{get store(){return n.movieSelectDialog},get children(){const d=Ii();return o(d,r(rn,{get store(){return n.movieSelect}})),d}})]};Pe(["click"]);async function sv(t){const e=await Nt.post("/api/admin/short_link",{url:t});return e.error?P.Err(e.error.message):P.Ok(e.data.url)}const ht={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},yt={L:1,M:0,Q:3,H:2},Ot={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},Ke={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo(t){let e=t<<10;for(;Ke.getBCHDigit(e)-Ke.getBCHDigit(Ke.G15)>=0;)e^=Ke.G15<<Ke.getBCHDigit(e)-Ke.getBCHDigit(Ke.G15);return(t<<10|e)^Ke.G15_MASK},getBCHTypeNumber(t){let e=t<<12;for(;Ke.getBCHDigit(e)-Ke.getBCHDigit(Ke.G18)>=0;)e^=Ke.G18<<Ke.getBCHDigit(e)-Ke.getBCHDigit(Ke.G18);return t<<12|e},getBCHDigit(t){let e=0;for(;t!=0;)e++,t>>>=1;return e},getPatternPosition(t){return Ke.PATTERN_POSITION_TABLE[t-1]},getMask(t,e,s){switch(t){case Ot.PATTERN000:return(e+s)%2==0;case Ot.PATTERN001:return e%2==0;case Ot.PATTERN010:return s%3==0;case Ot.PATTERN011:return(e+s)%3==0;case Ot.PATTERN100:return(Math.floor(e/2)+Math.floor(s/3))%2==0;case Ot.PATTERN101:return e*s%2+e*s%3==0;case Ot.PATTERN110:return(e*s%2+e*s%3)%2==0;case Ot.PATTERN111:return(e*s%3+(e+s)%2)%2==0;default:throw new Error(`bad maskPattern:${t}`)}},getErrorCorrectPolynomial(t){let e=new ds([1],0);for(let s=0;s<t;s++)e=e.multiply(new ds([1,st.gexp(s)],0));return e},getLengthInBits(t,e){if(e>=1&&e<10)switch(t){case ht.MODE_NUMBER:return 10;case ht.MODE_ALPHA_NUM:return 9;case ht.MODE_8BIT_BYTE:return 8;case ht.MODE_KANJI:return 8;default:throw new Error(`mode:${t}`)}else if(e<27)switch(t){case ht.MODE_NUMBER:return 12;case ht.MODE_ALPHA_NUM:return 11;case ht.MODE_8BIT_BYTE:return 16;case ht.MODE_KANJI:return 10;default:throw new Error(`mode:${t}`)}else if(e<41)switch(t){case ht.MODE_NUMBER:return 14;case ht.MODE_ALPHA_NUM:return 13;case ht.MODE_8BIT_BYTE:return 16;case ht.MODE_KANJI:return 12;default:throw new Error(`mode:${t}`)}else throw new Error(`type:${e}`)},getLostPoint(t){const e=t.getModuleCount();let s=0;for(var n=0;n<e;n++)for(var i=0;i<e;i++){let c=0;const d=t.isDark(n,i);for(let u=-1;u<=1;u++)if(!(n+u<0||e<=n+u))for(let f=-1;f<=1;f++)i+f<0||e<=i+f||u==0&&f==0||d==t.isDark(n+u,i+f)&&c++;c>5&&(s+=3+c-5)}for(let c=0;c<e-1;c+=1)for(let d=0;d<e-1;d+=1){let u=0;t.isDark(c,d)&&u++,t.isDark(c+1,d)&&u++,t.isDark(c,d+1)&&u++,t.isDark(c+1,d+1)&&u++,(u==0||u==4)&&(s+=3)}for(var n=0;n<e;n++)for(var i=0;i<e-6;i++)t.isDark(n,i)&&!t.isDark(n,i+1)&&t.isDark(n,i+2)&&t.isDark(n,i+3)&&t.isDark(n,i+4)&&!t.isDark(n,i+5)&&t.isDark(n,i+6)&&(s+=40);for(var i=0;i<e;i++)for(var n=0;n<e-6;n++)t.isDark(n,i)&&!t.isDark(n+1,i)&&t.isDark(n+2,i)&&t.isDark(n+3,i)&&t.isDark(n+4,i)&&!t.isDark(n+5,i)&&t.isDark(n+6,i)&&(s+=40);let l=0;for(var i=0;i<e;i++)for(var n=0;n<e;n++)t.isDark(n,i)&&l++;const a=Math.abs(100*l/e/e-50)/5;return s+=a*10,s}},st={glog(t){if(t<1)throw new Error(`glog(${t})`);return st.LOG_TABLE[t]},gexp(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return st.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};(()=>{for(let t=0;t<8;t+=1)st.EXP_TABLE[t]=1<<t;for(let t=8;t<256;t+=1)st.EXP_TABLE[t]=st.EXP_TABLE[t-4]^st.EXP_TABLE[t-5]^st.EXP_TABLE[t-6]^st.EXP_TABLE[t-8];for(let t=0;t<255;t+=1)st.LOG_TABLE[st.EXP_TABLE[t]]=t})();class ds{num;constructor(e,s){if(e.length===void 0)throw new Error(`${e.length}/${s}`);let n=0;for(;n<e.length&&e[n]===0;)n++;this.num=new Array(e.length-n+s);for(let i=0;i<e.length-n;i+=1)this.num[i]=e[i+n]}get(e){return this.num[e]}getLength(){return this.num.length}multiply(e){const s=new Array(this.getLength()+e.getLength()-1);for(let n=0;n<this.getLength();n++)for(let i=0;i<e.getLength();i++)s[n+i]^=st.gexp(st.glog(this.get(n))+st.glog(e.get(i)));return new ds(s,0)}mod(e){if(this.getLength()-e.getLength()<0)return this;const s=st.glog(this.get(0))-st.glog(e.get(0)),n=new Array(this.getLength());for(let i=0;i<this.getLength();i++)n[i]=this.get(i);for(let i=0;i<e.getLength();i++)n[i]^=st.gexp(st.glog(e.get(i))+s);return new ds(n,0).mod(e)}}class nv{mode;parsedData;data;constructor(e){this.mode=ht.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(let s=0,n=this.data.length;s<n;s++){const i=[],l=this.data.charCodeAt(s);l>65536?(i[0]=240|(l&1835008)>>>18,i[1]=128|(l&258048)>>>12,i[2]=128|(l&4032)>>>6,i[3]=128|l&63):l>2048?(i[0]=224|(l&61440)>>>12,i[1]=128|(l&4032)>>>6,i[2]=128|l&63):l>128?(i[0]=192|(l&1984)>>>6,i[1]=128|l&63):i[0]=l,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}getLength(){return this.parsedData.length}write(e){for(let s=0,n=this.parsedData.length;s<n;s++)e.put(this.parsedData[s],8)}}class as{static PAD0=236;static PAD1=17;static createData=function(e,s,n){const i=It.getRSBlocks(e,s),l=new iv;for(let c=0;c<n.length;c+=1){const d=n[c];l.put(d.mode,4),l.put(d.getLength(),Ke.getLengthInBits(d.mode,e)),d.write(l)}let a=0;for(let c=0;c<i.length;c+=1)a+=i[c].dataCount;if(l.getLengthInBits()>a*8)throw new Error(`code length overflow. (${l.getLengthInBits()}>${a*8})`);for(l.getLengthInBits()+4<=a*8&&l.put(0,4);l.getLengthInBits()%8!==0;)l.putBit(!1);for(;!(l.getLengthInBits()>=a*8||(l.put(as.PAD0,8),l.getLengthInBits()>=a*8));)l.put(as.PAD1,8);return as.createBytes(l,i)};static createBytes=function(e,s){let n=0,i=0,l=0;const a=new Array(s.length),c=new Array(s.length);for(let g=0;g<s.length;g+=1){const C=s[g].dataCount,v=s[g].totalCount-C;i=Math.max(i,C),l=Math.max(l,v),a[g]=new Array(C);for(let _=0;_<a[g].length;_+=1)a[g][_]=255&e.buffer[_+n];n+=C;const w=Ke.getErrorCorrectPolynomial(v),E=new ds(a[g],w.getLength()-1).mod(w);c[g]=new Array(w.getLength()-1);for(let _=0;_<c[g].length;_+=1){const k=_+E.getLength()-c[g].length;c[g][_]=k>=0?E.get(k):0}}let d=0;for(let g=0;g<s.length;g+=1)d+=s[g].totalCount;const u=new Array(d);let f=0;for(let g=0;g<i;g+=1)for(let C=0;C<s.length;C+=1)g<a[C].length&&(u[f++]=a[C][g]);for(var p=0;p<l;p++)for(var m=0;m<s.length;m++)p<c[m].length&&(u[f++]=c[m][p]);return u};typeNumber;errorCorrectLevel;modules=[];moduleCount;dataCache;dataList;constructor(e,s){this.typeNumber=e,this.errorCorrectLevel=s,this.modules=[],this.moduleCount=0,this.dataCache=null,this.dataList=[]}addData(e){const s=new nv(e);this.dataList.push(s),this.dataCache=null}isDark(e,s){if(e<0||this.moduleCount<=e||s<0||this.moduleCount<=s)throw new Error(`${e},${s}`);return this.modules[e][s]}getModuleCount(){return this.moduleCount}make(){this.makeImpl(!1,this.getBestMaskPattern())}makeImpl(e,s){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(let n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(let i=0;i<this.moduleCount;i++)this.modules[n][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,s),this.typeNumber>=7&&this.setupTypeNumber(e),this.dataCache==null&&(this.dataCache=as.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,s)}setupPositionProbePattern(e,s){for(let n=-1;n<=7;n++)if(!(e+n<=-1||this.moduleCount<=e+n))for(let i=-1;i<=7;i++)s+i<=-1||this.moduleCount<=s+i||(n>=0&&n<=6&&(i==0||i==6)||i>=0&&i<=6&&(n==0||n==6)||n>=2&&n<=4&&i>=2&&i<=4?this.modules[e+n][s+i]=!0:this.modules[e+n][s+i]=!1)}getBestMaskPattern(){let e=0,s=0;for(let n=0;n<8;n++){this.makeImpl(!0,n);const i=Ke.getLostPoint(this);(n==0||e>i)&&(e=i,s=n)}return s}setupTimingPattern(){for(let e=8;e<this.moduleCount-8;e++)this.modules[e][6]==null&&(this.modules[e][6]=e%2==0);for(let e=8;e<this.moduleCount-8;e++)this.modules[6][e]==null&&(this.modules[6][e]=e%2==0)}setupPositionAdjustPattern(){const e=Ke.getPatternPosition(this.typeNumber);for(let s=0;s<e.length;s++)for(let n=0;n<e.length;n++){const i=e[s],l=e[n];if(this.modules[i][l]==null)for(let a=-2;a<=2;a++)for(let c=-2;c<=2;c++)a==-2||a==2||c==-2||c==2||a==0&&c==0?this.modules[i+a][l+c]=!0:this.modules[i+a][l+c]=!1}}setupTypeNumber(e){const s=Ke.getBCHTypeNumber(this.typeNumber);for(var n=0;n<18;n++){var i=!e&&(s>>n&1)==1;this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=i}for(var n=0;n<18;n++){var i=!e&&(s>>n&1)==1;this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=i}}setupTypeInfo(e,s){const n=this.errorCorrectLevel<<3|s,i=Ke.getBCHTypeInfo(n);for(var l=0;l<15;l++){var a=!e&&(i>>l&1)==1;l<6?this.modules[l][8]=a:l<8?this.modules[l+1][8]=a:this.modules[this.moduleCount-15+l][8]=a}for(var l=0;l<15;l++){var a=!e&&(i>>l&1)==1;l<8?this.modules[8][this.moduleCount-l-1]=a:l<9?this.modules[8][15-l-1+1]=a:this.modules[8][15-l-1]=a}this.modules[this.moduleCount-8][8]=!e}mapData(e,s){let n=-1,i=this.moduleCount-1,l=7,a=0;for(let c=this.moduleCount-1;c>0;c-=2)for(c==6&&c--;;){for(let d=0;d<2;d++)if(this.modules[i][c-d]==null){let u=!1;a<e.length&&(u=(e[a]>>>l&1)==1),Ke.getMask(s,i,c-d)&&(u=!u),this.modules[i][c-d]=u,l--,l==-1&&(a++,l=7)}if(i+=n,i<0||this.moduleCount<=i){i-=n,n=-n;break}}}}class It{static RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];static getRSBlocks=function(e,s){const n=It.getRsBlockTable(e,s);if(n==null)throw new Error(`bad rs block @ typeNumber:${e}/errorCorrectLevel:${s}`);const i=n.length/3,l=[];for(let a=0;a<i;a++){const c=n[a*3+0],d=n[a*3+1],u=n[a*3+2];for(let f=0;f<c;f++)l.push(new It(d,u))}return l};static getRsBlockTable=function(e,s){switch(s){case yt.L:return It.RS_BLOCK_TABLE[(e-1)*4+0];case yt.M:return It.RS_BLOCK_TABLE[(e-1)*4+1];case yt.Q:return It.RS_BLOCK_TABLE[(e-1)*4+2];case yt.H:return It.RS_BLOCK_TABLE[(e-1)*4+3];default:return}};totalCount;dataCount;constructor(e,s){this.totalCount=e,this.dataCount=s}}class iv{length;buffer;constructor(){this.buffer=[],this.length=0}get(e){const s=Math.floor(e/8);return(this.buffer[s]>>>7-e%8&1)==1}put(e,s){for(let n=0;n<s;n++)this.putBit((e>>>s-n-1&1)==1)}getLengthInBits(){return this.length}putBit(e){const s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),e&&(this.buffer[s]|=128>>>this.length%8),this.length++}}const ns=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function rv(){let t=!1;const e=navigator.userAgent;if(/android/i.test(e)){t=!0;const s=e.toString().match(/android ([0-9]\.[0-9])/i);s&&s[1]&&(t=parseFloat(s[1]))}return t}class lv{_bIsPainted;_htOption;_elCanvas;_oContext;_bSupportDataURI;_oDrawing=null;constructor(e){this._bIsPainted=!1,this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null}async drawLogo(e){const s=this._oContext;return new Promise((n,i)=>{const l=document.createElement("img");l.src=e,l.crossOrigin="anonymous",l.onload=a=>{s.drawImage(l,101,101,54,54),n(l)},l.onerror=()=>{i(new Error("logo loaded failed"))}})}draw(e){const{_oContext:s}=this,{_htOption:n}=this,i=e.getModuleCount(),l=n.width/i,a=n.height/i,c=Math.round(l),d=Math.round(a);this.clear();for(let u=0;u<i;u++)for(let f=0;f<i;f++){const p=e.isDark(u,f),m=f*l,g=u*a;s.strokeStyle=p?n.colorDark:n.colorLight,s.lineWidth=1,s.fillStyle=p?n.colorDark:n.colorLight,s.fillRect(m,g,l,a),s.strokeRect(Math.floor(m)+.5,Math.floor(g)+.5,c,d),s.strokeRect(Math.ceil(m)-.5,Math.ceil(g)-.5,c,d)}this._bIsPainted=!0}isPainted(){return this._bIsPainted}clear(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1}round(e){return e&&Math.floor(e*1e3)/1e3}}function ov(t,e){let s=1;const n=av(t);for(let i=0,l=ns.length;i<=l;i++){let a=0;switch(e){case yt.L:a=ns[i][0];break;case yt.M:a=ns[i][1];break;case yt.Q:a=ns[i][2];break;case yt.H:a=ns[i][3];break}if(n<=a)break;s++}if(s>ns.length)throw new Error("Too long data");return s}function av(t){const e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}class cv{static CorrectLevel=yt;_htOption;_android;_oQRCode=null;_oDrawing;constructor(e){this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:yt.H,text:""};const s=(()=>typeof e=="string"?{text:e}:e||{})();for(const n in s)this._htOption[n]=s[n];this._android=rv(),this._oQRCode=null,this._oDrawing=new lv(this._htOption)}async makeCode(e,s={}){if([void 0,null,""].includes(e))return;this._oQRCode=new as(ov(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._oDrawing.draw(this._oQRCode);const{logo:n}=s;return n!==void 0&&await this._oDrawing.drawLogo.call(this,n),this._oDrawing._elCanvas.toDataURL()}clear(){this._oDrawing.clear()}}const Vi=new cv,dv=Vi.makeCode.bind(Vi),uv=h("<img>");function hv(t){const{text:e,logo:s,...n}=t,[i,l]=z("");return tt(async()=>{const a=await dv(e,{logo:s});a&&l(a)}),(()=>{const a=uv();return oe(c=>{const d=t.class,u=t.style,f=i();return d!==c._v$&&be(a,c._v$=d),c._v$2=Ns(a,u,c._v$2),f!==c._v$3&&xe(a,"src",c._v$3=f),c},{_v$:void 0,_v$2:void 0,_v$3:void 0}),a})()}class fv extends $e{values=[];constructor(e={}){super(e);const{onChange:s}=e;s&&this.onStateChange(s)}toggle(e){if(this.values.includes(e)){this.remove(e);return}this.select(e)}select(e){this.values.includes(e)||(this.values.push(e),this.emit(0,[...this.values]))}remove(e){this.values.includes(e)&&(this.values=this.values.filter(s=>s!==e),this.emit(0,[...this.values]))}isEmpty(){return this.values.length===0}clear(){this.values=[],this.emit(0,[...this.values])}onStateChange(e){return this.on(0,e)}}const pv=h('<h1 class="text-2xl">成员列表(<!>)'),mv=h('<div class="space-y-8">'),gv=h('<div class="mt-8"><div class="flex items-center space-x-2"></div><div class="flex items-center space-x-2 mt-4"></div><div class="mt-4">'),gn=h('<div class="w-[520px]">'),vv=h('<div class="w-[520px]"><div>确认删除该成员吗？'),_v=h('<div class="w-[520px]"><pre class="p-2 w-bg-0 rounded-md">'),Ai=h('<div class="space-y-2">'),$v=h('<div class="w-[520px] h-[360px] overflow-y-auto">'),wv=h('<div class="space-y-8"><div class="card rounded-sm bg-white p-4"><div class="flex items-center"></div><div class="mt-4"><div class="flex space-x-2"></div><div class="mt-4 space-y-8"><div class="space-y-2"><div class="flex">'),xv=h('<div class="flex items-center text-gray-600"><div></div><div class="mx-2">/'),bv=h('<div class="mt-4 space-y-8">'),Cv=h('<div class="card rounded-sm bg-white p-4"><div class="flex items-center"><div class="flex items-center justify-center w-12 h-12 bg-slate-300 rounded-full mr-2"><div class="text-3xl text-slate-500"></div></div><div><div class="flex text-2xl"><p class=""></div></div></div><div class="mt-4"><div class="space-x-2">'),Sv=h('<div class="flex"><div><a target="_blank">'),yv=h('<div class="flex items-center space-x-2 px-8 py-4"><div>'),kv=h('<div><div class="text-lg"></div><div class="text-sm">');function Lv(t){const{app:e,client:s,storage:n,history:i}=t,l=new Oe(new I(ma),{onLoadingChange(b){w.setLoading(b)}}),a=new I($a,{onLoading(b){A.okBtn.setLoading(b)},onSuccess(){e.tip({text:["权限更新成功"]}),A.hide(),B.clear()},onFailed(b){e.tip({text:["权限更新失败",b.message]})},onCompleted(){B.clear()}}),c=new Fe,d=new I(va,{onLoading(b){O.setLoading(b)},onFailed(b){e.tip({text:["生成 token 失败",b.message]})},onSuccess(){l.refresh()}}),u=new I(ga,{onLoading(b){m.okBtn.setLoading(b),m.cancelBtn.setLoading(b)},onFailed(b){e.tip({text:["新增成员失败",b.message]})},onSuccess(b){m.hide(),g.clear(),l.refresh()}}),f=new Oe(new I(Ba,{process:Ea})),p=new Fe,m=new ge({title:"新增成员",onOk(){if(!g.value){e.tip({text:["请先输入成员备注"]});return}u.run({remark:g.value})}}),g=new _e({defaultValue:"",placeholder:"请输入备注",onEnter(){m.okBtn.click()}}),C=new Q({onClick(){i.push("root.home_layout.permission")}}),v=new Q({onClick(){m.show()}}),w=new Q({onClick(){l.refresh()}}),$=new _e({defaultValue:"",placeholder:"请输入名称或邮箱搜索",onEnter(){E.click()}}),E=new Q({onClick(){l.search({name:$.value})}}),_=new Q({onClick(){l.reset(),$.clear()}}),k=new Ae({onClick(b){f.init({member_id:b.id}),H.show()}}),T=new Ae({onClick(b){p.select(b),M.dialog.show()}}),O=new Ae({onClick(b){if(b===null){e.tip({text:["请先选择生成链接的成员"]});return}d.run({id:b.id})}}),F=new Ae({onClick(b){e.tip({text:["敬请期待"]})}}),x=new Ae({onClick(b){p.select(b),S.init(),A.show()}}),V=new Ae({onClick(b){b!==null&&(c.select(b),R.setTitle(`删除成员 '${b.remark}'`),R.show())}}),N=new I(_a,{onLoading(b){R.okBtn.setLoading(b)},onSuccess(){e.tip({text:["删除成员成功"]}),R.hide(),l.refresh()},onFailed(b){e.tip({text:["删除成员失败",b.message]})}}),y=new ge({title:"账号",footer:!1,onOk(){const b=c.value;if(b===null){e.tip({text:["请先选择要删除的成员"]});return}N.run({id:b.id})},onCancel(){R.hide()}}),R=new ge({title:"删除成员",onOk(){const b=c.value;if(b===null){e.tip({text:["请先选择要删除的成员"]});return}N.run({id:b.id})},onCancel(){R.hide()}}),M=new Ds({async onOk(){const b=p.value;if(!b||!M.value)return;const{tokens:L}=b,W=L[0];if(!W)return;const{name:D,id:K}=M.value,te=`${window.location.origin}/mobile/tv_play?id=${K}&season_id=${K}&rate=1.5&hide_menu=1&token=${W.id}`,ee=await sv(te);if(ee.error)return;const se=ee.data,he=`➤➤➤ ${D}
${se}`;e.copy(he),e.tip({text:["已复制到剪贴板"]}),M.dialog.hide()}}),J=new Ue({async onReachBottom(){await l.loadMore(),J.finishLoadingMore()}}),S=new Oe(new I(fr)),A=new ge({title:"权限配置",onOk(){if(!p.value){e.tip({text:["请先选择成员"]});return}a.run({member_id:p.value.id,permissions:B.values.map(b=>b.code)})}}),B=new fv({}),H=new ge({title:"播放历史",footer:!1});return{$memberList:l,$permissionList:S,$permissionMultipleSelect:B,$historyList:f,ui:{$scroll:J,$refreshBtn:w,$addMemberBtn:v,$permissionBtn:C,$nameInput:$,$searchBtn:E,$resetBtn:_,$profile:k,$link:T,$update:x,$ban:F,$delete:V,$seasonSelect:M,$memberAccountsDialog:y,$permissionDialog:A,$addMemberDialog:m,$remarkInput:g,$confirmDeleteMemberDialog:R,$historyDialog:H}}}const Pv=t=>{const{app:e,history:s,client:n,view:i}=t,l=Lv(t),[a,c]=z(l.$memberList.response),[d,u]=z(l.$historyList.response),[f,p]=z(l.$permissionList.response),[m,g]=z(l.$permissionMultipleSelect.values),[C,v]=z("");return l.$permissionList.onStateChange(w=>p(w)),l.$memberList.onStateChange(w=>c(w)),l.$historyList.onStateChange(w=>u(w)),l.$permissionMultipleSelect.onStateChange(w=>g(w)),l.$memberList.init(),[r(We,{get store(){return l.ui.$scroll},class:"h-screen p-8",get children(){return[(()=>{const w=pv(),$=w.firstChild,E=$.nextSibling;return E.nextSibling,o(w,()=>a().total,E),w})(),(()=>{const w=gv(),$=w.firstChild,E=$.nextSibling,_=E.nextSibling;return o($,r(U,{get icon(){return r(Zt,{class:"w-4 h-4"})},get store(){return l.ui.$refreshBtn},children:"刷新"}),null),o($,r(U,{class:"",get store(){return l.ui.$resetBtn},children:"重置"}),null),o($,r(U,{get store(){return l.ui.$addMemberBtn},get icon(){return r(ro,{class:"w-4 h-4"})},children:"新增成员"}),null),o($,r(U,{get store(){return l.ui.$permissionBtn},get icon(){return r(In,{class:"w-4 h-4"})},children:"权限"}),null),o(E,r(Le,{class:"",get store(){return l.ui.$nameInput}}),null),o(E,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},get store(){return l.ui.$searchBtn},children:"搜索"}),null),o(_,r(Ye,{get store(){return l.$memberList},get skeleton(){return(()=>{const k=wv(),T=k.firstChild,O=T.firstChild,F=O.nextSibling,x=F.firstChild,V=x.nextSibling,N=V.firstChild,y=N.firstChild;return o(O,r(j,{class:"w-12 h-12 rounded-full mr-2"}),null),o(O,r(j,{class:"w-36 h-8"}),null),o(x,r(j,{class:"w-24 h-10"}),null),o(x,r(j,{class:"w-24 h-10"}),null),o(x,r(j,{class:"w-24 h-10"}),null),o(N,r(j,{class:"w-[480px] h-6 mr-4"}),y),o(y,r(j,{class:"w-[120px] h-[120px] mr-4"}),null),o(y,r(j,{class:"w-[360px] h-6 mr-4"}),null),k})()},get children(){const k=mv();return o(k,r(ie,{get each(){return a().dataSource},children:T=>{const{inviter:O,remark:F,email:x,tokens:V}=T;return(()=>{const N=Cv(),y=N.firstChild,R=y.firstChild,M=R.firstChild,J=R.nextSibling,S=J.firstChild,A=S.firstChild,B=y.nextSibling,H=B.firstChild;return o(M,()=>F.slice(0,1).toUpperCase()),o(S,r(X,{when:O,get children(){const b=xv(),L=b.firstChild;return o(L,()=>O?.remark),b}}),A),o(A,F),o(J,r(X,{when:x,children:x}),null),o(H,r(U,{variant:"subtle",get icon(){return r(lo,{class:"w-4 h-4"})},get store(){return l.ui.$profile.bind(T)},children:"详情"}),null),o(H,r(U,{variant:"subtle",get icon(){return r(oo,{class:"w-4 h-4"})},get store(){return l.ui.$delete.bind(T)},children:"删除"}),null),o(B,r(X,{get when(){return V.length!==0},fallback:null,get children(){const b=bv();return o(b,r(ie,{each:V,children:L=>{const{id:W,used:D}=L;return(()=>{const K=Ai();return o(K,()=>[{prefix:"/pc/home/index?tmp=1&token=",qrcode:!1},{prefix:"/mobile/home/index?tmp=1&token=",qrcode:!0}].map(te=>{const{prefix:ee,qrcode:se}=te,he=`${s.$router.origin}${ee}${W}`;return(()=>{const ae=Sv(),fe=ae.firstChild,le=fe.firstChild;return o(ae,r(X,{when:se,get children(){return r(hv,{class:"w-[120px] h-[120px] mr-4",text:he})}}),fe),xe(le,"href",he),o(le,he),oe(()=>be(fe,de("text-lg text-slate-700 break-all whitespace-pre-wrap",D?"line-through":""))),ae})()})),K})()}})),b}}),null),N})()}})),k}})),w})()]}}),r(ve,{title:"新增成员",get store(){return l.ui.$addMemberDialog},get children(){const w=gn();return o(w,r(Le,{get store(){return l.ui.$remarkInput}})),w}}),r(ve,{title:"删除成员",get store(){return l.ui.$confirmDeleteMemberDialog},get children(){return vv()}}),r(ve,{get store(){return l.ui.$permissionDialog},get children(){const w=gn();return o(w,r(Ye,{get store(){return l.$permissionList},class:"space-y-8",get children(){return r(ie,{get each(){return f().dataSource},children:$=>{const{code:E,desc:_}=$;return(()=>{const k=yv(),T=k.firstChild;return k.$$click=()=>{l.$permissionMultipleSelect.toggle($)},o(T,_),oe(O=>pt(T,{"p-2 rounded-sm":!0,"bg-slate-500":m().includes($)},O)),k})()}})}})),w}}),r(ve,{get store(){return l.ui.$memberAccountsDialog},get children(){const w=_v(),$=w.firstChild;return $.$$click=()=>{e.copy(C()),e.tip({text:["复制成功"]})},o($,C),w}}),r(ve,{get store(){return l.ui.$historyDialog},get children(){const w=$v();return o(w,r(Ye,{get store(){return l.$historyList},get children(){const $=Ai();return o($,r(ie,{get each(){return d().dataSource},children:E=>{const{name:_,source:k,updated:T}=E;return(()=>{const O=kv(),F=O.firstChild,x=F.nextSibling;return o(F,_),o(x,T),O})()}})),$}})),w}}),r(ve,{get store(){return l.ui.$seasonSelect.dialog},get children(){const w=gn();return o(w,r(fs,{get store(){return l.ui.$seasonSelect}})),w}})]};Pe(["click"]);const Rv=h('<h1 class="text-2xl">问题列表'),Dv=h('<div class="mt-8 flex space-x-2">'),Mv=h('<div class="space-y-4">'),zi=h('<div class="w-[520px]"><div class="mb-2">'),Tv=h('<div class="p-4 rounded-sm bg-white"><div><div class="flex space-x-4"></div><div class="flex space-x-2">'),Bv=h('<div class="my-2 p-2 bg-gray-100 rounded-sm">'),Ev=h('<div><div class="mr-4"><div class="relative"><div class="w-16 h-16 rounded-full bg-slate-200"></div><div class="absolute left-[50%] translate-x-[-50%] bottom-0"><div class="px-2 text-sm bg-white rounded-sm"></div></div></div></div><div class="flex-1"><h2 class="text-xl"></h2><div class="flex space-x-4"><div></div><div class="flex items-center space-x-1"><div></div></div></div><div class="mt-2 flex items-center space-x-2">'),Fv=h('<div class="flex p-2 bg-gray-100 rounded-sm"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 w-0"><div class="flex items-center"><h2 class="text-2xl text-slate-800"><a></a><div>');function vn(t){const{type:e,data:s,member:n,media:i,media_source:l}=t;return e===ct.Want?i?`${i.name}」已收录，点击观看`:"你想看的电视剧/电影已收录":e===ct.Movie&&i&&i.type===Me.Movie?`电影《${i.name}》的问题 '${s}' 已解决`:e===ct.TV&&i&&i.type===Me.Season?`电视剧《${i.name}》的问题 '${s}' 已解决`:`你反馈的问题 '${s}' 已解决`}const Ov=t=>{const{app:e,history:s,view:n}=t,i=new Fe,l=new Oe(new I(wa,{process:xa}),{}),a=new I(La,{}),c=new ge({title:"回复",async onOk(){if(!i.value){e.tip({text:["请先选择要回复的问题/反馈"]});return}if(!d.value){e.tip({text:[d.placeholder]});return}c.okBtn.setLoading(!0);const R=await a.run({report_id:i.value.id,content:d.value});if(c.okBtn.setLoading(!1),R.error){e.tip({text:["回复失败",R.error.message]});return}e.tip({text:["回复成功"]}),c.hide()},onCancel(){i.clear(),d.clear()}}),d=new _e({defaultValue:"",placeholder:"请输入回复内容"}),u=new Ae({onClick(R){i.select(R),d.setValue(vn(R)),c.show()}}),f=new Ds({onSelect(R){i.value?.type===ct.Want&&d.setValue(`你想看的电视剧「${R.name}」已收录，点击观看`)}}),p=new ge({title:"选择电视剧",async onOk(){if(!i.value){e.tip({text:["请先选择要回复的问题/反馈"]});return}if(!d.value){e.tip({text:[d.placeholder]});return}if(!f.value){e.tip({text:["请选择电视剧"]});return}p.okBtn.setLoading(!0);const{id:R,name:M,poster_path:J,air_date:S}=f.value,A=await a.run({report_id:i.value.id,content:d.value,media_id:R});if(p.okBtn.setLoading(!1),A.error){e.tip({text:["回复失败",A.error.message]});return}e.tip({text:["回复成功"]}),p.hide()},onCancel(){i.clear(),f.clear(),d.clear()}}),m=new Ae({onClick(R){i.select(R),R.media&&R.media.type===Me.Season&&(f.nameInput.setValue(R.media.name),f.list.search({name:R.media.name})),d.setValue(vn(R)),p.show()}}),g=new Oe(new I(Kn,{process:Xn}),{onLoadingChange(R){v.setLoading(R)}}),C=new _e({defaultValue:"",placeholder:"请输入名称搜索",onEnter(){v.click()}}),v=new Q({onClick(){g.search({name:C.value})}}),w=new ti({onSelect(R){i.value?.type===ct.Want&&d.setValue(`你想看的电影「${R.name}」已收录，点击观看`)}}),$=new ge({title:"选择电影",async onOk(){if(!i.value){e.tip({text:["请先选择要回复的问题/反馈"]});return}if(!d.value){e.tip({text:[d.placeholder]});return}if(!w.value){e.tip({text:["请选择电影"]});return}$.okBtn.setLoading(!0);const R=await a.run({report_id:i.value.id,content:d.value,media_id:w.value.id});if($.okBtn.setLoading(!1),R.error){e.tip({text:["回复失败",R.error.message]});return}e.tip({text:["回复成功"]}),$.hide()},onCancel(){i.clear(),d.clear()}}),E=new Ae({onClick(R){i.select(R),(()=>{if(R.media&&R.media.type===Me.Movie){C.setValue(R.media.name),g.search({name:R.media.name});return}g.init()})(),d.setValue(vn(R)),$.show()}}),_=new Q({onClick(){Xs(),l.refresh()}}),k=new Ue,T=new Ze({}),[O,F]=z(l.response),[x,V]=z(g.response);g.onStateChange(R=>V(R)),l.onLoadingChange(R=>{_.setLoading(R)}),l.onStateChange(R=>F(R)),k.onReachBottom(async()=>{await l.loadMore(),k.finishLoadingMore()}),l.init();const N={[ct.TV]:()=>r(Bn,{class:"w-4 h-4"}),[ct.Movie]:()=>r(Gt,{class:"w-4 h-4"}),[ct.Question]:()=>r(tr,{class:"w-4 h-4"}),[ct.Want]:()=>r(Ys,{class:"w-4 h-4"})},y=()=>O().dataSource;return[r(We,{store:k,class:"h-screen p-8",get children(){return[Rv(),(()=>{const R=Dv();return o(R,r(U,{class:"space-x-1",get icon(){return r(xt,{class:"w-4 h-4"})},store:_,children:"刷新"})),R})(),r(Ye,{class:"mt-4",store:l,get skeleton(){return(()=>{const R=Tv(),M=R.firstChild,J=M.firstChild,S=J.nextSibling;return o(M,r(j,{class:"w-[240px] h-8"}),J),o(J,r(j,{class:"w-[320px] h-4"})),o(S,r(j,{class:"w-24 h-8"}),null),o(S,r(j,{class:"w-24 h-8"}),null),oe(()=>be(M,de("space-y-1"))),R})()},get children(){const R=Mv();return o(R,r(ie,{get each(){return y()},children:(M,J)=>{const{id:S,type:A,typeText:B,data:H,answer:b,media:L,member:W,created:D}=M;return(()=>{const K=Ev(),te=K.firstChild,ee=te.firstChild,se=ee.firstChild,he=se.nextSibling,ae=he.firstChild,fe=te.nextSibling,le=fe.firstChild,ce=le.nextSibling,Ce=ce.firstChild,G=Ce.nextSibling,re=G.firstChild,me=ce.nextSibling;return o(ae,()=>W.name),o(le,H),o(fe,r(X,{when:L,get children(){return(()=>{if(!L)return null;const pe=s.buildURLWithPrefix("root.home_layout.movie_profile",{id:L.id});return(()=>{const Re=Fv(),Te=Re.firstChild,ze=Te.nextSibling,Se=ze.firstChild,q=Se.firstChild,Z=q.firstChild,ne=Z.nextSibling;return o(Te,r(je,{class:"w-[68px] h-[102px]",get store(){return T.bind(L.poster_path)},get alt(){return L.name}})),xe(Z,"href",pe),o(Z,()=>L.name),o(ne,()=>L.type===Me.Movie?"电影":"电视剧"),Re})()})()}}),ce),o(fe,r(X,{when:!!b,get children(){const pe=Bv();return o(pe,b),pe}}),ce),o(Ce,D),o(G,r(On,{get component(){return N[A]}}),re),o(re,B),o(me,r(U,{get store(){return u.bind(M)},variant:"subtle",children:"回复"}),null),o(me,r(U,{get store(){return m.bind(M)},variant:"subtle",children:"选择电视剧"}),null),o(me,r(U,{get store(){return E.bind(M)},variant:"subtle",children:"选择电影"}),null),oe(pe=>{const Re=de("space-y-1 flex p-4 rounded-sm bg-white"),Te=de({});return Re!==pe._v$&&be(K,pe._v$=Re),Te!==pe._v$2&&be(re,pe._v$2=Te),pe},{_v$:void 0,_v$2:void 0}),K})()}})),R}})]}}),r(ve,{store:c,get children(){return r(gt,{store:d})}}),r(ve,{store:p,get children(){const R=zi(),M=R.firstChild;return o(M,r(gt,{store:d})),o(R,r(fs,{store:f}),null),R}}),r(ve,{store:$,get children(){const R=zi(),M=R.firstChild;return o(M,r(gt,{store:d})),o(R,r(rn,{store:w}),null),R}})]},Iv=h('<div class="p-8"><h1 class="text-2xl">权限管理</h1><div class="mt-8"><div class="space-x-2">'),Vv=h('<div class="mt-4">'),Av=h('<div class="w-[520px]">'),zv=h('<div class="px-8 py-4"><div class="">'),Nv=t=>{const{app:e}=t,s=new I(Pa,{onLoading(f){c.okBtn.setLoading(f)},onSuccess(){c.hide()}}),n=new Oe(new I(fr)),i=new Q({onClick(){n.refresh()}}),l=new _e({defaultValue:"",placeholder:"请填写权限描述",onEnter(){c.okBtn.click()}}),a=new Q({onClick(){c.show()}}),c=new ge({title:"新增权限",onOk(){if(!l.value){e.tip({text:[l.placeholder]});return}s.run({desc:l.value}),n.refresh()}}),[d,u]=z(n.response);return n.onStateChange(f=>{u(f)}),n.init(),[(()=>{const f=Iv(),p=f.firstChild,m=p.nextSibling,g=m.firstChild;return o(g,r(U,{get icon(){return r(Zt,{class:"w-4 h-4"})},store:i,children:"刷新"}),null),o(g,r(U,{store:a,get icon(){return r(In,{class:"w-4 h-4"})},children:"新增权限"}),null),f})(),(()=>{const f=Vv();return o(f,r(Ye,{store:n,class:"space-y-8",get children(){return r(ie,{get each(){return d().dataSource},children:p=>{const{code:m,desc:g}=p;return(()=>{const C=zv(),v=C.firstChild;return o(v,g),C})()}})}})),f})(),r(ve,{title:"新增权限",store:c,get children(){const f=Av();return o(f,r(Le,{store:l})),f}})]},Hv=h('<div class="absolute inset-0 pointer-events-none">'),qv=h('<div class="relative"><select>'),jv=h("<option>"),_n=t=>{const{store:e}=t,[s,n]=z(e.state);return e.onStateChange(i=>{n(i)}),(()=>{const i=qv(),l=i.firstChild;return o(i,r(X,{get when(){return s().value===null},get children(){const a=Hv();return o(a,()=>s().placeholder),a}}),l),l.addEventListener("change",a=>{const c=a.currentTarget.value;e.select(c)}),o(l,r(ie,{get each(){return s().options},children:a=>{const{label:c}=a;return(()=>{const d=jv();return o(d,c),oe(()=>d.value=a.value),d})()}})),oe(()=>l.classList.toggle("opacity-0",s().value===null)),oe(()=>l.value=s().value),i})()},Uv=h('<div class="absolute inset-0">'),Wv=h('<div class="w-full max-h-[360px] overflow-x-auto overflow-y-auto"><div class="p-4 keep-all white-space-nowrap">'),Yv=h('<div class="relative">');var jt=function(t){return t[t.Read=0]="Read",t[t.StateChange=1]="StateChange",t}(jt||{});class Gv extends $e{loading=!1;content=null;get state(){return{loading:this.loading,content:this.content}}constructor(e){super(e);const{onRead:s}=e;s&&this.onRead(s)}read(e){const s=new FileReader;this.loading=!0,this.emit(jt.StateChange,{...this.state}),s.onload=n=>{if(this.loading=!1,n.target){const i=n.target.result;this.content=i,this.emit(jt.Read,i)}this.emit(jt.StateChange,{...this.state})},s.readAsText(e)}clear(){this.content=null,this.emit(jt.StateChange,{...this.state})}onRead(e){return this.on(jt.Read,e)}onStateChange(e){return this.on(jt.StateChange,e)}}const Jv=t=>{const{store:e}=t,[s,n]=z(e.state);return e.onStateChange(i=>{n(i)}),(()=>{const i=Yv();return o(i,r(X,{get when(){return s().loading},get children(){const l=Uv();return o(l,r(Hs,{class:"w-8 h-8 animate animate-spin"})),l}}),null),o(i,r(X,{get when(){return!!s().content},get children(){const l=Wv(),a=l.firstChild;return o(a,()=>s().content),l}}),null),i})()},Kv=h("<div>"),Xv=t=>{const{ratio:e=1/1}=t;return(()=>{const s=Kv();return o(s,()=>t.children),oe(n=>{const i=t.class,l=`position: relative; width: 100%; padding-bottom: ${100/e}%;`;return i!==n._v$&&be(s,n._v$=i),n._v$2=Ns(s,l,n._v$2),n},{_v$:void 0,_v$2:void 0}),s})()},Qv=h('<h1 class="text-2xl">上传字幕'),Zv=h('<div class="flex"><div class="w-[160px] mr-4"></div><div class="flex-1"><div class="text-3xl"></div><div></div><div class="mt-8 space-x-2">'),e_=h('<div class="p-4"><div class="p-4 bg-white rounded-sm space-y-2"><div></div></div><div class="space-y-2 mt-8">'),t_=h('<div class="absolute bottom-0"><div class=" flex space-x-4 pt-8 w-full h-full"><div class="flex flex-1 space-x-2"></div><div class="relative flex-1"><div>'),s_=h('<div class="absolute bottom-0 py-4"><div class="flex rows-reverse">'),$n=h('<div class=" w-[520px]">'),n_=h('<div class="flex flex-col items-center w-[520px]"><div></div><div class="mt-4">正在上传中，请等待'),i_=h('<div><div class="space-x-2">'),r_=h('<div class="absolute inset-0 flex items-center justify-center cursor-pointer"><div class="p-4 text-center"><p>将文件拖拽至此或点击选择文件</p><input type="file" class="absolute inset-0 opacity-0 cursor-pointer">'),l_=h("<div>"),o_=h('<div class="p-4 bg-white rounded-sm space-y-2"><div class="flex items-center justify-between"><div class="text-xl break-all"></div><div class="flex items-center space-x-2"><div class=""></div><div></div></div></div><div>'),a_=t=>{const{app:e,view:s}=t,n=new I(Ra,{onFailed(S){e.tip({text:["校验失败",S.message]})},onSuccess(S){for(let A=0;A<S.length;A+=1){const B=S[A],H=u.bind(B.filename,{defaultValue:B.episode_text||""});if(H&&a.value){const L=B.episode_text.match(/E([0-9]{1,})/);if(!L)return;const W=a.value.episodes.find(D=>D.episode_number===Number(L[1]));if(!W)return;H.setValue(W.id)}const b=f.bind(B.filename,{defaultValue:B.language||""});b&&b.setValue(B.language)}}}),i=new I(Da,{onSuccess(S){it({job_id:S.job_id,onFinish(){e.tip({text:["上传完成"]}),T.hide(),n.clear(),E.clear(),_.clear(),g.clear()}})},onFailed(S){e.tip({text:["上传失败",S.message]}),T.hide()}}),l=new I(Ur,{process:Wr});new I(Yr,{process:Gr});const a=new Fe,c=new rl({onChange(S){E.clear(),_.clear(),f.clear(),g.clear(),n.run({filenames:S.map(A=>A.name)})}}),d=new hn({defaultValue:null}),u=new hn({defaultValue:""}),f=new hn({options:vi}),p=new Q({onClick(){m.show()}}),m=new ge({title:"选择电视剧",async onOk(){const S=g.value;if(!S){e.tip({text:["请选择电视剧"]});return}m.okBtn.setLoading(!0);const A=await l.run({season_id:S.id});if(m.okBtn.setLoading(!1),A.error){e.tip({text:["获取详情失败",A.error.message]});return}const{episodes:B}=A.data;if(u.setOptions(B.map(H=>({value:H.id,label:`${H.episode_number}、${H.name}`}))),x.setURL(S.poster_path),a.select({id:S.id,type:Me.Season,name:S.name,overview:S.overview,poster_path:S.poster_path,episodes:B}),m.hide(),n.response)for(let H=0;H<n.response.length;H+=1){const b=n.response[H],L=u.bind(b.filename,{defaultValue:b.episode_text||""});if(L&&a.value){const D=b.episode_text.match(/E([0-9]{1,})/);if(!D)return;const K=a.value.episodes.find(te=>te.episode_number===Number(D[1]));if(!K)return;L.setValue(K.id)}const W=f.bind(b.filename,{defaultValue:b.language||""});W&&W.setValue(b.language)}}}),g=new Ds({}),C=new Q({onClick(){v.show()}}),v=new ge({title:"选择电影",onOk(){const S=w.value;if(!S){e.tip({text:["请选择电影"]});return}x.setURL(S.poster_path),a.select({id:S.id,type:Me.Movie,name:S.name,overview:S.overview,poster_path:S.poster_path,episodes:[]}),v.hide()}}),w=new ti({}),$=new Q({onClick(){if(!n.response)return;const S=a.value;if(!S){e.tip({text:["请选择影视剧"]});return}if(S.type===Me.Season){const A=n.response.map(H=>{const{filename:b}=H,L=u.getValue(H.filename),W=f.getValue(H.filename),D=c.files.find(te=>te.name===b),K=[];return L===null&&K.push(`请为 ${b} 选择集`),W===null&&K.push(`请为 ${b} 选择语言`),D||K.push(`${b} 没有匹配的文件`),{filename:b,episode_id:L,language:W,file:D,errors:K}}),B=A.reduce((H,b)=>H.concat(b.errors),[]);if(B.length!==0){e.tip({text:B});return}T.show(),i.run({media_id:S.id,type:Me.Season,files:A.map(H=>{const{filename:b,episode_id:L,language:W,file:D}=H;return{filename:b,episode_id:L,language:W,file:D}})});return}if(S.type===Me.Movie){const A=n.response.map(H=>{const{filename:b}=H,L=f.getValue(H.filename),W=c.files.find(K=>K.name===b),D=[];return L===null&&D.push(`请为 ${b} 选择语言`),W||D.push(`${b} 没有匹配的文件`),{filename:b,language:L,file:W,errors:D}}),B=A.reduce((H,b)=>H.concat(b.errors),[]);if(B.length!==0){e.tip({text:B});return}T.show(),i.run({media_id:S.id,type:Me.Movie,files:A.map(H=>{const{filename:b,language:L,file:W}=H;return{filename:b,language:L,file:W}})});return}e.tip({text:["请先选择关联的影视剧"]})}}),E=new Cn({defaultValue:null,onChange(S){d.setValue(S)}}),_=new Cn({defaultValue:null,placeholder:"批量设置字幕语言",options:vi,onChange(S){f.setValue(S)}}),k=new ge({title:"内容预览",footer:!1}),T=new ge({title:"",footer:!1,closeable:!1}),O=new Gv({}),F=new Ue,x=new lt({}),[V,N]=z(c.state),[y,R]=z(a.value),[M,J]=z(n.response);return c.onStateChange(S=>{N(S)}),n.onResponseChange(S=>{J(S)}),a.onStateChange(S=>{R(S)}),[r(We,{store:F,class:"relative h-screen p-8",get children(){return[Qv(),(()=>{const S=t_(),A=S.firstChild,B=A.firstChild,H=B.nextSibling,b=H.firstChild;return S.style.setProperty("top","64px"),S.style.setProperty("left","32px"),S.style.setProperty("right","32px"),o(B,r(X,{get when(){return y()},get fallback(){return(()=>{const L=i_(),W=L.firstChild;return o(W,r(U,{store:p,children:"选择关联的电视剧"}),null),o(W,r(U,{store:C,children:"选择关联的电影"}),null),L})()},get children(){const L=Zv(),W=L.firstChild,D=W.nextSibling,K=D.firstChild,te=K.nextSibling,ee=te.nextSibling;return o(W,r(Xv,{ratio:3/4,get children(){return r(je,{class:"overflow-hidden absolute inset-0",store:x})}})),o(K,()=>y()?.name),o(te,()=>y()?.overview),o(ee,r(U,{store:p,children:"重新选择电视"}),null),o(ee,r(U,{store:C,children:"重新选择电影"}),null),L}})),b.addEventListener("drop",L=>{L.preventDefault(),c.handleDrop(Array.from(L.dataTransfer?.files||[]))}),b.addEventListener("dragleave",()=>{c.handleDragleave()}),b.addEventListener("dragover",L=>{L.preventDefault(),c.handleDragover()}),b.style.setProperty("bottom","128px"),o(b,r(X,{get when(){return M()?.length},get fallback(){return r_()},get children(){const L=e_(),W=L.firstChild,D=W.firstChild,K=W.nextSibling;return o(D,r(_n,{store:_})),o(K,r(ie,{get each(){return M()},children:te=>{const{filename:ee}=te;return(()=>{const se=o_(),he=se.firstChild,ae=he.firstChild,fe=ae.nextSibling,le=fe.firstChild,ce=le.nextSibling,Ce=he.nextSibling;return o(ae,ee),le.$$click=()=>{const G=c.getFileByName(ee);if(!G){e.tip({text:["没有匹配的文件"]});return}k.setTitle(ee),k.show(),O.read(G)},o(le,r(Ys,{class:"w-4 h-4 cursor-pointer"})),ce.$$click=()=>{n.modifyResponse(G=>G.filter(re=>re.filename!==ee))},o(ce,r(Dt,{class:"w-4 h-4 cursor-pointer"})),o(se,r(X,{get when(){return y()?.type===Me.Season},get children(){const G=l_();return o(G,r(_n,{get store(){return u.bind(ee)}})),G}}),Ce),o(Ce,r(_n,{get store(){return f.bind(ee)}})),se})()}})),L}})),oe(L=>pt(b,{"overflow-y-auto absolute top-0 right-0 w-full min-h-[180px] rounded-sm bg-slate-200 border border-2":!0,"border-green-500 border-dash":V().hovering},L)),S})(),(()=>{const S=s_(),A=S.firstChild;return o(A,r(U,{store:$,children:"上传"})),S})()]}}),r(ve,{store:m,get children(){const S=$n();return o(S,r(fs,{store:g})),S}}),r(ve,{store:v,get children(){const S=$n();return o(S,r(rn,{store:w})),S}}),r(ve,{store:k,get children(){const S=$n();return o(S,r(Jv,{store:O})),S}}),r(ve,{store:T,get children(){const S=n_(),A=S.firstChild;return o(A,r(Mt,{class:"w-8 h-8 animate animate-spin"})),S}})]};Pe(["click"]);const c_=h('<h1 class="text-2xl">字幕列表'),d_=h('<div class="mt-8 flex space-x-2">'),u_=h('<div class="space-y-4">'),h_=h('<div class="w-[520px]"><div>该操作会同步删除字幕文件</div><div>请确认后删除'),f_=h('<div class="p-4 rounded-sm bg-white"><div><div class="flex space-x-4"></div><div class="flex space-x-2">'),p_=h('<div><div class="flex flex-1"><div class="flex-1 ml-4 w-full"><div class="text-xl"></div><div class="overflow-y-auto mt-4 w-full max-h-[320px] space-y-4">'),m_=h('<div><div class="text-lg">、</div><div class="ml-4 mt-2 text-sm text-gray-600">'),g_=h('<div class="flex items-center space-x-2"><div></div><div></div><div class="text-sm"></div><div>'),v_=t=>{const{app:e,history:s,view:n}=t,i=new Fe,l=new Fe,a=new Fe,c=new Oe(new I(Ma),{}),d=new I(Ta,{onLoading($){u.okBtn.setLoading($)},onSuccess(){e.tip({text:["删除成功"]}),u.hide();const $=i.value?.id,E=l.value?.id,_=a.value?.id;c.modifyDataSource(k=>{if(k.id!==$)return k;const{sources:T}=k;return{...k,episodes:T.map(O=>O.id!==E?O:{...O,subtitles:O.subtitles.filter(F=>F.id!==_)})}}),i.clear(),l.clear(),a.clear()},onFailed($){e.tip({text:["删除失败",$.message]})}}),u=new ge({title:"删除字幕",onOk(){a.value&&d.run({subtitle_id:a.value.id})}}),f=new Q({onClick(){Xs(),c.refresh()}}),p=new Q({onClick(){s.push("root.home_layout.subtitles_create")}}),m=new Ue,g=new Ze({}),[C,v]=z(c.response);c.onLoadingChange($=>{f.setLoading($)}),c.onStateChange($=>{v($)}),m.onReachBottom(async()=>{await c.loadMore(),m.finishLoadingMore()}),c.init(),ct.TV+"",ct.Movie+"",ct.Question+"",ct.Want+"";const w=()=>C().dataSource;return[r(We,{store:m,class:"h-screen p-8",get children(){return[c_(),(()=>{const $=d_();return o($,r(U,{class:"space-x-1",get icon(){return r(xt,{class:"w-4 h-4"})},store:f,children:"刷新"}),null),o($,r(U,{class:"space-x-1",store:p,children:"新增"}),null),$})(),r(Ye,{class:"mt-4",store:c,get skeleton(){return(()=>{const $=f_(),E=$.firstChild,_=E.firstChild,k=_.nextSibling;return o(E,r(j,{class:"w-[240px] h-8"}),_),o(_,r(j,{class:"w-[320px] h-4"})),o(k,r(j,{class:"w-24 h-8"}),null),o(k,r(j,{class:"w-24 h-8"}),null),oe(()=>be(E,de("space-y-1"))),$})()},get children(){const $=u_();return o($,r(ie,{get each(){return w()},children:(E,_)=>{const{id:k,name:T,poster_path:O,sources:F}=E;return(()=>{const x=p_(),V=x.firstChild,N=V.firstChild,y=N.firstChild,R=y.nextSibling;return o(V,r(je,{class:"w-[120px] h-[180px] self-start object-cover",get store(){return g.bind(O)}}),N),o(y,T),o(R,r(ie,{each:F,children:M=>{const{id:J,name:S,order:A,subtitles:B}=M;return(()=>{const H=m_(),b=H.firstChild,L=b.firstChild,W=b.nextSibling;return o(b,A,L),o(b,S,null),o(W,r(ie,{each:B,children:D=>{const{id:K,unique_id:te,language:ee}=D;return(()=>{const se=g_(),he=se.firstChild,ae=he.nextSibling,fe=ae.nextSibling,le=fe.nextSibling;return o(he,r(Gi,{class:"w-4 h-4"})),o(ae,te),o(fe,ee),le.$$click=()=>{i.select(E),l.select(M),a.select(D),u.show()},o(le,r(Dt,{class:"w-4 h-4 cursor-pointer"})),se})()}})),oe(()=>b.classList.toggle("text-gray-200",B.length===0)),H})()}})),oe(()=>be(x,de("space-y-1 flex p-4 rounded-sm bg-white"))),x})()}})),$}})]}}),r(ve,{store:u,get children(){return h_()}})]};Pe(["click"]);const __=h('<h1 class="text-2xl">资源查询记录'),$_=h('<div class="mt-8"><div class="flex items-center space-x-2 mt-4"></div><div class="mt-8 space-y-4">'),w_=h('<div class="py-4"><p></p><a target="_blank">'),x_=t=>{const e=new Oe(new I(ba)),s=new Ue({async onReachBottom(){await e.loadMore(),s.finishLoadingMore()}}),n=new _e({defaultValue:"",onEnter(){i.click()}}),i=new Q({onClick(){e.search({name:n.value})}}),l=new Q({onClick(){e.reset()}}),[a,c]=z(Oe.defaultResponse());return e.onLoadingChange(d=>{i.setLoading(d)}),e.onStateChange(d=>{c(d)}),e.init(),r(We,{class:"h-screen p-8",store:s,get children(){return[__(),(()=>{const d=$_(),u=d.firstChild,f=u.nextSibling;return o(u,r(Le,{class:"",store:n}),null),o(u,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:i,children:"搜索"}),null),o(u,r(U,{class:"",store:l,children:"重置"}),null),o(f,r(ie,{get each(){return a().dataSource},children:p=>{const{id:m,url:g,title:C}=p;return(()=>{const v=w_(),w=v.firstChild,$=w.nextSibling;return o(w,C),xe($,"href",g),o($,g),v})()}})),d})()]}})},b_=h('<h1 class="text-2xl">转存记录'),C_=h('<div class="mt-8"><div class="flex items-center space-x-2 mt-4"></div><div class="mt-8 space-y-4">'),S_=h('<div class="py-4"><div class="text-lg"></div><div class="text-slate-800"><a target="_blank"></a></div><div class="text-sm text-slate-500">'),y_=t=>{const{app:e}=t,s=new Oe(new I(Ca)),n=new Ue({async onReachBottom(){await s.loadMore(),n.finishLoadingMore()}}),i=new _e({defaultValue:"",onEnter(){l.click()}}),l=new Q({onClick(){const u=i.value;if(!u.match(/\/s\/([a-zA-Z0-9]{1,})$/)){e.tip({text:["不是合法阿里云盘链接"]});return}s.search({name:u})}}),a=new Q({onClick(){s.reset()}}),[c,d]=z(Oe.defaultResponse());return s.onStateChange(u=>{d(u)}),s.init(),r(We,{class:"h-screen p-8",store:n,get children(){return[b_(),(()=>{const u=C_(),f=u.firstChild,p=f.nextSibling;return o(f,r(Le,{class:"",store:i}),null),o(f,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:l,children:"搜索"}),null),o(f,r(U,{class:"",store:a,children:"重置"}),null),o(p,r(ie,{get each(){return c().dataSource},children:m=>{const{id:g,url:C,name:v,created:w}=m;return(()=>{const $=S_(),E=$.firstChild,_=E.nextSibling,k=_.firstChild,T=_.nextSibling;return o(E,v),xe(k,"href",C),o(k,C),o(T,w),$})()}})),u})()]}})};var Rn=function(t){return t[t.StateChange=0]="StateChange",t[t.Change=1]="Change",t}(Rn||{});class k_ extends $e{ref=new Fe;get value(){return this.ref.value}constructor(e){super(e),this.ref.onStateChange(s=>{this.emit(Rn.Change,s)})}select(e){this.ref.select(e)}onChange(e){return this.on(Rn.Change,e)}}const L_=h('<div><div class="mt-2 space-y-4 h-[320px] overflow-y-auto">'),P_=h('<div><div class="py-2"><div class="text-xl"></div></div><div class="text-slate-500 text-sm">/'),R_=t=>{const{store:e}=t;new ge;const[s,n]=z(He.response),[i,l]=z(e.ref.value);return He.onStateChange(a=>n(a)),e.onChange(a=>{l(a)}),He.initAny(),(()=>{const a=L_(),c=a.firstChild;return o(c,r(ie,{get each(){return s().dataSource},children:d=>{const{id:u,name:f,state:p}=d;return(()=>{const m=P_(),g=m.firstChild,C=g.firstChild,v=g.nextSibling,w=v.firstChild;return m.$$click=()=>{e.select(d)},o(C,f),o(v,()=>p.used_size,w),o(v,()=>p.total_size,null),oe($=>pt(m,{"bg-gray-100 border rounded-sm p-2 cursor-pointer hover:bg-gray-200":!0,"border-green-500":i()?.id===u},$)),m})()}})),a})()};Pe(["click"]);const D_=h('<div class="inline-block ml-4">全部云盘'),M_=h('<div class="space-y-4">'),T_=h('<div class="relative"><div class="flex items-center space-x-1"><div class="p-1 cursor-pointer"></div><h1 class="text-2xl">影视剧列表(<!>)</div><div class="mt-8"><div class="flex items-center space-x-2 mt-4"></div><div class="flex items-center mt-4"></div><div class="flex items-center space-x-2"></div><div class="mt-4">'),B_=h('<div class=""><div></div><div><div></div><div class="absolute left-0 bottom-4 w-full text-center">%</div></div><div>/</div><div>'),E_=h('<div class="fixed right-12 top-12 rounded-sm bg-white p-4 shadow-xl">'),F_=h('<div class="fixed right-12 bottom-12 rounded-sm bg-white p-4 shadow-xl"><div class="flex flex-col items-center cursor-pointer"><div class="p-2">'),O_=h('<div class="w-[520px]">'),I_=h('<div><div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="flex-1 p-4"><div class="mt-2 space-y-1"></div><div class="flex items-center space-x-4 mt-2"></div><div class="flex space-x-2 mt-6">'),V_=h('<div class="flex items-center space-x-1 px-2 border border-blue-600 rounded-xl text-blue-600"><div>/'),A_=h('<div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="flex-1 w-0 p-4"><div class="flex items-center"><h2 class="text-2xl text-slate-800"></div><div class="mt-2 overflow-hidden text-ellipsis"></div><div class="mt-2 overflow-hidden text-ellipsis"></div><div class="flex items-center space-x-4 mt-2 break-keep overflow-hidden"></div><div class="flex items-center space-x-2 mt-4 p-1 overflow-hidden whitespace-nowrap"></div><div class="mt-6 space-y-4">'),z_=h('<div class="flex items-center space-x-1 px-2 border border-green-600 rounded-xl text-green-600"><div>全<!>集'),N_=h('<div class="text-lg">、'),H_=h("<div><div>"),q_=h('<div class="mt-2"><div class="flex items-center"><div></div></div><div>'),j_=h('<div class="flex items-center text-slate-500"><div class="break-all">/<span class="p-1 cursor-pointer">'),U_=h('<div class="flex space-x-2">'),W_=t=>{const{app:e,history:s,view:n}=t,i=new Oe(new I(zu,{process:Nu}),{pageSize:1,onLoadingChange(S){T.setLoading(S),O.setLoading(S)}}),l=new I(Hu,{process:qu}),a=new I(Uu,{onSuccess(S){it({job_id:S.job_id,onFinish(){const A=i.response.dataSource[0];if(!A)return;const{name:B}=A;e.tip({text:[`「${B}」移动到资源盘成功`]}),v(A),C.setLoading(!1)}})},onFailed(S){C.setLoading(!1),e.tip({text:["移动失败",S.message]})}}),c=new I(Kr,{beforeRequest(){e.tip({text:["开始归档，请等待一段时间"]}),$.setLoading(!0)},onSuccess(S){it({job_id:S.job_id,async onFinish(){if($.setLoading(!1),!u.value)return;const{name:A}=u.value;e.tip({text:[`完成「${A}」归档`]}),f.value&&(await f.value.refresh(),R(f.value.state)),v(u.value)}})},onFailed(S){$.setLoading(!1),e.tip({text:["归档失败",S.message]})}}),d=new I(sn,{onSuccess(){const S=p.value,A=m.value;if(!S||!A){e.tip({text:["删除成功，请刷新页面"]});return}i.modifyResponse(B=>({...B,dataSource:B.dataSource.map(H=>({...H,episodes:H.episodes.map(b=>b.id!==S.id?b:{...b,drives:b.drives.map(L=>({...L,sources:L.sources.filter(W=>W.id!==A.id)}))})}))})),e.tip({text:["删除成功"]})},onFailed(S){e.tip({text:["删除视频源失败",S.message]})}}),u=new Fe,f=new Fe;new Fe;const p=new Fe,m=new Fe,g=new bs({options:[],onChange(S){i.search({next_marker:"",drive_ids:S.join("|")})}}),C=new Ae({onClick(S){C.setLoading(!0),e.tip({text:["开始移动，请等待一段时间"]}),a.run({media_id:S.id})}});async function v(S){w.setLoading(!0);const A=await l.run({media_id:S.id});if(w.setLoading(!1),A.error){e.tip({text:["刷新失败"]});return}i.modifyDataSource(B=>B.id===S.id?A.data:B)}const w=new Ae({async onClick(S){v(S)}}),$=new Ae({onClick(S){if(u.select(S),!f.value){k.show();return}c.run({media_id:S.id,to_drive_id:f.value.id})}}),E=new Q({onClick(){if(!f.value){e.tip({text:["请先选择云盘"]});return}const S=f.value,A=s.buildURLWithPrefix("root.home_layout.drive_profile",{id:S.id,name:S.name});window.open(A,"black")}}),_=new Q({onClick(){k.show()}}),k=new ge({title:"选择云盘",onOk(){if(!F.value){e.tip({text:["请选择云盘"]});return}f.select(F.value),R(F.value.state),k.hide()}}),T=new _e({defaultValue:"",onEnter(){O.click()}}),O=new Q({onClick(){if(!T.value){e.tip({text:["请输入关键字"]});return}i.search({name:T.value})}}),F=new k_({}),x=new Ue({}),[V,N]=z(i.response),[y,R]=z(null),[M,J]=z(He.response);return He.onStateChange(S=>{const A=S.dataSource.map(B=>{const{name:H,id:b}=B;return{value:b,label:H}});g.setOptions(A),J(S)}),i.onStateChange(S=>{N(S)}),i.init(),He.initAny(),[r(We,{class:"h-screen p-8 bg-white",store:x,get children(){const S=T_(),A=S.firstChild,B=A.firstChild,H=B.nextSibling,b=H.firstChild,L=b.nextSibling;L.nextSibling;const W=A.nextSibling,D=W.firstChild,K=D.nextSibling,te=K.nextSibling,ee=te.nextSibling;return B.$$click=()=>{s.back()},o(B,r(hs,{class:"w-6 h-6"})),o(H,()=>V().total,L),o(D,r(Le,{class:"",store:T}),null),o(D,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:O,children:"搜索"}),null),o(K,r(Ts,{store:g}),null),o(K,r(X,{get when(){return!M().noMore},get children(){const se=D_();return se.$$click=()=>{He.loadMore()},se}}),null),o(ee,r(Ye,{store:i,get skeleton(){return(()=>{const se=I_(),he=se.firstChild,ae=he.firstChild,fe=ae.firstChild,le=fe.firstChild,ce=le.nextSibling,Ce=ce.nextSibling;return o(fe,r(j,{class:"h-[36px] w-[180px]"}),le),o(le,r(j,{class:"h-[24px] w-[120px]"}),null),o(le,r(j,{class:"h-[24px] w-[240px]"}),null),o(ce,r(j,{class:"w-10 h-6"}),null),o(ce,r(j,{class:"w-10 h-6"}),null),o(ce,r(j,{class:"w-10 h-6"}),null),o(Ce,r(j,{class:"w-24 h-8"}),null),o(Ce,r(j,{class:"w-24 h-8"}),null),se})()},get children(){const se=M_();return o(se,r(ie,{get each(){return V().dataSource},children:he=>{const{id:ae,type:fe,name:le,air_date:ce,cur_episode_count:Ce,can_archive:G,need_to_resource:re,size_count_text:me,episode_count:pe,episodes:Re,drives:Te}=he;return(()=>{const ze=A_(),Se=ze.firstChild,q=Se.firstChild,Z=q.firstChild,ne=Z.firstChild,ue=Z.nextSibling,we=ue.nextSibling,De=we.nextSibling,ye=De.nextSibling,Ie=ye.nextSibling;return o(ne,le),o(ue,ce),o(we,me),o(De,r(X,{get when(){return fe===Me.Season},get children(){return r(X,{when:Ce!==pe,get fallback(){return(()=>{const ke=z_(),Be=ke.firstChild,Ee=Be.firstChild,Je=Ee.nextSibling;return Je.nextSibling,o(ke,r(Ws,{class:"w-4 h-4"}),Be),o(Be,pe,Je),ke})()},get children(){const ke=V_(),Be=ke.firstChild,Ee=Be.firstChild;return o(ke,r(Jt,{class:"w-4 h-4"}),Be),o(Be,Ce,Ee),o(Be,pe,null),ke}})}})),o(ye,r(U,{get store(){return w.bind(he)},get icon(){return r(Zt,{class:"w-4 h-4"})},variant:"subtle"}),null),o(ye,r(X,{when:G,get children(){return r(U,{get store(){return $.bind(he)},variant:"subtle",children:"归档"})}}),null),o(ye,r(X,{when:re,get children(){return r(U,{get store(){return C.bind(he)},variant:"subtle",children:"移动到资源盘"})}}),null),o(Ie,r(ie,{each:Re,children:ke=>{const{name:Be,episode_number:Ee,drives:Je}=ke;return(()=>{const Ve=H_(),et=Ve.firstChild;return o(Ve,r(X,{get when(){return fe===Me.Season},get children(){const Ne=N_(),Ge=Ne.firstChild;return o(Ne,Ee,Ge),o(Ne,Be,null),Ne}}),et),o(et,r(ie,{each:Je,children:Ne=>{const{id:Ge,name:ut,sources:vt}=Ne;return(()=>{const _t=q_(),$t=_t.firstChild,Tt=$t.firstChild,Bt=$t.nextSibling;return o(Tt,ut),o(Bt,r(ie,{each:vt,children:Et=>{const{file_id:ps,file_name:ms,parent_paths:es}=Et;return(()=>{const gs=j_(),vs=gs.firstChild,_s=vs.firstChild,ts=_s.nextSibling;return o(vs,es,_s),o(vs,ms,ts),ts.$$click=()=>{p.select(ke),m.select(Et),d.run({parsed_media_source_id:Et.id})},o(ts,r(Dt,{class:"inline-block w-4 h-4"})),gs})()}})),_t})()}})),Ve})()}})),ze})()}})),se}})),S}}),(()=>{const S=E_();return o(S,r(X,{get when(){return y()},get fallback(){return(()=>{const A=U_();return o(A,r(U,{store:_,children:"选择目标云盘"})),A})()},get children(){const A=B_(),B=A.firstChild,H=B.nextSibling,b=H.firstChild,L=b.nextSibling,W=L.firstChild,D=H.nextSibling,K=D.firstChild,te=D.nextSibling;return o(B,()=>y()?.name),pt(H,{"relative w-full h-[240px] bg-state-500":!0}),o(L,()=>y()?.used_percent||0,W),o(D,()=>y()?.used_size,K),o(D,()=>y()?.total_size,null),o(te,r(U,{store:_,get icon(){return r(ao,{class:"w-4 h-4"})},variant:"subtle"}),null),o(te,r(U,{store:E,get icon(){return r(Tn,{class:"w-4 h-4"})},variant:"subtle"}),null),oe(ee=>{const se={"absolute w-full bottom-0 bg-green-500":!0,"bg-yellow-500":(y()?.used_percent||0)>=70,"bg-red-500":(y()?.used_percent||0)>=90},he=`${y()?.used_percent||0}%`;return ee._v$=pt(b,se,ee._v$),he!==ee._v$2&&((ee._v$2=he)!=null?b.style.setProperty("height",he):b.style.removeProperty("height")),ee},{_v$:void 0,_v$2:void 0}),A}})),S})(),r(X,{get when(){return!V().noMore},get children(){const S=F_(),A=S.firstChild,B=A.firstChild;return A.$$click=()=>{const H=i.response.next_marker;i.params.next_marker=H,i.next()},o(B,r(X,{get when(){return V().loading},get fallback(){return r(co,{class:"w-12 h-12"})},get children(){return r(Mt,{class:"w-12 h-12 animate animate-spin"})}})),S}}),r(ve,{store:k,get children(){const S=O_();return o(S,r(R_,{store:F})),S}})]};Pe(["click"]);const Y_=h('<h1 class="text-2xl">集合列表'),G_=h('<div class="space-y-4">'),J_=h('<div class="mt-8"><div class="flex items-center space-x-2"></div><div class="flex items-center space-x-2 mt-4"></div><div class="mt-4">'),K_=h('<div class="w-[520px]"><div>确认删除该集合吗？'),X_=h('<div><div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 p-4"><div class="mt-2 space-y-1"></div><div class="flex items-center space-x-4 mt-2"></div><div class="flex space-x-2 mt-6">'),Q_=h('<div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="flex-1 w-0 p-4"><h2 class="text-2xl text-slate-800"></h2><div class="mt-2 flex flex-wrap space-x-2"></div><div class="space-x-2 mt-6">'),Z_=h('<div><div class="w-[78px]"><div class="mt-2">'),e$=t=>{const{app:e,history:s,view:n}=t,i=new Oe(new I(qg),{onLoadingChange(_){d.setLoading(_),u.setLoading(_),f.setLoading(_)}}),l=new I(Gg,{onLoading(_){m.okBtn.setLoading(_)},onSuccess(){e.tip({text:["删除成功"]}),m.hide();const _=a.value;_&&i.deleteItem(k=>k.id===_.id)},onFailed(_){e.tip({text:["删除失败",_.message]})}}),a=new Fe,c=new _e({defaultValue:"",placeholder:"请输入名称搜索",onEnter(){d.click()}}),d=new Q({onClick(){i.search({name:c.value})}}),u=new Q({onClick(){i.reset(),c.clear()}}),f=new Q({onClick(){i.refresh()}}),p=new Ae({onClick(_){s.push("root.home_layout.collection_edit",{id:_.id})}}),m=new ge({title:"删除集合",onOk(){a.value&&l.run({collection_id:a.value.id})}}),g=new Ae({onClick(_){a.select(_),m.show()}}),C=new Q({onClick(){s.push("root.home_layout.collection_create")}}),v=new Ze({}),w=new Ue,[$,E]=z(i.response);return n.onShow(()=>{const{deleteMovie:_}=Rs;_&&(Qn("deleteMovie"),i.deleteItem(k=>k.id===_.movie_id))}),w.onReachBottom(async()=>{await i.loadMore(),w.finishLoadingMore()}),i.onStateChange(_=>{E(_)}),i.init(),He.initAny(),[r(We,{store:w,class:"h-screen p-8",get children(){return[Y_(),(()=>{const _=J_(),k=_.firstChild,T=k.nextSibling,O=T.nextSibling;return o(k,r(U,{class:"space-x-1",get icon(){return r(xt,{class:"w-4 h-4"})},store:f,children:"刷新"}),null),o(k,r(U,{class:"",store:u,children:"重置"}),null),o(k,r(U,{class:"space-x-1",store:C,children:"新增集合"}),null),o(T,r(Le,{class:"",store:c}),null),o(T,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:d,children:"搜索"}),null),o(O,r(Ye,{store:i,get skeleton(){return(()=>{const F=X_(),x=F.firstChild,V=x.firstChild,N=V.firstChild,y=N.nextSibling,R=y.firstChild,M=R.nextSibling,J=M.nextSibling;return o(N,r(j,{class:"w-[180px] h-[272px]"})),o(y,r(j,{class:"h-[36px] w-[180px]"}),R),o(R,r(j,{class:"h-[24px] w-[120px]"}),null),o(R,r(j,{class:"h-[24px] w-[240px]"}),null),o(M,r(j,{class:"w-10 h-6"}),null),o(M,r(j,{class:"w-10 h-6"}),null),o(M,r(j,{class:"w-10 h-6"}),null),o(J,r(j,{class:"w-24 h-8"}),null),o(J,r(j,{class:"w-24 h-8"}),null),F})()},get children(){const F=G_();return o(F,r(ie,{get each(){return $().dataSource},children:x=>{const{id:V,title:N,desc:y,medias:R}=x;return(()=>{const M=Q_(),J=M.firstChild,S=J.firstChild,A=S.firstChild,B=A.nextSibling,H=B.nextSibling;return o(A,N),o(B,r(ie,{each:R,children:b=>{const{id:L,name:W,poster_path:D}=b;return(()=>{const K=Z_(),te=K.firstChild,ee=te.firstChild;return o(te,r(je,{class:"w-full rounded-sm",get store(){return v.bind(D)}}),ee),o(ee,W),K})()}})),o(H,r(U,{get store(){return p.bind(x)},variant:"subtle",get icon(){return r(Es,{class:"w-4 h-4"})},children:"编辑"}),null),o(H,r(U,{get store(){return g.bind(x)},variant:"subtle",get icon(){return r(Es,{class:"w-4 h-4"})},children:"删除"}),null),M})()}})),F}})),_})()]}}),r(ve,{store:m,get children(){return K_()}})]},t$=h('<div class="grid gap-2 grid-cols-6">'),s$=h('<div class="flex mt-2 space-x-2"><div class="cursor-pointer"></div><div class="cursor-pointer">'),n$=h('<div class="h-screen p-8"><h1 class="text-2xl">编辑集合</h1><div class="w-[520px] mx-auto"><div class="space-y-4"><div class="space-y-2"><div>标题</div></div><div class="space-y-2"><div>描述</div></div><div class="space-y-2"><div>排序</div></div><div class="space-y-2"><div>类型</div></div><div class="space-y-2"><div>内容</div><div></div></div></div><div class="mt-12">'),Ni=h('<div class="w-[520px]">'),i$=h('<div class="flex space-x-2"><div class="cursor-pointer"></div><div class="cursor-pointer">'),r$=h('<div class="relative"><div class=""></div><div class="mt-2"><div></div></div><div class="absolute z-10 right-0 top-0 p-1 rounded-full bg-white cursor-pointer">'),l$=t=>{const{app:e,view:s}=t,n=new fl({}),i=new Ze({}),l=new Q({onClick(){n.edit(s.query.id)}}),[a,c]=z(n.state);return n.onStateChange(d=>{c(d)}),n.onLoading(d=>{l.setLoading(d)}),n.onTip(d=>{e.tip(d)}),n.profileRequest.run({collection_id:s.query.id}),[(()=>{const d=n$(),u=d.firstChild,f=u.nextSibling,p=f.firstChild,m=p.firstChild;m.firstChild;const g=m.nextSibling;g.firstChild;const C=g.nextSibling;C.firstChild;const v=C.nextSibling;v.firstChild;const w=v.nextSibling,$=w.firstChild,E=$.nextSibling,_=p.nextSibling;return o(m,r(Le,{get store(){return n.fields.title}}),null),o(g,r(gt,{get store(){return n.fields.desc}}),null),o(C,r(Le,{get store(){return n.fields.sort}}),null),o(v,r(hl,{get store(){return n.fields.type}}),null),o(E,r(X,{get when(){return a().medias.length},get fallback(){return(()=>{const k=i$(),T=k.firstChild,O=T.nextSibling;return T.$$click=()=>{n.seasonSelectDialog.show()},o(T,r(Fs,{class:"w-4 h-4"})),O.$$click=()=>{n.movieSelectDialog.show()},o(O,r(Gt,{class:"w-4 h-4"})),k})()},get children(){return[(()=>{const k=t$();return o(k,r(ie,{get each(){return a().medias},children:T=>{const{id:O,name:F,poster_path:x}=T;return(()=>{const V=r$(),N=V.firstChild,y=N.nextSibling,R=y.firstChild,M=y.nextSibling;return o(N,r(je,{class:"w-[78px] rounded-sm",get store(){return i.bind(x)}})),o(R,F),M.$$click=()=>{n.removeMedia(T)},o(M,r(ys,{class:"w-2 h-2"})),V})()}})),k})(),(()=>{const k=s$(),T=k.firstChild,O=T.nextSibling;return T.$$click=()=>{n.seasonSelectDialog.show()},o(T,r(Fs,{class:"w-4 h-4"})),O.$$click=()=>{n.movieSelectDialog.show()},o(O,r(Gt,{class:"w-4 h-4"})),k})()]}})),o(_,r(U,{store:l,children:"提交"})),d})(),r(ve,{get store(){return n.seasonSelectDialog},get children(){const d=Ni();return o(d,r(fs,{get store(){return n.seasonSelect}})),d}}),r(ve,{get store(){return n.movieSelectDialog},get children(){const d=Ni();return o(d,r(rn,{get store(){return n.movieSelect}})),d}})]};Pe(["click"]);const o$=h('<h1 class="text-2xl">待处理问题列表(<!>)'),a$=h('<div class="space-y-4">'),c$=h('<div class="mt-8"><div class="flex items-center space-x-2"></div><div class="flex items-center space-x-2 mt-4"></div><div class="mt-4">'),d$=h('<div><div class="rounded-md border border-slate-300 bg-white shadow-sm"><div class="flex"><div class="overflow-hidden mr-2 rounded-sm"></div><div class="flex-1 p-4"><div class="mt-2 space-y-1"></div><div class="flex items-center space-x-4 mt-2"></div><div class="flex space-x-2 mt-6">'),u$=h("<div>未知"),h$=h("<div>电视剧问题"),f$=h("<div>季问题"),p$=h("<div>剧集问题"),m$=h("<div>电影问题"),g$=h("<div>重复剧集详情"),v$=h("<div>重复季详情"),_$=h("<div>重复电视剧详情"),$$=h("<div>重复电影详情"),w$=h('<div class="mt-4">'),x$=h('<div class="p-4 bg-white"><a class="inline-flex mt-2" target="_blank"><div><div class="text-xl"></div><div class="text-sm"></div><div class="mt-4"></div></div></a><div class="mt-4 space-y-1">'),b$=h('<div class="flex items-center text-sm"><div class="mr-1 text-red-500"></div><div>'),C$=t=>{const{app:e,history:s,view:n}=t,i=new Oe(new I(ju),{onLoadingChange(v){d.setLoading(v),u.setLoading(v),p.setLoading(v)}}),l=new I(Ps);new Fe;const a=new Ae({async onClick(v){a.setLoading(!0);const w=await l.run({media_id:v.media.id});a.setLoading(!1),!w.error&&(e.tip({text:["删除成功"]}),i.deleteItem($=>$.id===v.id))}}),c=new _e({defaultValue:"",placeholder:"请输入名称搜索",onEnter(){d.click()}}),d=new Q({onClick(){i.search({name:c.value})}}),u=new Q({onClick(){i.reset(),c.clear()}}),f=new Ze,p=new Q({onClick(){i.refresh()}}),m=new Ue,[g,C]=z(i.response);return m.onReachBottom(async()=>{await i.loadMore(),m.finishLoadingMore()}),i.onStateChange(v=>C(v)),i.init(),r(We,{store:m,class:"h-screen p-8",get children(){return[(()=>{const v=o$(),w=v.firstChild,$=w.nextSibling;return $.nextSibling,o(v,()=>g().total,$),v})(),(()=>{const v=c$(),w=v.firstChild,$=w.nextSibling,E=$.nextSibling;return o(w,r(U,{class:"space-x-1",get icon(){return r(xt,{class:"w-4 h-4"})},store:p,children:"刷新"}),null),o(w,r(U,{class:"",store:u,children:"重置"}),null),o($,r(Le,{class:"",store:c}),null),o($,r(U,{class:"",get icon(){return r(ot,{class:"w-4 h-4"})},store:d,children:"搜索"}),null),o(E,r(Ye,{store:i,get skeleton(){return(()=>{const _=d$(),k=_.firstChild,T=k.firstChild,O=T.firstChild,F=O.nextSibling,x=F.firstChild,V=x.nextSibling,N=V.nextSibling;return o(O,r(j,{class:"w-[180px] h-[272px]"})),o(F,r(j,{class:"h-[36px] w-[180px]"}),x),o(x,r(j,{class:"h-[24px] w-[120px]"}),null),o(x,r(j,{class:"h-[24px] w-[240px]"}),null),o(V,r(j,{class:"w-10 h-6"}),null),o(V,r(j,{class:"w-10 h-6"}),null),o(V,r(j,{class:"w-10 h-6"}),null),o(N,r(j,{class:"w-24 h-8"}),null),o(N,r(j,{class:"w-24 h-8"}),null),_})()},get children(){const _=a$();return o(_,r(ie,{get each(){return g().dataSource},children:k=>{const{id:T,type:O,media:F,tips:x}=k,V={[St.Unknown]:u$(),[St.TV]:h$(),[St.Season]:f$(),[St.Episode]:p$(),[St.Movie]:m$(),[St.EpisodeProfile]:g$(),[St.SeasonProfile]:v$(),[St.TVProfile]:_$(),[St.MovieProfile]:$$()},N=(()=>{const J=w$();return o(J,r(U,{get store(){return a.bind(k)},children:"删除"})),J})(),{name:y,poster_path:R}=F,M=(()=>F.type===Me.Season?s.buildURLWithPrefix("root.home_layout.season_profile",{id:F.id}):F.type===Me.Movie?s.buildURLWithPrefix("root.home_layout.movie_profile",{id:F.id}):s.buildURLWithPrefix("root.notfound"))();return(()=>{const J=x$(),S=J.firstChild,A=S.firstChild,B=A.firstChild,H=B.nextSibling,b=H.nextSibling,L=S.nextSibling;return xe(S,"href",M),o(S,r(je,{class:"w-[80px] h-[120px] mr-2",get store(){return f.bind(R)},alt:y}),A),o(B,y),o(H,T),o(b,()=>V[O]),o(L,r(ie,{each:x,children:W=>(()=>{const D=b$(),K=D.firstChild,te=K.nextSibling;return o(K,r(Bs,{class:"w-4 h-4"})),o(te,W),D})()})),o(J,N,null),J})()}})),_}})),v})()]}})},Hi={"root.home_layout":$u,"root.home_layout.index":Iu,"root.home_layout.drive_list":Np,"root.home_layout.drive_profile":mm,"root.home_layout.season_list":Ch,"root.home_layout.season_profile":hf,"root.home_layout.movie_list":Jm,"root.home_layout.movie_profile":sg,"root.home_layout.invalid_media_list":C$,"root.home_layout.permission":Nv,"root.home_layout.person_list":Gp,"root.home_layout.parse_result_layout":mf,"root.home_layout.parse_result_layout.movie":bf,"root.home_layout.parse_result_layout.season":Tf,"root.home_layout.parse_result_layout.episode":hg,"root.home_layout.member_list":Pv,"root.home_layout.resource_sync":Og,"root.home_layout.job_list":Uf,"root.home_layout.job_profile":dp,"root.home_layout.transfer":Vm,"root.home_layout.transfer_history_list":y_,"root.home_layout.transfer_search_list":x_,"root.home_layout.report_list":Ov,"root.home_layout.collection_list":e$,"root.home_layout.collection_create":tv,"root.home_layout.collection_edit":l$,"root.home_layout.subtitles_list":v_,"root.home_layout.subtitles_create":a_,"root.archive":W_,"root.preview":rg,"root.login":Ef,"root.register":Of,"root.notfound":Vf},S$=h('<div class="fixed z-[99] left-[50%] translate-x-[-50%] top-60 w-120 h-120 ">'),y$=t=>t.children,k$=t=>{const{store:e}=t;return r(At,{get store(){return e.present},get children(){return r(js,{get children(){return t.children}})}})},L$=t=>{const{store:e,enterClassName:s,exitClassName:n}=t;return(()=>{const i=S$();return o(i,r(At,{get store(){return e.present},get class(){return de(t.class)},enterClassName:s,exitClassName:n,get children(){return t.children}})),i})()},P$=h('<div class="text-center">'),R$=t=>{const{store:e}=t,[s,n]=z(e.state);return e.onStateChange(i=>{n(i)}),r(y$,{store:e,get children(){return r(k$,{store:e,get children(){return r(L$,{store:e,get class(){return de("grid gap-4 rounded-b-lg bg-black text-white p-6 duration-200 sm:max-w-lg sm:rounded-lg","dark:bg-slate-900")},enterClassName:"animate-in fade-in-90 sm:zoom-in-90",exitClassName:"animate-out fade-out",get children(){return r(ie,{get each(){return s().texts},children:i=>(()=>{const l=P$();return o(l,i),l})()})}})}})}})};const D$=h('<div class="flex items-center justify-center w-full h-full"><div class="flex flex-col items-center text-slate-500"><div class="mt-4 text-center">正在加载'),M$=h('<div class="screen w-screen h-screen overflow-hidden">');function T$(){const t=Qe.$view,e=new zo,[s,n]=z(rt.state),[i,l]=z(t.subViews);return rt.onStateChange(a=>{n(a)}),t.onSubViewsChange(a=>{l(a)}),rt.onTip(a=>{const{text:c}=a;e.show({texts:c})}),tt(()=>{const{innerWidth:a,innerHeight:c,location:d}=window;Qe.$router.prepare(d),rt.start({width:a,height:c})}),(()=>{const a=M$();return o(a,r(X,{get when(){return!s().ready},get children(){const c=D$(),d=c.firstChild,u=d.firstChild;return o(d,r(Hs,{class:"w-8 h-8 animate-spin"}),u),c}}),null),o(a,r(X,{get when(){return i().length!==0},get children(){return r(ie,{get each(){return i()},children:(c,d)=>{const u=c.name,f=Hi[u];return r(Un,{class:"absolute inset-0 opacity-100 dark:bg-black",store:c,get index(){return d()},get children(){return r(f,{app:rt,history:Qe,storage:bt,pages:Hi,client:Nt,view:c})}})}})}}),null),o(a,r(R$,{store:e}),null),a})()}const B$=document.getElementById("root");uo(()=>r(T$,{}),B$);
